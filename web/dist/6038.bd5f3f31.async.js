/*! For license information please see 6038.bd5f3f31.async.js.LICENSE.txt */
(self.webpackChunkweb=self.webpackChunkweb||[]).push([[6038],{47736:function(t,e,n){"use strict";n.d(e,{Ct:function(){return In},Zt:function(){return re},Hd:function(){return Xn},C9:function(){return f},MD:function(){return O},kJ:function(){return ac},bG:function(){return E},aH:function(){return hs},z2:function(){return Gl},zs:function(){return un},RN:function(){return hc}});var i={};n.r(i),n.d(i,{circle:function(){return Fi},diamond:function(){return Zi},rect:function(){return Vi},simple:function(){return Hi},triangle:function(){return _i},triangleRect:function(){return Wi},vee:function(){return $i}});var s=n(1242),o=n(77716),r=n(95147),a=n(30335),l=n(4637);const h={duration:500},c={duration:1e3,easing:"cubic-bezier(0.250, 0.460, 0.450, 0.940)",iterations:1,fill:"both"};var d,u,p,g,f,y,m,v,b,E;!function(t){t.NodeAdded="NodeAdded",t.NodeUpdated="NodeUpdated",t.NodeRemoved="NodeRemoved",t.EdgeAdded="EdgeAdded",t.EdgeUpdated="EdgeUpdated",t.EdgeRemoved="EdgeRemoved",t.ComboAdded="ComboAdded",t.ComboUpdated="ComboUpdated",t.ComboRemoved="ComboRemoved"}(d||(d={})),function(t){t.DRAW="draw",t.COLLAPSE="collapse",t.EXPAND="expand",t.TRANSFORM="transform"}(u||(u={})),function(t){t.CLICK="canvas:click",t.DBLCLICK="canvas:dblclick",t.POINTER_OVER="canvas:pointerover",t.POINTER_LEAVE="canvas:pointerleave",t.POINTER_ENTER="canvas:pointerenter",t.POINTER_MOVE="canvas:pointermove",t.POINTER_OUT="canvas:pointerout",t.POINTER_DOWN="canvas:pointerdown",t.POINTER_UP="canvas:pointerup",t.CONTEXT_MENU="canvas:contextmenu",t.DRAG_START="canvas:dragstart",t.DRAG="canvas:drag",t.DRAG_END="canvas:dragend",t.DRAG_ENTER="canvas:dragenter",t.DRAG_OVER="canvas:dragover",t.DRAG_LEAVE="canvas:dragleave",t.DROP="canvas:drop",t.WHEEL="canvas:wheel"}(p||(p={})),function(t){t.CLICK="combo:click",t.DBLCLICK="combo:dblclick",t.POINTER_OVER="combo:pointerover",t.POINTER_LEAVE="combo:pointerleave",t.POINTER_ENTER="combo:pointerenter",t.POINTER_MOVE="combo:pointermove",t.POINTER_OUT="combo:pointerout",t.POINTER_DOWN="combo:pointerdown",t.POINTER_UP="combo:pointerup",t.CONTEXT_MENU="combo:contextmenu",t.DRAG_START="combo:dragstart",t.DRAG="combo:drag",t.DRAG_END="combo:dragend",t.DRAG_ENTER="combo:dragenter",t.DRAG_OVER="combo:dragover",t.DRAG_LEAVE="combo:dragleave",t.DROP="combo:drop"}(g||(g={})),function(t){t.CLICK="click",t.DBLCLICK="dblclick",t.POINTER_OVER="pointerover",t.POINTER_LEAVE="pointerleave",t.POINTER_ENTER="pointerenter",t.POINTER_MOVE="pointermove",t.POINTER_OUT="pointerout",t.POINTER_DOWN="pointerdown",t.POINTER_UP="pointerup",t.CONTEXT_MENU="contextmenu",t.DRAG_START="dragstart",t.DRAG="drag",t.DRAG_END="dragend",t.DRAG_ENTER="dragenter",t.DRAG_OVER="dragover",t.DRAG_LEAVE="dragleave",t.DROP="drop",t.KEY_DOWN="keydown",t.KEY_UP="keyup",t.WHEEL="wheel",t.PINCH="pinch"}(f||(f={})),function(t){t.KEY_DOWN="keydown",t.KEY_UP="keyup"}(y||(y={})),function(t){t.CLICK="edge:click",t.DBLCLICK="edge:dblclick",t.POINTER_OVER="edge:pointerover",t.POINTER_LEAVE="edge:pointerleave",t.POINTER_ENTER="edge:pointerenter",t.POINTER_MOVE="edge:pointermove",t.POINTER_OUT="edge:pointerout",t.POINTER_DOWN="edge:pointerdown",t.POINTER_UP="edge:pointerup",t.CONTEXT_MENU="edge:contextmenu",t.DRAG_ENTER="edge:dragenter",t.DRAG_OVER="edge:dragover",t.DRAG_LEAVE="edge:dragleave",t.DROP="edge:drop"}(m||(m={})),function(t){t.BEFORE_CANVAS_INIT="beforecanvasinit",t.AFTER_CANVAS_INIT="aftercanvasinit",t.BEFORE_SIZE_CHANGE="beforesizechange",t.AFTER_SIZE_CHANGE="aftersizechange",t.BEFORE_ELEMENT_CREATE="beforeelementcreate",t.AFTER_ELEMENT_CREATE="afterelementcreate",t.BEFORE_ELEMENT_UPDATE="beforeelementupdate",t.AFTER_ELEMENT_UPDATE="afterelementupdate",t.BEFORE_ELEMENT_DESTROY="beforeelementdestroy",t.AFTER_ELEMENT_DESTROY="afterelementdestroy",t.BEFORE_ELEMENT_TRANSLATE="beforeelementtranslate",t.AFTER_ELEMENT_TRANSLATE="afterelementtranslate",t.BEFORE_DRAW="beforedraw",t.AFTER_DRAW="afterdraw",t.BEFORE_RENDER="beforerender",t.AFTER_RENDER="afterrender",t.BEFORE_ANIMATE="beforeanimate",t.AFTER_ANIMATE="afteranimate",t.BEFORE_LAYOUT="beforelayout",t.AFTER_LAYOUT="afterlayout",t.BEFORE_STAGE_LAYOUT="beforestagelayout",t.AFTER_STAGE_LAYOUT="afterstagelayout",t.BEFORE_TRANSFORM="beforetransform",t.AFTER_TRANSFORM="aftertransform",t.BATCH_START="batchstart",t.BATCH_END="batchend",t.BEFORE_DESTROY="beforedestroy",t.AFTER_DESTROY="afterdestroy",t.BEFORE_RENDERER_CHANGE="beforerendererchange",t.AFTER_RENDERER_CHANGE="afterrendererchange"}(v||(v={})),function(t){t.UNDO="undo",t.REDO="redo",t.CANCEL="cancel",t.ADD="add",t.CLEAR="clear",t.CHANGE="change"}(b||(b={})),function(t){t.CLICK="node:click",t.DBLCLICK="node:dblclick",t.POINTER_OVER="node:pointerover",t.POINTER_LEAVE="node:pointerleave",t.POINTER_ENTER="node:pointerenter",t.POINTER_MOVE="node:pointermove",t.POINTER_OUT="node:pointerout",t.POINTER_DOWN="node:pointerdown",t.POINTER_UP="node:pointerup",t.CONTEXT_MENU="node:contextmenu",t.DRAG_START="node:dragstart",t.DRAG="node:drag",t.DRAG_END="node:dragend",t.DRAG_ENTER="node:dragenter",t.DRAG_OVER="node:dragover",t.DRAG_LEAVE="node:dragleave",t.DROP="node:drop"}(E||(E={}));const x="combo",w="tree";var O;!function(t){t.NODE="node",t.EDGE="edge",t.COMBO="combo",t.THEME="theme",t.PALETTE="palette",t.LAYOUT="layout",t.BEHAVIOR="behavior",t.PLUGIN="plugin",t.ANIMATION="animation",t.TRANSFORM="transform",t.SHAPE="shape"}(O||(O={}));const S={animation:{},behavior:{},combo:{},edge:{},layout:{},node:{},palette:{},theme:{},plugin:{},transform:{},shape:{}};function D(t,e){var n;const i=null===(n=S[t])||void 0===n?void 0:n[e];if(i)return i}function C(t){return`[G6 v5.0.45] ${t}`}const M={mute:!1,debug:t=>{!M.mute&&console.debug(C(t))},info:t=>{!M.mute&&console.info(C(t))},warn:t=>{!M.mute&&console.warn(C(t))},error:t=>{!M.mute&&console.error(C(t))}};function T(t){const{theme:e}=t;if(!e)return{};const n=D(O.THEME,e);return n||(M.warn(`The theme of ${e} is not registered.`),{})}function P(t,e){if(Array.isArray(t)&&0===t.length)return null;const n=Array.isArray(t)?t[0]:t,i=Array.isArray(t)?t.slice(1):e||[];return new Proxy(n,{get(t,e){return"function"!=typeof t[e]||["onframe","onfinish"].includes(e)?"finished"===e?Promise.all([n.finished,...i.map((t=>t.finished))]):Reflect.get(t,e):(...n)=>{t[e](...n),i.forEach((t=>{var i;return null===(i=t[e])||void 0===i?void 0:i.call(t,...n)}))}},set(t,e,n){return["onframe","onfinish"].includes(e)||i.forEach((t=>{t[e]=n})),Reflect.set(t,e,n)}})}function A(t){const e=t.reduce(((t,e)=>(Object.entries(e).forEach((([e,n])=>{void 0===t[e]?t[e]=[n]:t[e].push(n)})),t)),{});Object.entries(e).forEach((([n,i])=>{(i.length!==t.length||i.some((t=>(0,r.Z)(t)))||i.every((t=>!["sourceNode","targetNode","childrenNode"].includes(n)&&(0,a.Z)(t,i[0]))))&&delete e[n]}));const n=Object.entries(e).reduce(((t,[e,n])=>(n.forEach(((n,i)=>{t[i]?t[i][e]=n:t[i]={[e]:n}})),t)),[]);return 0!==t.length&&0===n.length&&n.push({_:0},{_:0}),n}function R(t){switch(t){case"opacity":return 1;case"x":case"y":case"z":case"zIndex":return 0;case"visibility":return"visible";case"collapsed":return!1;case"states":return[];default:return}}function L(t,e){const{animation:n}=t;if(!1===n||!1===e)return!1;const i=Object.assign({},h);return(0,l.Z)(n)&&Object.assign(i,n),(0,l.Z)(e)&&Object.assign(i,e),i}function k(t,e,n,i){var s,o;const{animation:r}=t;if(!1===r||!1===i)return[];const a=null===(s=null==t?void 0:t[e])||void 0===s?void 0:s.animation;if(!1===a)return[];const h=null==a?void 0:a[n];if(!1===h)return[];const d=null===(o=T(t)[e])||void 0===o?void 0:o.animation,u=(t=[])=>function(t){if("string"==typeof t){return D(O.ANIMATION,t)||(M.warn(`The animation of ${t} is not registered.`),[])}return t}(t).map((t=>Object.assign(Object.assign(Object.assign(Object.assign({},c),(0,l.Z)(r)&&r),t),(0,l.Z)(i)&&i)));if(h)return u(h);if(!d)return[];const p=d[n];return!1===p?[]:u(p)}var N=n(25897);function I(t,e,n,i=[]){if(!i&&0===t&&0===e&&0===n)return null;if(Array.isArray(i)){let s=-1;const o=[];for(let r=0;r<i.length;r++){const a=i[r];if("translate"===a[0]){if(a[1]===t&&a[2]===e)return null;s=r,o.push(["translate",t,e])}else if("translate3d"===a[0]){if(a[1]===t&&a[2]===e&&a[3]===n)return null;s=r,o.push(["translate3d",t,e,null!=n?n:0])}else o.push(a)}return-1===s&&o.splice(0,0,(0,N.Z)(n)?["translate3d",t,e,null!=n?n:0]:["translate",t,e]),0===o.length?null:o}const s=i?i.replace(/translate(3d)?\([^)]*\)/g,""):"";return 0===n?`translate(${t}, ${e})${s}`:`translate3d(${t}, ${e}, ${n})${s}`}var j=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(n[i[s]]=t[i[s]])}return n};const B=(t,e,n)=>{if(!n.length)return null;const[i,s]=e;let r;const a=n.map((e=>{var{fields:n,shape:a,states:l}=e,h=j(e,["fields","shape","states"]);const c=(e=>{var n;if(e){const r=t.getShape(e);if(!r)return null;const a=`get${(0,o.Z)(e)}Style`,l=(null===(n=null==t?void 0:t[a])||void 0===n?void 0:n.bind(t))||(t=>t);return{shape:r,fromStyle:(null==l?void 0:l(i))||{},toStyle:(null==l?void 0:l(s))||{}}}return{shape:t,fromStyle:i,toStyle:s}})(a);if(!c)return null;const{shape:d,fromStyle:u,toStyle:p}=c,g=[{},{}];if(n.forEach((t=>{var e,n;Object.assign(g[0],{[t]:null!==(e=u[t])&&void 0!==e?e:R(t)}),Object.assign(g[1],{[t]:null!==(n=p[t])&&void 0!==n?n:R(t)})})),g.some((t=>Object.keys(t).some((t=>["x","y","z"].includes(t)))))){const{x:t=0,y:e=0,z:n,transform:i=""}=d.attributes||{};g.forEach((s=>{var o,r,a;s.transform=I(null!==(o=s.x)&&void 0!==o?o:t,null!==(r=s.y)&&void 0!==r?r:e,null!==(a=s.z)&&void 0!==a?a:n,i)}))}const f=d.animate(A(g),h);return void 0===a&&(r=f),f})).filter(Boolean),l=r||(null==a?void 0:a[0]);return l?P(l,a.filter((t=>t!=t))):null},z=[{fields:["x","y"]}],F=z,_=[{fields:["sourceNode","targetNode"]}],Z=_,$=[{fields:["childrenNode","x","y"]}],V=$;var W=n(45607),H=n(5199),Y=Object.prototype.hasOwnProperty;var G=function(t,e){if(!e||!(0,H.Z)(t))return{};for(var n,i={},s=(0,W.Z)(e)?e:function(t){return t[e]},o=0;o<t.length;o++){var r=t[o];n=s(r),Y.call(i,n)?i[n].push(r):i[n]=[r]}return i},U=n(99711),K=n(83207);function X(t){return t instanceof Float32Array||!(!Array.isArray(t)||2!==t.length&&3!==t.length)&&t.every((t=>"number"==typeof t))}function q(t,e,n){return t>=e&&t<=n}function J(t=0){if(Array.isArray(t)){const[e=0,n=e,i=e,s=n]=t;return[e,n,i,s]}return[t,t,t,t]}function Q(t=0){const e=J(t);return e[0]+e[2]}function tt(t){return t.max[0]-t.min[0]}function et(t){return t.max[1]-t.min[1]}function nt(t){return[tt(t),et(t)]}function it(t,e){const n=X(t)?st(t):t.getShape("key").getBounds();return e?ot(n,e):n}function st(t){const[e,n,i=0]=t,o=new s.mN;return o.setMinMax([e,n,i],[e,n,i]),o}function ot(t,e){const[n,i,o,r]=J(e),[a,l,h]=t.min,[c,d,u]=t.max,p=new s.mN;return p.setMinMax([a-r,l-n,h],[c+i,d+o,u]),p}function rt(t){if(0===t.length)return new s.mN;if(1===t.length)return t[0];const e=new s.mN;e.setMinMax(t[0].min,t[0].max);for(let n=1;n<t.length;n++){const i=t[n];e.setMinMax([Math.min(e.min[0],i.min[0]),Math.min(e.min[1],i.min[1]),Math.min(e.min[2],i.min[2])],[Math.max(e.max[0],i.max[0]),Math.max(e.max[1],i.max[1]),Math.max(e.max[2],i.max[2])])}return e}function at(t,e){return q(t[0],e.min[0],e.max[0])&&q(t[1],e.min[1],e.max[1])}function lt(t,e,n=!1){const{min:[i,s],max:[o,r]}=e,a=(t[1]===s||t[1]===r)&&(n||q(t[0],i,o)),l=(t[0]===i||t[0]===o)&&(n||q(t[1],s,r));return a||l}function ht(t,e){const{center:n}=e;return t[0]===n[0]&&t[1]===n[1]}function ct(t,e){const[n,i]=t,[s,o]=e.min,[r,a]=e.max,l=n-s,h=r-n,c=i-o,d=a-i,u=Math.min(l,h,c,d);return u===l?"left":u===h?"right":u===c?"top":u===d?"bottom":"left"}function dt(t,e){const n=(0,K.Z)(t);if(at(t,e)){switch(ct(t,e)){case"left":n[0]=e.min[0];break;case"right":n[0]=e.max[0];break;case"top":n[1]=e.min[1];break;case"bottom":n[1]=e.max[1]}}else{const[i,s]=t,[o,r]=e.min,[a,l]=e.max;n[0]=q(i,o,a)?i:i<o?o:a,n[1]=q(s,r,l)?s:s<r?r:l}return n}var ut=function(t,e){return t===e},pt=function(){function t(t,e){void 0===e&&(e=null),this.value=t,this.next=e}return t.prototype.toString=function(t){return t?t(this.value):"".concat(this.value)},t}(),gt=function(){function t(t){void 0===t&&(t=ut),this.head=null,this.tail=null,this.compare=t}return t.prototype.prepend=function(t){var e=new pt(t,this.head);return this.head=e,this.tail||(this.tail=e),this},t.prototype.append=function(t){var e=new pt(t);return this.head?(this.tail.next=e,this.tail=e,this):(this.head=e,this.tail=e,this)},t.prototype.delete=function(t){if(!this.head)return null;for(var e=null;this.head&&this.compare(this.head.value,t);)e=this.head,this.head=this.head.next;var n=this.head;if(null!==n)for(;n.next;)this.compare(n.next.value,t)?(e=n.next,n.next=n.next.next):n=n.next;return this.compare(this.tail.value,t)&&(this.tail=n),e},t.prototype.find=function(t){var e=t.value,n=void 0===e?void 0:e,i=t.callback,s=void 0===i?void 0:i;if(!this.head)return null;for(var o=this.head;o;){if(s&&s(o.value))return o;if(void 0!==n&&this.compare(o.value,n))return o;o=o.next}return null},t.prototype.deleteTail=function(){var t=this.tail;if(this.head===this.tail)return this.head=null,this.tail=null,t;for(var e=this.head;e.next;)e.next.next?e=e.next:e.next=null;return this.tail=e,t},t.prototype.deleteHead=function(){if(!this.head)return null;var t=this.head;return this.head.next?this.head=this.head.next:(this.head=null,this.tail=null),t},t.prototype.fromArray=function(t){var e=this;return t.forEach((function(t){return e.append(t)})),this},t.prototype.toArray=function(){for(var t=[],e=this.head;e;)t.push(e),e=e.next;return t},t.prototype.reverse=function(){for(var t=this.head,e=null,n=null;t;)n=t.next,t.next=e,e=t,t=n;this.tail=this.head,this.head=e},t.prototype.toString=function(t){return void 0===t&&(t=void 0),this.toArray().map((function(e){return e.toString(t)})).toString()},t}(),ft=(function(){function t(){this.linkedList=new gt}t.prototype.isEmpty=function(){return!this.linkedList.head},t.prototype.peek=function(){return this.linkedList.head?this.linkedList.head.value:null},t.prototype.enqueue=function(t){this.linkedList.append(t)},t.prototype.dequeue=function(){var t=this.linkedList.deleteHead();return t?t.value:null},t.prototype.toString=function(t){return this.linkedList.toString(t)}}(),function(t,e,n){void 0===e&&(e=[]);var i=e.filter((function(e){return e.source===t||e.target===t}));if("target"===n){return i.filter((function(e){return e.source===t})).map((function(t){return t.target}))}if("source"===n){return i.filter((function(e){return e.target===t})).map((function(t){return t.source}))}return i.map((function(e){return e.source===t?e.target:e.source}))}),yt=function(t,e){return e.filter((function(e){return e.source===t||e.target===t}))};var mt=function(t){var e={},n=t.nodes,i=void 0===n?[]:n,s=t.edges,o=void 0===s?[]:s;return i.forEach((function(t){e[t.id]={degree:0,inDegree:0,outDegree:0}})),o.forEach((function(t){e[t.source].degree++,e[t.source].outDegree++,e[t.target].degree++,e[t.target].inDegree++})),e},vt=mt;var bt=n(97582),Et={}.toString,xt=function(t,e){return Et.call(t)==="[object "+e+"]"},wt=function(t){return xt(t,"Function")},Ot=function(t){return Array.isArray?Array.isArray(t):xt(t,"Array")};var St=function(t,e){var n,i;if(t)if(Ot(t))for(var s=0,o=t.length;s<o&&!1!==e(t[s],s);s++);else if(i=typeof(n=t),null!==n&&"object"===i||"function"===i)for(var r in t)if(t.hasOwnProperty(r)&&!1===e(t[r],r))break};Object.keys;var Dt=Array.prototype,Ct=(Dt.splice,Dt.indexOf,Array.prototype.splice,function(t){return xt(t,"String")});Object.prototype.hasOwnProperty;var Mt=function(t){return xt(t,"Number")},Tt=(Number.isInteger&&Number.isInteger,Math.PI,Math.PI,Object.values?function(t){return Object.values(t)}:function(t){var e=[];return St(t,(function(n,i){wt(t)&&"prototype"===i||e.push(n)})),e});Object.prototype;var Pt=function(t){if("object"!=typeof t||null===t)return t;var e;if(Ot(t)){e=[];for(var n=0,i=t.length;n<i;n++)"object"==typeof t[n]&&null!=t[n]?e[n]=Pt(t[n]):e[n]=t[n]}else for(var s in e={},t)"object"==typeof t[s]&&null!=t[s]?e[s]=Pt(t[s]):e[s]=t[s];return e},At=Pt;Object.prototype.hasOwnProperty;Object.prototype.hasOwnProperty,function(t,e){if(!wt(t))throw new TypeError("Expected a function");var n=function(){for(var i=[],s=0;s<arguments.length;s++)i[s]=arguments[s];var o=e?e.apply(this,i):i[0],r=n.cache;if(r.has(o))return r.get(o);var a=t.apply(this,i);return r.set(o,a),a};n.cache=new Map}((function(t,e){void 0===e&&(e={});var n=e.fontSize,i=e.fontFamily,s=e.fontWeight,o=e.fontStyle,r=e.fontVariant;return Rt||(Rt=document.createElement("canvas").getContext("2d")),Rt.font=[o,r,s,n+"px",i].join(" "),Rt.measureText(Ct(t)?t:"").width}),(function(t,e){return void 0===e&&(e={}),(0,bt.pr)([t],Tt(e)).join("")})),function(){function t(){this.map={}}t.prototype.has=function(t){return void 0!==this.map[t]},t.prototype.get=function(t,e){var n=this.map[t];return void 0===n?e:n},t.prototype.set=function(t,e){this.map[t]=e},t.prototype.clear=function(){this.map={}},t.prototype.delete=function(t){delete this.map[t]},t.prototype.size=function(){return Object.keys(this.map).length}}();var Rt,Lt=function(t,e,n,i){var s=t.nodes,o=void 0===s?[]:s,r=t.edges,a=void 0===r?[]:r,l=[],h={},c={},d={};o.forEach((function(t,n){var i=t.id;l.push(i),c[i]=1/0,i===e&&(c[i]=0)}));for(var u=o.length,p=function(t){var e=function(t,e,n){for(var i,s=1/0,o=0;o<e.length;o++){var r=e[o].id;!n[r]&&t[r]<=s&&(s=t[r],i=e[o])}return i}(c,o,h),s=e.id;if(h[s]=!0,c[s]===1/0)return"continue";var r=[];r=n?function(t,e){return e.filter((function(e){return e.source===t}))}(s,a):yt(s,a),r.forEach((function(t){var n=t.target,o=t.source,r=n===s?o:n,a=i&&t[i]?t[i]:1;c[r]>c[e.id]+a?(c[r]=c[e.id]+a,d[r]=[e.id]):c[r]===c[e.id]+a&&d[r].push(e.id)}))},g=0;g<u;g++)p();d[e]=[e];var f={};for(var y in c)c[y]!==1/0&&kt(e,y,d,f);var m={};for(var y in f)m[y]=f[y][0];return{length:c,path:m,allPath:f}};function kt(t,e,n,i){if(t===e)return[t];if(i[e])return i[e];for(var s=[],o=0,r=n[e];o<r.length;o++){var a=kt(t,r[o],n,i);if(!a)return;for(var l=0,h=a;l<h.length;l++){var c=h[l];Ot(c)?s.push((0,bt.ev)((0,bt.ev)([],c,!0),[e],!1)):s.push([c,e])}}return i[e]=s,i[e]}var Nt,It=function(t,e,n,i,s){var o=Lt(t,e,i,s),r=o.length,a=o.path,l=o.allPath;return{length:r[n],path:a[n],allPath:l[n]}};!function(){function t(t){this.arr=t}t.prototype.getArr=function(){return this.arr||[]},t.prototype.add=function(e){var n,i=e.arr;if(!(null===(n=this.arr)||void 0===n?void 0:n.length))return new t(i);if(!(null==i?void 0:i.length))return new t(this.arr);if(this.arr.length===i.length){var s=[];for(var o in this.arr)s[o]=this.arr[o]+i[o];return new t(s)}},t.prototype.subtract=function(e){var n,i=e.arr;if(!(null===(n=this.arr)||void 0===n?void 0:n.length))return new t(i);if(!(null==i?void 0:i.length))return new t(this.arr);if(this.arr.length===i.length){var s=[];for(var o in this.arr)s[o]=this.arr[o]-i[o];return new t(s)}},t.prototype.avg=function(e){var n=[];if(0!==e)for(var i in this.arr)n[i]=this.arr[i]/e;return new t(n)},t.prototype.negate=function(){var e=[];for(var n in this.arr)e[n]=-this.arr[n];return new t(e)},t.prototype.squareEuclideanDistance=function(t){var e,n=t.arr;if(!(null===(e=this.arr)||void 0===e?void 0:e.length)||!(null==n?void 0:n.length))return 0;if(this.arr.length===n.length){var i=0;for(var s in this.arr)i+=Math.pow(this.arr[s]-t.arr[s],2);return i}},t.prototype.euclideanDistance=function(t){var e,n=t.arr;if(!(null===(e=this.arr)||void 0===e?void 0:e.length)||!(null==n?void 0:n.length))return 0;if(this.arr.length===n.length){var i=0;for(var s in this.arr)i+=Math.pow(this.arr[s]-t.arr[s],2);return Math.sqrt(i)}console.error("The two vectors are unequal in length.")},t.prototype.normalize=function(){var e=[],n=At(this.arr);n.sort((function(t,e){return t-e}));var i=n[n.length-1],s=n[0];for(var o in this.arr)e[o]=(this.arr[o]-s)/(i-s);return new t(e)},t.prototype.norm2=function(){var t;if(!(null===(t=this.arr)||void 0===t?void 0:t.length))return 0;var e=0;for(var n in this.arr)e+=Math.pow(this.arr[n],2);return Math.sqrt(e)},t.prototype.dot=function(t){var e,n=t.arr;if(!(null===(e=this.arr)||void 0===e?void 0:e.length)||!(null==n?void 0:n.length))return 0;if(this.arr.length===n.length){var i=0;for(var s in this.arr)i+=this.arr[s]*t.arr[s];return i}console.error("The two vectors are unequal in length.")},t.prototype.equal=function(t){var e,n=t.arr;if((null===(e=this.arr)||void 0===e?void 0:e.length)!==(null==n?void 0:n.length))return!1;for(var i in this.arr)if(this.arr[i]!==n[i])return!1;return!0}}();!function(t){t.EuclideanDistance="euclideanDistance"}(Nt||(Nt={}));!function(){function t(t){this.count=t.length,this.parent={};for(var e=0,n=t;e<n.length;e++){var i=n[e];this.parent[i]=i}}t.prototype.find=function(t){for(;this.parent[t]!==t;)t=this.parent[t];return t},t.prototype.union=function(t,e){var n=this.find(t),i=this.find(e);n!==i&&(n<i?(this.parent[e]!==e&&this.union(this.parent[e],t),this.parent[e]=this.parent[t]):(this.parent[t]!==t&&this.union(this.parent[t],e),this.parent[t]=this.parent[e]))},t.prototype.connected=function(t,e){return this.find(t)===this.find(e)}}();var jt=function(t,e){return t-e},Bt=(function(){function t(t){void 0===t&&(t=jt),this.compareFn=t,this.list=[]}t.prototype.getLeft=function(t){return 2*t+1},t.prototype.getRight=function(t){return 2*t+2},t.prototype.getParent=function(t){return 0===t?null:Math.floor((t-1)/2)},t.prototype.isEmpty=function(){return this.list.length<=0},t.prototype.top=function(){return this.isEmpty()?void 0:this.list[0]},t.prototype.delMin=function(){var t=this.top(),e=this.list.pop();return this.list.length>0&&(this.list[0]=e,this.moveDown(0)),t},t.prototype.insert=function(t){if(null!==t){this.list.push(t);var e=this.list.length-1;return this.moveUp(e),!0}return!1},t.prototype.moveUp=function(t){for(var e=this.getParent(t);t&&t>0&&this.compareFn(this.list[e],this.list[t])>0;){var n=this.list[e];this.list[e]=this.list[t],this.list[t]=n,t=e,e=this.getParent(t)}},t.prototype.moveDown=function(t){var e,n=t,i=this.getLeft(t),s=this.getRight(t),o=this.list.length;null!==i&&i<o&&this.compareFn(this.list[n],this.list[i])>0?n=i:null!==s&&s<o&&this.compareFn(this.list[n],this.list[s])>0&&(n=s),t!==n&&(e=[this.list[n],this.list[t]],this.list[t]=e[0],this.list[n]=e[1],this.moveDown(n))}}(),function(t,e,n){"number"!=typeof e&&(e=1e-6),"number"!=typeof n&&(n=.85);for(var i,s=1,o=0,r=1e3,a=t.nodes,l=void 0===a?[]:a,h=t.edges,c=void 0===h?[]:h,d=l.length,u={},p={},g=0;g<d;++g){u[y=(x=l[g]).id]=1/d,p[y]=1/d}for(var f=vt(t);r>0&&s>e;){o=0;for(g=0;g<d;++g){var y=(x=l[g]).id;if(i=0,0===f[x.id].inDegree)u[y]=0;else{for(var m=ft(y,c,"source"),v=0;v<m.length;++v){var b=m[v],E=f[b].outDegree;E>0&&(i+=p[b]/E)}u[y]=n*i,o+=u[y]}}o=(1-o)/d,s=0;for(g=0;g<d;++g){var x;i=u[y=(x=l[g]).id]+o,s+=Math.abs(i-p[y]),p[y]=i}r-=1}return p}),zt="-1",Ft=function(t,e,n,i){void 0===t&&(t=-1),void 0===e&&(e=-1),void 0===n&&(n=-1),void 0===i&&(i="-1"),this.id=t,this.from=e,this.to=n,this.label=i},_t=function(){function t(t,e){void 0===t&&(t=-1),void 0===e&&(e=zt),this.id=t,this.label=e,this.edges=[],this.edgeMap={}}return t.prototype.addEdge=function(t){this.edges.push(t),this.edgeMap[t.id]=t},t}(),Zt=function(){function t(t,e,n){void 0===t&&(t=-1),void 0===e&&(e=!0),void 0===n&&(n=!1),this.id=t,this.edgeIdAutoIncrease=e,this.edges=[],this.nodes=[],this.nodeMap={},this.edgeMap={},this.nodeLabelMap={},this.edgeLabelMap={},this.counter=0,this.directed=n}return t.prototype.getNodeNum=function(){return this.nodes.length},t.prototype.addNode=function(t,e){if(!this.nodeMap[t]){var n=new _t(t,e);this.nodes.push(n),this.nodeMap[t]=n,this.nodeLabelMap[e]||(this.nodeLabelMap[e]=[]),this.nodeLabelMap[e].push(t)}},t.prototype.addEdge=function(t,e,n,i){if((this.edgeIdAutoIncrease||void 0===t)&&(t=this.counter++),!(this.nodeMap[e]&&this.nodeMap[n]&&this.nodeMap[n].edgeMap[t])){var s=new Ft(t,e,n,i);if(this.edges.push(s),this.edgeMap[t]=s,this.nodeMap[e].addEdge(s),this.edgeLabelMap[i]||(this.edgeLabelMap[i]=[]),this.edgeLabelMap[i].push(s),!this.directed){var o=new Ft(t,n,e,i);this.nodeMap[n].addEdge(o),this.edgeLabelMap[i].push(o)}}},t}(),$t=function(){function t(t,e,n,i,s){this.fromNode=t,this.toNode=e,this.nodeEdgeNodeLabel={nodeLabel1:n||zt,edgeLabel:i||"-1",nodeLabel2:s||zt}}return t.prototype.equalTo=function(t){return this.fromNode===t.formNode&&this.toNode===t.toNode&&this.nodeEdgeNodeLabel===t.nodeEdgeNodeLabel},t.prototype.notEqualTo=function(t){return!this.equalTo(t)},t}(),Vt=function(){function t(){this.rmpath=[],this.dfsEdgeList=[]}return t.prototype.equalTo=function(t){var e=this.dfsEdgeList.length;if(e!==t.length)return!1;for(var n=0;n<e;n++)if(this.dfsEdgeList[n]!==t[n])return!1;return!0},t.prototype.notEqualTo=function(t){return!this.equalTo(t)},t.prototype.pushBack=function(t,e,n,i,s){return this.dfsEdgeList.push(new $t(t,e,n,i,s)),this.dfsEdgeList},t.prototype.toGraph=function(t,e){void 0===t&&(t=-1),void 0===e&&(e=!1);var n=new Zt(t,!0,e);return this.dfsEdgeList.forEach((function(t){var e=t.fromNode,i=t.toNode,s=t.nodeEdgeNodeLabel,o=s.nodeLabel1,r=s.edgeLabel,a=s.nodeLabel2;o!==zt&&n.addNode(e,o),a!==zt&&n.addNode(i,a),o!==zt&&a!==o&&n.addEdge(void 0,e,i,r)})),n},t.prototype.buildRmpath=function(){this.rmpath=[];for(var t=void 0,e=this.dfsEdgeList.length-1;e>=0;e--){var n=this.dfsEdgeList[e],i=n.fromNode,s=n.toNode;i<s&&(void 0===t||s===t)&&(this.rmpath.push(e),t=i)}return this.rmpath},t.prototype.getNodeNum=function(){var t={};return this.dfsEdgeList.forEach((function(e){t[e.fromNode]||(t[e.fromNode]=!0),t[e.toNode]||(t[e.toNode]=!0)})),Object.keys(t).length},t}(),Wt=function(){function t(t){if(this.his={},this.nodesUsed={},this.edgesUsed={},this.edges=[],t){for(;t;){var e=t.edge;this.edges.push(e),this.nodesUsed[e.from]=1,this.nodesUsed[e.to]=1,this.edgesUsed[e.id]=1,t=t.preNode}this.edges=this.edges.reverse()}}return t.prototype.hasNode=function(t){return 1===this.nodesUsed[t.id]},t.prototype.hasEdge=function(t){return 1===this.edgesUsed[t.id]},t}();(function(){function t(t){var e=t.graphs,n=t.minSupport,i=void 0===n?2:n,s=t.minNodeNum,o=void 0===s?1:s,r=t.maxNodeNum,a=void 0===r?4:r,l=t.top,h=void 0===l?10:l,c=t.directed,d=void 0!==c&&c,u=t.verbose,p=void 0!==u&&u;this.graphs=e,this.dfsCode=new Vt,this.support=0,this.frequentSize1Subgraphs=[],this.frequentSubgraphs=[],this.minSupport=i,this.top=h,this.directed=d,this.counter=0,this.maxNodeNum=a,this.minNodeNum=o,this.verbose=p,this.maxNodeNum<this.minNodeNum&&(this.maxNodeNum=this.minNodeNum),this.reportDF=[]}t.prototype.findForwardRootEdges=function(t,e){var n=this,i=[],s=t.nodeMap;return e.edges.forEach((function(t){(n.directed||e.label<=s[t.to].label)&&i.push(t)})),i},t.prototype.findBackwardEdge=function(t,e,n,i){if(!this.directed&&e===n)return null;for(var s=t.nodeMap,o=s[n.to].edges,r=o.length,a=0;a<r;a++){var l=o[a];if(!i.hasEdge(l)&&l.to===e.from)if(this.directed){if(s[e.from].label<s[n.to].label||s[e.from].label===s[n.to].label&&e.label<=l.label)return l}else if(e.label<l.label||e.label===l.label&&s[e.to].label<=s[n.to].label)return l}return null},t.prototype.findForwardPureEdges=function(t,e,n,i){for(var s=[],o=e.to,r=t.nodeMap[o].edges,a=r.length,l=0;l<a;l++){var h=r[l],c=t.nodeMap[h.to];n<=c.label&&!i.hasNode(c)&&s.push(h)}return s},t.prototype.findForwardRmpathEdges=function(t,e,n,i){for(var s=[],o=t.nodeMap,r=o[e.to].label,a=o[e.from].edges,l=a.length,h=0;h<l;h++){var c=a[h],d=o[c.to].label;e.to===c.to||n>d||i.hasNode(o[c.to])||(e.label<c.label||e.label===c.label&&r<=d)&&s.push(c)}return s},t.prototype.getSupport=function(t){var e={};return t.forEach((function(t){e[t.graphId]||(e[t.graphId]=!0)})),Object.keys(e).length},t.prototype.findMinLabel=function(t){var e=void 0;return Object.keys(t).forEach((function(n){var i=t[n],s=i.nodeLabel1,o=i.edgeLabel,r=i.nodeLabel2;e?(s<e.nodeLabel1||s===e.nodeLabel1&&o<e.edgeLabel||s===e.nodeLabel1&&o===e.edgeLabel&&r<e.nodeLabel2)&&(e={nodeLabel1:s,edgeLabel:o,nodeLabel2:r}):e={nodeLabel1:s,edgeLabel:o,nodeLabel2:r}})),e},t.prototype.isMin=function(){var t=this,e=this.dfsCode;if(this.verbose&&console.log("isMin checking",e),1===e.dfsEdgeList.length)return!0;var n=this.directed,i=e.toGraph(-1,n),s=i.nodeMap,o=new Vt,r={};i.nodes.forEach((function(e){t.findForwardRootEdges(i,e).forEach((function(t){var n=s[t.to],o="".concat(e.label,"-").concat(t.label,"-").concat(n.label);r[o]||(r[o]={projected:[],nodeLabel1:e.label,edgeLabel:t.label,nodeLabel2:n.label});var a={graphId:i.id,edge:t,preNode:null};r[o].projected.push(a)}))}));var a=this.findMinLabel(r);if(a){o.dfsEdgeList.push(new $t(0,1,a.nodeLabel1,a.edgeLabel,a.nodeLabel2));var l="".concat(a.nodeLabel1,"-").concat(a.edgeLabel,"-").concat(a.nodeLabel2);return function r(a){for(var l=o.buildRmpath(),h=o.dfsEdgeList[0].nodeEdgeNodeLabel.nodeLabel1,c=o.dfsEdgeList[l[0]].toNode,d={},u=!1,p=0,g=n?-1:0,f=function(e){if(u)return"break";a.forEach((function(n){var s=new Wt(n),r=t.findBackwardEdge(i,s.edges[l[e]],s.edges[l[0]],s);r&&(d[r.label]||(d[r.label]={projected:[],edgeLabel:r.label}),d[r.label].projected.push({graphId:i.id,edge:d,preNode:n}),p=o.dfsEdgeList[l[e]].fromNode,u=!0)}))},y=l.length-1;y>g;y--){if("break"===f(y))break}if(u){var m=t.findMinLabel(d);o.dfsEdgeList.push(new $t(c,p,zt,m.edgeLabel,zt));var v=o.dfsEdgeList.length-1;return t.dfsCode.dfsEdgeList[v]===o.dfsEdgeList[v]&&r(d[m.edgeLabel].projected)}var b={};u=!1;var E=0;a.forEach((function(e){var n=new Wt(e),o=t.findForwardPureEdges(i,n.edges[l[0]],h,n);o.length>0&&(u=!0,E=c,o.forEach((function(t){var n="".concat(t.label,"-").concat(s[t.to].label);b[n]||(b[n]={projected:[],edgeLabel:t.label,nodeLabel2:s[t.to].label}),b[n].projected.push({graphId:i.id,edge:t,preNode:e})})))}));var x=l.length,w=function(e){if(u)return"break";var n=l[e];a.forEach((function(e){var r=new Wt(e),a=t.findForwardRmpathEdges(i,r.edges[n],h,r);a.length>0&&(u=!0,E=o.dfsEdgeList[n].fromNode,a.forEach((function(t){var n="".concat(t.label,"-").concat(s[t.to].label);b[n]||(b[n]={projected:[],edgeLabel:t.label,nodeLabel2:s[t.to].label}),b[n].projected.push({graphId:i.id,edge:t,preNode:e})})))}))};for(y=0;y<x;y++){if("break"===w(y))break}if(!u)return!0;var O=t.findMinLabel(b);o.dfsEdgeList.push(new $t(E,c+1,zt,O.edgeLabel,O.nodeLabel2));var S=o.dfsEdgeList.length-1;return e.dfsEdgeList[S]===o.dfsEdgeList[S]&&r(b["".concat(O.edgeLabel,"-").concat(O.nodeLabel2)].projected)}(r[l].projected)}},t.prototype.report=function(){if(!(this.dfsCode.getNodeNum()<this.minNodeNum)){this.counter++;var t=this.dfsCode.toGraph(this.counter,this.directed);this.frequentSubgraphs.push(At(t))}},t.prototype.subGraphMining=function(t){var e=this;if(!(this.getSupport(t)<this.minSupport)&&this.isMin()){this.report();var n=this.dfsCode.getNodeNum(),i=this.dfsCode.buildRmpath(),s=this.dfsCode.dfsEdgeList[i[0]].toNode,o=this.dfsCode.dfsEdgeList[0].nodeEdgeNodeLabel.nodeLabel1,r={},a={};t.forEach((function(t){for(var l=e.graphs[t.graphId],h=l.nodeMap,c=new Wt(t),d=i.length-1;d>=0;d--){var u=e.findBackwardEdge(l,c.edges[i[d]],c.edges[i[0]],c);if(u){var p="".concat(e.dfsCode.dfsEdgeList[i[d]].fromNode,"-").concat(u.label);a[p]||(a[p]={projected:[],toNodeId:e.dfsCode.dfsEdgeList[i[d]].fromNode,edgeLabel:u.label}),a[p].projected.push({graphId:t.graphId,edge:u,preNode:t})}}if(!(n>=e.maxNodeNum)){e.findForwardPureEdges(l,c.edges[i[0]],o,c).forEach((function(e){var n="".concat(s,"-").concat(e.label,"-").concat(h[e.to].label);r[n]||(r[n]={projected:[],fromNodeId:s,edgeLabel:e.label,nodeLabel2:h[e.to].label}),r[n].projected.push({graphId:t.graphId,edge:e,preNode:t})}));var g=function(n){e.findForwardRmpathEdges(l,c.edges[i[n]],o,c).forEach((function(s){var o="".concat(e.dfsCode.dfsEdgeList[i[n]].fromNode,"-").concat(s.label,"-").concat(h[s.to].label);r[o]||(r[o]={projected:[],fromNodeId:e.dfsCode.dfsEdgeList[i[n]].fromNode,edgeLabel:s.label,nodeLabel2:h[s.to].label}),r[o].projected.push({graphId:t.graphId,edge:s,preNode:t})}))};for(d=0;d<i.length;d++)g(d)}})),Object.keys(a).forEach((function(t){var n=a[t],i=n.toNodeId,o=n.edgeLabel;e.dfsCode.dfsEdgeList.push(new $t(s,i,"-1",o,"-1")),e.subGraphMining(a[t].projected),e.dfsCode.dfsEdgeList.pop()})),Object.keys(r).forEach((function(t){var n=r[t],i=n.fromNodeId,o=n.edgeLabel,a=n.nodeLabel2;e.dfsCode.dfsEdgeList.push(new $t(i,s+1,zt,o,a)),e.subGraphMining(r[t].projected),e.dfsCode.dfsEdgeList.pop()}))}},t.prototype.generate1EdgeFrequentSubGraphs=function(){var t=this.graphs,e=this.directed,n=this.minSupport,i=this.frequentSize1Subgraphs,s={},o={},r={},a={};return Object.keys(t).forEach((function(n){var i=t[n],l=i.nodeMap;i.nodes.forEach((function(t,i){var h=t.label,c="".concat(n,"-").concat(h);if(!r[c]){var d=s[h]||0;d++,s[h]=d}r[c]={graphKey:n,label:h},t.edges.forEach((function(t){var i=h,s=l[t.to].label;if(!e&&i>s){var r=s;s=i,i=r}var c=t.label,d="".concat(n,"-").concat(i,"-").concat(c,"-").concat(s),u="".concat(i,"-").concat(c,"-").concat(s);if(!o[u]){var p=o[u]||0;p++,o[u]=p}a[d]={graphId:n,nodeLabel1:i,edgeLabel:c,nodeLabel2:s}}))}))})),Object.keys(s).forEach((function(t){if(!(s[t]<n)){var e={nodes:[],edges:[]};e.nodes.push({id:"0",label:t}),i.push(e)}})),i},t.prototype.run=function(){var t=this;if(this.frequentSize1Subgraphs=this.generate1EdgeFrequentSubGraphs(),!(this.maxNodeNum<2)){var e=this.graphs,n=(this.directed,{});Object.keys(e).forEach((function(i){var s=e[i],o=s.nodeMap;s.nodes.forEach((function(e){t.findForwardRootEdges(s,e).forEach((function(t){var s=o[t.to],r="".concat(e.label,"-").concat(t.label,"-").concat(s.label);n[r]||(n[r]={projected:[],nodeLabel1:e.label,edgeLabel:t.label,nodeLabel2:s.label});var a={graphId:i,edge:t,preNode:null};n[r].projected.push(a)}))}))})),Object.keys(n).forEach((function(e){var i=n[e],s=i.projected,o=i.nodeLabel1,r=i.edgeLabel,a=i.nodeLabel2;t.dfsCode.dfsEdgeList.push(new $t(0,1,o,r,a)),t.subGraphMining(s),t.dfsCode.dfsEdgeList.pop()}))}}})(),function(){function t(t){void 0===t&&(t=10),this.linkedList=new gt,this.maxStep=t}Object.defineProperty(t.prototype,"length",{get:function(){return this.linkedList.toArray().length},enumerable:!1,configurable:!0}),t.prototype.isEmpty=function(){return!this.linkedList.head},t.prototype.isMaxStack=function(){return this.toArray().length>=this.maxStep},t.prototype.peek=function(){return this.isEmpty()?null:this.linkedList.head.value},t.prototype.push=function(t){this.linkedList.prepend(t),this.length>this.maxStep&&this.linkedList.deleteTail()},t.prototype.pop=function(){var t=this.linkedList.deleteHead();return t?t.value:null},t.prototype.toArray=function(){return this.linkedList.toArray().map((function(t){return t.value}))},t.prototype.clear=function(){for(;!this.isEmpty();)this.pop()}}();function Ht(t){if(void 0!==t.id)return t.id;if(void 0!==t.source&&void 0!==t.target)return`${t.source}-${t.target}`;throw new Error(C("The datum does not have available id."))}function Yt(t){return t.combo}function Gt(t,e){const n={nodes:(t.nodes||[]).map(Ht),edges:(t.edges||[]).map(Ht),combos:(t.combos||[]).map(Ht)};return e?Object.values(n).flat():n}const Ut=(t,e,n)=>{var i;switch(n.type){case"degree":{const s=new Map;return null===(i=t.nodes)||void 0===i||i.forEach((t=>{const i=e(Ht(t),n.direction).length;s.set(Ht(t),i)})),s}case"betweenness":return Xt(t,n.directed,n.weightPropertyName);case"closeness":return qt(t,n.directed,n.weightPropertyName);case"eigenvector":return Qt(t,n.directed);case"pagerank":return Jt(t,n.epsilon,n.linkProb);default:return Kt(t)}},Kt=t=>{var e;const n=new Map;return null===(e=t.nodes)||void 0===e||e.forEach((t=>{n.set(Ht(t),0)})),n},Xt=(t,e,n)=>{const i=Kt(t),{nodes:s=[]}=t;return s.forEach((o=>{s.forEach((s=>{if(o!==s){const{allPath:r}=It(t,Ht(o),Ht(s),e,n),a=r.length;r.flat().forEach((t=>{t!==Ht(o)&&t!==Ht(s)&&i.set(t,i.get(t)+1/a)}))}}))})),i},qt=(t,e,n)=>{const i=new Map,{nodes:s=[]}=t;return s.forEach((o=>{const r=s.reduce(((i,s)=>{if(o!==s){const{length:r}=It(t,Ht(o),Ht(s),e,n);i+=r}return i}),0);i.set(Ht(o),1/r)})),i},Jt=(t,e,n)=>{var i;const s=new Map,o=Bt(t,e,n);return null===(i=t.nodes)||void 0===i||i.forEach((t=>{s.set(Ht(t),o[Ht(t)])})),s},Qt=(t,e)=>{const{nodes:n=[]}=t,i=te(t,e),s=ee(i,n.length),o=new Map;return n.forEach(((t,e)=>{o.set(Ht(t),s[e])})),o},te=(t,e)=>{const{nodes:n=[],edges:i=[]}=t,s=Array(n.length).fill(null).map((()=>Array(n.length).fill(0)));return i.forEach((({source:t,target:i})=>{const o=n.findIndex((e=>Ht(e)===t)),r=n.findIndex((t=>Ht(t)===i));e?s[o][r]=1:(s[o][r]=1,s[r][o]=1)})),s},ee=(t,e,n=100,i=1e-6)=>{let s=Array(e).fill(1),o=1/0;for(let r=0;r<n&&o>i;r++){const n=Array(e).fill(0);for(let i=0;i<e;i++)for(let o=0;o<e;o++)n[i]+=t[i][o]*s[o];const i=Math.sqrt(n.reduce(((t,e)=>t+e*e),0));for(let t=0;t<e;t++)n[t]/=i;o=Math.sqrt(n.reduce(((t,e,n)=>t+(e-s[n])*e),0)),s=n}return s};function ne(t,e,n,i=a.Z){const s=new Map(t.map((t=>[n(t),t]))),o=new Map(e.map((t=>[n(t),t]))),r=new Set(s.keys()),l=new Set(o.keys()),h=[],c=[],d=[],u=[];return l.forEach((t=>{r.has(t)?i(s.get(t),o.get(t))?u.push(o.get(t)):c.push(o.get(t)):h.push(o.get(t))})),r.forEach((t=>{l.has(t)||d.push(s.get(t))})),{enter:h,exit:d,keep:u,update:c}}function ie(t,e,n){t.forEach((t=>{(t=>{n&&!n(t)||(t.style.visibility=e)})(t)}))}class se{constructor(t){this.extensions=[],this.extensionMap={},this.context=t}setExtensions(t){const e=function(t,e,n){const i={},s=t=>(t in i||(i[t]=0),`${e}-${t}-${i[t]++}`);return n.map((e=>"string"==typeof e?{type:e,key:s(e)}:"function"==typeof e?e.call(t):e.key?e:Object.assign(Object.assign({},e),{key:s(e.type)})))}(this.context.graph,this.category,t),{enter:n,update:i,exit:s,keep:o}=ne(this.extensions,e,(t=>t.key));this.createExtensions(n),this.updateExtensions([...i,...o]),this.destroyExtensions(s),this.extensions=e}createExtension(t){const{category:e}=this,{key:n,type:i}=t,s=D(e,i);if(!s)return M.warn(`The extension ${i} of ${e} is not registered.`);const o=new s(this.context,t);this.extensionMap[n]=o}createExtensions(t){t.forEach((t=>this.createExtension(t)))}updateExtension(t){const{key:e}=t,n=this.extensionMap[e];n&&n.update(t)}updateExtensions(t){t.forEach((t=>this.updateExtension(t)))}destroyExtension(t){const e=this.extensionMap[t];e&&(e.destroy(),delete this.extensionMap[t])}destroyExtensions(t){t.forEach((({key:t})=>this.destroyExtension(t)))}destroy(){Object.values(this.extensionMap).forEach((t=>t.destroy())),this.context={},this.extensions=[],this.extensionMap={}}}class oe{constructor(t,e){this.events=[],this.destroyed=!1,this.context=t,this.options=e}update(t){this.options=Object.assign(this.options,t)}destroy(){this.context={},this.options={},this.destroyed=!0}}class re extends oe{}class ae extends re{constructor(t,e){super(t,Object.assign({},ae.defaultOptions,e)),this.isOverlapping=(t,e)=>e.some((e=>t.intersects(e))),this.occupiedBounds=[],this.detectLabelCollision=t=>{const e=this.context.viewport,n={show:[],hide:[]};return this.occupiedBounds=[],t.forEach((t=>{const i=t.getShape("label").getRenderBounds();e.isInViewport(i,!0)&&!this.isOverlapping(i,this.occupiedBounds)?(n.show.push(t),this.occupiedBounds.push(ot(i,this.options.padding))):n.hide.push(t)})),n},this.hideLabelIfExceedViewport=(t,e)=>{const{exit:n}=ne(t,e,(t=>t.id));null==n||n.forEach(this.hideLabel)},this.nodeCentralities=new Map,this.sortNodesByCentrality=(t,e)=>{const{model:n}=this.context,i=n.getData(),s=n.getRelatedEdgesData.bind(n);return t.map((t=>(this.nodeCentralities.has(t.id)||(this.nodeCentralities=Ut(i,s,e)),{node:t,centrality:this.nodeCentralities.get(t.id)}))).sort(((t,e)=>e.centrality-t.centrality)).map((t=>t.node))},this.sortLabelElementsInView=t=>{const{sort:e,sortNode:n,sortCombo:i,sortEdge:s}=this.options,{model:o}=this.context;if((0,W.Z)(e))return t.sort(((t,n)=>e(o.getElementDataById(t.id),o.getElementDataById(n.id))));const{node:r=[],edge:a=[],combo:l=[]}=G(t,(t=>t.type));return[...(0,W.Z)(i)?l.sort(((t,e)=>i(...o.getComboData([t.id,e.id])))):l,...(0,W.Z)(n)?r.sort(((t,e)=>n(...o.getNodeData([t.id,e.id])))):this.sortNodesByCentrality(r,n),...(0,W.Z)(s)?a.sort(((t,e)=>s(...o.getEdgeData([t.id,e.id])))):a]},this.labelElementsInView=[],this.isFirstRender=!0,this.onToggleVisibility=t=>{var e;if("zIndex"===(null===(e=t.data)||void 0===e?void 0:e.stage))return;if(!this.validate(t))return void(this.hiddenElements.size>0&&(this.hiddenElements.forEach(this.showLabel),this.hiddenElements.clear()));const n=this.isFirstRender?this.getLabelElements():this.getLabelElementsInView();this.hideLabelIfExceedViewport(this.labelElementsInView,n),this.labelElementsInView=n;const i=this.sortLabelElementsInView(this.labelElementsInView),{show:s,hide:o}=this.detectLabelCollision(i);for(let t=s.length-1;t>=0;t--)this.showLabel(s[t]);o.forEach(this.hideLabel)},this.hiddenElements=new Map,this.hideLabel=t=>{const e=t.getShape("label");e&&ie(e,"hidden"),this.hiddenElements.set(t.id,t)},this.showLabel=t=>{const e=t.getShape("label");e&&ie(e,"visible"),t.toFront(),this.hiddenElements.delete(t.id)},this.onTransform=(0,U.Z)(this.onToggleVisibility,this.options.throttle,{leading:!0}),this.enableToggle=!0,this.toggle=t=>{this.enableToggle&&this.onToggleVisibility(t)},this.onBeforeRender=()=>{this.enableToggle=!1},this.onAfterRender=t=>{this.onToggleVisibility(t),this.enableToggle=!0},this.bindEvents()}update(t){this.unbindEvents(),super.update(t),this.bindEvents(),this.onToggleVisibility({})}getLabelElements(){const{elementMap:t}=this.context.element,e=[];for(const n in t){const i=t[n];i.isVisible()&&i.getShape("label")&&e.push(i)}return e}getLabelElementsInView(){const t=this.context.viewport;return this.getLabelElements().filter((e=>t.isInViewport(e.getShape("key").getRenderBounds())))}bindEvents(){const{graph:t}=this.context;t.on(v.BEFORE_RENDER,this.onBeforeRender),t.on(v.AFTER_RENDER,this.onAfterRender),t.on(v.AFTER_DRAW,this.toggle),t.on(v.AFTER_LAYOUT,this.toggle),t.on(v.AFTER_TRANSFORM,this.onTransform)}unbindEvents(){const{graph:t}=this.context;t.off(v.BEFORE_RENDER,this.onBeforeRender),t.off(v.AFTER_RENDER,this.onAfterRender),t.off(v.AFTER_DRAW,this.toggle),t.off(v.AFTER_LAYOUT,this.toggle),t.off(v.AFTER_TRANSFORM,this.onTransform)}validate(t){if(this.destroyed)return!1;const{enable:e}=this.options;return(0,W.Z)(e)?e(t):!!e}destroy(){this.unbindEvents(),super.destroy()}}ae.defaultOptions={enable:!0,throttle:100,padding:0,sortNode:{type:"degree"}};var le=n(83787);const he=[0,0,0];function ce(t,e){return t.map(((t,n)=>t+e[n]))}function de(t,e){return t.map(((t,n)=>t-e[n]))}function ue(t,e){return"number"==typeof e?t.map((t=>t*e)):t.map(((t,n)=>t*e[n]))}function pe(t,e){return"number"==typeof e?t.map((t=>t/e)):t.map(((t,n)=>t/e[n]))}function ge(t,e){return t.map((t=>t*e))}function fe(t,e){return Math.sqrt(t.reduce(((t,n,i)=>t+Math.pow(n-e[i]||0,2)),0))}function ye(t,e){return t.reduce(((t,n,i)=>t+Math.abs(n-e[i])),0)}function me(t){const e=t.reduce(((t,e)=>t+Math.pow(e,2)),0);return t.map((t=>t/Math.sqrt(e)))}function ve(t,e,n=!1){const i=t[0]*e[1]-t[1]*e[0];let s=Math.acos(ue(t,e).reduce(((t,e)=>t+e),0)/(fe(t,he)*fe(e,he)));return n&&i<0&&(s=2*Math.PI-s),s}function be(t,e=!0){return e?[-t[1],t[0]]:[t[1],-t[0]]}function Ee(t,e){return t.map((t=>t%e))}function xe(t){return[t[0],t[1]]}function we(t){return function(t){return 2===t.length}(t)?[t[0],t[1],0]:t}function Oe(t){const[e,n]=t;return e||n?Math.atan2(n,e):0}function Se(t,e){const[n,i]=t,[s,o]=e;return function(t,e){const n=we(t),i=we(e);return[n[1]*i[2]-n[2]*i[1],n[2]*i[0]-n[0]*i[2],n[0]*i[1]-n[1]*i[0]]}(de(n,i),de(s,o)).every((t=>0===t))}function De(t,e,n=!1){if(Se(t,e))return;const[i,s]=t,[o,r]=e,a=((i[0]-o[0])*(o[1]-r[1])-(i[1]-o[1])*(o[0]-r[0]))/((i[0]-s[0])*(o[1]-r[1])-(i[1]-s[1])*(o[0]-r[0])),l=r[0]-o[0]?(i[0]-o[0]+a*(s[0]-i[0]))/(r[0]-o[0]):(i[1]-o[1]+a*(s[1]-i[1]))/(r[1]-o[1]);return n||q(a,0,1)&&q(l,0,1)?[i[0]+a*(s[0]-i[0]),i[1]+a*(s[1]-i[1])]:void 0}function Ce(t){if(Array.isArray(t))return q(t[0],0,1)&&q(t[1],0,1)?t:[.5,.5];const e=t.split("-");return[e.includes("left")?0:e.includes("right")?1:.5,e.includes("top")?0:e.includes("bottom")?1:.5]}function Me(t){const{x:e=0,y:n=0,z:i=0}=t.style||{};return[+e,+n,+i]}function Te(t){const{x:e,y:n,z:i}=t.style||{};return void 0!==e||void 0!==n||void 0!==i}function Pe(t,e){const[n,i]=e,{min:s,max:o}=t;return[s[0]+n*(o[0]-s[0]),s[1]+i*(o[1]-s[1])]}function Ae(t,e="center"){return Pe(t,Ce(e))}function Re(t){var e;return[t.x,t.y,null!==(e=t.z)&&void 0!==e?e:0]}function Le(t){var e;return{x:t[0],y:t[1],z:null!==(e=t[2])&&void 0!==e?e:0}}function ke(t,e=0){return t.map((t=>parseFloat(t.toFixed(e))))}function Ne(t,e,n,i=!1){if((0,a.Z)(t,e))return t;const s=me(i?de(t,e):de(e,t)),o=[s[0]*n,s[1]*n];return ce(xe(t),o)}function Ie(t,e){return t[1]===e[1]}function je(t,e,n){return Se([t,e],[e,n])}function Be(t,e){return[2*e[0]-t[0],2*e[1]-t[1]]}function ze(t,e,n,i=!0,s=!1){for(let o=0;o<n.length;o++){let r=n[o],a=n[(o+1)%n.length];i&&(r=ce(e,r),a=ce(e,a));const l=De([e,s?Be(t,e):t],[r,a]);if(l)return{point:l,line:[r,a]}}return{point:e,line:void 0}}function Fe(t,e,n=!1){const i=e.center,s=de(n?Be(t,i):t,e.center),o=Math.atan2(s[1],s[0]);if(isNaN(o))return i;const r=tt(e)/2,a=et(e)/2;return[i[0]+r*Math.cos(o),i[1]+a*Math.sin(o)]}function _e(t,e){return fe(t,Ze(t,e))}function Ze(t,e){const[n,i]=e[0],[s,o]=e[1],[r,a]=t,l=s-n,h=o-i;if(0===l&&0===h)return[n,i];let c=((r-n)*l+(a-i)*h)/(l*l+h*h);c>1?c=1:c<0&&(c=0);return[n+c*l,i+c*h]}function $e(t,e=!0){const n=function(t){return pe(t.reduce(((t,e)=>ce(t,e)),[0,0]),t.length)}(t);return t.sort((([t,i],[s,o])=>{const r=Math.atan2(i-n[1],t-n[0]),a=Math.atan2(o-n[1],s-n[0]);return e?a-r:r-a}))}function Ve(t,e){return[t,[t[0],e[1]],e,[e[0],t[1]]]}var We=n(76714);class He{constructor(t,e,n){if(this.phase=e,this.pointerByTouch=[],this.initialDistance=null,this.emitter=t,He.instance)return He.callbacks[this.phase].push(n),He.instance;this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.bindEvents(),He.instance=this,He.callbacks[this.phase].push(n)}bindEvents(){const{emitter:t}=this;t.on(f.POINTER_DOWN,this.onPointerDown),t.on(f.POINTER_MOVE,this.onPointerMove),t.on(f.POINTER_UP,this.onPointerUp)}updatePointerPosition(t,e,n){const i=this.pointerByTouch.findIndex((e=>e.pointerId===t));i>=0&&(this.pointerByTouch[i]={x:e,y:n,pointerId:t})}onPointerDown(t){const{x:e,y:n}=t.client||{};if(void 0!==e&&void 0!==n&&(this.pointerByTouch.push({x:e,y:n,pointerId:t.pointerId}),"touch"===t.pointerType&&2===this.pointerByTouch.length)){He.isPinching=!0;const e=this.pointerByTouch[0].x-this.pointerByTouch[1].x,n=this.pointerByTouch[0].y-this.pointerByTouch[1].y;this.initialDistance=Math.sqrt(e*e+n*n),He.callbacks.pinchstart.forEach((e=>e(t,{scale:0})))}}onPointerMove(t){if(2!==this.pointerByTouch.length||null===this.initialDistance)return;const{x:e,y:n}=t.client||{};if(void 0===e||void 0===n)return;this.updatePointerPosition(t.pointerId,e,n);const i=this.pointerByTouch[0].x-this.pointerByTouch[1].x,s=this.pointerByTouch[0].y-this.pointerByTouch[1].y,o=Math.sqrt(i*i+s*s)/this.initialDistance;He.callbacks.pinchmove.forEach((e=>e(t,{scale:5*(o-1)})))}onPointerUp(t){var e;He.callbacks.pinchend.forEach((e=>e(t,{scale:0}))),He.isPinching=!1,this.initialDistance=null,this.pointerByTouch=[],null===(e=He.instance)||void 0===e||e.tryDestroy()}destroy(){this.emitter.off(f.POINTER_DOWN,this.onPointerDown),this.emitter.off(f.POINTER_MOVE,this.onPointerMove),this.emitter.off(f.POINTER_UP,this.onPointerUp),He.instance=null}off(t,e){const n=He.callbacks[t].indexOf(e);n>-1&&He.callbacks[t].splice(n,1),this.tryDestroy()}tryDestroy(){Object.values(He.callbacks).every((t=>0===t.length))&&this.destroy()}}He.isPinching=!1,He.instance=null,He.callbacks={pinchstart:[],pinchmove:[],pinchend:[]};const Ye=t=>t.map((t=>(0,We.Z)(t)?t.toLocaleLowerCase():t));class Ge{constructor(t){this.map=new Map,this.boundHandlePinch=()=>{},this.recordKey=new Set,this.onKeyDown=t=>{(null==t?void 0:t.key)&&(this.recordKey.add(t.key),this.trigger(t))},this.onKeyUp=t=>{(null==t?void 0:t.key)&&this.recordKey.delete(t.key)},this.onWheel=t=>{this.triggerExtendKey(f.WHEEL,t)},this.onDrag=t=>{this.triggerExtendKey(f.DRAG,t)},this.handlePinch=(t,e)=>{this.triggerExtendKey(f.PINCH,Object.assign(Object.assign({},t),e))},this.onFocus=()=>{this.recordKey.clear()},this.emitter=t,this.bindEvents()}bind(t,e){0!==t.length&&(t.includes(f.PINCH)&&!this.pinchHandler&&(this.boundHandlePinch=this.handlePinch.bind(this),this.pinchHandler=new He(this.emitter,"pinchmove",this.boundHandlePinch)),this.map.set(t,e))}unbind(t,e){this.map.forEach(((n,i)=>{(0,a.Z)(i,t)&&(e&&e!==n||this.map.delete(i))}))}unbindAll(){this.map.clear()}match(t){const e=Ye(Array.from(this.recordKey)).sort(),n=Ye(t).sort();return(0,a.Z)(e,n)}bindEvents(){var t;const{emitter:e}=this;e.on(f.KEY_DOWN,this.onKeyDown),e.on(f.KEY_UP,this.onKeyUp),e.on(f.WHEEL,this.onWheel),e.on(f.DRAG,this.onDrag),null===(t=globalThis.addEventListener)||void 0===t||t.call(globalThis,"focus",this.onFocus)}trigger(t){this.map.forEach(((e,n)=>{this.match(n)&&e(t)}))}triggerExtendKey(t,e){this.map.forEach(((n,i)=>{i.includes(t)&&(0,a.Z)(Array.from(this.recordKey),i.filter((e=>e!==t)))&&n(e)}))}destroy(){var t,e;this.unbindAll(),this.emitter.off(f.KEY_DOWN,this.onKeyDown),this.emitter.off(f.KEY_UP,this.onKeyUp),this.emitter.off(f.WHEEL,this.onWheel),this.emitter.off(f.DRAG,this.onDrag),null===(t=this.pinchHandler)||void 0===t||t.off("pinchmove",this.boundHandlePinch),null===(e=globalThis.removeEventListener)||void 0===e||e.call(globalThis,"blur",this.onFocus)}}class Ue extends re{constructor(t,e){super(t,(0,le.Z)({},Ue.defaultOptions,e)),this.shortcut=new Ge(t.graph),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.clearStates=this.clearStates.bind(this),this.bindEvents()}onPointerDown(t){if(!this.validate(t)||!this.isKeydown()||this.startPoint)return;const{canvas:e,graph:n}=this.context,i=Object.assign({},this.options.style);this.options.style.lineWidth&&(i.lineWidth=+this.options.style.lineWidth/n.getZoom()),this.rectShape=new s.UL({id:"g6-brush-select",style:i}),e.appendChild(this.rectShape),this.startPoint=[t.canvas.x,t.canvas.y]}onPointerMove(t){var e;if(!this.startPoint)return;const{immediately:n,mode:i}=this.options;this.endPoint=Ke(t),null===(e=this.rectShape)||void 0===e||e.attr({x:Math.min(this.endPoint[0],this.startPoint[0]),y:Math.min(this.endPoint[1],this.startPoint[1]),width:Math.abs(this.endPoint[0]-this.startPoint[0]),height:Math.abs(this.endPoint[1]-this.startPoint[1])}),n&&"default"===i&&this.updateElementsStates(Ve(this.startPoint,this.endPoint))}onPointerUp(t){this.startPoint&&(this.endPoint?(this.endPoint=Ke(t),this.updateElementsStates(Ve(this.startPoint,this.endPoint)),this.clearBrush()):this.clearBrush())}clearStates(){this.endPoint||this.clearElementsStates()}clearElementsStates(){const{graph:t}=this.context,e=Object.values(t.getData()).reduce(((t,e)=>Object.assign({},t,e.reduce(((t,e)=>(t[Ht(e)]=[],t)),{}))),{});t.setElementState(e,this.options.animation)}updateElementsStates(t){const{graph:e}=this.context,{enableElements:n,state:i,mode:s,onSelect:o}=this.options,r=this.selector(e,t,n);let a={};switch(s){case"union":r.forEach((t=>{a[t]=[...e.getElementState(t),i]}));break;case"diff":r.forEach((t=>{const n=e.getElementState(t);a[t]=n.includes(i)?n.filter((t=>t!==i)):[...n,i]}));break;case"intersect":r.forEach((t=>{const n=e.getElementState(t);a[t]=n.includes(i)?[i]:[]}));break;default:r.forEach((t=>{a[t]=[i]}))}(0,W.Z)(o)&&(a=o(a)),e.setElementState(a,this.options.animation)}selector(t,e,n){if(!n||0===n.length)return[];const i=[],s=t.getData();if(n.forEach((n=>{s[`${n}s`].forEach((n=>{const s=Ht(n);"hidden"!==t.getElementVisibility(s)&&function(t,e,n,i){const s=t[0],o=t[1];let r=!1;void 0===n&&(n=0),void 0===i&&(i=e.length);const a=i-n;for(let t=0,i=a-1;t<a;i=t++){const a=e[t+n][0],l=e[t+n][1],h=e[i+n][0],c=e[i+n][1];l>o!=c>o&&s<(h-a)*(o-l)/(c-l)+a&&(r=!r)}return r}(t.getElementPosition(s),e)&&i.push(s)}))})),n.includes("edge")){const t=s.edges;null==t||t.forEach((t=>{const{source:e,target:n}=t;i.includes(e)&&i.includes(n)&&i.push(Ht(t))}))}return i}clearBrush(){var t;null===(t=this.rectShape)||void 0===t||t.remove(),this.rectShape=void 0,this.startPoint=void 0,this.endPoint=void 0}isKeydown(){const{trigger:t}=this.options,e=Array.isArray(t)?t:[t];return this.shortcut.match(e.filter((t=>"drag"!==t)))}validate(t){if(this.destroyed)return!1;const{enable:e}=this.options;return(0,W.Z)(e)?e(t):!!e}bindEvents(){const{graph:t}=this.context;t.on(f.POINTER_DOWN,this.onPointerDown),t.on(f.POINTER_MOVE,this.onPointerMove),t.on(f.POINTER_UP,this.onPointerUp),t.on(p.CLICK,this.clearStates)}unbindEvents(){const{graph:t}=this.context;t.off(f.POINTER_DOWN,this.onPointerDown),t.off(f.POINTER_MOVE,this.onPointerMove),t.off(f.POINTER_UP,this.onPointerUp),t.off(p.CLICK,this.clearStates)}update(t){this.unbindEvents(),this.options=(0,le.Z)(this.options,t),this.bindEvents()}destroy(){this.unbindEvents(),super.destroy()}}Ue.defaultOptions={animation:!1,enable:!0,enableElements:["node","combo","edge"],immediately:!1,mode:"default",state:"selected",trigger:["shift"],style:{width:0,height:0,lineWidth:1,fill:"#1677FF",stroke:"#1677FF",fillOpacity:.1,zIndex:2,pointerEvents:"none"}};const Ke=t=>[t.canvas.x,t.canvas.y],Xe=.8,qe=["node","edge","combo"];function Je(t,e,n,i,s=0){"TB"===i&&e(t,s);const o=n(t);if(o)for(const t of o)Je(t,e,n,i,s+1);"BT"===i&&e(t,s)}function Qe(t,e,n,i,s="both"){if("combo"===e||"node"===e)return tn(t,n,i,s);const o=t.getEdgeData(n);if(!o)return[];const r=tn(t,o.source,i-1,s),a=tn(t,o.target,i-1,s);return Array.from(new Set([...r,...a,n]))}function tn(t,e,n,i="both"){const s=new Set,o=new Set,r=new Set;return function(t,e,n){const i=[[t,0]];for(;i.length;){const[t,s]=i.shift();e(t,s);const o=n(t);if(o)for(const t of o)i.push([t,s+1])}}(e,((e,s)=>{s>n||(r.add(e),t.getRelatedEdgesData(e,i).forEach((t=>{const e=Ht(t);!o.has(e)&&s<n&&(r.add(e),o.add(e))})))}),(e=>t.getRelatedEdgesData(e,i).map((t=>t.source===e?t.target:t.source)).filter((t=>!s.has(t)&&(s.add(t),!0))))),Array.from(r)}function en(t){return t.states||[]}var nn=function(t,e,n,i){return new(n||(n=Promise))((function(s,o){function r(t){try{l(i.next(t))}catch(t){o(t)}}function a(t){try{l(i.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,a)}l((i=i.apply(t,e||[])).next())}))};class sn extends re{constructor(t,e){super(t,Object.assign({},sn.defaultOptions,e)),this.onClickSelect=t=>nn(this,void 0,void 0,(function*(){var e,n;this.validate(t)&&(yield this.updateState(t),null===(n=(e=this.options).onClick)||void 0===n||n.call(e,t))})),this.onClickCanvas=t=>nn(this,void 0,void 0,(function*(){var e,n;this.validate(t)&&(yield this.clearState(),null===(n=(e=this.options).onClick)||void 0===n||n.call(e,t))})),this.shortcut=new Ge(t.graph),this.bindEvents()}bindEvents(){const{graph:t}=this.context;this.unbindEvents(),qe.forEach((e=>{t.on(`${e}:${f.CLICK}`,this.onClickSelect)})),t.on(p.CLICK,this.onClickCanvas)}get isMultipleSelect(){const{multiple:t,trigger:e}=this.options;return t&&this.shortcut.match(e)}getNeighborIds(t){const{target:e,targetType:n}=t,{graph:i}=this.context,{degree:s}=this.options;return Qe(i,n,e.id,"function"==typeof s?s(t):s).filter((t=>t!==e.id))}updateState(t){return nn(this,void 0,void 0,(function*(){const{state:e,unselectedState:n,neighborState:i,animation:s}=this.options;if(!e&&!i&&!n)return;const{target:o}=t,{graph:r}=this.context,a=en(r.getElementData(o.id)).includes(e)?"unselect":"select",l={},h=this.isMultipleSelect,c=[o.id],d=this.getNeighborIds(t);if(h)if(Object.assign(l,this.getDataStates()),"select"===a){const t=(t,e)=>{t.forEach((t=>{const i=new Set(r.getElementState(t));i.add(e),i.delete(n),l[t]=Array.from(i)}))};t(c,e),t(d,i),n&&Object.keys(l).forEach((t=>{const s=l[t];s.includes(e)||s.includes(i)||s.includes(n)||l[t].push(n)}))}else{const t=l[o.id];l[o.id]=t.filter((t=>t!==e&&t!==i)),t.includes(n)||l[o.id].push(n),d.forEach((t=>{l[t]=l[t].filter((t=>t!==i)),l[t].includes(e)||l[t].push(n)}))}else if("select"===a){Object.assign(l,this.getClearStates(!!n));const t=(t,e)=>{t.forEach((t=>{l[t]||(l[t]=r.getElementState(t)),l[t].push(e)}))};t(c,e),t(d,i),n&&Object.keys(l).forEach((t=>{c.includes(t)||d.includes(t)||l[t].push(n)}))}else Object.assign(l,this.getClearStates());yield r.setElementState(l,s)}))}getDataStates(){const{graph:t}=this.context,{nodes:e,edges:n,combos:i}=t.getData(),s={};return[...e,...n,...i].forEach((t=>{s[Ht(t)]=en(t)})),s}getClearStates(t=!1){const{graph:e}=this.context,{state:n,unselectedState:i,neighborState:s}=this.options,o=new Set([n,i,s]),{nodes:r,edges:a,combos:l}=e.getData(),h={};return[...r,...a,...l].forEach((e=>{const n=en(e),i=n.filter((t=>!o.has(t)));(t||i.length!==n.length)&&(h[Ht(e)]=i)})),h}clearState(){return nn(this,void 0,void 0,(function*(){const{graph:t}=this.context;yield t.setElementState(this.getClearStates(),this.options.animation)}))}validate(t){if(this.destroyed)return!1;const{enable:e}=this.options;return(0,W.Z)(e)?e(t):!!e}unbindEvents(){const{graph:t}=this.context;qe.forEach((e=>{t.off(`${e}:${f.CLICK}`,this.onClickSelect)})),t.off(p.CLICK,this.onClickCanvas)}destroy(){this.unbindEvents(),super.destroy()}}function on(t){var e;return!!(null===(e=t.style)||void 0===e?void 0:e.collapsed)}sn.defaultOptions={animation:!0,enable:!0,multiple:!1,trigger:["shift"],state:"selected",neighborState:"selected",unselectedState:void 0,degree:0};var rn=n(53032),an=n(17829),ln=n(73576);function hn(t,e){if(!t.startsWith(e))return!1;const n=t[e.length];return n>="A"&&n<="Z"}function cn(t,e){return`${e}${(0,o.Z)(t)}`}function dn(t,e,n=!0){if(!e)return t;if(!hn(t,e))return t;const i=t.slice(e.length);return n?(0,ln.Z)(i):i}function un(t,e){const n=Object.entries(t).reduce(((t,[n,i])=>("className"===n||"class"===n||hn(n,e)&&Object.assign(t,{[dn(n,e)]:i}),t)),{});if("opacity"in t){const i=cn("opacity",e),s=t.opacity;if(i in t){const e=t[i];Object.assign(n,{opacity:s*e})}else Object.assign(n,{opacity:s})}return n}function pn(t,e){const n=e.length;return Object.keys(t).reduce(((i,s)=>{if(s.startsWith(e)){i[s.slice(n)]=t[s]}return i}),{})}function gn(t,e){const n="string"==typeof e?[e]:e,i={};return Object.keys(t).forEach((e=>{n.find((t=>e.startsWith(t)))||(i[e]=t[e])})),i}function fn(t=0){if("number"==typeof t)return[t,t,t];const[e,n=e,i=e]=t;return[e,n,i]}var yn=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(n[i[s]]=t[i[s]])}return n};function mn(t,e){const{datum:n,graph:i}=e;return"function"==typeof t?t.call(i,n):Object.fromEntries(Object.entries(t).map((([t,e])=>"function"==typeof e?[t,e.call(i,n)]:[t,e])))}function vn(t,e){const n=(null==t?void 0:t.style)||{},i=(null==e?void 0:e.style)||{};for(const t in n)t in i||(i[t]=n[t]);return Object.assign({},t,e,{style:i})}function bn(t){if(t)return"string"==typeof t||"function"==typeof t||Array.isArray(t)?{type:"group",field:t=>t.id,color:t,invert:!1}:t}function En(t){const e="string"==typeof t?D("palette",t):t;if("function"!=typeof e)return e}function xn(t,e){let n=2*t;return"string"==typeof e?n=t*Number(e.replace("%",""))/100:"number"==typeof e&&(n=e),isNaN(n)&&(n=2*t),n}function wn(t,e,n=1,i=!1){const s=i?n:1;return xn((t.max[0]-t.min[0])*s,e)}var On=n(82844),Sn={}.toString,Dn=function(t){return Sn.call(t).replace(/^\[object /,"").replace(/]$/,"")},Cn=Object.prototype,Mn=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||Cn)},Tn=Object.prototype.hasOwnProperty;var Pn=function(t){if((0,r.Z)(t))return!0;if((0,On.Z)(t))return!t.length;var e=Dn(t);if("Map"===e||"Set"===e)return!t.size;if(Mn(t))return!Object.keys(t).length;for(var n in t)if(Tn.call(t,n))return!1;return!0};class An extends s.b_{constructor(t){Ln(t.style),super(t),this.shapeMap={},this.animateMap={},this.render(this.attributes,this),this.setVisibility(),this.bindEvents()}get parsedAttributes(){return this.attributes}upsert(t,e,n,i,s){var o,r,a,l,h,c,d,u;const p=this.shapeMap[t];if(!1===n)return void(p&&(null===(o=null==s?void 0:s.beforeDestroy)||void 0===o||o.call(s,p),i.removeChild(p),delete this.shapeMap[t],null===(r=null==s?void 0:s.afterDestroy)||void 0===r||r.call(s,p)));const g="string"==typeof e?D(O.SHAPE,e):e;if(!g)throw new Error(C(`Shape ${e} not found`));if(!p||p.destroyed||!(p instanceof g)){p&&(null===(a=null==s?void 0:s.beforeDestroy)||void 0===a||a.call(s,p),null==p||p.destroy(),null===(l=null==s?void 0:s.afterDestroy)||void 0===l||l.call(s,p)),null===(h=null==s?void 0:s.beforeCreate)||void 0===h||h.call(s);const e=new g({className:t,style:n});return i.appendChild(e),this.shapeMap[t]=e,null===(c=null==s?void 0:s.afterCreate)||void 0===c||c.call(s,e),e}return null===(d=null==s?void 0:s.beforeUpdate)||void 0===d||d.call(s,p),Ds(p,n),null===(u=null==s?void 0:s.afterUpdate)||void 0===u||u.call(s,p),p}update(t={}){const e=Object.assign({},this.attributes,t);Ln(e),function(t,e){const{zIndex:n,transform:i,transformOrigin:s,visibility:o,cursor:r,clipPath:a,component:l}=e,h=ds(e,["zIndex","transform","transformOrigin","visibility","cursor","clipPath","component"]);Object.assign(t.attributes,h),i&&t.setAttribute("transform",i);(0,N.Z)(n)&&t.setAttribute("zIndex",n);s&&t.setAttribute("transformOrigin",s);o&&t.setAttribute("visibility",o);r&&t.setAttribute("cursor",r);a&&t.setAttribute("clipPath",a);l&&t.setAttribute("component",l)}(this,e),this.render(e,this),this.setVisibility()}bindEvents(){}getGraphicStyle(t){return function(t){const{x:e,y:n,z:i,class:s,className:o,transform:r,transformOrigin:a,zIndex:l,visibility:h}=t;return yn(t,["x","y","z","class","className","transform","transformOrigin","zIndex","visibility"])}(t)}get compositeShapes(){return[["badges","badge-"],["ports","port-"]]}animate(t,e){if(0===t.length)return null;const n=[];if(void 0!==t[0].x||void 0!==t[0].y||void 0!==t[0].z){const{x:e=0,y:n=0,z:i=0}=this.attributes;t.forEach((t=>{const{x:s=e,y:o=n,z:r=i}=t;Object.assign(t,{transform:r?[["translate3d",s,o,r]]:[["translate",s,o]]})}))}const i=super.animate(t,e);if(i&&(Rn(this,i),n.push(i)),Array.isArray(t)&&t.length>0){const i=["transform","transformOrigin","x","y","z","zIndex"];if(Object.keys(t[0]).some((t=>!i.includes(t)))){Object.entries(this.shapeMap).forEach((([i,s])=>{const r=this[`get${(0,o.Z)(i)}Style`];if((0,W.Z)(r)){const i=t.map((t=>r.call(this,Object.assign(Object.assign({},this.attributes),t)))),o=s.animate(A(i),e);o&&(Rn(s,o),n.push(o))}}));const i=(i,s)=>{if(!Pn(i)){const r=this[`get${(0,o.Z)(s)}Style`];if((0,W.Z)(r)){const s=t.map((t=>r.call(this,Object.assign(Object.assign({},this.attributes),t))));Object.entries(s[0]).map((([t])=>{const o=s.map((e=>e[t])),r=i[t];if(r){const t=r.animate(A(o),e);t&&(Rn(r,t),n.push(t))}}))}}};this.compositeShapes.forEach((([t,e])=>{const n=pn(this.shapeMap,e);i(n,t)}))}}return P(n)}getShape(t){return this.shapeMap[t]}setVisibility(){const{visibility:t}=this.attributes;ie(this,t)}destroy(){this.shapeMap={},this.animateMap={},super.destroy()}}function Rn(t,e){null==e||e.finished.then((()=>{const n=t.activeAnimations.findIndex((t=>t===e));n>-1&&t.activeAnimations.splice(n,1)}))}function Ln(t){if(!t)return{};if("x"in t||"y"in t||"z"in t){const{x:e=0,y:n=0,z:i,transform:s}=t,o=I(e,n,i,s);o&&(t.transform=o)}return t}var kn=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(n[i[s]]=t[i[s]])}return n};class Nn extends An{constructor(t){super(vn({style:Nn.defaultStyleProps},t))}isTextStyle(t){return hn(t,"label")}isBackgroundStyle(t){return hn(t,"background")}getTextStyle(t){const e=this.getGraphicStyle(t),{padding:n}=e;return gn(kn(e,["padding"]),"background")}getBackgroundStyle(t){if(!1===t.background)return!1;const e=this.getGraphicStyle(t),{wordWrap:n,wordWrapWidth:i,padding:s}=e,o=un(e,"background"),{min:[r,a],center:[l,h],halfExtents:[c,d]}=this.shapeMap.text.getGeometryBounds(),[u,p,g,f]=J(s),y=2*c+f+p,{width:m,height:v}=o;m&&v?Object.assign(o,{x:l-Number(m)/2,y:h-Number(v)/2}):Object.assign(o,{x:r-f,y:a-u,width:n?Math.min(y,i+f+p):y,height:2*d+u+g});const{radius:b}=o;if("string"==typeof b&&b.endsWith("%")){const t=Number(b.replace("%",""))/100;o.radius=Math.min(+o.width,+o.height)*t}return o}render(t=this.parsedAttributes,e=this){this.upsert("text",s.xv,this.getTextStyle(t),e),this.upsert("background",s.UL,this.getBackgroundStyle(t),e)}getGeometryBounds(){return(this.getShape("background")||this.getShape("text")).getGeometryBounds()}}Nn.defaultStyleProps={padding:0,fontSize:12,fontFamily:"system-ui, sans-serif",wordWrap:!0,maxLines:1,wordWrapWidth:128,textOverflow:"...",textBaseline:"middle",backgroundOpacity:.75,backgroundZIndex:-1,backgroundLineWidth:0};class In extends An{constructor(t){super(vn({style:In.defaultStyleProps},t))}getBadgeStyle(t){return this.getGraphicStyle(t)}render(t=this.parsedAttributes,e=this){this.upsert("label",Nn,this.getBadgeStyle(t),e)}getGeometryBounds(){const t=this.getShape("label");return(t.getShape("background")||t.getShape("text")).getGeometryBounds()}}In.defaultStyleProps={padding:[2,4,2,4],fontSize:10,wordWrap:!1,backgroundRadius:"50%",backgroundOpacity:1};const jn={M:["x","y"],m:["dx","dy"],H:["x"],h:["dx"],V:["y"],v:["dy"],L:["x","y"],l:["dx","dy"],Z:[],z:[],C:["x1","y1","x2","y2","x","y"],c:["dx1","dy1","dx2","dy2","dx","dy"],S:["x2","y2","x","y"],s:["dx2","dy2","dx","dy"],Q:["x1","y1","x","y"],q:["dx1","dy1","dx","dy"],T:["x","y"],t:["dx","dy"],A:["rx","ry","rotation","large-arc","sweep","x","y"],a:["rx","ry","rotation","large-arc","sweep","dx","dy"]};function Bn(t){const e=[],n="string"==typeof t?function(t){const e=t.replace(/[\n\r]/g,"").replace(/-/g," -").replace(/(\d*\.)(\d+)(?=\.)/g,"$1$2 ").trim().split(/\s*,|\s+/),n=[];let i="",s={};for(;e.length>0;){let t=e.shift();t in jn?i=t:e.unshift(t),s={type:i},jn[i].forEach((n=>{t=e.shift(),s[n]=t})),"M"===i?i="L":"m"===i&&(i="l");const[o,...r]=Object.values(s);n.push([o,...r.map(Number)])}return n}(t):t;return n.forEach((t=>{const n=t[0];if("Z"!==n)if("A"!==n)for(let n=1;n<t.length;n+=2)e.push([t[n],t[n+1],0]);else{const n=t.length;e.push([t[n-2],t[n-1],0])}else e.push(e[0])})),e}const zn=t=>{if(t.length<2)return[["M",0,0],["L",0,0]];const e=t[0],n=t[1],i=t[t.length-1],s=t[t.length-2];t.unshift(s,i),t.push(e,n);const o=[["M",i[0],i[1]]];for(let e=1;e<t.length-2;e+=1){const[n,i]=t[e-1],[s,r]=t[e],[a,l]=t[e+1],[h,c]=e!==t.length-2?t[e+2]:[a,l],d=s+(a-n)/6,u=r+(l-i)/6,p=a-(h-s)/6,g=l-(c-r)/6;o.push(["C",d,u,p,g,a,l])}return o};function Fn(t,e,n,i,s,o,r){const[l,h]=Ae(t,e),c={textAlign:"left"===e?"right":"right"===e?"left":"center",textBaseline:"top"===e?"bottom":"bottom"===e?"top":"middle",transform:[["translate",l+n,h+i]]};if("center"===e||!s)return c;const d=Bn(o);if(!d||d.length<=3)return c;const u=d.map(((t,e)=>{const n=t,i=d[(e+1)%d.length];return(0,a.Z)(n,i)?null:[n,i]})).filter(Boolean),p=function(t,e){let n=1/0,i=[[0,0],[0,0]];return e.forEach((e=>{const s=_e(t,e);s<n&&(n=s,i=e)})),i}([l,h],u),g=Ze([l,h],p);if(g&&p&&(c.transform=[["translate",g[0]+n,g[1]+i]],r)){const t=Math.atan((p[0][1]-p[1][1])/(p[0][0]-p[1][0]));c.transform.push(["rotate",t/Math.PI*180]),c.textAlign="center","right"!==e&&"left"!==e||(c.textBaseline=t>0?"right"===e?"bottom":"top":"right"===e?"top":"bottom")}return c}var _n=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(n[i[s]]=t[i[s]])}return n};class Zn extends An{constructor(t){super(vn({style:Zn.defaultStyleProps},t))}getLabelStyle(t){if(!t.label||!t.d||0===t.d.length)return!1;const e=un(this.getGraphicStyle(t),"label"),{maxWidth:n,offsetX:i,offsetY:s,autoRotate:o,placement:r,closeToPath:a}=e,l=_n(e,["maxWidth","offsetX","offsetY","autoRotate","placement","closeToPath"]),h=this.shapeMap.key,c=null==h?void 0:h.getRenderBounds();return Object.assign(Fn(c,r,i,s,a,t.d,o),{wordWrapWidth:wn(c,n)},l)}getKeyStyle(t){return this.getGraphicStyle(t)}render(t,e){this.upsert("key",s.y$,this.getKeyStyle(t),e),this.upsert("label",Nn,this.getLabelStyle(t),e)}}Zn.defaultStyleProps={label:!0,labelPlacement:"bottom",labelCloseToPath:!0,labelAutoRotate:!0,labelOffsetX:0,labelOffsetY:0};class $n extends s.Ee{constructor(t){super(t),this.onMounted=()=>{this.handleRadius()},this.onAttrModified=()=>{this.handleRadius()},Wn=this,this.isMutationObserved=!0,this.addEventListener(s.Dk.MOUNTED,this.onMounted),this.addEventListener(s.Dk.ATTR_MODIFIED,this.onAttrModified)}handleRadius(){const{radius:t,clipPath:e,width:n=0,height:i=0}=this.attributes;if(t&&n&&i){const[o,r]=this.getBounds().min,a={x:o,y:r,radius:t,width:n,height:i};if(e)Object.assign(this.parsedStyle.clipPath.style,a);else{const t=new s.UL({style:a});this.style.clipPath=t}}else e&&(this.style.clipPath=null)}}const Vn=new WeakMap;let Wn=null;const Hn=t=>{if(Wn&&function(t){const e=[];let n=t.parentNode;for(;n;)e.push(n),n=n.parentNode;return e}(Wn).includes(t)){const e=Vn.get(t);e?e.includes(Wn)||e.push(Wn):Vn.set(t,[Wn])}},Yn=t=>{const e=Vn.get(t);e&&e.forEach((t=>t.handleRadius()))};class Gn extends An{constructor(t){super(t)}isImage(){const{src:t}=this.attributes;return!!t}getIconStyle(t=this.attributes){const{width:e=0,height:n=0}=t,i=this.getGraphicStyle(t);return this.isImage()?Object.assign({x:-e/2,y:-n/2},i):Object.assign({textBaseline:"middle",textAlign:"center"},i)}render(t=this.attributes,e=this){this.upsert("icon",this.isImage()?$n:s.xv,this.getIconStyle(t),e)}}class Un extends An{get context(){return this.config.context}get parsedAttributes(){return this.attributes}onframe(){}animate(t,e){const n=super.animate(t,e);return n&&(n.onframe=()=>this.onframe(),n.finished.then((()=>this.onframe()))),n}}var Kn=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(n[i[s]]=t[i[s]])}return n};class Xn extends Un{constructor(t){super(vn({style:Xn.defaultStyleProps},t)),this.type="node"}getSize(t=this.attributes){const{size:e}=t;return fn(e)}getKeyStyle(t){const e=this.getGraphicStyle(t);return Object.assign(gn(e,["label","halo","icon","badge","port"]))}getLabelStyle(t){if(!1===t.label||!t.labelText)return!1;const e=un(this.getGraphicStyle(t),"label"),{placement:n,maxWidth:i,offsetX:s,offsetY:o}=e,r=Kn(e,["placement","maxWidth","offsetX","offsetY"]),a=this.getShape("key").getLocalBounds();return Object.assign(Ss(a,n,s,o),{wordWrapWidth:wn(a,i)},r)}getHaloStyle(t){if(!1===t.halo)return!1;const e=this.getKeyStyle(t),{fill:n}=e,i=Kn(e,["fill"]),s=un(this.getGraphicStyle(t),"halo");return Object.assign(Object.assign(Object.assign({},i),{stroke:n}),s)}getIconStyle(t){if(!1===t.icon||!t.iconText&&!t.iconSrc)return!1;const e=un(this.getGraphicStyle(t),"icon");return Object.assign(function(t,e){const n=fn(t);let i={};return e.text&&!e.fontSize&&(i={fontSize:.5*Math.min(...n)}),!e.src||e.width&&e.height||(i={width:.5*n[0],height:.5*n[1]}),i}(t.size,e),e)}getBadgesStyle(t){var e;const n=pn(this.shapeMap,"badge-"),i={};if(Object.keys(n).forEach((t=>{i[t]=!1})),!1===t.badge||!(null===(e=t.badges)||void 0===e?void 0:e.length))return i;const{badges:s=[],badgePalette:o,opacity:r=1}=t,a=Kn(t,["badges","badgePalette","opacity"]),l=En(o),h=un(this.getGraphicStyle(a),"badge");return s.forEach(((t,e)=>{i[e]=Object.assign(Object.assign({backgroundFill:l?l[e%(null==l?void 0:l.length)]:void 0,opacity:r},h),this.getBadgeStyle(t))})),i}getBadgeStyle(t){const e=this.getShape("key"),{placement:n="top",offsetX:i,offsetY:s}=t,o=Kn(t,["placement","offsetX","offsetY"]),r=Ss(e.getLocalBounds(),n,i,s,!0);return Object.assign(Object.assign({},r),o)}getPortsStyle(t){var e;const n=this.getPorts(),i={};if(Object.keys(n).forEach((t=>{i[t]=!1})),!1===t.port||!(null===(e=t.ports)||void 0===e?void 0:e.length))return i;const s=un(this.getGraphicStyle(t),"port"),{ports:o=[]}=t;return o.forEach(((e,n)=>{const o=e.key||n,r=Object.assign(Object.assign({},s),e);if(vs(r))i[o]=!1;else{const[n,s]=this.getPortXY(t,e);i[o]=Object.assign({transform:[["translate",n,s]]},r)}})),i}getPortXY(t,e){const{placement:n="left"}=e,i=this.getShape("key");return ys(function(t,e){if(!t)return e.getLocalBounds();const n=t.canvas.getLayer(),i=e.cloneNode();ie(i,"hidden"),n.appendChild(i);const s=i.getLocalBounds();return i.destroy(),s}(this.context,i),n)}getPorts(){return pn(this.shapeMap,"port-")}getCenter(){return this.getShape("key").getBounds().center}getIntersectPoint(t,e=!1){return function(t,e,n=!1){return ze(t,Ae(e,"center"),[Ae(e,"left-top"),Ae(e,"right-top"),Ae(e,"right-bottom"),Ae(e,"left-bottom")],!1,n).point}(t,this.getShape("key").getBounds(),e)}drawHaloShape(t,e){const n=this.getHaloStyle(t),i=this.getShape("key");this.upsert("halo",i.constructor,n,e)}drawIconShape(t,e){const n=this.getIconStyle(t);this.upsert("icon",Gn,n,e),Hn(this)}drawBadgeShapes(t,e){const n=this.getBadgesStyle(t);Object.keys(n).forEach((t=>{const i=n[t];this.upsert(`badge-${t}`,In,i,e)}))}drawPortShapes(t,e){const n=this.getPortsStyle(t);Object.keys(n).forEach((t=>{const i=n[t],o=`port-${t}`;this.upsert(o,s.Cd,i,e)}))}drawLabelShape(t,e){const n=this.getLabelStyle(t);this.upsert("label",Nn,n,e)}_drawKeyShape(t,e){return this.drawKeyShape(t,e)}render(t=this.parsedAttributes,e=this){this._drawKeyShape(t,e),this.getShape("key")&&(this.drawHaloShape(t,e),this.drawIconShape(t,e),this.drawBadgeShapes(t,e),this.drawLabelShape(t,e),this.drawPortShapes(t,e))}update(t){super.update(t),t&&("x"in t||"y"in t||"z"in t)&&Yn(this)}onframe(){this.drawBadgeShapes(this.parsedAttributes,this),this.drawLabelShape(this.parsedAttributes,this)}}Xn.defaultStyleProps={x:0,y:0,size:32,droppable:!0,draggable:!0,port:!0,ports:[],portZIndex:2,portLinkToCenter:!1,badge:!0,badges:[],badgeZIndex:3,halo:!1,haloDroppable:!1,haloLineDash:0,haloLineWidth:12,haloStrokeOpacity:.25,haloPointerEvents:"none",haloZIndex:-1,icon:!0,iconZIndex:1,label:!0,labelIsBillboard:!0,labelMaxWidth:"200%",labelPlacement:"bottom",labelWordWrap:!1,labelZIndex:0};class qn extends Xn{constructor(t){super(vn({style:qn.defaultStyleProps},t))}drawKeyShape(t,e){return this.upsert("key",s.Cd,this.getKeyStyle(t),e)}getKeyStyle(t){const e=super.getKeyStyle(t);return Object.assign(Object.assign({},e),{r:Math.min(...this.getSize(t))/2})}getIconStyle(t){const e=super.getIconStyle(t),{r:n}=this.getShape("key").attributes,i=2*n*Xe;return!!e&&Object.assign({width:i,height:i},e)}getIntersectPoint(t,e=!1){return Fe(t,this.getShape("key").getBounds(),e)}}qn.defaultStyleProps={size:32};class Jn extends Xn{constructor(t){super(t)}get parsedAttributes(){return this.attributes}drawKeyShape(t,e){return this.upsert("key",s.mg,this.getKeyStyle(t),e)}getKeyStyle(t){const e=super.getKeyStyle(t);return Object.assign(Object.assign({},e),{points:this.getPoints(t)})}getIntersectPoint(t,e=!1){var n,i;const{points:s}=this.getShape("key").attributes;return ze(t,[+((null===(n=this.attributes)||void 0===n?void 0:n.x)||0),+((null===(i=this.attributes)||void 0===i?void 0:i.y)||0)],s,!0,e).point}}var Qn=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(n[i[s]]=t[i[s]])}return n};class ti extends qn{constructor(t){super(vn({style:ti.defaultStyleProps},t))}parseOuterR(){const{size:t}=this.parsedAttributes;return Math.min(...fn(t))/2}parseInnerR(){const{innerR:t}=this.parsedAttributes;return(0,We.Z)(t)?parseInt(t)/100*this.parseOuterR():t}drawDonutShape(t,e){const{donuts:n}=t;if(!(null==n?void 0:n.length))return;const i=n.map((t=>(0,N.Z)(t)?{value:t}:t)),o=un(this.getGraphicStyle(t),"donut"),r=En(t.donutPalette);if(!r)return;const a=i.reduce(((t,e)=>{var n;return t+(null!==(n=e.value)&&void 0!==n?n:0)}),0),l=this.parseOuterR(),h=this.parseInnerR();let c=0;i.forEach(((t,n)=>{const{value:d=0,color:u=r[n%r.length]}=t,p=Qn(t,["value","color"]),g=360*(0===a?1/i.length:d/a);this.upsert(`round${n}`,s.y$,Object.assign(Object.assign(Object.assign({},o),{d:ni(l,h,c,c+g),fill:u}),p),e),c+=g}))}render(t,e=this){super.render(t,e),this.drawDonutShape(t,e)}}ti.defaultStyleProps={innerR:"50%",donuts:[],donutPalette:"tableau"};const ei=(t,e,n,i)=>[t+Math.sin(i)*n,e-Math.cos(i)*n],ni=(t=0,e=0,n,i)=>{const[s,o]=[0,0];return Math.abs(n-i)%360<1e-6?((t,e,n,i)=>i<=0||n<=i?[["M",t-n,e],["A",n,n,0,1,1,t+n,e],["A",n,n,0,1,1,t-n,e],["Z"]]:[["M",t-n,e],["A",n,n,0,1,1,t+n,e],["A",n,n,0,1,1,t-n,e],["Z"],["M",t+i,e],["A",i,i,0,1,0,t-i,e],["A",i,i,0,1,0,t+i,e],["Z"]])(s,o,t,e):((t,e,n,i,s,o)=>{const[r,a]=[s/360*2*Math.PI,o/360*2*Math.PI],l=[ei(t,e,i,r),ei(t,e,n,r),ei(t,e,n,a),ei(t,e,i,a)],h=a-r>Math.PI?1:0;return[["M",l[0][0],l[0][1]],["L",l[1][0],l[1][1]],["A",n,n,0,h,1,l[2][0],l[2][1]],["L",l[3][0],l[3][1]],["A",i,i,0,h,0,l[0][0],l[0][1]],["Z"]]})(s,o,t,e,n,i)};class ii extends Xn{constructor(t){super(vn({style:ii.defaultStyleProps},t))}drawKeyShape(t,e){return this.upsert("key",s.Pj,this.getKeyStyle(t),e)}getKeyStyle(t){const e=super.getKeyStyle(t),[n,i]=this.getSize(t);return Object.assign(Object.assign({},e),{rx:n/2,ry:i/2})}getIconStyle(t){const e=super.getIconStyle(t),{rx:n,ry:i}=this.getShape("key").attributes,s=2*Math.min(+n,+i)*Xe;return!!e&&Object.assign({width:s,height:s},e)}getIntersectPoint(t,e=!1){return Fe(t,this.getShape("key").getBounds(),e)}}ii.defaultStyleProps={size:[45,35]};var si=n(66056),oi=n(23413),ri=n(71154),ai=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(n[i[s]]=t[i[s]])}return n};class li extends Xn{constructor(t){super(Object.assign(Object.assign({},t),{style:Object.assign({},li.defaultStyleProps,t.style)})),this.rootPointerEvent=new s.nR(null),this.forwardEvents=t=>{const e=this.context.canvas,n=e.context.renderingContext.root.ownerDocument.defaultView;this.normalizeToPointerEvent(t,n).forEach((i=>{const s=this.bootstrapEvent(this.rootPointerEvent,i,n,t);(0,an.Z)(e.context.eventService,"mappingTable.pointerupoutside",[]),e.context.eventService.mapEvent(s)}))}}get eventService(){return this.context.canvas.context.eventService}get events(){return[f.CLICK,f.POINTER_DOWN,f.POINTER_MOVE,f.POINTER_UP,f.POINTER_OVER,f.POINTER_LEAVE]}getDomElement(){return this.getShape("key").getDomElement()}render(t=this.parsedAttributes,e=this){this.drawKeyShape(t,e),this.drawPortShapes(t,e)}getKeyStyle(t){const e=(0,oi.Z)(t,["dx","dy","innerHTML","pointerEvents","cursor"]),{dx:n=0,dy:i=0}=e,s=ai(e,["dx","dy"]),[o,r]=this.getSize(t);return Object.assign(Object.assign({x:n,y:i},s),{width:o,height:r})}drawKeyShape(t,e){const n=this.getKeyStyle(t),{x:i,y:o,width:r=0,height:a=0}=n,l=this.upsert("key-container",s.UL,{x:i,y:o,width:r,height:a,opacity:0},e);return this.upsert("key",s.k9,n,l)}connectedCallback(){if(!(this.context.canvas.getRenderer("main")instanceof si.Th))return;const t=this.getDomElement();this.events.forEach((e=>{t.addEventListener(e,this.forwardEvents)}))}attributeChangedCallback(t,e,n){"zIndex"===t&&e!==n&&(this.getDomElement().style.zIndex=n)}destroy(){const t=this.getDomElement();this.events.forEach((e=>{t.removeEventListener(e,this.forwardEvents)})),super.destroy()}normalizeToPointerEvent(t,e){const n=[];if(e.isTouchEvent(t))for(let e=0;e<t.changedTouches.length;e++){const i=t.changedTouches[e];(0,ri.Z)(i.button)&&(i.button=0),(0,ri.Z)(i.buttons)&&(i.buttons=1),(0,ri.Z)(i.isPrimary)&&(i.isPrimary=1===t.touches.length&&"touchstart"===t.type),(0,ri.Z)(i.width)&&(i.width=i.radiusX||1),(0,ri.Z)(i.height)&&(i.height=i.radiusY||1),(0,ri.Z)(i.tiltX)&&(i.tiltX=0),(0,ri.Z)(i.tiltY)&&(i.tiltY=0),(0,ri.Z)(i.pointerType)&&(i.pointerType="touch"),(0,ri.Z)(i.pointerId)&&(i.pointerId=i.identifier||0),(0,ri.Z)(i.pressure)&&(i.pressure=i.force||.5),(0,ri.Z)(i.twist)&&(i.twist=0),(0,ri.Z)(i.tangentialPressure)&&(i.tangentialPressure=0),i.isNormalized=!0,i.type=t.type,n.push(i)}else if(e.isMouseEvent(t)){const e=t;(0,ri.Z)(e.isPrimary)&&(e.isPrimary=!0),(0,ri.Z)(e.width)&&(e.width=1),(0,ri.Z)(e.height)&&(e.height=1),(0,ri.Z)(e.tiltX)&&(e.tiltX=0),(0,ri.Z)(e.tiltY)&&(e.tiltY=0),(0,ri.Z)(e.pointerType)&&(e.pointerType="mouse"),(0,ri.Z)(e.pointerId)&&(e.pointerId=1),(0,ri.Z)(e.pressure)&&(e.pressure=.5),(0,ri.Z)(e.twist)&&(e.twist=0),(0,ri.Z)(e.tangentialPressure)&&(e.tangentialPressure=0),e.isNormalized=!0,n.push(e)}else n.push(t);return n}transferMouseData(t,e){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.altKey=e.altKey,t.metaKey=e.metaKey,t.shiftKey=e.shiftKey,t.ctrlKey=e.ctrlKey,t.button=e.button,t.buttons=e.buttons,t.client.x=e.clientX,t.client.y=e.clientY,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.screen.x=e.screenX,t.screen.y=e.screenY,t.relatedTarget=null}bootstrapEvent(t,e,n,i){t.view=n,t.originalEvent=null,t.nativeEvent=i,t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,this.transferMouseData(t,e);const{x:s,y:o}=this.getViewportXY(e);t.viewport.x=s,t.viewport.y=o;const[r,a]=this.context.canvas.getCanvasByViewport([s,o]);return t.canvas.x=r,t.canvas.y=a,t.global.copyFrom(t.canvas),t.offset.copyFrom(t.canvas),t.isTrusted=i.isTrusted,"pointerleave"===t.type&&(t.type="pointerout"),t}getViewportXY(t){let e,n;const{offsetX:i,offsetY:s,clientX:o,clientY:a}=t;if((0,r.Z)(i)||(0,r.Z)(s)){const t=this.eventService.client2Viewport({x:o,y:a});e=t.x,n=t.y}else e=i,n=s;return{x:e,y:n}}onframe(){super.onframe();const{opacity:t}=this.attributes;this.getDomElement().style.opacity=`${t}`}}li.defaultStyleProps={size:[160,80],halo:!1,icon:!1,label:!1,pointerEvents:"auto"};var hi=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(n[i[s]]=t[i[s]])}return n};class ci extends Xn{constructor(t){super(vn({style:ci.defaultStyleProps},t))}getKeyStyle(t){const[e,n]=this.getSize(t),i=super.getKeyStyle(t),{fillOpacity:s,opacity:o=s}=i,r=hi(i,["fillOpacity","opacity"]);return Object.assign(Object.assign({opacity:o},r),{width:e,height:n,x:-e/2,y:-n/2})}getHaloStyle(t){if(!1===t.halo)return!1;const e=this.getShape("key").attributes,{fill:n,stroke:i}=e,s=(hi(e,["fill","stroke"]),un(this.getGraphicStyle(t),"halo")),o=Number(s.lineWidth),[r,a]=ce(this.getSize(t),[o,o]);return Object.assign(Object.assign({},s),{width:r,height:a,fill:"transparent",x:-r/2,y:-a/2})}getIconStyle(t){const e=super.getIconStyle(t),[n,i]=this.getSize(t);return!!e&&Object.assign({width:n*Xe,height:i*Xe},e)}drawKeyShape(t,e){const n=this.upsert("key",$n,this.getKeyStyle(t),e);return Hn(this),n}drawHaloShape(t,e){this.upsert("halo",s.UL,this.getHaloStyle(t),e)}update(t){super.update(t),t&&("x"in t||"y"in t||"z"in t)&&Yn(this)}}ci.defaultStyleProps={size:32};class di extends Jn{constructor(t){super(vn({style:di.defaultStyleProps},t))}getPoints(t){const{direction:e}=t,[n,i]=this.getSize(t);return function(t,e,n){const i=e/2,s=t/2,o={up:[[-s,i],[s,i],[0,-i]],left:[[-s,0],[s,i],[s,-i]],right:[[-s,i],[-s,-i],[s,0]],down:[[-s,-i],[s,-i],[0,i]]};return o[n]||o.up}(n,i,e)}getPortXY(t,e){const{direction:n}=t,{placement:i="top"}=e,s=this.getShape("key").getLocalBounds(),[o,r]=this.getSize(t),a=function(t,e,n){const i=e/2,s=t/2,o={};"down"===n?(o.bottom=o.default=[0,i],o.right=[s,-i],o.left=[-s,-i]):"left"===n?(o.top=[s,-i],o.bottom=[s,i],o.left=o.default=[-s,0]):"right"===n?(o.top=[-s,-i],o.bottom=[-s,i],o.right=o.default=[s,0]):(o.left=[-s,i],o.top=o.default=[0,-i],o.right=[s,i]);return o}(o,r,n);return ys(s,i,a,!1)}getIconStyle(t){const{icon:e,iconText:n,iconSrc:i,direction:s}=t;if(!1===e||Pn(n||i))return!1;const o=un(this.getGraphicStyle(t),"icon"),r=this.getShape("key").getLocalBounds(),[a,l]=function(t,e){const{center:n}=t,[i,s]=nt(t);return["up"===e||"down"===e?n[0]:"right"===e?n[0]-i/6:n[0]+i/6,"left"===e||"right"===e?n[1]:"down"===e?n[1]-s/6:n[1]+s/6]}(r,s),h=2*function(t,e){let[n,i]=nt(t);return[n,i]="up"===e||"down"===e?[n,i]:[i,n],(Math.pow(i,2)-Math.pow(Math.sqrt(Math.pow(n/2,2)+Math.pow(i,2))-n/2,2))/(2*i)}(r,s)*Xe;return Object.assign({x:a,y:l,width:h,height:h},o)}}di.defaultStyleProps={size:40,direction:"up"};var ui=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(n[i[s]]=t[i[s]])}return n};class pi extends Xn{constructor(t){super(vn({style:pi.defaultStyleProps},t)),this.type="combo",this.updateComboPosition(this.parsedAttributes)}getKeySize(t){const{collapsed:e,childrenNode:n=[]}=t;return 0===n.length?this.getEmptyKeySize(t):e?this.getCollapsedKeySize(t):this.getExpandedKeySize(t)}getEmptyKeySize(t){const{padding:e,collapsedSize:n}=t,[i,s,o,r]=J(e);return ce(fn(n),[r+s,i+o,0])}getCollapsedKeySize(t){return fn(t.collapsedSize)}getExpandedKeySize(t){const e=this.getContentBBox(t);return[tt(e),et(e),0]}getContentBBox(t){const{childrenNode:e=[],padding:n}=t,i=e.map((t=>this.context.element.getElement(t))).filter(Boolean);if(0===i.length){const e=new s.mN,{x:n=0,y:i=0,size:o}=t,[r,a]=fn(o);return e.setMinMax([n-r/2,i-a/2,0],[n+r/2,i+a/2,0]),e}const o=rt(i.map((t=>t.getBounds())));return n?ot(o,n):o}drawCollapsedMarkerShape(t,e){const n=this.getCollapsedMarkerStyle(t);this.upsert("collapsed-marker",Gn,n,e),Hn(this)}getCollapsedMarkerStyle(t){if(!t.collapsed||!t.collapsedMarker)return!1;const e=un(this.getGraphicStyle(t),"collapsedMarker"),{type:n}=e,i=ui(e,["type"]),s=this.getShape("key"),[o,r]=Ae(s.getLocalBounds(),"center"),a=Object.assign(Object.assign({},i),{x:o,y:r});if(n){const e=this.getCollapsedMarkerText(n,t);Object.assign(a,{text:e})}return a}getCollapsedMarkerText(t,e){const{childrenData:n=[]}=e,{model:i}=this.context;return"descendant-count"===t?i.getDescendantsData(this.id).length.toString():"child-count"===t?n.length.toString():"node-count"===t?i.getDescendantsData(this.id).filter((t=>"node"===i.getElementType(Ht(t)))).length.toString():(0,W.Z)(t)?t(n):""}getComboPosition(t){const{x:e=0,y:n=0,collapsed:i,childrenData:s=[]}=t;if(0===s.length)return[+e,+n,0];if(i){const{model:t}=this.context,i=t.getDescendantsData(this.id).filter((e=>!t.isCombo(Ht(e))));if(i.length>0&&i.some(Te)){return pe(i.reduce(((t,e)=>ce(t,Me(e))),[0,0,0]),i.length)}return[+e,+n,0]}return this.getContentBBox(t).center}getComboStyle(t){const[e,n]=this.getComboPosition(t);return{x:e,y:n,transform:[["translate",e,n]]}}updateComboPosition(t){const e=this.getComboStyle(t);Object.assign(this.style,e);const{x:n,y:i}=e;this.context.model.syncNodeLikeDatum({id:this.id,style:{x:n,y:i}}),Yn(this)}render(t,e=this){super.render(t,e),this.drawCollapsedMarkerShape(t,e)}update(t={}){super.update(t),this.updateComboPosition(this.parsedAttributes)}onframe(){super.onframe(),this.attributes.collapsed||this.updateComboPosition(this.parsedAttributes),this.drawKeyShape(this.parsedAttributes,this)}animate(t,e){const n=super.animate(this.attributes.collapsed?t:t.map((t=>{var{x:e,y:n,z:i,transform:s}=t;return ui(t,["x","y","z","transform"])})),e);return n?new Proxy(n,{set:(t,e,n)=>("currentTime"===e&&Promise.resolve().then((()=>this.onframe())),Reflect.set(t,e,n))}):n}}pi.defaultStyleProps={childrenNode:[],droppable:!0,draggable:!0,collapsed:!1,collapsedSize:32,collapsedMarker:!0,collapsedMarkerZIndex:1,collapsedMarkerFontSize:12,collapsedMarkerTextAlign:"center",collapsedMarkerTextBaseline:"middle",collapsedMarkerType:"child-count"};var gi=n(47666),fi=function(t,e){return!!(0,On.Z)(t)&&t.indexOf(e)>-1},yi=function(t,e){return void 0===e&&(e=[]),(0,gi.Z)(t,(function(t){return!fi(e,t)}))};const mi={padding:10};function vi(t,e,n,i,s,o){const{padding:r}=Object.assign(mi,o),a=it(n,r),l=it(i,r),h=[t,...s,e];let c=null;const d=[];for(let t=0,e=h.length;t<e-1;t++){const n=t+1,i=h[t],s=h[n],o=Ie(u=i,p=s)||function(t,e){return t[0]===e[0]}(u,p);let g=null;if(0===t)if(n===e-1)if(a.intersects(l))g=Mi(i,s,a,l);else if(ht(i,a)||ht(s,l))o||(g=Ci(i,s,a,l));else{const t=dt(i,a),e=dt(s,l);g=Oi(t,e,xi(t,e)),g.points.unshift(t),g.points.push(e)}else at(s,a)?g=Mi(i,s,a,it(s,r),c):o||(g=Si(i,s,a));else n===e-1?at(i,l)?g=Mi(i,s,it(i,r),l,c):o||(g=Di(i,s,l,c)):o||(g=Oi(i,s,c));g?(d.push(...g.points),c=g.direction):c=xi(i,s),n<e-1&&d.push(s)}var u,p;return d.map(xe)}const bi={N:"S",S:"N",W:"E",E:"W"},Ei={N:-Math.PI/2,S:Math.PI/2,E:0,W:Math.PI};function xi(t,e){const[n,i]=t,[s,o]=e;return n===s?i>o?"N":"S":i===o?n>s?"W":"E":null}function wi(t,e){return"N"===e||"S"===e?et(t):tt(t)}function Oi(t,e,n){const i=[t[0],e[1]],s=[e[0],t[1]],o=xi(t,i),r=xi(t,s),a=n?bi[n]:null,l=o===n||o!==a&&r!==n?i:s;return{points:[l],direction:xi(l,e)}}function Si(t,e,n){if(ht(t,n)){const i=Ti(t,e,n);return{points:[i],direction:xi(i,e)}}{const i=dt(t,n),s=["left","right"].includes(ct(t,n))?[e[0],i[1]]:[i[0],e[1]];return{points:[s],direction:xi(s,e)}}}function Di(t,e,n,i){const s=ht(e,n)?e:dt(e,n),o=[[s[0],t[1]],[t[0],s[1]]],r=o.filter((t=>function(t,e){return!at(t,e)}(t,n)&&!lt(t,n,!0))),a=r.filter((e=>xi(e,t)!==i));if(a.length>0){const n=a.find((e=>xi(t,e)===i))||a[0];return{points:[n],direction:xi(n,e)}}{const s=Ne(e,yi(o,r)[0],wi(n,i)/2);return{points:[Ti(s,t,n),s],direction:xi(s,e)}}}function Ci(t,e,n,i){let s=Si(t,e,n);const o=we(s.points[0]);if(at(o,i)){s=Si(e,t,i);const r=we(s.points[0]);if(at(r,n)){const a=Ne(t,o,wi(n,xi(t,o))/2),l=Ne(e,r,wi(i,xi(e,r))/2),h=[(a[0]+l[0])/2,(a[1]+l[1])/2],c=Si(t,h,n),d=Di(h,e,i,c.direction);s.points=[c.points[0],d.points[0]],s.direction=d.direction}}return s}function Mi(t,e,n,i,s){const o=.01,r=rt([n,i]),l=fe(e,r.center)>fe(t,r.center),[h,c]=l?[e,t]:[t,e],d=et(r)+tt(r);let u;if(s){const t=[h[0]+d*Math.cos(Ei[s]),h[1]+d*Math.sin(Ei[s])];u=Ne(dt(t,r),t,o)}else u=Ne(dt(h,r),h,-.01);let p=Ti(u,c,r),g=[ke(u,2),ke(p,2)];if((0,a.Z)(ke(u),ke(p))){const t=ve(de(u,h),[1,0,0])+Math.PI/2;p=[c[0]+d*Math.cos(t),c[1]+d*Math.sin(t),0],p=ke(Ne(dt(p,r),c,-.01),2);g=[u,Ti(u,p,r),p]}return{points:l?g.reverse():g,direction:xi(l?u:p,e)}}function Ti(t,e,n){let i=[t[0],e[1]];return at(i,n)&&(i=[e[0],t[1]]),i}function Pi(t,e,n,i,s){let o="number"==typeof e?e:.5;"start"===e&&(o=0),"end"===e&&(o=.99);const r=Re(t.getPoint(o)),a=Re(t.getPoint(o+.01));let l="start"===e?"left":"end"===e?"right":"center";if(Ie(r,a)||!n){const[e,n]=Ai(t,o,i,s);return{transform:[["translate",e,n]],textAlign:l}}let h=Math.atan2(a[1]-r[1],a[0]-r[0]);a[0]<r[0]&&(l="center"===l?l:"left"===l?"right":"left",i*=-1,h+=Math.PI);const[c,d]=Ai(t,o,i,s,h);return{textAlign:l,transform:[["translate",c,d],["rotate",h/Math.PI*180]]}}function Ai(t,e,n,i,s){const[o,r]=Re(t.getPoint(e));let a=n,l=i;return s&&(a=n*Math.cos(s)-i*Math.sin(s),l=n*Math.sin(s)+i*Math.cos(s)),[o+a,r+l]}function Ri(t,e,n,i){if((0,a.Z)(t,e))return t;const s=de(e,t),o=[t[0]+n*s[0],t[1]+n*s[1]],r=me(be(s,!1));return o[0]+=i*r[0],o[1]+=i*r[1],o}function Li(t,e,n){return[["M",t[0],t[1]],["C",n[0][0],n[0][1],n[1][0],n[1][1],e[0],e[1]]]}function ki(t,e=0,n=!1){const i=t.length-1,s=t[0],o=t[i],r=t.slice(1,i),a=[["M",s[0],s[1]]];return r.forEach(((t,n)=>{const i=r[n-1]||s,l=r[n+1]||o;if(!je(i,t,l)&&e){const[n,s]=function(t,e,n,i){const s=ye(t,e),o=ye(n,e),r=Math.min(i,Math.min(s,o)/2),a=[e[0]-r/s*(e[0]-t[0]),e[1]-r/s*(e[1]-t[1])],l=[e[0]-r/o*(e[0]-n[0]),e[1]-r/o*(e[1]-n[1])];return[a,l]}(i,t,l,e);a.push(["L",n[0],n[1]],["Q",t[0],t[1],s[0],s[1]],["L",s[0],s[1]])}else a.push(["L",t[0],t[1]])})),a.push(["L",o[0],o[1]]),n&&a.push(["Z"]),a}function Ni(t,e,n,i,s){const o=it(t),r=t.getCenter();let a=i&&bs(i),l=s&&bs(s);if(!a||!l){const i=(t=>{const e=Math.PI/2,n=et(t)/2,i=tt(t)/2,s=Math.atan2(n,i)/2,o=Math.atan2(i,n)/2;return{top:[-e-o,-e+o],"top-right":[-e+o,-s],"right-top":[-e+o,-s],right:[-s,s],"bottom-right":[s,e-o],"right-bottom":[s,e-o],bottom:[e-o,e+o],"bottom-left":[e+o,Math.PI-s],"left-bottom":[e+o,Math.PI-s],left:[Math.PI-s,Math.PI+s],"top-left":[Math.PI+s,-e-o],"left-top":[Math.PI+s,-e-o]}})(o),s=i[e][0],h=i[e][1],[c,d]=nt(o),u=Math.max(c,d),p=ce(r,[u*Math.cos(s),u*Math.sin(s),0]),g=ce(r,[u*Math.cos(h),u*Math.sin(h),0]);a=Os(t,p),l=Os(t,g),n||([a,l]=[l,a])}return[a,l]}function Ii(t,e,n,i,s,o){const r=t.getPorts()[s||o],l=t.getPorts()[o||s];let[h,c]=Ni(t,e,n,r,l);const d=function(t,e,n,i){const s=t.getCenter();if((0,a.Z)(e,n)){const t=de(e,s),o=[i*Math.sign(t[0])||i/2,i*Math.sign(t[1])||-i/2,0];return[ce(e,o),ce(n,ue(o,[1,-1,1]))]}return[Ne(s,e,fe(s,e)+i),Ne(s,n,fe(s,n)+i)]}(t,h,c,i);return r&&(h=ws(r,d[0])),l&&(c=ws(l,d.at(-1))),Li(h,c,d)}function ji(t,e,n,i,s,o,r){const l=ms(t),h=l[o||r],c=l[r||o];let[d,u]=Ni(t,n,i,h,c);const p=function(t,e,n,i){const s=[],o=it(t);if((0,a.Z)(e,n)){switch(ct(e,o)){case"left":s.push([e[0]-i,e[1]]),s.push([e[0]-i,e[1]+i]),s.push([e[0],e[1]+i]);break;case"right":s.push([e[0]+i,e[1]]),s.push([e[0]+i,e[1]+i]),s.push([e[0],e[1]+i]);break;case"top":s.push([e[0],e[1]-i]),s.push([e[0]+i,e[1]-i]),s.push([e[0]+i,e[1]]);break;case"bottom":s.push([e[0],e[1]+i]),s.push([e[0]+i,e[1]+i]),s.push([e[0]+i,e[1]])}}else{const t=ct(e,o),r=ct(n,o);if(t===r){let o,r;switch(t){case"left":o=Math.min(e[0],n[0])-i,s.push([o,e[1]]),s.push([o,n[1]]);break;case"right":o=Math.max(e[0],n[0])+i,s.push([o,e[1]]),s.push([o,n[1]]);break;case"top":r=Math.min(e[1],n[1])-i,s.push([e[0],r]),s.push([n[0],r]);break;case"bottom":r=Math.max(e[1],n[1])+i,s.push([e[0],r]),s.push([n[0],r])}}else{const a=(t,e)=>({left:[e[0]-i,e[1]],right:[e[0]+i,e[1]],top:[e[0],e[1]-i],bottom:[e[0],e[1]+i]}[t]),l=a(t,e),h=a(r,n),c=Ti(l,h,o);s.push(l,c,h)}}return s}(t,d,u,s);return h&&(d=ws(h,p[0])),c&&(u=ws(c,p.at(-1))),ki([d,...p,u],e)}function Bi(t,e){const n=new Set,i=new Set,s=new Set;return t.forEach((o=>{e(o).forEach((e=>{n.add(e),t.includes(e.source)&&t.includes(e.target)?i.add(e):s.add(e)}))})),{edges:Array.from(n),internal:Array.from(i),external:Array.from(s)}}function zi(t,e){const n=[];let i=t;for(;i;){n.push(i);const t=e(Ht(i));if(!t)break;i=t}if(n.some((t=>{var e;return null===(e=t.style)||void 0===e?void 0:e.collapsed}))){const t=n.reverse().findIndex(on);return n[t]||n.at(-1)}return t}const Fi=(t,e)=>{const n=Math.max(t,e)/2;return[["M",-t/2,0],["A",n,n,0,1,0,2*n-t/2,0],["A",n,n,0,1,0,-t/2,0],["Z"]]},_i=(t,e)=>[["M",-t/2,0],["L",t/2,-e/2],["L",t/2,e/2],["Z"]],Zi=(t,e)=>[["M",-t/2,0],["L",0,-e/2],["L",t/2,0],["L",0,e/2],["Z"]],$i=(t,e)=>[["M",-t/2,0],["L",t/2,-e/2],["L",4*t/5-t/2,0],["L",t/2,e/2],["Z"]],Vi=(t,e)=>[["M",-t/2,-e/2],["L",t/2,-e/2],["L",t/2,e/2],["L",-t/2,e/2],["Z"]],Wi=(t,e)=>{const n=t/2,i=t/7,s=t-i;return[["M",-n,0],["L",0,-e/2],["L",0,e/2],["Z"],["M",s-n,-e/2],["L",s+i-n,-e/2],["L",s+i-n,e/2],["L",s-n,e/2],["Z"]]},Hi=(t,e)=>[["M",t/2,-e/2],["L",-t/2,0],["L",t/2,0],["L",-t/2,0],["L",t/2,e/2]];var Yi=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(n[i[s]]=t[i[s]])}return n};class Gi extends Un{constructor(t){super(vn({style:Gi.defaultStyleProps},t)),this.type="edge"}get sourceNode(){const{sourceNode:t}=this.parsedAttributes;return this.context.element.getElement(t)}get targetNode(){const{targetNode:t}=this.parsedAttributes;return this.context.element.getElement(t)}getKeyStyle(t){const e=this.getGraphicStyle(t),{loop:n}=e,i=Yi(e,["loop"]),{sourceNode:o,targetNode:r}=this;var a,l;const h={d:n&&(l=r,(a=o)&&l&&a===l)?this.getLoopPath(t):this.getKeyPath(t)};return s.y$.PARSED_STYLE_LIST.forEach((t=>{t in i&&(h[t]=i[t])})),h}getLoopPath(t){const{sourcePort:e,targetPort:n}=t,i=this.sourceNode,s=it(i),o=Math.max(tt(s),et(s)),{placement:r,clockwise:a,dist:l=o}=un(this.getGraphicStyle(t),"loop");return Ii(i,r,a,l,e,n)}getEndpoints(t,e=!0,n=[]){const{sourcePort:i,targetPort:s}=t,{sourceNode:o,targetNode:r}=this,[a,l]=function(t,e,n,i){const s=Es(t,e,n,i),o=Es(e,t,i,n);return[s,o]}(o,r,i,s);if(!e){return[a?bs(a):o.getCenter(),l?bs(l):r.getCenter()]}const h="function"==typeof n?n():n;return[xs(a||o,h[0]||l||r),xs(l||r,h[h.length-1]||a||o)]}getHaloStyle(t){if(!1===t.halo)return!1;const e=this.getKeyStyle(t),n=un(this.getGraphicStyle(t),"halo");return Object.assign(Object.assign({},e),n)}getLabelStyle(t){if(!1===t.label||!t.labelText)return!1;const e=un(this.getGraphicStyle(t),"label"),{placement:n,offsetX:i,offsetY:s,autoRotate:o,maxWidth:r}=e,a=Yi(e,["placement","offsetX","offsetY","autoRotate","maxWidth"]),l=Pi(this.shapeMap.key,n,o,i,s),h=this.shapeMap.key.getLocalBounds(),c=function(t,e,n=1){return xn(fe(t[0],t[1])*n,e)}([h.min,h.max],r);return Object.assign({wordWrapWidth:c},l,a)}getBadgeStyle(t){if(!1===t.badge||!t.badgeText)return!1;const e=un(t,"badge"),{offsetX:n,offsetY:i,placement:s}=e,o=Yi(e,["offsetX","offsetY","placement"]);return Object.assign(o,function(t,e,n,i,s){var o,r;const a=2*(null===(o=t.badge)||void 0===o?void 0:o.getGeometryBounds().halfExtents[0])||0,l=2*(null===(r=t.label)||void 0===r?void 0:r.getGeometryBounds().halfExtents[0])||0;return Pi(t.key,n,!0,(l?(l/2+a/2)*("suffix"===e?1:-1):0)+i,s)}(this.shapeMap,s,t.labelPlacement,n,i))}drawArrow(t,e){var n;const i="start"===e,o=t["start"===e?"startArrow":"endArrow"],r=this.shapeMap.key;if(o){const e=this.getArrowStyle(t,i),[n,o,a]=i?["markerStart","markerStartOffset","startArrowOffset"]:["markerEnd","markerEndOffset","endArrowOffset"],l=r.parsedStyle[n];if(l)l.attr(e);else{const t=new(e.src?s.Ee:s.y$)({style:e});r.style[n]=t}r.style[o]=t[a]||e.width/2+ +e.lineWidth}else{const t=i?"markerStart":"markerEnd";null===(n=r.style[t])||void 0===n||n.destroy(),r.style[t]=null}}getArrowStyle(t,e){const n=this.getShape("key").attributes,s=e?"startArrow":"endArrow",o=un(this.getGraphicStyle(t),s),{size:r,type:a}=o,l=Yi(o,["size","type"]),[h,c]=fn(function(t,e){return e||(t<4?10:4===t?12:2.5*t)}(n.lineWidth,r)),d=((0,W.Z)(a)?a:i[a]||_i)(h,c);return Object.assign((0,oi.Z)(n,["stroke","strokeOpacity","fillOpacity"]),{width:h,height:c},Object.assign({},d&&{d:d,fill:"simple"===a?"":n.stroke}),l)}drawLabelShape(t,e){const n=this.getLabelStyle(t);this.upsert("label",Nn,n,e)}drawHaloShape(t,e){const n=this.getHaloStyle(t);this.upsert("halo",s.y$,n,e)}drawBadgeShape(t,e){const n=this.getBadgeStyle(t);this.upsert("badge",In,n,e)}drawSourceArrow(t){this.drawArrow(t,"start")}drawTargetArrow(t){this.drawArrow(t,"end")}drawKeyShape(t,e){const n=this.getKeyStyle(t);return this.upsert("key",s.y$,n,e)}render(t=this.parsedAttributes,e=this){this.drawKeyShape(t,e),this.getShape("key")&&(this.drawSourceArrow(t),this.drawTargetArrow(t),this.drawLabelShape(t,e),this.drawHaloShape(t,e),this.drawBadgeShape(t,e))}onframe(){this.drawKeyShape(this.parsedAttributes,this),this.drawSourceArrow(this.parsedAttributes),this.drawTargetArrow(this.parsedAttributes),this.drawHaloShape(this.parsedAttributes,this),this.drawLabelShape(this.parsedAttributes,this),this.drawBadgeShape(this.parsedAttributes,this)}animate(t,e){const n=super.animate(t,e);return n?new Proxy(n,{set:(t,e,n)=>("currentTime"===e&&Promise.resolve().then((()=>this.onframe())),Reflect.set(t,e,n))}):n}}Gi.defaultStyleProps={badge:!0,badgeOffsetX:0,badgeOffsetY:0,badgePlacement:"suffix",isBillboard:!0,label:!0,labelAutoRotate:!0,labelIsBillboard:!0,labelMaxWidth:"80%",labelOffsetX:4,labelOffsetY:0,labelPlacement:"center",labelTextBaseline:"middle",labelWordWrap:!1,halo:!1,haloDroppable:!1,haloLineDash:0,haloLineWidth:12,haloPointerEvents:"none",haloStrokeOpacity:.25,haloZIndex:-1,loop:!0,startArrow:!1,startArrowLineDash:0,startArrowLineJoin:"round",startArrowLineWidth:1,startArrowTransformOrigin:"center",startArrowType:"vee",endArrow:!1,endArrowLineDash:0,endArrowLineJoin:"round",endArrowLineWidth:1,endArrowTransformOrigin:"center",endArrowType:"vee",loopPlacement:"top",loopClockwise:!0};class Ui extends Gi{constructor(t){super(vn({style:Ui.defaultStyleProps},t))}getKeyPath(t){const[e,n]=this.getEndpoints(t),{controlPoints:i,curvePosition:s,curveOffset:o}=t,r=this.getControlPoints(e,n,function(t){return(0,N.Z)(t)?[t,1-t]:t}(s),function(t){return(0,N.Z)(t)?[t,-t]:t}(o),i);return Li(e,n,r)}getControlPoints(t,e,n,i,s){return 2===(null==s?void 0:s.length)?s:[Ri(t,e,n[0],i[0]),Ri(t,e,n[1],i[1])]}}Ui.defaultStyleProps={curvePosition:.5,curveOffset:20};class Ki extends Ui{constructor(t){super(vn({style:Ki.defaultStyleProps},t))}getControlPoints(t,e,n,i){const s=e[0]-t[0];return[[t[0]+s*n[0]+i[0],t[1]],[e[0]-s*n[1]+i[1],e[1]]]}}Ki.defaultStyleProps={curvePosition:[.5,.5],curveOffset:[0,0]};class Xi extends Ui{constructor(t){super(vn({style:Xi.defaultStyleProps},t))}get ref(){return this.context.model.getRootsData()[0]}getEndpoints(t){if(this.sourceNode.id===this.ref.id)return super.getEndpoints(t);const e=Me(this.ref);return[this.sourceNode.getIntersectPoint(e,!0),this.targetNode.getIntersectPoint(e)]}toRadialCoordinate(t){const e=Me(this.ref);return[fe(t,e),Oe(de(t,e))]}getControlPoints(t,e,n,i){const[s,o]=this.toRadialCoordinate(t),[r]=this.toRadialCoordinate(e),a=r-s;return[[t[0]+(a*n[0]+i[0])*Math.cos(o),t[1]+(a*n[0]+i[0])*Math.sin(o)],[e[0]-(a*n[1]-i[0])*Math.cos(o),e[1]-(a*n[1]-i[0])*Math.sin(o)]]}}Xi.defaultStyleProps={curvePosition:.5,curveOffset:20};class qi extends Ui{constructor(t){super(vn({style:qi.defaultStyleProps},t))}getControlPoints(t,e,n,i){const s=e[1]-t[1];return[[t[0],t[1]+s*n[0]+i[0]],[e[0],e[1]-s*n[1]+i[1]]]}}qi.defaultStyleProps={curvePosition:[.5,.5],curveOffset:[0,0]};class Ji extends Gi{constructor(t){super(vn({style:Ji.defaultStyleProps},t))}getKeyPath(t){const[e,n]=this.getEndpoints(t);return[["M",e[0],e[1]],["L",n[0],n[1]]]}}Ji.defaultStyleProps={};const Qi={enableObstacleAvoidance:!1,offset:10,maxAllowedDirectionChange:Math.PI/2,maximumLoops:3e3,gridSize:5,startDirections:["top","right","bottom","left"],endDirections:["top","right","bottom","left"],directionMap:{right:{stepX:1,stepY:0},left:{stepX:-1,stepY:0},bottom:{stepX:0,stepY:1},top:{stepX:0,stepY:-1}},penalties:{0:0,90:0},distFunc:ye},ts=t=>`${Math.round(t[0])}|||${Math.round(t[1])}`;function es(t,e){const n=t=>Math.round(t/e);return(0,N.Z)(t)?n(t):t.map(n)}function ns(t,e){const n=e[0]-t[0],i=e[1]-t[1];return n||i?Math.atan2(i,n):0}function is(t,e,n,i){const s=ns(t,e),o=n[ts(t)];return function(t,e){const n=Math.abs(t-e);return n>Math.PI?2*Math.PI-n:n}(ns(o||i,t),s)}function ss(t,e,n){return Math.min(...e.map((e=>n(t,e))))}const os=(t,e,n,i)=>{if(!e)return[t];const{directionMap:s,offset:o}=i,r=ot(e.getRenderBounds(),o),a=Object.keys(s).reduce(((e,i)=>{if(n.includes(i)){const n=s[i],[o,a]=nt(r),l=[t[0]+n.stepX*o,t[1]+n.stepY*a],h=function(t){const{min:[e,n],max:[i,s]}=t,o=[e,s],r=[i,s],a=[i,n],l=[e,n];return[[o,r],[r,a],[a,l],[l,o]]}(r);for(let n=0;n<h.length;n++){const i=De([t,l],h[n]);i&&lt(i,r)&&e.push(i)}}return e}),[]);return at(t,r)||a.push(t),a.map((t=>es(t,i.gridSize)))},rs=(t,e,n,i,s,o,r)=>{const a=[];let l=[o[0]===i[0]?i[0]:t[0]*r,o[1]===i[1]?i[1]:t[1]*r];a.unshift(l);let h=t,c=e[ts(h)];for(;c;){const t=c,i=h;is(t,i,e,n)&&(l=[t[0]===i[0]?l[0]:t[0]*r,t[1]===i[1]?l[1]:t[1]*r],a.unshift(l)),c=e[ts(t)],h=t}const d=s.map((t=>[t[0]*r,t[1]*r])),u=function(t,e,n){let i=t[0],s=n(t[0],e);for(let o=0;o<t.length;o++){const r=t[o],a=n(r,e);a<s&&(i=r,s=a)}return i}(d,l,ye);return a.unshift(u),a};function as(t,e,n,i){const s=xe(t.getCenter()),o=xe(e.getCenter()),r=Object.assign(Qi,i),{gridSize:a}=r,l=((t,e)=>{const{offset:n,gridSize:i}=e,s={};return t.forEach((t=>{if(!t||t.destroyed||!t.isVisible())return;const e=ot(t.getRenderBounds(),n);for(let t=es(e.min[0],i);t<=es(e.max[0],i);t+=1)for(let n=es(e.min[1],i);n<=es(e.max[1],i);n+=1)s[`${t}|||${n}`]=!0})),s})(r.enableObstacleAvoidance?n:[t,e],r),h=es(s,a),c=es(o,a),d=os(s,t,r.startDirections,r),u=os(o,e,r.endDirections,r);d.forEach((t=>delete l[ts(t)])),u.forEach((t=>delete l[ts(t)]));const p={},g={},f={},y={},m={},v=new ls;for(let t=0;t<d.length;t++){const e=d[t],n=ts(e);p[n]=e,y[n]=0,m[n]=ss(e,u,r.distFunc),v.add({id:n,value:m[n]})}const b=u.map((t=>ts(t)));let E,x=r.maximumLoops,w=1/0;for(const[t,e]of Object.entries(p))m[t]<=w&&(w=m[t],E=e);for(;Object.keys(p).length>0&&x>0;){const t=v.minId(!1);if(!t)break;E=p[t];const e=ts(E);if(b.includes(e))return rs(E,f,h,o,d,c,a);delete p[e],v.remove(e),g[e]=!0;for(const t of Object.values(r.directionMap)){const n=ce(E,[t.stepX,t.stepY]),i=ts(n);if(g[i])continue;const s=is(E,n,f,h);if(s>r.maxAllowedDirectionChange)continue;if(l[i])continue;p[i]||(p[i]=n);const o=r.penalties[s],c=r.distFunc(E,n)+(isNaN(o)?a:o),d=y[e]+c,b=y[i];b&&d>=b||(f[i]=E,y[i]=d,m[i]=d+ss(n,u,r.distFunc),v.add({id:i,value:m[i]}))}x-=1}return[]}class ls{constructor(){this.arr=[],this.map={},this.arr=[],this.map={}}_innerAdd(t,e){let n=0,i=e-1;for(;i-n>1;){const e=Math.floor((n+i)/2);if(this.arr[e].value>t.value)i=e;else{if(!(this.arr[e].value<t.value))return this.arr.splice(e,0,t),void(this.map[t.id]=!0);n=e}}this.arr.splice(i,0,t),this.map[t.id]=!0}add(t){delete this.map[t.id];const e=this.arr.length;if(!e||this.arr[e-1].value<t.value)return this.arr.push(t),void(this.map[t.id]=!0);this._innerAdd(t,e)}remove(t){this.map[t]&&delete this.map[t]}_clearAndGetMinId(){let t;for(let e=this.arr.length-1;e>=0;e--)this.map[this.arr[e].id]?t=this.arr[e].id:this.arr.splice(e,1);return t}_findFirstId(){for(;this.arr.length;){const t=this.arr.shift();if(this.map[t.id])return t.id}}minId(t){return t?this._clearAndGetMinId():this._findFirstId()}}class hs extends Gi{constructor(t){super(vn({style:hs.defaultStyleProps},t))}getControlPoints(t){const{router:e}=t,{sourceNode:n,targetNode:i}=this,[s,o]=this.getEndpoints(t,!1);let r=[];if(e)if("shortest-path"===e.type){r=as(n,i,this.context.element.getNodes(),e),r.length||(r=vi(s,o,n,i,t.controlPoints,{padding:e.offset}))}else"orth"===e.type&&(r=vi(s,o,n,i,t.controlPoints,e));else r=t.controlPoints;return r}getPoints(t){const e=this.getControlPoints(t),[n,i]=this.getEndpoints(t,!0,e);return[n,...e,i]}getKeyPath(t){return ki(this.getPoints(t),t.radius)}getLoopPath(t){const{sourcePort:e,targetPort:n,radius:i}=t,s=this.sourceNode,o=it(s),r=Math.max(tt(o),et(o))/4,{placement:a,clockwise:l,dist:h=r}=un(this.getGraphicStyle(t),"loop");return ji(s,i,a,l,h,e,n)}}hs.defaultStyleProps={radius:0,controlPoints:[],router:!1};class cs extends Gi{constructor(t){super(vn({style:cs.defaultStyleProps},t))}getKeyPath(t){const{curvePosition:e,curveOffset:n}=t,[i,s]=this.getEndpoints(t);return function(t,e,n){return[["M",t[0],t[1]],["Q",n[0],n[1],e[0],e[1]]]}(i,s,t.controlPoint||Ri(i,s,e,n))}}cs.defaultStyleProps={curvePosition:.5,curveOffset:30};var ds=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(n[i[s]]=t[i[s]])}return n};function us(t){return t instanceof Xn&&"node"===t.type}function ps(t){return t instanceof Gi}function gs(t){return t instanceof pi}const fs={top:[.5,0],right:[1,.5],bottom:[.5,1],left:[0,.5],"left-top":[0,0],"top-left":[0,0],"left-bottom":[0,1],"bottom-left":[0,1],"right-top":[1,0],"top-right":[1,0],"right-bottom":[1,1],"bottom-right":[1,1],default:[.5,.5]};function ys(t,e,n=fs,i=!0){const s=[.5,.5],o=(0,We.Z)(e)?(0,rn.Z)(n,e.toLocaleLowerCase(),s):e;if(!i&&(0,We.Z)(e))return o;const[r,a]=o||s;return[t.min[0]+tt(t)*r,t.min[1]+et(t)*a]}function ms(t){if(!t)return{};const e=t.getPorts();return(t.attributes.ports||[]).forEach(((n,i)=>{var s;const{key:o,placement:r}=n;vs(n)&&(e[s=o||i]||(e[s]=Ae(t.getShape("key").getBounds(),r)))})),e}function vs(t){const{r:e}=t;return!e||0===Number(e)}function bs(t){return X(t)?t:t.getPosition()}function Es(t,e,n,i){const s=ms(t);if(n)return s[n];const o=Object.values(s);if(0===o.length)return;const r=o.map((t=>bs(t))),a=function(t,e){const n=ms(t);if(e)return[bs(n[e])];const i=Object.values(n);return i.length>0?i.map((t=>bs(t))):[t.getCenter()]}(e,i),[l]=function(t,e){let n=1/0,i=[t[0],e[0]];return t.forEach((t=>{e.forEach((e=>{const s=fe(t,e);s<n&&(n=s,i=[t,e])}))})),i}(r,a);return o.find((t=>bs(t)===l))}function xs(t,e){return gs(t)||us(t)?Os(t,e):ws(t,e)}function ws(t,e){if(!t||!e)return[0,0,0];if(X(t))return t;if(t.attributes.linkToCenter)return t.getPosition();return Fe(X(e)?e:us(e)?e.getCenter():e.getPosition(),t.getBounds())}function Os(t,e){if(!t||!e)return[0,0,0];const n=X(e)?e:us(e)?e.getCenter():e.getPosition();return t.getIntersectPoint(n)||t.getCenter()}function Ss(t,e="bottom",n=0,i=0,s=!1){const o=e.split("-"),[r,a]=Ae(t,e),[l,h]=s?["bottom","top"]:["top","bottom"];return{transform:[["translate",r+n,a+i]],textBaseline:o.includes("top")?h:o.includes("bottom")?l:"middle",textAlign:o.includes("left")?"right":o.includes("right")?"left":"center"}}function Ds(t,e){"update"in t?t.update(e):t.attr(e)}function Cs(t){return(0,rn.Z)(t,"__to_be_destroyed__",!1)}var Ms=function(t,e,n,i){return new(n||(n=Promise))((function(s,o){function r(t){try{l(i.next(t))}catch(t){o(t)}}function a(t){try{l(i.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,a)}l((i=i.apply(t,e||[])).next())}))};class Ts extends re{constructor(t,e){super(t,Object.assign({},Ts.defaultOptions,e)),this.onCollapseExpand=t=>Ms(this,void 0,void 0,(function*(){if(!this.validate(t))return;const{target:e}=t;if(!(us(n=e)||ps(n)||gs(n)))return;var n;const i=e.id,{model:s,graph:o}=this.context,r=s.getElementDataById(i);if(!r)return!1;const{onCollapse:a,onExpand:l,animation:h,align:c}=this.options;on(r)?(yield o.expandElement(i,{animation:h,align:c}),null==l||l(i)):(yield o.collapseElement(i,{animation:h,align:c}),null==a||a(i))})),this.bindEvents()}update(t){this.unbindEvents(),super.update(t),this.bindEvents()}bindEvents(){const{graph:t}=this.context,{trigger:e}=this.options;t.on(`node:${e}`,this.onCollapseExpand),t.on(`combo:${e}`,this.onCollapseExpand)}unbindEvents(){const{graph:t}=this.context,{trigger:e}=this.options;t.off(`node:${e}`,this.onCollapseExpand),t.off(`combo:${e}`,this.onCollapseExpand)}validate(t){if(this.destroyed)return!1;const{enable:e}=this.options;return(0,W.Z)(e)?e(t):!!e}destroy(){this.unbindEvents(),super.destroy()}}Ts.defaultOptions={enable:!0,animation:!0,trigger:f.DBLCLICK,align:!0};var Ps={},As=function(t,e,n,i){return new(n||(n=Promise))((function(s,o){function r(t){try{l(i.next(t))}catch(t){o(t)}}function a(t){try{l(i.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,a)}l((i=i.apply(t,e||[])).next())}))};const Rs="g6-create-edge-assist-node-id";class Ls extends re{constructor(t,e){super(t,Object.assign({},Ls.defaultOptions,e)),this.drop=t=>As(this,void 0,void 0,(function*(){const{targetType:e}=t;["combo","node"].includes(e)&&this.source?yield this.handleCreateEdge(t):yield this.cancelEdge()})),this.handleCreateEdge=t=>As(this,void 0,void 0,(function*(){var e,n,i;if(!this.validate(t))return;const{graph:s,canvas:o,batch:r,element:a}=this.context,{style:l}=this.options;if(this.source)return this.createEdge(t),void(yield this.cancelEdge());r.startBatch(),o.setCursor("crosshair"),this.source=this.getSelectedNodeIDs([t.target.id])[0];const h=s.getElementData(this.source);s.addNodeData([{id:Rs,style:{visibility:"hidden",ports:[{key:"port-1",placement:[.5,.5]}],x:null===(e=h.style)||void 0===e?void 0:e.x,y:null===(n=h.style)||void 0===n?void 0:n.y}}]),s.addEdgeData([{id:"g6-create-edge-assist-edge-id",source:this.source,target:Rs,style:Object.assign({pointerEvents:"none"},l)}]),yield null===(i=a.draw({animation:!1}))||void 0===i?void 0:i.finished})),this.updateAssistEdge=t=>As(this,void 0,void 0,(function*(){var e;if(!this.source)return;const{model:n,element:i}=this.context;n.translateNodeTo(Rs,[t.canvas.x,t.canvas.y]),yield null===(e=i.draw({animation:!1,silence:!0}))||void 0===e?void 0:e.finished})),this.createEdge=t=>{var e,n;const{graph:i}=this.context,{style:s,onFinish:o,onCreate:r}=this.options;if(void 0===(null===(e=t.target)||void 0===e?void 0:e.id)||void 0===this.source)return;const a=null===(n=this.getSelectedNodeIDs([t.target.id]))||void 0===n?void 0:n[0];var l;const h=r({id:`${this.source}-${a}-${Ps[l=l||"g"]?Ps[l]+=1:Ps[l]=1,l+Ps[l]}`,source:this.source,target:a,style:s});i.addEdgeData([h]),o(h)},this.cancelEdge=()=>As(this,void 0,void 0,(function*(){var t;if(!this.source)return;const{graph:e,element:n,batch:i}=this.context;e.removeNodeData([Rs]),this.source=void 0,yield null===(t=n.draw({animation:!1}))||void 0===t?void 0:t.finished,i.endBatch()})),this.bindEvents()}update(t){super.update(t),this.bindEvents()}bindEvents(){const{graph:t}=this.context,{trigger:e}=this.options;this.unbindEvents(),"click"===e?(t.on(E.CLICK,this.handleCreateEdge),t.on(g.CLICK,this.handleCreateEdge),t.on(p.CLICK,this.cancelEdge),t.on(m.CLICK,this.cancelEdge)):(t.on(E.DRAG_START,this.handleCreateEdge),t.on(g.DRAG_START,this.handleCreateEdge),t.on(f.POINTER_UP,this.drop)),t.on(f.POINTER_MOVE,this.updateAssistEdge)}getSelectedNodeIDs(t){return Array.from(new Set(this.context.graph.getElementDataByState("node",this.options.state).map((t=>t.id)).concat(t)))}validate(t){if(this.destroyed)return!1;const{enable:e}=this.options;return(0,W.Z)(e)?e(t):!!e}unbindEvents(){const{graph:t}=this.context;t.off(E.CLICK,this.handleCreateEdge),t.off(g.CLICK,this.handleCreateEdge),t.off(p.CLICK,this.cancelEdge),t.off(m.CLICK,this.cancelEdge),t.off(E.DRAG_START,this.handleCreateEdge),t.off(g.DRAG_START,this.handleCreateEdge),t.off(f.POINTER_UP,this.drop),t.off(f.POINTER_MOVE,this.updateAssistEdge)}destroy(){this.unbindEvents(),super.destroy()}}Ls.defaultOptions={animation:!0,enable:!0,style:{},trigger:"drag",onCreate:t=>t,onFinish:()=>{}};var ks=n(68040),Ns=function(t,e,n,i){return new(n||(n=Promise))((function(s,o){function r(t){try{l(i.next(t))}catch(t){o(t)}}function a(t){try{l(i.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,a)}l((i=i.apply(t,e||[])).next())}))};class Is extends re{constructor(t,e){super(t,Object.assign({},Is.defaultOptions,e)),this.isDragging=!1,this.onDragStart=t=>{this.validate(t)&&(this.isDragging=!0,this.context.canvas.setCursor("grabbing"))},this.onDrag=t=>{var e,n,i,s;if(!this.isDragging||He.isPinching)return;const o=null!==(n=null===(e=t.movement)||void 0===e?void 0:e.x)&&void 0!==n?n:t.dx,r=null!==(s=null===(i=t.movement)||void 0===i?void 0:i.y)&&void 0!==s?s:t.dy;o|r&&this.translate([o,r],!1)},this.onDragEnd=()=>{var t,e;this.isDragging=!1,this.context.canvas.setCursor(this.defaultCursor),null===(e=(t=this.options).onFinish)||void 0===e||e.call(t)},this.invokeOnFinish=(0,ks.Z)((()=>{var t,e;null===(e=(t=this.options).onFinish)||void 0===e||e.call(t)}),300),this.shortcut=new Ge(t.graph),this.bindEvents(),this.defaultCursor=this.context.canvas.getConfig().cursor||"default"}update(t){this.unbindEvents(),super.update(t),this.bindEvents()}bindEvents(){const{trigger:t}=this.options;if((0,l.Z)(t)){const{up:e=[],down:n=[],left:i=[],right:s=[]}=t;this.shortcut.bind(e,(t=>this.onTranslate([0,1],t))),this.shortcut.bind(n,(t=>this.onTranslate([0,-1],t))),this.shortcut.bind(i,(t=>this.onTranslate([1,0],t))),this.shortcut.bind(s,(t=>this.onTranslate([-1,0],t)))}else{const{graph:t}=this.context;t.on(f.DRAG_START,this.onDragStart),t.on(f.DRAG,this.onDrag),t.on(f.DRAG_END,this.onDragEnd)}}onTranslate(t,e){return Ns(this,void 0,void 0,(function*(){if(!this.validate(e))return;const{sensitivity:n}=this.options,i=-1*n;yield this.translate(ue(t,i),this.options.animation),this.invokeOnFinish()}))}translate(t,e){return Ns(this,void 0,void 0,(function*(){t=this.clampByDirection(t),t=this.clampByRange(t),yield this.context.graph.translateBy(t,e)}))}clampByDirection([t,e]){const{direction:n}=this.options;return"x"===n?e=0:"y"===n&&(t=0),[t,e]}clampByRange([t,e]){const{viewport:n,canvas:i}=this.context,[s,o]=i.getSize(),[r,a,l,h]=J(this.options.range),c=[o*r,s*a,o*l,s*h],d=ot(st(n.getCanvasCenter()),c),u=de(n.getViewportCenter(),[t,e,0]);if(!at(u,d)){const{min:[n,i],max:[s,o]}=d;(u[0]<n&&t>0||u[0]>s&&t<0)&&(t=0),(u[1]<i&&e>0||u[1]>o&&e<0)&&(e=0)}return[t,e]}validate(t){if(this.destroyed)return!1;const{enable:e}=this.options;return"function"==typeof e?e(t):!!e}unbindEvents(){this.shortcut.unbindAll();const{graph:t}=this.context;t.off(f.DRAG_START,this.onDragStart),t.off(f.DRAG,this.onDrag),t.off(f.DRAG_END,this.onDragEnd)}destroy(){this.shortcut.destroy(),this.unbindEvents(),this.context.canvas.setCursor(this.defaultCursor),super.destroy()}}Is.defaultOptions={enable:t=>!("targetType"in t)||"canvas"===t.targetType,sensitivity:10,direction:"both",range:1/0};var js=function(t,e,n,i){return new(n||(n=Promise))((function(s,o){function r(t){try{l(i.next(t))}catch(t){o(t)}}function a(t){try{l(i.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,a)}l((i=i.apply(t,e||[])).next())}))};class Bs extends re{constructor(t,e){super(t,Object.assign({},Bs.defaultOptions,e)),this.enable=!1,this.enableElements=["node","combo"],this.target=[],this.shadowOrigin=[0,0],this.hiddenEdges=[],this.isDragging=!1,this.onDrop=t=>js(this,void 0,void 0,(function*(){var e;if("link"!==this.options.dropEffect)return;const{model:n,element:i}=this.context,s=t.target.id;this.target.forEach((t=>{const e=n.getParentData(t,x);e&&Ht(e)===s&&n.refreshComboData(s),n.setParent(t,s,x)})),yield null===(e=null==i?void 0:i.draw({animation:!0}))||void 0===e?void 0:e.finished})),this.setCursor=t=>{if(this.isDragging)return;const{type:e}=t,{canvas:n}=this.context,{cursor:i}=this.options;e===f.POINTER_ENTER?n.setCursor((null==i?void 0:i.grab)||"grab"):n.setCursor((null==i?void 0:i.default)||"default")},this.onDragStart=this.onDragStart.bind(this),this.onDrag=this.onDrag.bind(this),this.onDragEnd=this.onDragEnd.bind(this),this.onDrop=this.onDrop.bind(this),this.bindEvents()}update(t){this.unbindEvents(),super.update(t),this.bindEvents()}bindEvents(){const{graph:t,canvas:e}=this.context,n=e.getLayer().getContextService().$canvas;n&&(n.addEventListener("blur",this.onDragEnd),n.addEventListener("contextmenu",this.onDragEnd)),this.enableElements.forEach((e=>{t.on(`${e}:${f.DRAG_START}`,this.onDragStart),t.on(`${e}:${f.DRAG}`,this.onDrag),t.on(`${e}:${f.DRAG_END}`,this.onDragEnd),t.on(`${e}:${f.POINTER_ENTER}`,this.setCursor),t.on(`${e}:${f.POINTER_LEAVE}`,this.setCursor)})),["link"].includes(this.options.dropEffect)&&(t.on(g.DROP,this.onDrop),t.on(p.DROP,this.onDrop))}getSelectedNodeIDs(t){return Array.from(new Set(this.context.graph.getElementDataByState("node",this.options.state).map((t=>t.id)).concat(t)))}getDelta(t){const e=this.context.graph.getZoom();return pe([t.dx,t.dy],e)}onDragStart(t){var e;if(this.enable=this.validate(t),!this.enable)return;const{batch:n,canvas:i,graph:s}=this.context;i.setCursor((null===(e=this.options.cursor)||void 0===e?void 0:e.grabbing)||"grabbing"),this.isDragging=!0,n.startBatch();const o=t.target.id;s.getElementState(o).includes(this.options.state)?this.target=this.getSelectedNodeIDs([o]):this.target=[o],this.hideEdge(),this.context.graph.frontElement(this.target),this.options.shadow&&this.createShadow(this.target)}onDrag(t){if(!this.enable)return;const e=this.getDelta(t);this.options.shadow?this.moveShadow(e):this.moveElement(this.target,e)}onDragEnd(){var t,e,n;if(this.enable=!1,this.options.shadow){if(!this.shadow)return;this.shadow.style.visibility="hidden";const{x:t=0,y:e=0}=this.shadow.attributes,[n,i]=de([+t,+e],this.shadowOrigin);this.moveElement(this.target,[n,i])}this.showEdges(),null===(e=(t=this.options).onFinish)||void 0===e||e.call(t,this.target);const{batch:i,canvas:s}=this.context;i.endBatch(),s.setCursor((null===(n=this.options.cursor)||void 0===n?void 0:n.grab)||"grab"),this.isDragging=!1,this.target=[]}validate(t){if(this.destroyed)return!1;const{enable:e}=this.options;return(0,W.Z)(e)?e(t):!!e}moveElement(t,e){return js(this,void 0,void 0,(function*(){const{graph:n,model:i}=this.context,{dropEffect:s}=this.options;"move"===s&&t.forEach((t=>i.refreshComboData(t))),n.translateElementBy(Object.fromEntries(t.map((t=>[t,e]))),!1)}))}moveShadow(t){if(!this.shadow)return;const{x:e=0,y:n=0}=this.shadow.attributes,[i,s]=t;this.shadow.attr({x:+e+i,y:+n+s})}createShadow(t){const e=un(this.options,"shadow"),n=rt(t.map((t=>this.context.element.getElement(t).getBounds()))),[i,o]=n.min;this.shadowOrigin=[i,o];const[r,a]=nt(n),l={width:r,height:a,x:i,y:o};this.shadow?this.shadow.attr(Object.assign(Object.assign(Object.assign({},e),l),{visibility:"visible"})):(this.shadow=new s.UL({style:Object.assign(Object.assign(Object.assign({$layer:"transient"},e),l),{pointerEvents:"none"})}),this.context.canvas.appendChild(this.shadow))}showEdges(){this.options.shadow||0===this.hiddenEdges.length||(this.context.graph.showElement(this.hiddenEdges),this.hiddenEdges=[])}hideEdge(){const{hideEdge:t,shadow:e}=this.options;if("none"===t||e)return;const{graph:n}=this.context;this.hiddenEdges="all"===t?n.getEdgeData().map(Ht):Array.from(new Set(this.target.map((e=>n.getRelatedEdgesData(e,t).map(Ht))).flat())),n.hideElement(this.hiddenEdges)}unbindEvents(){const{graph:t,canvas:e}=this.context,n=e.getLayer().getContextService().$canvas;n&&(n.removeEventListener("blur",this.onDragEnd),n.removeEventListener("contextmenu",this.onDragEnd)),this.enableElements.forEach((e=>{t.off(`${e}:${f.DRAG_START}`,this.onDragStart),t.off(`${e}:${f.DRAG}`,this.onDrag),t.off(`${e}:${f.DRAG_END}`,this.onDragEnd),t.off(`${e}:${f.POINTER_ENTER}`,this.setCursor),t.off(`${e}:${f.POINTER_LEAVE}`,this.setCursor)})),t.off(`combo:${f.DROP}`,this.onDrop),t.off(`canvas:${f.DROP}`,this.onDrop)}destroy(){var t;this.unbindEvents(),null===(t=this.shadow)||void 0===t||t.destroy(),super.destroy()}}Bs.defaultOptions={animation:!0,enable:t=>["node","combo"].includes(t.targetType),dropEffect:"move",state:"selected",hideEdge:"none",shadow:!1,shadowZIndex:100,shadowFill:"#F3F9FF",shadowFillOpacity:.5,shadowStroke:"#1890FF",shadowStrokeOpacity:.9,shadowLineDash:[5,5],cursor:{default:"default",grab:"grab",grabbing:"grabbing"}};var zs=n(72137);class Fs{constructor(t,e){this.context=t,this.options=e||{}}}var _s=function(t,e,n,i){return new(n||(n=Promise))((function(s,o){function r(t){try{l(i.next(t))}catch(t){o(t)}}function a(t){try{l(i.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,a)}l((i=i.apply(t,e||[])).next())}))},Zs=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(n[i[s]]=t[i[s]])}return n};function $s(t){const{nodes:e,edges:n}=t,i={nodes:[],edges:[],combos:[]};return e.forEach((t=>{const e=t.data._isCombo?i.combos:i.nodes,{x:n,y:s,z:o=0}=t.data;null==e||e.push({id:t.id,style:{x:n,y:s,z:o}})})),n.forEach((t=>{const{id:e,source:n,target:s,data:{points:o=[],controlPoints:r=o.slice(1,o.length-1)}}=t;i.edges.push({id:e,source:n,target:s,style:Object.assign({},(null==r?void 0:r.length)?{controlPoints:r.map(Re)}:{})})})),i}function Vs(t,e,...n){if(e in t)return t[e](...n);if("instance"in t){const i=t.instance;if(e in i)return i[e](...n)}return null}function Ws(t,e){if(e in t)return t[e];if("instance"in t){const n=t.instance;if(e in n)return n[e]}return null}var Hs=function(t,e,n,i){return new(n||(n=Promise))((function(s,o){function r(t){try{l(i.next(t))}catch(t){o(t)}}function a(t){try{l(i.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,a)}l((i=i.apply(t,e||[])).next())}))};var Ys=function(t,e,n,i){return new(n||(n=Promise))((function(s,o){function r(t){try{l(i.next(t))}catch(t){o(t)}}function a(t){try{l(i.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,a)}l((i=i.apply(t,e||[])).next())}))};class Gs extends re{constructor(t,e){super(t,Object.assign({},Gs.defaultOptions,e)),this.isZoomEvent=t=>Boolean(t.data&&"scale"in t.data),this.relatedEdgeToUpdate=new Set,this.zoom=this.context.graph.getZoom(),this.fixElementSize=t=>Ys(this,void 0,void 0,(function*(){if(!this.validate(t))return;const{graph:e}=this.context,{state:n,nodeFilter:i,edgeFilter:s,comboFilter:o}=this.options,r=(n?e.getElementDataByState("node",n):e.getNodeData()).filter(i),a=(n?e.getElementDataByState("edge",n):e.getEdgeData()).filter(s),l=(n?e.getElementDataByState("combo",n):e.getComboData()).filter(o),h=this.isZoomEvent(t)?this.zoom=Math.max(.01,Math.min(t.data.scale,10)):this.zoom,c=[...r,...l];c.length>0&&c.forEach((t=>this.fixNodeLike(t,h))),this.updateRelatedEdges(),a.length>0&&a.forEach((t=>this.fixEdge(t,h)))})),this.cachedStyles=new Map,this.getOriginalFieldValue=(t,e,n)=>{var i;const s=this.cachedStyles.get(t)||[],o=(null===(i=s.find((t=>t.shape===e)))||void 0===i?void 0:i.style)||{};return n in o||(o[n]=e.attributes[n],this.cachedStyles.set(t,[...s.filter((t=>t.shape!==e)),{shape:e,style:o}])),o[n]},this.scaleEntireElement=(t,e,n)=>{e.setLocalScale(1/n);const i=this.cachedStyles.get(t)||[];i.push({shape:e}),this.cachedStyles.set(t,i)},this.scaleSpecificShapes=(t,e,n)=>{const i=function(t){const e=[],n=t=>{(null==t?void 0:t.children.length)&&t.children.forEach((t=>{e.push(t),n(t)}))};return n(t),e}(t);(Array.isArray(n)?n:[n]).forEach((n=>{const{shape:s,fields:o}=n,r="function"==typeof s?s(i):t.getShape(s);r&&(o?o.forEach((n=>{const i=this.getOriginalFieldValue(t.id,r,n);(0,N.Z)(i)&&(r.style[n]=i/e)})):this.scaleEntireElement(t.id,r,e))}))},this.skipIfExceedViewport=t=>{const{viewport:e}=this.context;return!(null==e?void 0:e.isInViewport(t.getRenderBounds(),!1,30))},this.fixNodeLike=(t,e)=>{const n=Ht(t),{element:i,model:s}=this.context,o=i.getElement(n);if(!o||this.skipIfExceedViewport(o))return;s.getRelatedEdgesData(n).forEach((t=>this.relatedEdgeToUpdate.add(Ht(t))));const r=this.options[o.type];r?this.scaleSpecificShapes(o,e,r):this.scaleEntireElement(n,o,e)},this.fixEdge=(t,e)=>{const n=Ht(t),i=this.context.element.getElement(n);if(!i||this.skipIfExceedViewport(i))return;const s=this.options.edge;if(!s)return i.style.transformOrigin="center",void this.scaleEntireElement(n,i,e);this.scaleSpecificShapes(i,e,s)},this.updateRelatedEdges=()=>{const{element:t}=this.context;this.relatedEdgeToUpdate.size>0&&this.relatedEdgeToUpdate.forEach((e=>{const n=t.getElement(e);null==n||n.update({})})),this.relatedEdgeToUpdate.clear()},this.resetTransform=t=>Ys(this,void 0,void 0,(function*(){var e;(null===(e=t.data)||void 0===e?void 0:e.firstRender)||(this.options.reset?this.restoreCachedStyles():this.fixElementSize({data:{scale:this.zoom}}))})),this.bindEvents()}restoreCachedStyles(){if(this.cachedStyles.size>0){this.cachedStyles.forEach((t=>{t.forEach((({shape:t,style:e})=>{if(Pn(e))t.setLocalScale(1);else{if(this.options.state)return;Object.entries(e).forEach((([e,n])=>t.style[e]=n))}}))}));const{graph:t,element:e}=this.context,n=Object.keys(Object.fromEntries(this.cachedStyles)).filter((e=>e&&"node"===t.getElementType(e)));if(n.length>0){const i=new Set;n.forEach((e=>{t.getRelatedEdgesData(e).forEach((t=>i.add(Ht(t))))})),i.forEach((t=>{const n=null==e?void 0:e.getElement(t);null==n||n.update({})}))}}}bindEvents(){const{graph:t}=this.context;t.on(v.AFTER_DRAW,this.resetTransform),t.on(v.AFTER_TRANSFORM,this.fixElementSize)}unbindEvents(){const{graph:t}=this.context;t.off(v.AFTER_DRAW,this.resetTransform),t.off(v.AFTER_TRANSFORM,this.fixElementSize)}validate(t){if(this.destroyed)return!1;const{enable:e}=this.options;return(0,W.Z)(e)?e(t):!!e}destroy(){this.unbindEvents(),super.destroy()}}Gs.defaultOptions={enable:t=>t.data.scale<1,nodeFilter:()=>!0,edgeFilter:()=>!0,comboFilter:()=>!0,edge:[{shape:"key",fields:["lineWidth"]},{shape:"halo",fields:["lineWidth"]},{shape:"label"}],reset:!1};var Us=function(t,e,n,i){return new(n||(n=Promise))((function(s,o){function r(t){try{l(i.next(t))}catch(t){o(t)}}function a(t){try{l(i.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,a)}l((i=i.apply(t,e||[])).next())}))};class Ks extends re{constructor(t,e){super(t,Object.assign({},Ks.defaultOptions,e)),this.focus=t=>Us(this,void 0,void 0,(function*(){if(!this.validate(t))return;const{graph:e}=this.context;yield e.focusElement(t.target.id,this.options.animation)})),this.bindEvents()}bindEvents(){const{graph:t}=this.context;this.unbindEvents(),qe.forEach((e=>{t.on(`${e}:${f.CLICK}`,this.focus)}))}validate(t){if(this.destroyed)return!1;const{enable:e}=this.options;return(0,W.Z)(e)?e(t):!!e}unbindEvents(){const{graph:t}=this.context;qe.forEach((e=>{t.off(`${e}:${f.CLICK}`,this.focus)}))}destroy(){this.unbindEvents(),super.destroy()}}Ks.defaultOptions={animation:{easing:"ease-in",duration:500},enable:!0};class Xs extends re{constructor(t,e){super(t,Object.assign({},Xs.defaultOptions,e)),this.isFrozen=!1,this.toggleFrozen=t=>{this.isFrozen="dragstart"===t.type},this.hoverElement=t=>{if(!this.validate(t))return;const e=t.type===f.POINTER_ENTER;this.updateElementsState(t,e);const{onHover:n,onHoverEnd:i}=this.options;e?null==n||n(t):null==i||i(t)},this.updateElementsState=(t,e)=>{if(!this.options.state&&!this.options.inactiveState)return;const{graph:n}=this.context,{state:i,animation:s,inactiveState:o}=this.options,r=this.getActiveIds(t),a={};if(i&&Object.assign(a,this.getElementsState(r,i,e)),o){const t=Gt(n.getData(),!0).filter((t=>!r.includes(t)));Object.assign(a,this.getElementsState(t,o,e))}n.setElementState(a,s)},this.getElementsState=(t,e,n)=>{const{graph:i}=this.context,s={};return t.forEach((t=>{const o=i.getElementState(t);s[t]=n?o.includes(e)?o:[...o,e]:o.filter((t=>t!==e))})),s},this.bindEvents()}bindEvents(){const{graph:t}=this.context;this.unbindEvents(),qe.forEach((e=>{t.on(`${e}:${f.POINTER_ENTER}`,this.hoverElement),t.on(`${e}:${f.POINTER_LEAVE}`,this.hoverElement)}));const e=this.context.canvas.document;e.addEventListener(`${f.DRAG_START}`,this.toggleFrozen),e.addEventListener(`${f.DRAG_END}`,this.toggleFrozen)}getActiveIds(t){const{graph:e}=this.context,{degree:n,direction:i}=this.options,s=t.target.id;return n?Qe(e,t.targetType,s,"function"==typeof n?n(t):n,i):[s]}validate(t){if(this.destroyed||this.isFrozen||Cs(t.target)||this.context.graph.isCollapsingExpanding)return!1;const{enable:e}=this.options;return(0,W.Z)(e)?e(t):!!e}unbindEvents(){const{graph:t}=this.context;qe.forEach((e=>{t.off(`${e}:${f.POINTER_ENTER}`,this.hoverElement),t.off(`${e}:${f.POINTER_LEAVE}`,this.hoverElement)}));const e=this.context.canvas.document;e.removeEventListener(`${f.DRAG_START}`,this.toggleFrozen),e.removeEventListener(`${f.DRAG_END}`,this.toggleFrozen)}destroy(){this.unbindEvents(),super.destroy()}}Xs.defaultOptions={animation:!1,enable:!0,degree:0,direction:"both",state:"active",inactiveState:void 0};class qs extends re{constructor(t,e){super(t,Object.assign({},qs.defaultOptions,e)),this.hiddenShapes=[],this.isVisible=!0,this.setElementsVisibility=(t,e,n)=>{t.filter(Boolean).forEach((t=>{"hidden"!==e||t.isVisible()?"visible"===e&&this.hiddenShapes.includes(t)?this.hiddenShapes.splice(this.hiddenShapes.indexOf(t),1):ie(t,e,n):this.hiddenShapes.push(t)}))},this.filterShapes=(t,e)=>{if((0,W.Z)(e))return n=>!e(t,n);const n=null==e?void 0:e[t];return t=>!t.className||!(null==n?void 0:n.includes(t.className))},this.hideShapes=t=>{if(!this.validate(t)||!this.isVisible)return;const{element:e}=this.context,{shapes:n={}}=this.options;this.setElementsVisibility(e.getNodes(),"hidden",this.filterShapes("node",n)),this.setElementsVisibility(e.getEdges(),"hidden",this.filterShapes("edge",n)),this.setElementsVisibility(e.getCombos(),"hidden",this.filterShapes("combo",n)),this.isVisible=!1},this.showShapes=(0,ks.Z)((t=>{if(!this.validate(t)||this.isVisible)return;const{element:e}=this.context;this.setElementsVisibility(e.getNodes(),"visible"),this.setElementsVisibility(e.getEdges(),"visible"),this.setElementsVisibility(e.getCombos(),"visible"),this.isVisible=!0}),this.options.debounce),this.bindEvents()}bindEvents(){const{graph:t}=this.context;t.on(v.BEFORE_TRANSFORM,this.hideShapes),t.on(v.AFTER_TRANSFORM,this.showShapes)}unbindEvents(){const{graph:t}=this.context;t.off(v.BEFORE_TRANSFORM,this.hideShapes),t.off(v.AFTER_TRANSFORM,this.showShapes)}validate(t){if(this.destroyed)return!1;const{enable:e}=this.options;return(0,W.Z)(e)?e(t):!!e}update(t){this.unbindEvents(),super.update(t),this.bindEvents()}destroy(){this.unbindEvents(),super.destroy()}}qs.defaultOptions={enable:!0,debounce:200,shapes:t=>"node"===t};var Js=function(t,e,n,i){return new(n||(n=Promise))((function(s,o){function r(t){try{l(i.next(t))}catch(t){o(t)}}function a(t){try{l(i.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,a)}l((i=i.apply(t,e||[])).next())}))};class Qs extends re{constructor(t,e){super(t,Object.assign({},Qs.defaultOptions,e)),this.onWheel=t=>Js(this,void 0,void 0,(function*(){this.options.preventDefault&&t.preventDefault();const e=t.deltaX,n=t.deltaY;yield this.scroll([-e,-n],t)})),this.shortcut=new Ge(t.graph),this.bindEvents()}update(t){super.update(t),this.bindEvents()}bindEvents(){var t,e;const{trigger:n}=this.options;if(this.shortcut.unbindAll(),(0,l.Z)(n)){null===(t=this.graphDom)||void 0===t||t.removeEventListener(f.WHEEL,this.onWheel);const{up:e=[],down:i=[],left:s=[],right:o=[]}=n;this.shortcut.bind(e,(t=>this.scroll([0,-10],t))),this.shortcut.bind(i,(t=>this.scroll([0,10],t))),this.shortcut.bind(s,(t=>this.scroll([-10,0],t))),this.shortcut.bind(o,(t=>this.scroll([10,0],t)))}else null===(e=this.graphDom)||void 0===e||e.addEventListener(f.WHEEL,this.onWheel,{passive:!1})}get graphDom(){return this.context.graph.getCanvas().getContextService().getDomElement()}formatDisplacement(t){const{sensitivity:e}=this.options;return t=ue(t,e),t=this.clampByDirection(t),t=this.clampByRange(t)}clampByDirection([t,e]){const{direction:n}=this.options;return"x"===n?e=0:"y"===n&&(t=0),[t,e]}clampByRange([t,e]){const{viewport:n,canvas:i}=this.context,[s,o]=i.getSize(),[r,a,l,h]=J(this.options.range),c=[o*r,s*a,o*l,s*h],d=ot(st(n.getCanvasCenter()),c),u=de(n.getViewportCenter(),[t,e,0]);if(!at(u,d)){const{min:[n,i],max:[s,o]}=d;(u[0]<n&&t>0||u[0]>s&&t<0)&&(t=0),(u[1]<i&&e>0||u[1]>o&&e<0)&&(e=0)}return[t,e]}scroll(t,e){return Js(this,void 0,void 0,(function*(){if(!this.validate(e))return;const{onFinish:n}=this.options,i=this.context.graph,s=this.formatDisplacement(t);yield i.translateBy(s,!1),null==n||n()}))}validate(t){if(this.destroyed)return!1;const{enable:e}=this.options;return(0,W.Z)(e)?e(t):!!e}destroy(){var t;this.shortcut.destroy(),null===(t=this.graphDom)||void 0===t||t.removeEventListener(f.WHEEL,this.onWheel),super.destroy()}}Qs.defaultOptions={enable:!0,sensitivity:1,preventDefault:!0,range:1/0};var to=n(81957),eo=function(t,e,n,i){return new(n||(n=Promise))((function(s,o){function r(t){try{l(i.next(t))}catch(t){o(t)}}function a(t){try{l(i.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,a)}l((i=i.apply(t,e||[])).next())}))};class no extends re{constructor(t,e){super(t,Object.assign({},no.defaultOptions,e)),this.zoom=(t,e,n)=>eo(this,void 0,void 0,(function*(){if(!this.validate(e))return;const{graph:i}=this.context;let s;"viewport"in e&&(s=Re(e.viewport));const{sensitivity:o,onFinish:r}=this.options,a=1+(0,to.Z)(t,-50,50)*o/100,l=i.getZoom();yield i.zoomTo(l*a,n,s),null==r||r()})),this.onReset=()=>eo(this,void 0,void 0,(function*(){yield this.context.graph.zoomTo(1,this.options.animation)})),this.preventDefault=t=>{this.options.preventDefault&&t.preventDefault()},this.shortcut=new Ge(t.graph),this.bindEvents()}update(t){super.update(t),this.bindEvents()}bindEvents(){const{trigger:t}=this.options;if(this.shortcut.unbindAll(),Array.isArray(t))if(t.includes(f.PINCH))this.shortcut.bind([f.PINCH],(t=>{this.zoom(t.scale,t,!1)}));else{const e=this.context.canvas.getContainer();null==e||e.addEventListener(f.WHEEL,this.preventDefault),this.shortcut.bind([...t,f.WHEEL],(t=>{const{deltaX:e,deltaY:n}=t;this.zoom(-(null!=n?n:e),t,!1)}))}if("object"==typeof t){const{zoomIn:e=[],zoomOut:n=[],reset:i=[]}=t;this.shortcut.bind(e,(t=>this.zoom(10,t,this.options.animation))),this.shortcut.bind(n,(t=>this.zoom(-10,t,this.options.animation))),this.shortcut.bind(i,this.onReset)}}validate(t){if(this.destroyed)return!1;const{enable:e}=this.options;return(0,W.Z)(e)?e(t):!!e}destroy(){var t;this.shortcut.destroy(),null===(t=this.context.canvas.getContainer())||void 0===t||t.removeEventListener(f.WHEEL,this.preventDefault),super.destroy()}}no.defaultOptions={animation:{duration:200},enable:!0,sensitivity:1,trigger:[],preventDefault:!0};var io=n(81746),so=n(45978),oo=n(63795),ro=n(63757),ao=n(5192),lo=n(55982),ho=n(21183),co=n(40476),uo=n(70979),po=n(89469),go=n(41733),fo=n(64912),yo=n(29257),mo=n(26629),vo=n(92426),bo=function(t,e,n,i){return new(n||(n=Promise))((function(s,o){function r(t){try{l(i.next(t))}catch(t){o(t)}}function a(t){try{l(i.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,a)}l((i=i.apply(t,e||[])).next())}))};class Eo extends Fs{constructor(){super(...arguments),this.id="fishbone"}getRoot(){const t=this.context.model.getRootsData();if(!(Pn(t)||t.length>2))return t[0]}formatSize(t){const e="function"==typeof t?t:()=>t;return t=>fn(e(t))}doLayout(t,e){const{hGap:n,getRibSep:i,vGap:s,nodeSize:o,height:r}=e,{model:a}=this.context,l=this.formatSize(o);let h=l(t)[0]+i(t);const c=(t,e=0)=>{var i;return e+=n*((t.children||[]).length+1),null===(i=t.children)||void 0===i||i.forEach((t=>{var n;null===(n=a.getNodeLikeDatum(t).children)||void 0===n||n.forEach((t=>{const n=a.getNodeLikeDatum(t);e=c(n,e)}))})),e},d=t=>{if(1===t.depth)return h;const e=a.getParentData(t.id,"tree");if(Oo(t)){const i=a.getParentData(e.id,"tree"),o=g(t)-g(i);return d(e)+o*n/s}{const n=(e.children||[]).indexOf(t.id),i=a.getNodeData((e.children||[]).slice(n));return u(e)-i.reduce(((t,e)=>t+c(e)),0)-l(e)[0]/2}},u=(0,vo.Z)((t=>{if(wo(t))return l(t)[0]/2;const e=a.getParentData(t.id,"tree");if(Oo(t))return d(t)+c(t)+l(t)[0]/2;{const i=g(t)-g(e),o=n/s;return d(t)+i*o}}),(t=>t.id)),p=t=>g(a.getParentData(t,"tree")),g=(0,vo.Z)((t=>{if(wo(t))return r/2;if(Oo(t)){const e=a.getParentData(t.id,"tree"),n=e.children.indexOf(t.id);if(0===n)return p(e.id)+s;const i=a.getNodeLikeDatum(e.children[n-1]);if(Pn(i.children))return g(i)+s;const o=a.getDescendantsData(i.id);return Math.max(...o.map((t=>Oo(t)?p(t.id):g(t))))+s}{if(Pn(t.children))return p(t.id)+s;const e=a.getNodeLikeDatum(t.children.slice(-1)[0]);if(Pn(e.children))return g(e)+s;const n=a.getDescendantsData(t.id).slice(-1)[0];return(Oo(n)?p(n.id):g(n))+s}}),(t=>t.id));let f=0;const y={nodes:[],edges:[]},m=t=>{var e;null===(e=t.children)||void 0===e||e.forEach((t=>m(a.getNodeLikeDatum(t))));const n=g(t),s=u(t);if(y.nodes.push({id:t.id,x:s,y:n}),wo(t))return;const o=a.getRelatedEdgesData(t.id,"in")[0],r=[d(t),Oo(t)?n:p(t.id)];y.edges.push({id:Ht(o),controlPoints:[r],relatedNodeId:t.id}),f=Math.max(f,s+i(t)),1===t.depth&&(h=f)};return m(t),y}placeAlterative(t,e){const n=(e.children||[]).filter(((t,e)=>e%2!=0));if(0===n.length)return t;const{model:i}=this.context,s=t.nodes.find((t=>t.id===e.id)).y,o=t=>{const e=i.getAncestorsData(t,"tree");if(Pn(e))return!1;const s=1===e.length?t:e[e.length-2].id;return n.includes(s)};t.nodes.forEach((t=>{o(t.id)&&(t.y=2*s-t.y)})),t.edges.forEach((t=>{o(t.relatedNodeId)&&(t.controlPoints=t.controlPoints.map((t=>[t[0],2*s-t[1]])))}))}rightToLeft(t,e){return t.nodes.forEach((t=>t.x=e.width-t.x)),t.edges.forEach((t=>{t.controlPoints=t.controlPoints.map((t=>[e.width-t[0],t[1]]))})),t}execute(t,e){return bo(this,void 0,void 0,(function*(){const n=Object.assign(Object.assign(Object.assign({},Eo.defaultOptions),this.options),e),{direction:i,nodeSize:s}=n,o=this.getRoot();if(!o)return t;const r=this.formatSize(s);n.vGap||(n.vGap=Math.max(...(t.nodes||[]).map((t=>r(t)[1])))),n.hGap||(n.hGap=Math.max(...(t.nodes||[]).map((t=>r(t)[0]))));let a=this.doLayout(o,n);this.placeAlterative(a,o),"RL"===i&&(a=this.rightToLeft(a,n));const{model:l}=this.context,h=[],c=[];return a.nodes.forEach((t=>{const{id:e,x:n,y:i}=t,s=l.getNodeLikeDatum(e);h.push(xo(s,{x:n,y:i}))})),a.edges.forEach((t=>{const{id:e,controlPoints:n}=t,i=l.getEdgeDatum(e);c.push(xo(i,{controlPoints:n}))})),{nodes:h,edges:c}}))}}Eo.defaultOptions={direction:"RL",getRibSep:()=>60};const xo=(t,e)=>Object.assign(Object.assign({},t),{style:Object.assign(Object.assign({},t.style||{}),e)}),wo=t=>0===t.depth,Oo=t=>(t.depth||(t.depth=0))%2==0;var So=function(t,e,n,i){return new(n||(n=Promise))((function(s,o){function r(t){try{l(i.next(t))}catch(t){o(t)}}function a(t){try{l(i.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,a)}l((i=i.apply(t,e||[])).next())}))};class Do extends Fs{constructor(){super(...arguments),this.id="snake"}formatSize(t,e){const n="function"==typeof e?e:()=>e;return t.reduce(((t,e)=>{const[i,s]=fn(n(e))||[0,0];return[Math.max(t[0],i),Math.max(t[1],s)]}),[0,0])}validate(t){const{nodes:e=[],edges:n=[]}=t,i={},s={},o={};e.forEach((t=>{i[t.id]=0,s[t.id]=0,o[t.id]=[]})),n.forEach((t=>{i[t.target]++,s[t.source]++,o[t.source].push(t.target)}));const r=new Set,a=t=>{r.has(t)||(r.add(t),o[t].forEach(a))};if(a(e[0].id),r.size!==e.length)return!1;const l=e.filter((t=>0===i[t.id])),h=e.filter((t=>0===s[t.id]));if(1!==l.length||1!==h.length)return!1;return e.filter((t=>1===i[t.id]&&1===s[t.id])).length===e.length-2}execute(t,e){return So(this,void 0,void 0,(function*(){var n;if(!this.validate(t))return t;const{nodeSize:i,padding:s,sortBy:o,cols:r,colGap:a,rowGap:l,clockwise:h,width:c,height:d}=Object.assign({},Do.defaultOptions,this.options,e),[u,p,g,f]=J(s),y=this.formatSize(t.nodes||[],i),m=Math.ceil((t.nodes||[]).length/r);let v=a||(c-f-p-r*y[0])/(r-1),b=l||(d-u-g-m*y[1])/(m-1);(b===1/0||b<0)&&(b=0),(v===1/0||v<0)&&(v=0);const E=o?null===(n=t.nodes)||void 0===n?void 0:n.sort(o):function(t){const{nodes:e=[],edges:n=[]}=t,i={},s={};e.forEach((t=>{i[t.id]=0,s[t.id]=[]})),n.forEach((t=>{i[t.target]++,s[t.source].push(t.target)}));const o=[],r=[];e.forEach((t=>{0===i[t.id]&&o.push(t.id)}));for(;o.length>0;){const t=o.shift(),n=e.find((e=>e.id===t));r.push(n),s[t].forEach((t=>{i[t]--,0===i[t]&&o.push(t)}))}return r}(t);return{nodes:(E||[]).map(((t,e)=>{const n=Math.floor(e/r),i=e%r,s=f+(h?n%2==0?i:r-1-i:n%2==0?r-1-i:i)*(y[0]+v)+y[0]/2,o=u+n*(y[1]+b)+y[1]/2;return{id:t.id,style:{x:s,y:o}}}))}}))}}Do.defaultOptions={padding:0,cols:5,clockwise:!0};var Co=n(35278);class Mo extends oe{}function To(t,e=!0,n){const i=document.createElement("div");return i.setAttribute("class",`g6-${t}`),Object.assign(i.style,{position:"absolute",display:"block"}),e&&Object.assign(i.style,{position:"unset",gridArea:"1 / 1 / 2 / 2",inset:"0px",height:"100%",width:"100%",overflow:"hidden",pointerEvents:"none"}),n&&Object.assign(i.style,n),i}function Po(t,e="div",n={},i="",s=document.body){const o=document.getElementById(t);o&&o.remove();const r=document.createElement(e);return r.innerHTML=i,r.id=t,Object.assign(r.style,n),s.appendChild(r),r}var Ao,Ro,Lo=function(t,e,n,i){return new(n||(n=Promise))((function(s,o){function r(t){try{l(i.next(t))}catch(t){o(t)}}function a(t){try{l(i.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,a)}l((i=i.apply(t,e||[])).next())}))};class ko extends Mo{constructor(t,e){super(t,Object.assign({},ko.defaultOptions,e)),this.$element=To("background");this.context.canvas.getContainer().prepend(this.$element),this.update(e)}update(t){const e=Object.create(null,{update:{get:()=>super.update}});return Lo(this,void 0,void 0,(function*(){e.update.call(this,t),Object.assign(this.$element.style,(0,Co.Z)(this.options,["key","type"]))}))}destroy(){super.destroy(),this.$element.remove()}}function No(t,e,n,i,s,o){const r=n-t,a=i-e;let l=s-t,h=o-e,c=l*r+h*a,d=0;c<=0?d=0:(l=r-l,h=a-h,c=l*r+h*a,d=c<=0?0:c*c/(r*r+a*a));const u=l*l+h*h-d;return u<0?0:u}function Io(t,e,n,i){return(t-n)*(t-n)+(e-i)*(e-i)}function jo(t,e,n,i,s){return Io(t,e,n,i)<s*s}function Bo(t){const e=Math.min(t.x1,t.x2),n=Math.max(t.x1,t.x2),i=Math.min(t.y1,t.y2),s=Math.max(t.y1,t.y2);return{x:e,y:i,x2:n,y2:s,width:n-e,height:s-i}}ko.defaultOptions={transition:"background 0.5s",backgroundSize:"cover",zIndex:"-1"};class zo{constructor(t,e,n,i){this.x1=t,this.y1=e,this.x2=n,this.y2=i}equals(t){return this.x1===t.x1&&this.y1===t.y1&&this.x2===t.x2&&this.y2===t.y2}draw(t){t.moveTo(this.x1,this.y1),t.lineTo(this.x2,this.y2)}toString(){return`Line(from=(${this.x1},${this.y1}),to=(${this.x2},${this.y2}))`}static from(t){return new zo(t.x1,t.y1,t.x2,t.y2)}cuts(t,e){if(this.y1===this.y2)return!1;if(e<this.y1&&e<=this.y2||e>this.y1&&e>=this.y2)return!1;if(t>this.x1&&t>=this.x2)return!1;if(t<this.x1&&t<=this.x2)return!0;return t<=this.x1+(e-this.y1)*(this.x2-this.x1)/(this.y2-this.y1)}distSquare(t,e){return No(this.x1,this.y1,this.x2,this.y2,t,e)}ptClose(t,e,n){if(this.x1<this.x2){if(t<this.x1-n||t>this.x2+n)return!1}else if(t<this.x2-n||t>this.x1+n)return!1;if(this.y1<this.y2){if(e<this.y1-n||e>this.y2+n)return!1}else if(e<this.y2-n||e>this.y1+n)return!1;return!0}}!function(t){t[t.POINT=1]="POINT",t[t.PARALLEL=2]="PARALLEL",t[t.COINCIDENT=3]="COINCIDENT",t[t.NONE=4]="NONE"}(Ao||(Ao={}));class Fo{constructor(t,e=0,n=0){this.state=t,this.x=e,this.y=n}}function _o(t,e){const n=(e.x2-e.x1)*(t.y1-e.y1)-(e.y2-e.y1)*(t.x1-e.x1),i=(t.x2-t.x1)*(t.y1-e.y1)-(t.y2-t.y1)*(t.x1-e.x1),s=(e.y2-e.y1)*(t.x2-t.x1)-(e.x2-e.x1)*(t.y2-t.y1);if(s){const e=n/s,o=i/s;return 0<=e&&e<=1&&0<=o&&o<=1?new Fo(Ao.POINT,t.x1+e*(t.x2-t.x1),t.y1+e*(t.y2-t.y1)):new Fo(Ao.NONE)}return new Fo(0===n||0===i?Ao.COINCIDENT:Ao.PARALLEL)}function Zo(t,e){const n=(e.x2-e.x1)*(t.y1-e.y1)-(e.y2-e.y1)*(t.x1-e.x1),i=(t.x2-t.x1)*(t.y1-e.y1)-(t.y2-t.y1)*(t.x1-e.x1),s=(e.y2-e.y1)*(t.x2-t.x1)-(e.x2-e.x1)*(t.y2-t.y1);if(s){const t=n/s,e=i/s;if(0<=t&&t<=1&&0<=e&&e<=1)return t}return Number.POSITIVE_INFINITY}function $o(t,e,n){const i=new Set;return t.width<=0?(i.add(Ro.LEFT),i.add(Ro.RIGHT)):e<t.x?i.add(Ro.LEFT):e>t.x+t.width&&i.add(Ro.RIGHT),t.height<=0?(i.add(Ro.TOP),i.add(Ro.BOTTOM)):n<t.y?i.add(Ro.TOP):n>t.y+t.height&&i.add(Ro.BOTTOM),i}function Vo(t,e){let n=e.x1,i=e.y1;const s=e.x2,o=e.y2,r=Array.from($o(t,s,o));if(0===r.length)return!0;let a=$o(t,n,i);for(;0!==a.size;){for(const t of r)if(a.has(t))return!1;if(a.has(Ro.RIGHT)||a.has(Ro.LEFT)){let e=t.x;a.has(Ro.RIGHT)&&(e+=t.width),i+=(e-n)*(o-i)/(s-n),n=e}else{let e=t.y;a.has(Ro.BOTTOM)&&(e+=t.height),n+=(e-i)*(s-n)/(o-i),i=e}a=$o(t,n,i)}return!0}function Wo(t,e){let n=Number.POSITIVE_INFINITY,i=0;function s(t,s,o,r){let a=Zo(e,new zo(t,s,o,r));a=Math.abs(a-.5),a>=0&&a<=1&&(i++,a<n&&(n=a))}return s(t.x,t.y,t.x2,t.y),s(t.x,t.y,t.x,t.y2),i>1?n:(s(t.x,t.y2,t.x2,t.y2),i>1?n:(s(t.x2,t.y,t.x2,t.y2),0===i?-1:n))}function Ho(t,e){let n=0;const i=_o(t,new zo(e.x,e.y,e.x2,e.y));n+=i.state===Ao.POINT?1:0;const s=_o(t,new zo(e.x,e.y,e.x,e.y2));n+=s.state===Ao.POINT?1:0;const o=_o(t,new zo(e.x,e.y2,e.x2,e.y2));n+=o.state===Ao.POINT?1:0;const r=_o(t,new zo(e.x2,e.y,e.x2,e.y2));return n+=r.state===Ao.POINT?1:0,{top:i,left:s,bottom:o,right:r,count:n}}!function(t){t[t.LEFT=0]="LEFT",t[t.TOP=1]="TOP",t[t.RIGHT=2]="RIGHT",t[t.BOTTOM=3]="BOTTOM"}(Ro||(Ro={}));class Yo{constructor(t,e,n,i){this.x=t,this.y=e,this.width=n,this.height=i}get x2(){return this.x+this.width}get y2(){return this.y+this.height}get cx(){return this.x+this.width/2}get cy(){return this.y+this.height/2}get radius(){return Math.max(this.width,this.height)/2}static from(t){return new Yo(t.x,t.y,t.width,t.height)}equals(t){return this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height}clone(){return new Yo(this.x,this.y,this.width,this.height)}add(t){const e=Math.min(this.x,t.x),n=Math.min(this.y,t.y),i=Math.max(this.x2,t.x+t.width),s=Math.max(this.y2,t.y+t.height);this.x=e,this.y=n,this.width=i-e,this.height=s-n}addPoint(t){const e=Math.min(this.x,t.x),n=Math.min(this.y,t.y),i=Math.max(this.x2,t.x),s=Math.max(this.y2,t.y);this.x=e,this.y=n,this.width=i-e,this.height=s-n}toString(){return`Rectangle[x=${this.x}, y=${this.y}, w=${this.width}, h=${this.height}]`}draw(t){t.rect(this.x,this.y,this.width,this.height)}containsPt(t,e){return t>=this.x&&t<=this.x2&&e>=this.y&&e<=this.y2}get area(){return this.width*this.height}intersects(t){return!(this.area<=0||t.width<=0||t.height<=0)&&(t.x+t.width>this.x&&t.y+t.height>this.y&&t.x<this.x2&&t.y<this.y2)}distSquare(t,e){if(this.containsPt(t,e))return 0;const n=$o(this,t,e);return n.has(Ro.TOP)?n.has(Ro.LEFT)?Io(t,e,this.x,this.y):n.has(Ro.RIGHT)?Io(t,e,this.x2,this.y):(this.y-e)*(this.y-e):n.has(Ro.BOTTOM)?n.has(Ro.LEFT)?Io(t,e,this.x,this.y2):n.has(Ro.RIGHT)?Io(t,e,this.x2,this.y2):(e-this.y2)*(e-this.y2):n.has(Ro.LEFT)?(this.x-t)*(this.x-t):n.has(Ro.RIGHT)?(t-this.x2)*(t-this.x2):0}}class Go{constructor(t,e,n){this.cx=t,this.cy=e,this.radius=n}get x(){return this.cx-this.radius}get x2(){return this.cx+this.radius}get width(){return 2*this.radius}get y(){return this.cy-this.radius}get y2(){return this.cy+this.radius}get height(){return 2*this.radius}static from(t){return new Go(t.cx,t.cy,t.radius)}containsPt(t,e){return Io(this.cx,this.cy,t,e)<this.radius*this.radius}distSquare(t,e){const n=Io(this.cx,this.cy,t,e);if(n<this.radius*this.radius)return 0;const i=Math.sqrt(n)-this.radius;return i*i}draw(t){t.ellipse(this.cx,this.cy,this.radius,this.radius,0,0,2*Math.PI)}}class Uo{constructor(t,e=0,n=0,i=0,s=0,o=10,r=10,a=new Float32Array(Math.max(0,o*r)).fill(0)){this.pixelGroup=t,this.i=e,this.j=n,this.pixelX=i,this.pixelY=s,this.width=o,this.height=r,this.area=a}createSub(t,e){return new Uo(this.pixelGroup,t.x,t.y,e.x,e.y,t.width,t.height)}static fromPixelRegion(t,e){return new Uo(e,0,0,t.x,t.y,Math.ceil(t.width/e),Math.ceil(t.height/e))}copy(t,e){return new Uo(this.pixelGroup,this.scaleX(e.x),this.scaleY(e.y),e.x,e.y,t.width,t.height,t.area)}boundX(t){return t<this.i?this.i:t>=this.width?this.width-1:t}boundY(t){return t<this.j?this.j:t>=this.height?this.height-1:t}scaleX(t){return this.boundX(Math.floor((t-this.pixelX)/this.pixelGroup))}scaleY(t){return this.boundY(Math.floor((t-this.pixelY)/this.pixelGroup))}scale(t){const e=this.scaleX(t.x),n=this.scaleY(t.y),i=this.boundX(Math.ceil((t.x+t.width-this.pixelX)/this.pixelGroup)),s=this.boundY(Math.ceil((t.y+t.height-this.pixelY)/this.pixelGroup));return new Yo(e,n,i-e,s-n)}invertScaleX(t){return Math.round(t*this.pixelGroup+this.pixelX)}invertScaleY(t){return Math.round(t*this.pixelGroup+this.pixelY)}addPadding(t,e){const n=Math.ceil(e/this.pixelGroup),i=this.boundX(t.x-n),s=this.boundY(t.y-n),o=this.boundX(t.x2+n),r=this.boundY(t.y2+n);return new Yo(i,s,o-i,r-s)}get(t,e){return t<0||e<0||t>=this.width||e>=this.height?Number.NaN:this.area[t+e*this.width]}inc(t,e,n){t<0||e<0||t>=this.width||e>=this.height||(this.area[t+e*this.width]+=n)}set(t,e,n){t<0||e<0||t>=this.width||e>=this.height||(this.area[t+e*this.width]=n)}incArea(t,e){if(t.width<=0||t.height<=0||0===e)return;const n=this.width,i=t.width,s=Math.max(0,t.i),o=Math.max(0,t.j),r=Math.min(t.i+t.width,n),a=Math.min(t.j+t.height,this.height);if(!(a<=0||r<=0||s>=n||a>=this.height))for(let l=o;l<a;l++){const o=(l-t.j)*i,a=l*n;for(let n=s;n<r;n++){const i=t.area[n-t.i+o];0!==i&&(this.area[n+a]+=e*i)}}}fill(t){this.area.fill(t)}fillArea(t,e){const n=t.x+t.y*this.width;for(let i=0;i<t.height;i++){const s=n+i*this.width;this.area.fill(e,s,s+t.width)}}fillHorizontalLine(t,e,n,i){const s=t+e*this.width;this.area.fill(i,s,s+n)}fillVerticalLine(t,e,n,i){const s=t+e*this.width;for(let t=0;t<n;t++)this.area[s+t*this.width]=i}clear(){this.area.fill(0)}toString(){let t="";for(let e=0;e<this.height;e++){const n=e*this.width;for(let e=0;e<this.width;e++){t+=this.area[n+e].toFixed(1).padStart(6),t+=" "}t+="\n"}return t}draw(t,e=!0){if(this.width<=0||this.height<=0)return;t.save(),e&&t.translate(this.pixelX,this.pixelY);const n=this.area.reduce(((t,e)=>Math.min(t,e)),Number.POSITIVE_INFINITY),i=this.area.reduce(((t,e)=>Math.max(t,e)),Number.NEGATIVE_INFINITY),s=t=>(t-n)/(i-n);t.scale(this.pixelGroup,this.pixelGroup);for(let e=0;e<this.width;e++)for(let n=0;n<this.height;n++){const i=this.area[e+n*this.width];t.fillStyle=`rgba(0, 0, 0, ${s(i)})`,t.fillRect(e,n,1,1)}t.restore()}drawThreshold(t,e,n=!0){if(!(this.width<=0||this.height<=0)){t.save(),n&&t.translate(this.pixelX,this.pixelY),t.scale(this.pixelGroup,this.pixelGroup);for(let n=0;n<this.width;n++)for(let i=0;i<this.height;i++){const s=this.area[n+i*this.width];t.fillStyle=s>e?"black":"white",t.fillRect(n,i,1,1)}t.restore()}}}function Ko(t,e){const n=t=>({x:t.x-e,y:t.y-e,width:t.width+2*e,height:t.height+2*e});return Array.isArray(t)?t.map(n):n(t)}function Xo(t,e,n){return qo(Object.assign(Bo(t),{distSquare:(e,n)=>No(t.x1,t.y1,t.x2,t.y2,e,n)}),e,n)}function qo(t,e,n){const i=Ko(t,n),s=e.scale(i),o=e.createSub(s,i);return function(t,e,n,i){const s=n*n;for(let o=0;o<t.height;o++)for(let r=0;r<t.width;r++){const a=i(e.invertScaleX(t.i+r),e.invertScaleY(t.j+o));if(0!==a){if(a<s){const e=n-Math.sqrt(a);t.set(r,o,e*e)}}else t.set(r,o,s)}}(o,e,n,((e,n)=>t.distSquare(e,n))),o}function Jo(t,e){return{x:t,y:e}}function Qo(t,e,n,i){if(0===t.length)return[];const s=function(t){if(t.length<2)return t;let e=0,n=0;return t.forEach((t=>{e+=t.cx,n+=t.cy})),e/=t.length,n/=t.length,t.map((t=>{const i=e-t.cx,s=n-t.cy;return[t,i*i+s*s]})).sort(((t,e)=>t[1]-e[1])).map((t=>t[0]))}(t);return s.map(((t,o)=>{const r=s.slice(0,o);return function(t,e,n,i,s){const o=Jo(e.cx,e.cy),r=function(t,e,n){let i=Number.POSITIVE_INFINITY;return e.reduce(((e,s)=>{const o=Io(t.x,t.y,s.cx,s.cy);if(o>i)return e;const r=new zo(t.x,t.y,s.cx,s.cy),a=function(t,e){return t.reduce(((t,n)=>Vo(n,e)&&function(t,e){function n(t,n,i,s){let o=Zo(e,new zo(t,n,i,s));return o=Math.abs(o-.5),o>=0&&o<=1?1:0}let i=n(t.x,t.y,t.x2,t.y);return i+=n(t.x,t.y,t.x,t.y2),i>1||(i+=n(t.x,t.y2,t.x2,t.y2),i>1||(i+=n(t.x2,t.y,t.x2,t.y2),i>0))}(n,e)?t+1:t),0)}(n,r);return o*(a+1)*(a+1)<i&&(e=s,i=o*(a+1)*(a+1)),e}),null)}(o,n,t);if(null==r)return[];const a=function(t,e,n,i){const s=[],o=[];o.push(t);let r=!0;for(let t=0;t<n&&r;t++)for(r=!1;!r&&o.length>0;){const t=o.pop(),n=nr(e,t),a=n?Ho(t,n):null;if(!n||!a||2!==a.count){r||s.push(t);continue}let l=i,h=ir(n,l,a,!0),c=er(h,o)||er(h,s),d=tr(h,e);for(;!c&&d&&l>=1;)l/=1.5,h=ir(n,l,a,!0),c=er(h,o)||er(h,s),d=tr(h,e);if(!h||c||d||(o.push(new zo(t.x1,t.y1,h.x,h.y)),o.push(new zo(h.x,h.y,t.x2,t.y2)),r=!0),r)continue;l=i,h=ir(n,l,a,!1);let u=er(h,o)||er(h,s);for(d=tr(h,e);!u&&d&&l>=1;)l/=1.5,h=ir(n,l,a,!1),u=er(h,o)||er(h,s),d=tr(h,e);h&&!u&&(o.push(new zo(t.x1,t.y1,h.x,h.y)),o.push(new zo(h.x,h.y,t.x2,t.y2)),r=!0),r||s.push(t)}for(;o.length>0;)s.push(o.pop());return s}(new zo(o.x,o.y,r.cx,r.cy),t,i,s);return function(t,e){const n=[];for(;t.length>0;){const i=t.pop();if(0===t.length){n.push(i);break}const s=t.pop(),o=new zo(i.x1,i.y1,s.x2,s.y2);nr(e,o)?(n.push(i),t.push(s)):t.push(o)}return n}(a,t)}(e,t,r,n,i)})).flat()}function tr(t,e){return e.some((e=>e.containsPt(t.x,t.y)))}function er(t,e){return e.some((e=>!!jo(e.x1,e.y1,t.x,t.y,.001)||!!jo(e.x2,e.y2,t.x,t.y,.001)))}function nr(t,e){let n=Number.POSITIVE_INFINITY,i=null;for(const s of t){if(!Vo(s,e))continue;const t=Wo(s,e);t>=0&&t<n&&(i=s,n=t)}return i}function ir(t,e,n,i){const s=n.top,o=n.left,r=n.bottom,a=n.right;if(i){if(o.state===Ao.POINT){if(s.state===Ao.POINT)return Jo(t.x-e,t.y-e);if(r.state===Ao.POINT)return Jo(t.x-e,t.y2+e);const n=t.width*t.height;return t.width*(.5*(o.y-t.y+(a.y-t.y)))<.5*n?o.y>a.y?Jo(t.x-e,t.y-e):Jo(t.x2+e,t.y-e):o.y<a.y?Jo(t.x-e,t.y2+e):Jo(t.x2+e,t.y2+e)}if(a.state===Ao.POINT){if(s.state===Ao.POINT)return Jo(t.x2+e,t.y-e);if(r.state===Ao.POINT)return Jo(t.x2+e,t.y2+e)}const n=t.height*t.width;return t.height*(.5*(s.x-t.x+(a.x-t.x)))<.5*n?s.x>r.x?Jo(t.x-e,t.y-e):Jo(t.x-e,t.y2+e):s.x<r.x?Jo(t.x2+e,t.y-e):Jo(t.x2+e,t.y2+e)}if(o.state===Ao.POINT){if(s.state===Ao.POINT)return Jo(t.x2+e,t.y2+e);if(r.state===Ao.POINT)return Jo(t.x2+e,t.y-e);const n=t.height*t.width;return t.width*(.5*(o.y-t.y+(a.y-t.y)))<.5*n?o.y>a.y?Jo(t.x2+e,t.y2+e):Jo(t.x-e,t.y2+e):o.y<a.y?Jo(t.x2+e,t.y-e):Jo(t.x-e,t.y-e)}if(a.state===Ao.POINT){if(s.state===Ao.POINT)return Jo(t.x-e,t.y2+e);if(r.state===Ao.POINT)return Jo(t.x-e,t.y-e)}const l=t.height*t.width;return t.height*(.5*(s.x-t.x+(a.x-t.x)))<.5*l?s.x>r.x?Jo(t.x2+e,t.y2+e):Jo(t.x2+e,t.y-e):s.x<r.x?Jo(t.x-e,t.y2+e):Jo(t.x-e,t.y-e)}function sr(t,e,n,i){if(!(t.closed?n<t.length:n<t.length-1))return!1;const s=t.get(e),o=t.get(n+1);for(let r=e+1;r<=n;r++){const e=t.get(r);if(No(s.x,s.y,o.x,o.y,e.x,e.y)>i)return!1}return!0}function or(t,e){switch(t){case-2:return(((3-e)*e-3)*e+1)/6;case-1:return((3*e-6)*e*e+4)/6;case 0:return(((-3*e+3)*e+3)*e+1)/6;case 1:return e*e*e/6;default:throw new Error("unknown error")}}class rr{constructor(t=[],e=!0){this.points=t,this.closed=e}get(t){const e=t,n=this.points.length;return t<0?this.closed?this.get(t+n):this.points[0]:t>=n?this.closed?this.get(t-n):this.points[n-1]:this.points[e]}get length(){return this.points.length}toString(t=1/0){const e=this.points;if(0===e.length)return"";const n="function"==typeof t?t:function(t){if(!Number.isFinite(t))return t=>t;if(0===t)return Math.round;const e=Math.pow(10,t);return t=>Math.round(t*e)/e}(t);let i="M";for(const t of e)i+=`${n(t.x)},${n(t.y)} L`;return i=i.slice(0,-1),this.closed&&(i+=" Z"),i}draw(t){const e=this.points;if(0!==e.length){t.beginPath(),t.moveTo(e[0].x,e[0].y);for(const n of e)t.lineTo(n.x,n.y);this.closed&&t.closePath()}}sample(t){return function(t=8){return e=>{let n=t,i=e.length;if(n>1)for(i=Math.floor(e.length/n);i<3&&n>1;)n-=1,i=Math.floor(e.length/n);const s=[];for(let t=0,o=0;o<i;o++,t+=n)s.push(e.get(t));return new rr(s)}}(t)(this)}simplify(t){return function(t=0){return e=>{if(t<0||e.length<3)return e;const n=[];let i=0;const s=t*t;for(;i<e.length;){let t=i+1;for(;sr(e,i,t,s);)t++;n.push(e.get(i)),i=t}return new rr(n)}}(t)(this)}bSplines(t){return function(t=6){function e(t,e,n){let i=0,s=0;for(let o=-2;o<=1;o++){const r=t.get(e+o),a=or(o,n);i+=a*r.x,s+=a*r.y}return{x:i,y:s}}return n=>{if(n.length<3)return n;const i=[],s=n.closed,o=n.length+3-1+(s?0:2);i.push(e(n,2-(s?0:2),0));for(let r=2-(s?0:2);r<o;r++)for(let s=1;s<=t;s++)i.push(e(n,r,s/t));return new rr(i)}}(t)(this)}apply(t){return t(this)}containsElements(t){const e=function(t){if(0===t.length)return null;const e=t[0],n=new Yo(e.x,e.y,0,0);for(const e of t)n.addPoint(e);return n}(this.points);return!!e&&t.every((t=>e.containsPt(t.cx,t.cy)&&this.withinArea(t.cx,t.cy)))}withinArea(t,e){if(0===this.length)return!1;let n=0;const i=this.points[0],s=new zo(i.x,i.y,i.x,i.y);for(let i=1;i<this.points.length;i++){const o=this.points[i];s.x1=s.x2,s.y1=s.y2,s.x2=o.x,s.y2=o.y,s.cuts(t,e)&&n++}return s.x1=s.x2,s.y1=s.y2,s.x2=i.x,s.y2=i.y,s.cuts(t,e)&&n++,n%2==1}}class ar{constructor(t=0){this.count=0,this.arr=[],this.set=new Set,this.arr.length=t}add(t){this.set.add(`${t.x}x${t.y}`),this.arr[this.count++]=t}contains(t){return this.set.has(`${t.x}x${t.y}`)}isFirst(t){if(0===this.count)return!1;const e=this.arr[0];return null!=e&&e.x===t.x&&e.y===t.y}path(){return new rr(this.arr.slice(0,this.count))}clear(){this.set.clear(),this.count=0}get(t){return this.arr[t]}get length(){return this.count}}function lr(t,e){const n=2*(Math.floor(t.width)+Math.floor(t.height)),i=new ar(n);function s(n,i,s,o){const r=t.get(n,i);return Number.isNaN(r)?Number.NaN:r>e?s+o:s}function o(t,e){let n=0;return n=s(t,e,n,1),n=s(t+1,e,n,2),n=s(t,e+1,n,4),n=s(t+1,e+1,n,8),Number.isNaN(n)?-1:n}let r=1;function a(e,n){let s=e,a=n,l=t.invertScaleX(s),h=t.invertScaleY(a);for(let e=0;e<t.width*t.height;e++){const e={x:l,y:h};if(i.contains(e)){if(i.isFirst(e))return!0}else i.add(e);const n=o(s,a);switch(n){case-1:return!0;case 0:case 3:case 2:case 7:r=2;break;case 12:case 14:case 4:r=3;break;case 6:r=0===r?3:2;break;case 1:case 13:case 5:r=0;break;case 9:r=2===r?0:1;break;case 10:case 8:case 11:r=1;break;default:return console.warn("Marching squares invalid state: "+n),!0}switch(r){case 0:a--,h-=t.pixelGroup;break;case 1:a++,h+=t.pixelGroup;break;case 3:s--,l-=t.pixelGroup;break;case 2:s++,l+=t.pixelGroup;break;default:return console.warn("Marching squares invalid state: "+n),!0}}return!0}for(let n=0;n<t.width;n++)for(let s=0;s<t.height;s++){if(t.get(n,s)<=e)continue;const r=o(n,s);if(!(r<0||15===r)&&a(n,s))return i.path()}return null}const hr={maxRoutingIterations:100,maxMarchingIterations:20,pixelGroup:4,edgeR0:10,edgeR1:20,nodeR0:15,nodeR1:50,morphBuffer:10,threshold:1,memberInfluenceFactor:1,edgeInfluenceFactor:1,nonMemberInfluenceFactor:-.8,virtualEdges:!0};function cr(t){return null!=t&&"number"==typeof t.radius}function dr(t,e){if(cr(t)!==cr(e))return!1;if(cr(t)){const n=e;return t.cx===n.cx&&t.cy===n.cy&&t.radius===n.radius}const n=e;return t.x===n.x&&t.y===n.y&&t.width===n.width&&t.height===n.height}var ur;!function(t){t[t.MEMBERS=0]="MEMBERS",t[t.NON_MEMBERS=1]="NON_MEMBERS",t[t.EDGES=2]="EDGES"}(ur||(ur={}));class pr{constructor(t={}){this.dirty=new Set,this.members=[],this.nonMembers=[],this.virtualEdges=[],this.edges=[],this.activeRegion=new Yo(0,0,0,0),this.potentialArea=new Uo(1,0,0,0,0,0,0),this.o=Object.assign({},hr,t)}pushMember(...t){if(0!==t.length){this.dirty.add(ur.MEMBERS);for(const e of t)this.members.push({raw:e,obj:cr(e)?Go.from(e):Yo.from(e),area:null})}}removeMember(t){const e=this.members.findIndex((e=>dr(e.raw,t)));return!(e<0)&&(this.members.splice(e,1),this.dirty.add(ur.MEMBERS),!0)}removeNonMember(t){const e=this.nonMembers.findIndex((e=>dr(e.raw,t)));return!(e<0)&&(this.nonMembers.splice(e,1),this.dirty.add(ur.NON_MEMBERS),!0)}removeEdge(t){const e=this.edges.findIndex((e=>e.obj.equals(t)));return!(e<0)&&(this.edges.splice(e,1),this.dirty.add(ur.NON_MEMBERS),!0)}pushNonMember(...t){if(0!==t.length){this.dirty.add(ur.NON_MEMBERS);for(const e of t)this.nonMembers.push({raw:e,obj:cr(e)?Go.from(e):Yo.from(e),area:null})}}pushEdge(...t){if(0!==t.length){this.dirty.add(ur.EDGES);for(const e of t)this.edges.push({raw:e,obj:zo.from(e),area:null})}}update(){const t=this.dirty.has(ur.MEMBERS),e=this.dirty.has(ur.NON_MEMBERS);let n=this.dirty.has(ur.EDGES);this.dirty.clear();const i=this.members.map((t=>t.obj));if(this.o.virtualEdges&&(t||e)){const t=Qo(i,this.nonMembers.map((t=>t.obj)),this.o.maxRoutingIterations,this.o.morphBuffer),e=new Map(this.virtualEdges.map((t=>[t.obj.toString(),t.area])));this.virtualEdges=t.map((t=>{var n;return{raw:t,obj:t,area:null!==(n=e.get(t.toString()))&&void 0!==n?n:null}})),n=!0}let s=!1;if(t||n){const t=function(t,e){if(0===t.length)return new Yo(0,0,0,0);const n=Yo.from(t[0]);for(const e of t)n.add(e);for(const t of e)n.add(Bo(t));return n}(i,this.virtualEdges.concat(this.edges).map((t=>t.obj))),e=Math.max(this.o.edgeR1,this.o.nodeR1)+this.o.morphBuffer,n=Yo.from(Ko(t,e));n.equals(this.activeRegion)||(s=!0,this.activeRegion=n)}if(s){const t=Math.ceil(this.activeRegion.width/this.o.pixelGroup),e=Math.ceil(this.activeRegion.height/this.o.pixelGroup);this.activeRegion.x!==this.potentialArea.pixelX||this.activeRegion.y!==this.potentialArea.pixelY?(this.potentialArea=Uo.fromPixelRegion(this.activeRegion,this.o.pixelGroup),this.members.forEach((t=>t.area=null)),this.nonMembers.forEach((t=>t.area=null)),this.edges.forEach((t=>t.area=null)),this.virtualEdges.forEach((t=>t.area=null))):t===this.potentialArea.width&&e===this.potentialArea.height||(this.potentialArea=Uo.fromPixelRegion(this.activeRegion,this.o.pixelGroup))}const o=new Map,r=t=>{if(t.area){const e=`${t.obj.width}x${t.obj.height}x${t.obj instanceof Yo?"R":"C"}`;o.set(e,t.area)}},a=t=>{if(t.area)return;const e=`${t.obj.width}x${t.obj.height}x${t.obj instanceof Yo?"R":"C"}`;if(o.has(e)){const n=o.get(e);return void(t.area=this.potentialArea.copy(n,{x:t.obj.x-this.o.nodeR1,y:t.obj.y-this.o.nodeR1}))}const n=t.obj instanceof Yo?function(t,e,n){const i=e.scale(t),s=e.addPadding(i,n),o=e.createSub(s,{x:t.x-n,y:t.y-n}),r=i.x-s.x,a=i.y-s.y,l=s.x2-i.x2,h=s.y2-i.y2,c=s.width-r-l,d=s.height-a-h,u=n*n;o.fillArea({x:r,y:a,width:c+1,height:d+1},u);const p=[0],g=Math.max(a,r,l,h);{const s=e.invertScaleX(i.x+i.width/2);for(let o=1;o<g;o++){const r=e.invertScaleY(i.y-o),a=t.distSquare(s,r);if(!(a<u))break;{const t=n-Math.sqrt(a);p.push(t*t)}}}const f=[],y=Math.max(r,l),m=Math.max(a,l);for(let s=1;s<y;s++){const o=e.invertScaleX(i.x-s),r=[];for(let s=1;s<m;s++){const a=e.invertScaleY(i.y-s),l=t.distSquare(o,a);if(l<u){const t=n-Math.sqrt(l);r.push(t*t)}else r.push(0)}f.push(r)}for(let t=1;t<Math.min(a,p.length);t++){const e=p[t];o.fillHorizontalLine(r,a-t,c+1,e)}for(let t=1;t<Math.min(h,p.length);t++){const e=p[t];o.fillHorizontalLine(r,a+d+t,c+1,e)}for(let t=1;t<Math.min(r,p.length);t++){const e=p[t];o.fillVerticalLine(r-t,a,d+1,e)}for(let t=1;t<Math.min(h,p.length);t++){const e=p[t];o.fillVerticalLine(r+c+t,a,d+1,e)}for(let t=1;t<r;t++){const e=f[t-1],n=r-t;for(let t=1;t<a;t++)o.set(n,a-t,e[t-1]);for(let t=1;t<h;t++)o.set(n,a+d+t,e[t-1])}for(let t=1;t<l;t++){const e=f[t-1],n=r+c+t;for(let t=1;t<a;t++)o.set(n,a-t,e[t-1]);for(let t=1;t<h;t++)o.set(n,a+d+t,e[t-1])}return o}(t.obj,this.potentialArea,this.o.nodeR1):qo(t.obj,this.potentialArea,this.o.nodeR1);t.area=n,o.set(e,n)};this.members.forEach(r),this.nonMembers.forEach(r),this.members.forEach(a),this.nonMembers.forEach((t=>{this.activeRegion.intersects(t.obj)?a(t):t.area=null})),this.edges.forEach((t=>{t.area||(t.area=Xo(t.obj,this.potentialArea,this.o.edgeR1))})),this.virtualEdges.forEach((t=>{t.area||(t.area=Xo(t.obj,this.potentialArea,this.o.edgeR1))}))}drawMembers(t){for(const e of this.members)e.obj.draw(t)}drawNonMembers(t){for(const e of this.nonMembers)e.obj.draw(t)}drawEdges(t){for(const e of this.edges)e.obj.draw(t)}drawPotentialArea(t,e=!0){this.potentialArea.draw(t,e)}compute(){if(0===this.members.length)return new rr([]);this.dirty.size>0&&this.update();const{o:t,potentialArea:e}=this,n=this.members.map((t=>t.area)),i=this.virtualEdges.concat(this.edges).map((t=>t.area)),s=this.nonMembers.filter((t=>null!=t.area)).map((t=>t.area)),o=this.members.map((t=>t.obj));return function(t,e,n,i,s,o={}){const r=Object.assign({},hr,o);let a=r.threshold,l=r.memberInfluenceFactor,h=r.edgeInfluenceFactor,c=r.nonMemberInfluenceFactor;const d=(r.nodeR0-r.nodeR1)*(r.nodeR0-r.nodeR1),u=(r.edgeR0-r.edgeR1)*(r.edgeR0-r.edgeR1);for(let o=0;o<r.maxMarchingIterations;o++){if(t.clear(),0!==l){const n=l/d;for(const i of e)t.incArea(i,n)}if(0!==h){const e=h/u;for(const i of n)t.incArea(i,e)}if(0!==c){const e=c/d;for(const n of i)t.incArea(n,e)}const p=lr(t,a);if(p&&s(p))return p;if(a*=.95,o<=.5*r.maxMarchingIterations)l*=1.2,h*=1.2;else{if(!(0!==c&&i.length>0))break;c*=.8}}return new rr([])}(e,n,i,s,(t=>t.containsElements(o)),t)}}var gr=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(n[i[s]]=t[i[s]])}return n};class fr extends Mo{constructor(t,e){super(t,(0,le.Z)({},fr.defaultOptions,e)),this.members=new Map,this.avoidMembers=new Map,this.bubbleSetOptions={},this.drawBubbleSets=()=>{const{style:t,bubbleSetOptions:e}=this.parseOptions();(0,a.Z)(this.bubbleSetOptions,e)||this.init(),this.bubbleSetOptions=Object.assign({},e);const n=Object.assign(Object.assign({},t),{d:this.getPath()});this.shape?this.shape.update(n):(this.shape=new Zn({style:n}),this.context.canvas.appendChild(this.shape))},this.updateBubbleSetsPath=t=>{if(!this.shape)return;const e=Ht(t.data);[...this.options.members,...this.options.avoidMembers].includes(e)&&this.shape.update(Object.assign(Object.assign({},this.parseOptions().style),{d:this.getPath(e)}))},this.getPath=t=>{const{graph:e}=this.context,n=this.options.members,i=[...this.members.keys()],s=this.options.avoidMembers,o=[...this.avoidMembers.keys()];if(!t&&(0,a.Z)(n,i)&&(0,a.Z)(s,o))return this.path;const{enter:r=[],exit:l=[]}=ne(i,n,(t=>t)),{enter:h=[],exit:c=[]}=ne(o,s,(t=>t));t&&(l.push(t),r.push(t));const d=(t,n,i)=>{t.forEach((t=>{const s=i?this.members:this.avoidMembers,o=i?"pushMember":"pushNonMember",r=i?"removeMember":"removeNonMember";if(n){let n;"edge"===e.getElementType(t)?([n]=mr(e,t),this.bubbleSets.pushEdge(n)):([n]=yr(e,t),this.bubbleSets[o](n)),s.set(t,n)}else{const n=s.get(t);n&&("edge"===e.getElementType(t)?this.bubbleSets.removeEdge(n):this.bubbleSets[r](n),s.delete(t))}}))};d(l,!1,!0),d(r,!0,!0),d(c,!1,!1),d(h,!0,!1);const u=this.bubbleSets.compute().sample(8).simplify(0).bSplines().simplify(0);return this.path=zn(u.points.map(Re)),this.path},this.bindEvents(),this.bubbleSets=new pr(this.options)}bindEvents(){this.context.graph.on(v.AFTER_RENDER,this.drawBubbleSets),this.context.graph.on(v.AFTER_ELEMENT_UPDATE,this.updateBubbleSetsPath)}init(){this.bubbleSets=new pr(this.options),this.members=new Map,this.avoidMembers=new Map}parseOptions(){const t=this.options,{type:e,key:n,members:i,avoidMembers:s}=t,o=gr(t,["type","key","members","avoidMembers"]),r=Object.keys(o).reduce(((t,e)=>(e in hr?t.bubbleSetOptions[e]=o[e]:t.style[e]=o[e],t)),{style:{},bubbleSetOptions:{}});return Object.assign({type:e,key:n,members:i,avoidMembers:s},r)}addMember(t){const e=Array.isArray(t)?t:[t];e.some((t=>this.options.avoidMembers.includes(t)))&&(this.options.avoidMembers=this.options.avoidMembers.filter((t=>!e.includes(t)))),this.options.members=[...new Set([...this.options.members,...e])],this.drawBubbleSets()}removeMember(t){const e=Array.isArray(t)?t:[t];this.options.members=this.options.members.filter((t=>!e.includes(t))),this.drawBubbleSets()}updateMember(t){this.options.members=(0,W.Z)(t)?t(this.options.members):t,this.drawBubbleSets()}getMember(){return this.options.members}addAvoidMember(t){const e=Array.isArray(t)?t:[t];e.some((t=>this.options.members.includes(t)))&&(this.options.members=this.options.members.filter((t=>!e.includes(t)))),this.options.avoidMembers=[...new Set([...this.options.avoidMembers,...e])],this.drawBubbleSets()}removeAvoidMember(t){const e=Array.isArray(t)?t:[t];this.options.avoidMembers.some((t=>e.includes(t)))&&(this.options.avoidMembers=this.options.avoidMembers.filter((t=>!e.includes(t))),this.drawBubbleSets())}updateAvoidMember(t){this.options.avoidMembers=Array.isArray(t)?t:[t],this.drawBubbleSets()}getAvoidMember(){return this.options.avoidMembers}destroy(){this.context.graph.off(v.AFTER_RENDER,this.drawBubbleSets),this.context.graph.off(v.AFTER_ELEMENT_UPDATE,this.updateBubbleSetsPath),this.shape.destroy(),super.destroy()}}fr.defaultOptions=Object.assign({members:[],avoidMembers:[],fill:"lightblue",fillOpacity:.2,stroke:"blue",strokeOpacity:.2},hr);const yr=(t,e)=>(Array.isArray(e)?e:[e]).map((e=>{const n=t.getElementRenderBounds(e);return new Yo(n.min[0],n.min[1],tt(n),et(n))})),mr=(t,e)=>(Array.isArray(e)?e:[e]).map((e=>{const n=t.getEdgeData(e),i=t.getElementPosition(n.source),s=t.getElementPosition(n.target);return zo.from({x1:i[0],y1:i[1],x2:s[0],y2:s[1]})}));var vr=function(t,e,n,i){return new(n||(n=Promise))((function(s,o){function r(t){try{l(i.next(t))}catch(t){o(t)}}function a(t){try{l(i.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,a)}l((i=i.apply(t,e||[])).next())}))};class br extends Mo{constructor(t,e){super(t,Object.assign({},br.defaultOptions,e)),this.targetElement=null,this.onTriggerEvent=t=>{var e;null===(e=t.preventDefault)||void 0===e||e.call(t),this.show(t)},this.onMenuItemClick=t=>{const{onClick:e,trigger:n}=this.options;if(t.target instanceof HTMLElement&&t.target.className.includes("g6-contextmenu-li")){const n=t.target.getAttribute("value");null==e||e(n,t.target,this.targetElement),this.hide()}"click"!==n&&this.hide()},this.initElement(),this.update(e)}initElement(){this.$element=To("contextmenu",!1,{zIndex:"99"});const{className:t}=this.options;t&&this.$element.classList.add(t);this.context.canvas.getContainer().appendChild(this.$element),Po("g6-contextmenu-css","style",{},"\n  .g6-contextmenu {\n    font-size: 12px;\n    background-color: rgba(255, 255, 255, 0.96);\n    border-radius: 4px;\n    overflow: hidden;\n    box-shadow: rgba(0, 0, 0, 0.12) 0px 6px 12px 0px;\n    transition: visibility 0.2s cubic-bezier(0.23, 1, 0.32, 1) 0s, left 0.4s cubic-bezier(0.23, 1, 0.32, 1) 0s, top 0.4s cubic-bezier(0.23, 1, 0.32, 1) 0s;\n  }\n\n  .g6-contextmenu-ul {\n    max-width: 256px;\n    min-width: 96px;\n    list-style: none;\n    padding: 0;\n    margin: 0;\n  }\n\n  .g6-contextmenu-li {\n    padding: 8px 12px;\n    cursor: pointer;\n    user-select: none;\n  }\n\n  .g6-contextmenu-li:hover {\n    background-color: #f5f5f5;\n    cursor: pointer;\n  }\n",document.head)}show(t){return vr(this,void 0,void 0,(function*(){const{enable:e,offset:n}=this.options;if("function"==typeof e&&!e(t)||!e)return void this.hide();const i=yield this.getDOMContent(t);i instanceof HTMLElement?(this.$element.innerHTML="",this.$element.appendChild(i)):this.$element.innerHTML=i;const s=this.context.graph.getCanvas().getContainer().getBoundingClientRect();this.$element.style.left=`${t.client.x-s.left+n[0]}px`,this.$element.style.top=`${t.client.y-s.top+n[1]}px`,this.$element.style.display="block",this.targetElement=t.target}))}hide(){this.$element.style.display="none",this.targetElement=null}update(t){this.unbindEvents(),super.update(t),this.bindEvents()}destroy(){this.unbindEvents(),super.destroy(),this.$element.remove()}getDOMContent(t){return vr(this,void 0,void 0,(function*(){const{getContent:e,getItems:n}=this.options;return n?`\n    <ul class="g6-contextmenu-ul">\n      ${(yield n(t)).map((t=>`<li  class="g6-contextmenu-li" value="${t.value}">${t.name}</li>`)).join("")}\n    </ul>\n  `:yield e(t)}))}bindEvents(){const{graph:t}=this.context,{trigger:e}=this.options;t.on(`canvas:${e}`,this.onTriggerEvent),t.on(`node:${e}`,this.onTriggerEvent),t.on(`edge:${e}`,this.onTriggerEvent),t.on(`combo:${e}`,this.onTriggerEvent),document.addEventListener("click",this.onMenuItemClick)}unbindEvents(){const{graph:t}=this.context,{trigger:e}=this.options;t.off(`canvas:${e}`,this.onTriggerEvent),t.off(`node:${e}`,this.onTriggerEvent),t.off(`edge:${e}`,this.onTriggerEvent),t.off(`combo:${e}`,this.onTriggerEvent),document.removeEventListener("click",this.onMenuItemClick)}}br.defaultOptions={trigger:"contextmenu",offset:[4,4],loadingContent:'<div class="g6-contextmenu-loading">Loading...</div>',getContent:()=>"It is a empty context menu.",enable:()=>!0};class Er extends Mo{constructor(t,e){super(t,Object.assign({},Er.defaultOptions,e)),this.edgeBundles={},this.edgePoints={},this.onBundle=()=>{const{model:t,element:e}=this.context,n=t.getEdgeData();this.divideEdges(this.options.divisions);const{cycles:i,iterRate:s,divRate:o}=this.options;let{lambda:r,divisions:a,iterations:l}=this.options;for(let t=0;t<i;t++){for(let t=0;t<l;t++){const t={};n.forEach((e=>{var n;if(e.source===e.target)return;const i=Ht(e);t[i]=this.getEdgeForces(e,a,r);for(let e=0;e<a+1;e++)(n=this.edgePoints)[i]||(n[i]=[]),this.edgePoints[i][e]=ce(this.edgePoints[i][e],t[i][e])}))}r/=2,a*=o,l*=s,this.divideEdges(a)}n.forEach((t=>{const n=Ht(t),i=e.getElement(n);null==i||i.update({d:ki(this.edgePoints[n])})}))},this.bindEvents()}get nodeMap(){const t=this.context.model.getNodeData();return Object.fromEntries(t.map((t=>[Ht(t),xe(Me(t))])))}divideEdges(t){this.context.model.getEdgeData().forEach((e=>{var n;const i=Ht(e);(n=this.edgePoints)[i]||(n[i]=[]);const s=this.nodeMap[e.source],o=this.nodeMap[e.target];if(1===t)this.edgePoints[i].push(s),this.edgePoints[i].push(pe(ce(s,o),2)),this.edgePoints[i].push(o);else{const e=(0===this.edgePoints[i].length?fe(s,o):Mr(this.edgePoints[i]))/(t+1);let n=e;const r=[s];for(let t=1;t<this.edgePoints[i].length;t++){const s=this.edgePoints[i][t-1],o=this.edgePoints[i][t];let a=fe(o,s);for(;a>n;){const t=n/a,i=ce(s,ue(de(o,s),t));r.push(i),a-=n,n=e}n-=a}r.push(o),this.edgePoints[i]=r}}))}getVectorPosition(t){const e=this.nodeMap[t.source],n=this.nodeMap[t.target],[i,s]=de(n,e);return{source:e,target:n,vx:i,vy:s,length:fe(e,n)}}measureEdgeCompatibility(t,e){const n=this.getVectorPosition(t),i=this.getVectorPosition(e);return xr(n,i)*wr(n,i)*Or(n,i)*Cr(n,i)}getEdgeBundles(){const t={},e=this.options.bundleThreshold,n=this.context.model.getEdgeData();return n.forEach(((i,s)=>{n.forEach(((n,o)=>{var r,a;if(o<=s)return;this.measureEdgeCompatibility(i,n)>=e&&(t[r=Ht(i)]||(t[r]=[]),t[Ht(i)].push(n),t[a=Ht(n)]||(t[a]=[]),t[Ht(n)].push(i))}))})),t}getSpringForce(t,e){const{pre:n,cur:i,next:s}=t;return ue(de(ce(n,s),ue(i,2)),e)}getElectrostaticForce(t,e){Pn(this.edgeBundles)&&(this.edgeBundles=this.getEdgeBundles());const n=this.edgeBundles[Ht(e)];let i=[0,0];return null==n||n.forEach((n=>{const s=this.edgePoints[Ht(n)][t],o=this.edgePoints[Ht(e)][t],r=de(s,o),a=fe(s,o);i=ce(i,ue(r,1/a))})),i}getEdgeForces(t,e,n){const i=this.nodeMap[t.source],s=this.nodeMap[t.target],o=this.options.K/(fe(i,s)*(e+1)),r=[[0,0]],a=Ht(t);for(let i=1;i<e;i++){const e=this.getSpringForce({pre:this.edgePoints[a][i-1],cur:this.edgePoints[a][i],next:this.edgePoints[a][i+1]||[0,0]},o),s=this.getElectrostaticForce(i,t);r.push(ue(ce(e,s),n))}return r.push([0,0]),r}bindEvents(){const{graph:t}=this.context;t.on(v.AFTER_RENDER,this.onBundle)}unbindEvents(){const{graph:t}=this.context;t.off(v.AFTER_RENDER,this.onBundle)}destroy(){this.unbindEvents(),super.destroy()}}Er.defaultOptions={K:.1,lambda:.1,divisions:1,divRate:2,cycles:6,iterations:90,iterRate:2/3,bundleThreshold:.6};const xr=(t,e)=>{return Math.abs((n=[t.vx,t.vy],i=[e.vx,e.vy],n.reduce(((t,e,n)=>t+e*i[n]),0)/(t.length*e.length)));var n,i},wr=(t,e)=>{const n=(t.length+e.length)/2;return 2/(n/Math.min(t.length,e.length)+Math.max(t.length,e.length)/n)},Or=(t,e)=>{const n=(t.length+e.length)/2;return n/(n+fe(pe(ce(t.source,t.target),2),pe(ce(e.source,e.target),2)))},Sr=(t,e)=>{if(e.source[0]===e.target[0])return[e.source[0],t[1]];if(e.source[1]===e.target[1])return[t[0],e.source[1]];const n=(e.source[1]-e.target[1])/(e.source[0]-e.target[0]),i=(n*n*e.source[0]+n*(t[1]-e.source[1])+t[0])/(n*n+1);return[i,n*(i-e.source[0])+e.source[1]]},Dr=(t,e)=>{const n=Sr(e.source,t),i=Sr(e.target,t),s=pe(ce(n,i),2),o=pe(ce(t.source,t.target),2);return 0===fe(n,i)?0:Math.max(0,1-2*fe(o,s)/fe(n,i))},Cr=(t,e)=>Math.min(Dr(t,e),Dr(e,t)),Mr=t=>{let e=0;for(let n=1;n<t.length;n++)e+=fe(t[n],t[n-1]);return e},Tr={fill:"#fff",fillOpacity:1,lineWidth:1,stroke:"#000",strokeOpacity:.8,zIndex:-1/0};class Pr extends Mo{constructor(t,e){super(t,Object.assign({},Pr.defaultOptions,e)),this.shapes=new Map,this.r=this.options.r,this.onEdgeFilter=t=>{if("drag"===this.options.trigger&&this.isLensOn)return;const e=Re(t.canvas);this.renderLens(e),this.renderFocusElements()},this.renderLens=t=>{const e=Object.assign({},Tr,this.options.style);this.isLensOn||(this.lens=new qn({style:e}),this.canvas.appendChild(this.lens)),Object.assign(e,Le(t),{size:2*this.r}),this.lens.update(e)},this.getFilterData=()=>{const{filter:t}=this.options,{model:e}=this.context,n=e.getData();if(!t)return n;const{nodes:i,edges:s,combos:o}=n;return{nodes:i.filter((e=>t(Ht(e),"node"))),edges:s.filter((e=>t(Ht(e),"edge"))),combos:o.filter((e=>t(Ht(e),"combo")))}},this.getFocusElements=t=>{const{nodes:e,edges:n}=this.getFilterData(),i=e.filter((e=>fe(Me(e),t)<this.r)),s=i.map((t=>Ht(t)));return{nodes:i,edges:n.filter((t=>{const{source:e,target:n}=t,i=s.includes(e),o=s.includes(n);switch(this.options.nodeType){case"both":return i&&o;case"either":return i!==o;case"source":return i&&!o;case"target":return!i&&o;default:return!1}}))}},this.renderFocusElements=()=>{const{element:t,graph:e}=this.context;if(!this.isLensOn)return;const n=this.lens.getCenter(),{nodes:i,edges:s}=this.getFocusElements(n),o=new Set,r=n=>{const i=Ht(n);o.add(i);const s=t.getElement(i);if(!s)return;const r=this.shapes.get(i)||s.cloneNode();r.setPosition(s.getPosition()),r.id=s.id,this.shapes.has(i)?Object.entries(s.attributes).forEach((([t,e])=>{r.style[t]!==e&&(r.style[t]=e)})):(this.canvas.appendChild(r),this.shapes.set(i,r));const a=e.getElementType(i),l=this.getElementStyle(a,n);r.update(l)};i.forEach(r),s.forEach(r),this.shapes.forEach(((t,e)=>{o.has(e)||(t.destroy(),this.shapes.delete(e))}))},this.scaleRByWheel=t=>{var e;this.options.preventDefault&&t.preventDefault();const{clientX:n,clientY:i,deltaX:s,deltaY:o}=t,{graph:r,canvas:a}=this.context,l=r.getCanvasByClient([n,i]),h=null===(e=this.lens)||void 0===e?void 0:e.getCenter();if(!this.isLensOn||fe(l,h)>this.r)return;const{maxR:c,minR:d}=this.options,u=s+o>0?1/.95:.95,p=Math.min(...a.getSize())/2;this.r=Math.max(d||0,Math.min(c||p,this.r*u)),this.renderLens(h),this.renderFocusElements()},this.isLensDragging=!1,this.onDragStart=t=>{var e;const n=Re(t.canvas),i=null===(e=this.lens)||void 0===e?void 0:e.getCenter();!this.isLensOn||fe(n,i)>this.r||(this.isLensDragging=!0)},this.onDrag=t=>{if(!this.isLensDragging)return;const e=Re(t.canvas);this.renderLens(e),this.renderFocusElements()},this.onDragEnd=()=>{this.isLensDragging=!1},this.bindEvents()}get canvas(){return this.context.canvas.getLayer("transient")}get isLensOn(){return this.lens&&!this.lens.destroyed}getElementStyle(t,e){const n="node"===t?this.options.nodeStyle:this.options.edgeStyle;return"function"==typeof n?n(e):n}get graphDom(){return this.context.graph.getCanvas().getContextService().getDomElement()}bindEvents(){var t;const{graph:e}=this.context,{trigger:n,scaleRBy:i}=this.options,s=e.getCanvas().getLayer();["click","drag"].includes(n)&&s.addEventListener(f.CLICK,this.onEdgeFilter),"pointermove"===n?s.addEventListener(f.POINTER_MOVE,this.onEdgeFilter):"drag"===n&&(s.addEventListener(f.DRAG_START,this.onDragStart),s.addEventListener(f.DRAG,this.onDrag),s.addEventListener(f.DRAG_END,this.onDragEnd)),"wheel"===i&&(null===(t=this.graphDom)||void 0===t||t.addEventListener(f.WHEEL,this.scaleRByWheel,{passive:!1}))}unbindEvents(){var t;const{graph:e}=this.context,{trigger:n,scaleRBy:i}=this.options,s=e.getCanvas().getLayer();["click","drag"].includes(n)&&s.removeEventListener(f.CLICK,this.onEdgeFilter),"pointermove"===n?s.removeEventListener(f.POINTER_MOVE,this.onEdgeFilter):"drag"===n&&(s.removeEventListener(f.DRAG_START,this.onDragStart),s.removeEventListener(f.DRAG,this.onDrag),s.removeEventListener(f.DRAG_END,this.onDragEnd)),"wheel"===i&&(null===(t=this.graphDom)||void 0===t||t.removeEventListener(f.WHEEL,this.scaleRByWheel))}update(t){var e;this.unbindEvents(),super.update(t),this.r=null!==(e=t.r)&&void 0!==e?e:this.r,this.bindEvents()}destroy(){this.unbindEvents(),this.isLensOn&&this.lens.destroy(),this.shapes.forEach(((t,e)=>{t.destroy(),this.shapes.delete(e)})),super.destroy()}}Pr.defaultOptions={trigger:"pointermove",r:60,nodeType:"both",filter:()=>!0,style:{lineWidth:2},nodeStyle:{label:!1},edgeStyle:{label:!0},scaleRBy:"wheel",preventDefault:!0};const Ar={fill:"#ccc",fillOpacity:.1,lineWidth:2,stroke:"#000",strokeOpacity:.8,labelFontSize:12};class Rr extends Mo{constructor(t,e){super(t,Object.assign({},Rr.defaultOptions,e)),this.r=this.options.r,this.d=this.options.d,this.onCreateFisheye=t=>{if("drag"===this.options.trigger&&this.isLensOn)return;const e=Re(t.canvas);this.onMagnify(e)},this.onMagnify=t=>{t.some(isNaN)||(this.renderLens(t),this.renderFocusElements())},this.renderLens=t=>{const e=Object.assign({},Ar,this.options.style);this.isLensOn||(this.lens=new qn({style:e}),this.canvas.appendChild(this.lens)),Object.assign(e,Le(t),{size:2*this.r,label:this.options.showDPercent,labelText:this.getDPercent()}),this.lens.update(e)},this.getDPercent=()=>{const{minD:t,maxD:e}=this.options;return`${Math.round((this.d-t)/(e-t)*100)}%`},this.prevMagnifiedStyleMap=new Map,this.prevOriginStyleMap=new Map,this.renderFocusElements=()=>{if(!this.isLensOn)return;const{graph:t}=this.context,e=this.lens.getCenter(),n=(this.d+1)*this.r,i=new Map,s=new Map;t.getNodeData().forEach((o=>{const r=Me(o),a=fe(r,e);if(a>this.r)return;const l=n*a/(this.d*a+this.r),[h,c]=r,[d,u]=e,p=[d+l*((h-d)/a),u+l*((c-u)/a)],g=Ht(o),f=this.getNodeStyle(o),y=(0,oi.Z)(t.getElementRenderStyle(g),Object.keys(f));i.set(g,Object.assign(Object.assign({},Le(p)),f)),s.set(g,Object.assign(Object.assign({},Le(r)),y))})),this.updateStyle(i,s)},this.getNodeStyle=t=>{const{nodeStyle:e}=this.options;return"function"==typeof e?e(t):e},this.updateStyle=(t,e)=>{const{graph:n,element:i}=this.context,{enter:s,exit:o,keep:r}=ne(Array.from(this.prevMagnifiedStyleMap.keys()),Array.from(t.keys()),(t=>t)),a=new Set,l=(t,e)=>{const s=i.getElement(t);null==s||s.update(e),n.getRelatedEdgesData(t).forEach((t=>{a.add(Ht(t))}))};[...s,...r].forEach((e=>{l(e,t.get(e))})),o.forEach((t=>{l(t,this.prevOriginStyleMap.get(t)),this.prevOriginStyleMap.delete(t)})),a.forEach((t=>{const e=i.getElement(t);null==e||e.update({})})),this.prevMagnifiedStyleMap=t,e.forEach(((t,e)=>{this.prevOriginStyleMap.has(e)||this.prevOriginStyleMap.set(e,t)}))},this.isWheelValid=t=>{if(this.options.preventDefault&&t.preventDefault(),!this.isLensOn)return!1;const{clientX:e,clientY:n}=t;return!(fe(this.context.graph.getCanvasByClient([e,n]),this.lens.getCenter())>this.r)},this.scaleR=t=>{const{maxR:e,minR:n}=this.options,i=t?1/.95:.95,s=Math.min(...this.context.canvas.getSize())/2;this.r=Math.max(n||0,Math.min(e||s,this.r*i))},this.scaleD=t=>{const{maxD:e,minD:n}=this.options,i=t?this.d+.1:this.d-.1;this.d=Math.max(n,Math.min(e,i))},this.scaleRByWheel=t=>{if(!this.isWheelValid(t))return;const{deltaX:e,deltaY:n}=t;this.scaleR(e+n>0);const i=this.lens.getCenter();this.onMagnify(i)},this.scaleDByWheel=t=>{if(!this.isWheelValid(t))return;const{deltaX:e,deltaY:n}=t;this.scaleD(e+n>0);const i=this.lens.getCenter();this.onMagnify(i)},this.isDragValid=t=>{if(this.options.preventDefault&&t.preventDefault(),!this.isLensOn)return!1;return!(fe(Re(t.canvas),this.lens.getCenter())>this.r)},this.isLensDragging=!1,this.onDragStart=t=>{this.isDragValid(t)&&(this.isLensDragging=!0)},this.onDrag=t=>{if(!this.isLensDragging)return;const e=Re(t.canvas);this.onMagnify(e)},this.onDragEnd=()=>{this.isLensDragging=!1},this.scaleRByDrag=t=>{if(!this.isLensDragging)return;const{dx:e,dy:n}=t;this.scaleR(e-n>0);const i=this.lens.getCenter();this.onMagnify(i)},this.scaleDByDrag=t=>{if(!this.isLensDragging)return;const{dx:e,dy:n}=t;this.scaleD(e-n>0);const i=this.lens.getCenter();this.onMagnify(i)},this.bindEvents()}get canvas(){return this.context.canvas.getLayer("transient")}get isLensOn(){return this.lens&&!this.lens.destroyed}get graphDom(){return this.context.graph.getCanvas().getContextService().getDomElement()}bindEvents(){var t;const{graph:e}=this.context,{trigger:n,scaleRBy:i,scaleDBy:s}=this.options,o=e.getCanvas().getLayer();if(["click","drag"].includes(n)&&o.addEventListener(f.CLICK,this.onCreateFisheye),"pointermove"===n&&o.addEventListener(f.POINTER_MOVE,this.onCreateFisheye),"drag"===n||"drag"===i||"drag"===s){o.addEventListener(f.DRAG_START,this.onDragStart),o.addEventListener(f.DRAG_END,this.onDragEnd);const t="drag"===n?this.onDrag:"drag"===i?this.scaleRByDrag:this.scaleDByDrag;o.addEventListener(f.DRAG,t)}if("wheel"===i||"wheel"===s){const e="wheel"===i?this.scaleRByWheel:this.scaleDByWheel;null===(t=this.graphDom)||void 0===t||t.addEventListener(f.WHEEL,e,{passive:!1})}}unbindEvents(){var t;const{graph:e}=this.context,{trigger:n,scaleRBy:i,scaleDBy:s}=this.options,o=e.getCanvas().getLayer();if(["click","drag"].includes(n)&&o.removeEventListener(f.CLICK,this.onCreateFisheye),"pointermove"===n&&o.removeEventListener(f.POINTER_MOVE,this.onCreateFisheye),"drag"===n||"drag"===i||"drag"===s){o.removeEventListener(f.DRAG_START,this.onDragStart),o.removeEventListener(f.DRAG_END,this.onDragEnd);const t="drag"===n?this.onDrag:"drag"===i?this.scaleRByDrag:this.scaleDByDrag;o.removeEventListener(f.DRAG,t)}if("wheel"===i||"wheel"===s){const e="wheel"===i?this.scaleRByWheel:this.scaleDByWheel;null===(t=this.graphDom)||void 0===t||t.removeEventListener(f.WHEEL,e)}}update(t){var e,n;this.unbindEvents(),super.update(t),this.r=null!==(e=t.r)&&void 0!==e?e:this.r,this.d=null!==(n=t.d)&&void 0!==n?n:this.d,this.bindEvents()}destroy(){var t;this.unbindEvents(),this.isLensOn&&(null===(t=this.lens)||void 0===t||t.destroy()),this.prevMagnifiedStyleMap.clear(),this.prevOriginStyleMap.clear(),super.destroy()}}Rr.defaultOptions={trigger:"pointermove",r:120,d:1.5,maxD:5,minD:0,showDPercent:!0,style:{},nodeStyle:{label:!0},preventDefault:!0};class Lr extends Mo{constructor(t,e){super(t,Object.assign({},Lr.defaultOptions,e)),this.$el=this.context.canvas.getContainer(),this.graphSize=[0,0],this.onFullscreenChange=()=>{var t,e,n,i;const s=!!document.fullscreenElement;this.options.autoFit&&this.setGraphSize(s),s?null===(e=(t=this.options).onEnter)||void 0===e||e.call(t):null===(i=(n=this.options).onExit)||void 0===i||i.call(n)},this.shortcut=new Ge(t.graph),this.bindEvents(),this.style=document.createElement("style"),document.head.appendChild(this.style),this.style.innerHTML="\n      :not(:root):fullscreen::backdrop {\n        background: transparent;\n      }\n    "}bindEvents(){this.unbindEvents(),this.shortcut.unbindAll();const{request:t=[],exit:e=[]}=this.options.trigger;this.shortcut.bind(t,this.request),this.shortcut.bind(e,this.exit);["webkitfullscreenchange","mozfullscreenchange","fullscreenchange","MSFullscreenChange"].forEach((t=>{document.addEventListener(t,this.onFullscreenChange,!1)}))}unbindEvents(){this.shortcut.unbindAll();["webkitfullscreenchange","mozfullscreenchange","fullscreenchange","MSFullscreenChange"].forEach((t=>{document.removeEventListener(t,this.onFullscreenChange,!1)}))}setGraphSize(t=!0){var e,n;let i,s;t?(i=(null===(e=globalThis.screen)||void 0===e?void 0:e.width)||0,s=(null===(n=globalThis.screen)||void 0===n?void 0:n.height)||0,this.graphSize=this.context.graph.getSize()):[i,s]=this.graphSize,this.context.graph.setSize(i,s),this.context.graph.render()}request(){!document.fullscreenElement&&(document.fullscreenEnabled||Reflect.get(document,"webkitFullscreenEnabled")||Reflect.get(document,"mozFullscreenEnabled")||Reflect.get(document,"msFullscreenEnabled"))&&this.$el.requestFullscreen().catch((t=>{M.warn(`Error attempting to enable full-screen: ${t.message} (${t.name})`)}))}exit(){document.fullscreenElement&&document.exitFullscreen()}update(t){this.unbindEvents(),super.update(t),this.bindEvents()}destroy(){this.exit(),this.style.remove(),super.destroy()}}Lr.defaultOptions={trigger:{},autoFit:!0};var kr=n(90134);class Nr extends Mo{constructor(t,e){super(t,Object.assign({},Nr.defaultOptions,e)),this.$element=To("grid-line",!0),this.offset=[0,0],this.currentScale=1,this.followZoom=t=>{const{data:{scale:e,origin:n}}=t;if(!e)return;const i=this.currentScale;this.currentScale=e;const s=e/i,o=ue(n||this.context.graph.getCanvasCenter(),1-s),r=this.baseSize*e,a=ce(Ee(ue(this.offset,s),r),o);this.$element.style.backgroundSize=`${r}px ${r}px`,this.$element.style.backgroundPosition=`${a[0]}px ${a[1]}px`,this.offset=Ee(a,r)},this.followTranslate=t=>{if(!this.options.follow)return;const{data:{translate:e}}=t;e&&this.updateOffset(e)},this.onTransform=t=>{const e=this.parseFollow(this.options.follow);e.zoom&&this.followZoom(t),e.translate&&this.followTranslate(t)};this.context.canvas.getContainer().prepend(this.$element),this.baseSize=this.options.size,this.updateStyle(),this.bindEvents()}update(t){super.update(t),void 0!==t.size&&(this.baseSize=t.size),this.updateStyle()}bindEvents(){const{graph:t}=this.context;t.on(v.AFTER_TRANSFORM,this.onTransform)}updateStyle(){const{stroke:t,lineWidth:e,border:n,borderLineWidth:i,borderStroke:s,borderStyle:o}=this.options,r=this.baseSize*this.currentScale;Object.assign(this.$element.style,{border:n?`${i}px ${o} ${s}`:"none",backgroundImage:`linear-gradient(${t} ${e}px, transparent ${e}px), linear-gradient(90deg, ${t} ${e}px, transparent ${e}px)`,backgroundSize:`${r}px ${r}px`,backgroundRepeat:"repeat"})}updateOffset(t){const e=this.baseSize*this.currentScale;this.offset=Ee(ce(this.offset,t),e),this.$element.style.backgroundPosition=`${this.offset[0]}px ${this.offset[1]}px`}parseFollow(t){var e,n;return(0,kr.Z)(t)?{translate:t,zoom:t}:{translate:null!==(e=null==t?void 0:t.translate)&&void 0!==e&&e,zoom:null!==(n=null==t?void 0:t.zoom)&&void 0!==n&&n}}destroy(){this.context.graph.off(v.AFTER_TRANSFORM,this.onTransform),this.$element.remove(),super.destroy()}}Nr.defaultOptions={border:!0,borderLineWidth:1,borderStroke:"#eee",borderStyle:"solid",lineWidth:1,size:20,stroke:"#eee"};var Ir=n(90494);function jr(t){const e={Added:new Map,Updated:new Map,Removed:new Map};return t.forEach((t=>{const{type:n,value:i}=t,s=Ht(i);if("NodeAdded"===n||"EdgeAdded"===n||"ComboAdded"===n)e.Added.set(s,t);else if("NodeUpdated"===n||"EdgeUpdated"===n||"ComboUpdated"===n)if(e.Added.has(s))e.Added.set(s,{type:n.replace("Updated","Added"),value:i});else if(e.Updated.has(s)){const{original:t}=e.Updated.get(s);e.Updated.set(s,{type:n,value:i,original:t})}else e.Removed.has(s)||e.Updated.set(s,t);else"NodeRemoved"!==n&&"EdgeRemoved"!==n&&"ComboRemoved"!==n||(e.Added.has(s)?e.Added.delete(s):e.Updated.has(s)?(e.Updated.delete(s),e.Removed.set(s,t)):e.Removed.set(s,t))})),[...Array.from(e.Added.values()),...Array.from(e.Updated.values()),...Array.from(e.Removed.values())]}function Br(t){const{NodeAdded:e=[],NodeUpdated:n=[],NodeRemoved:i=[],EdgeAdded:s=[],EdgeUpdated:o=[],EdgeRemoved:r=[],ComboAdded:a=[],ComboUpdated:l=[],ComboRemoved:h=[]}=G(t,(t=>t.type));return{add:{nodes:e,edges:s,combos:a},update:{nodes:n,edges:o,combos:l},remove:{nodes:i,edges:r,combos:h}}}function zr(t,e){for(const n in t)(0,l.Z)(t[n])&&!Array.isArray(t[n])&&null!==t[n]?(e[n]||(e[n]={}),zr(t[n],e[n])):void 0===e[n]&&(e[n]=R(n))}function Fr(t,e=!1,n){const i={animation:e,current:{add:{},update:{},remove:{}},original:{add:{},update:{},remove:{}}},{add:s,update:o,remove:r}=Br(jr(t));return["nodes","edges","combos"].forEach((t=>{o[t]&&o[t].forEach((e=>{var s,o;const r=Object.assign({},e.value);let a=Object.assign({},e.original);if(n){const t=n.graph.getElementType(Ht(e.original)),i="edge"===t?"stroke":"fill",s=n.element.getElementComputedStyle(t,e.original);a=Object.assign(Object.assign({},e.original),{style:Object.assign({[i]:s[i]},e.original.style)})}zr(r,a),(s=i.current.update)[t]||(s[t]=[]),i.current.update[t].push(r),(o=i.original.update)[t]||(o[t]=[]),i.original.update[t].push(a)})),s[t]&&s[t].forEach((e=>{var n,s;const o=Object.assign({},e.value);(n=i.current.add)[t]||(n[t]=[]),i.current.add[t].push(o),(s=i.original.remove)[t]||(s[t]=[]),i.original.remove[t].push(o)})),r[t]&&r[t].forEach((e=>{var n,s;const o=Object.assign({},e.value);(n=i.current.remove)[t]||(n[t]=[]),i.current.remove[t].push(o),(s=i.original.add)[t]||(s[t]=[]),i.original.add[t].push(o)}))})),i}class _r extends Mo{constructor(t,e){super(t,Object.assign({},_r.defaultOptions,e)),this.batchChanges=null,this.batchAnimation=!1,this.undoStack=[],this.redoStack=[],this.freezed=!1,this.executeCommand=(t,e=!0)=>{var n,i,s;this.freezed=!0,null===(i=(n=this.options).executeCommand)||void 0===i||i.call(n,t);const o=e?t.original:t.current;this.context.graph.addData(o.add),this.context.graph.updateData(o.update),this.context.graph.removeData(Gt(o.remove,!1)),null===(s=this.context.element)||void 0===s||s.draw({silence:!0,animation:t.animation}),this.freezed=!1},this.addCommand=t=>{var e;if(!this.freezed){if(t.type===v.AFTER_DRAW){const{dataChanges:n=[],animation:i=!0}=t.data;if(null===(e=this.context.batch)||void 0===e?void 0:e.isBatching){if(!this.batchChanges)return;return this.batchChanges.push(n),void(this.batchAnimation&&(this.batchAnimation=i))}this.batchChanges=[n],this.batchAnimation=i}this.undoStackPush(Fr(this.batchChanges.flat(),this.batchAnimation,this.context)),this.notify(b.ADD,this.undoStack[this.undoStack.length-1])}},this.initBatchCommand=t=>{const{initiate:e}=t.data;if(this.batchAnimation=!1,e)this.batchChanges=[];else{this.undoStack.pop()||(this.batchChanges=null)}},this.emitter=new Ir.Z;const{graph:n}=this.context;n.on(v.AFTER_DRAW,this.addCommand),n.on(v.BATCH_START,this.initBatchCommand),n.on(v.BATCH_END,this.addCommand)}canUndo(){return this.undoStack.length>0}canRedo(){return this.redoStack.length>0}undo(){var t,e,n,i;const s=this.undoStack.pop();if(s){this.executeCommand(s);if(!1===(null===(e=(t=this.options).beforeAddCommand)||void 0===e?void 0:e.call(t,s,!1)))return;this.redoStack.push(s),null===(i=(n=this.options).afterAddCommand)||void 0===i||i.call(n,s,!1),this.notify(b.UNDO,s)}return this}redo(){const t=this.redoStack.pop();return t&&(this.executeCommand(t,!1),this.undoStackPush(t),this.notify(b.REDO,t)),this}undoAndCancel(){const t=this.undoStack.pop();return t&&(this.executeCommand(t,!1),this.redoStack=[],this.notify(b.CANCEL,t)),this}undoStackPush(t){var e,n,i,s;const{stackSize:o}=this.options;0!==o&&this.undoStack.length>=o&&this.undoStack.shift();!1!==(null===(n=(e=this.options).beforeAddCommand)||void 0===n?void 0:n.call(e,t,!0))&&(this.undoStack.push(t),null===(s=(i=this.options).afterAddCommand)||void 0===s||s.call(i,t,!0))}clear(){this.undoStack=[],this.redoStack=[],this.batchChanges=null,this.batchAnimation=!1,this.notify(b.CLEAR,null)}notify(t,e){this.emitter.emit(t,{cmd:e}),this.emitter.emit(b.CHANGE,{cmd:e})}on(t,e){this.emitter.on(t,e)}destroy(){const{graph:t}=this.context;t.off(v.AFTER_DRAW,this.addCommand),t.off(v.BATCH_START,this.initBatchCommand),t.off(v.BATCH_END,this.addCommand),this.emitter.off(),super.destroy(),this.undoStack=[],this.redoStack=[]}}_r.defaultOptions={stackSize:0};const Zr={toXy(t,e){if(!e)return[...t];const n=e[0].slice(1),i=e[1].slice(1);return t.map((t=>[t[n],t[i]]))},fromXy(t,e){if(!e)return[...t];const n=e[0].slice(1),i=e[1].slice(1);return t.map((([t,e])=>({[n]:t,[i]:e})))}};class $r{constructor(t,e){this._cells=[],this._cellSize=e,this._reverseCellSize=1/e;for(const e of t){const t=this.coordToCellNum(e[0]),n=this.coordToCellNum(e[1]);this._cells[t]||(this._cells[t]=[]),this._cells[t][n]||(this._cells[t][n]=[]),this._cells[t][n].push(e)}}cellPoints(t,e){var n;return(null===(n=this._cells[t])||void 0===n?void 0:n[e])||[]}rangePoints(t){const e=this.coordToCellNum(t[0]),n=this.coordToCellNum(t[1]),i=this.coordToCellNum(t[2]),s=this.coordToCellNum(t[3]),o=[];for(let t=e;t<=i;t++)for(let e=n;e<=s;e++){const n=this.cellPoints(t,e);for(const t of n)o.push(t)}return o}removePoint(t){const e=this.coordToCellNum(t[0]),n=this.coordToCellNum(t[1]),i=this._cells[e][n],s=i.findIndex((([e,n])=>e===t[0]&&n===t[1]));return s>-1&&i.splice(s,1),i}trunc(t){return Math.trunc(t)}coordToCellNum(t){return this.trunc(t*this._reverseCellSize)}extendBbox(t,e){return[t[0]-e*this._cellSize,t[1]-e*this._cellSize,t[2]+e*this._cellSize,t[3]+e*this._cellSize]}}const Vr=+(Math.pow(2,27)+1);function Wr(t,e,n){const i=t*e,s=Vr*t,o=s-(s-t),r=t-o,a=Vr*e,l=a-(a-e),h=e-l,c=r*h-(i-o*l-r*l-o*h);return n?(n[0]=c,n[1]=i,n):[c,i]}function Hr(t,e,n){const i=t+e,s=i-t,o=e-s,r=t-(i-s);return n?(n[0]=r+o,n[1]=i,n):[r+o,i]}function Yr(t,e){const n=t.length;if(1===n){const n=Wr(t[0],e);return n[0]?n:[n[1]]}const i=new Array(2*n),s=[.1,.1],o=[.1,.1];let r=0;Wr(t[0],e,s),s[0]&&(i[r++]=s[0]);for(let a=1;a<n;++a){Wr(t[a],e,o);Hr(s[1],o[0],s),s[0]&&(i[r++]=s[0]);const n=o[1],l=s[1],h=n+l,c=l-(h-n);s[1]=h,c&&(i[r++]=c)}return s[1]&&(i[r++]=s[1]),0===r&&(i[r++]=0),i.length=r,i}function Gr(t,e){const n=0|t.length,i=0|e.length;if(1===n&&1===i)return function(t,e){const n=t+e,i=n-t,s=t-(n-i)+(e-i);return s?[s,n]:[n]}(t[0],-e[0]);const s=new Array(n+i);let o=0,r=0,a=0;const l=Math.abs;let h,c,d=t[r],u=l(d),p=-e[a],g=l(p);u<g?(c=d,r+=1,r<n&&(d=t[r],u=l(d))):(c=p,a+=1,a<i&&(p=-e[a],g=l(p))),r<n&&u<g||a>=i?(h=d,r+=1,r<n&&(d=t[r],u=l(d))):(h=p,a+=1,a<i&&(p=-e[a],g=l(p)));let f,y,m,v,b,E=h+c,x=E-h,w=c-x,O=w,S=E;for(;r<n&&a<i;)u<g?(h=d,r+=1,r<n&&(d=t[r],u=l(d))):(h=p,a+=1,a<i&&(p=-e[a],g=l(p))),c=O,E=h+c,x=E-h,w=c-x,w&&(s[o++]=w),f=S+E,y=f-S,m=f-y,v=E-y,b=S-m,O=b+v,S=f;for(;r<n;)h=d,c=O,E=h+c,x=E-h,w=c-x,w&&(s[o++]=w),f=S+E,y=f-S,m=f-y,v=E-y,b=S-m,O=b+v,S=f,r+=1,r<n&&(d=t[r]);for(;a<i;)h=p,c=O,E=h+c,x=E-h,w=c-x,w&&(s[o++]=w),f=S+E,y=f-S,m=f-y,v=E-y,b=S-m,O=b+v,S=f,a+=1,a<i&&(p=-e[a]);return O&&(s[o++]=O),S&&(s[o++]=S),o||(s[o++]=0),s.length=o,s}function Ur(t,e){const n=0|t.length,i=0|e.length;if(1===n&&1===i)return function(t,e){const n=t+e,i=n-t,s=t-(n-i)+(e-i);return s?[s,n]:[n]}(t[0],e[0]);const s=new Array(n+i);let o=0,r=0,a=0;const l=Math.abs;let h,c,d=t[r],u=l(d),p=e[a],g=l(p);u<g?(c=d,r+=1,r<n&&(d=t[r],u=l(d))):(c=p,a+=1,a<i&&(p=e[a],g=l(p))),r<n&&u<g||a>=i?(h=d,r+=1,r<n&&(d=t[r],u=l(d))):(h=p,a+=1,a<i&&(p=e[a],g=l(p)));let f,y,m,v,b,E=h+c,x=E-h,w=c-x,O=w,S=E;for(;r<n&&a<i;)u<g?(h=d,r+=1,r<n&&(d=t[r],u=l(d))):(h=p,a+=1,a<i&&(p=e[a],g=l(p))),c=O,E=h+c,x=E-h,w=c-x,w&&(s[o++]=w),f=S+E,y=f-S,m=f-y,v=E-y,b=S-m,O=b+v,S=f;for(;r<n;)h=d,c=O,E=h+c,x=E-h,w=c-x,w&&(s[o++]=w),f=S+E,y=f-S,m=f-y,v=E-y,b=S-m,O=b+v,S=f,r+=1,r<n&&(d=t[r]);for(;a<i;)h=p,c=O,E=h+c,x=E-h,w=c-x,w&&(s[o++]=w),f=S+E,y=f-S,m=f-y,v=E-y,b=S-m,O=b+v,S=f,a+=1,a<i&&(p=e[a]);return O&&(s[o++]=O),S&&(s[o++]=S),o||(s[o++]=0),s.length=o,s}function Kr(t,e,n,i){return function(n,s,o){const r=t(t(e(s[1],o[0]),e(-o[1],s[0])),t(e(n[1],s[0]),e(-s[1],n[0]))),a=t(e(n[1],o[0]),e(-o[1],n[0])),l=i(r,a);return l[l.length-1]}}function Xr(t,e,n,i){return function(s,o,r,a){const l=t(t(n(t(e(r[1],a[0]),e(-a[1],r[0])),o[2]),t(n(t(e(o[1],a[0]),e(-a[1],o[0])),-r[2]),n(t(e(o[1],r[0]),e(-r[1],o[0])),a[2]))),t(n(t(e(o[1],a[0]),e(-a[1],o[0])),s[2]),t(n(t(e(s[1],a[0]),e(-a[1],s[0])),-o[2]),n(t(e(s[1],o[0]),e(-o[1],s[0])),a[2])))),h=t(t(n(t(e(r[1],a[0]),e(-a[1],r[0])),s[2]),t(n(t(e(s[1],a[0]),e(-a[1],s[0])),-r[2]),n(t(e(s[1],r[0]),e(-r[1],s[0])),a[2]))),t(n(t(e(o[1],r[0]),e(-r[1],o[0])),s[2]),t(n(t(e(s[1],r[0]),e(-r[1],s[0])),-o[2]),n(t(e(s[1],o[0]),e(-o[1],s[0])),r[2])))),c=i(l,h);return c[c.length-1]}}function qr(t,e,n,i){return function(s,o,r,a,l){const h=t(t(t(n(t(n(t(e(a[1],l[0]),e(-l[1],a[0])),r[2]),t(n(t(e(r[1],l[0]),e(-l[1],r[0])),-a[2]),n(t(e(r[1],a[0]),e(-a[1],r[0])),l[2]))),o[3]),t(n(t(n(t(e(a[1],l[0]),e(-l[1],a[0])),o[2]),t(n(t(e(o[1],l[0]),e(-l[1],o[0])),-a[2]),n(t(e(o[1],a[0]),e(-a[1],o[0])),l[2]))),-r[3]),n(t(n(t(e(r[1],l[0]),e(-l[1],r[0])),o[2]),t(n(t(e(o[1],l[0]),e(-l[1],o[0])),-r[2]),n(t(e(o[1],r[0]),e(-r[1],o[0])),l[2]))),a[3]))),t(n(t(n(t(e(r[1],a[0]),e(-a[1],r[0])),o[2]),t(n(t(e(o[1],a[0]),e(-a[1],o[0])),-r[2]),n(t(e(o[1],r[0]),e(-r[1],o[0])),a[2]))),-l[3]),t(n(t(n(t(e(a[1],l[0]),e(-l[1],a[0])),o[2]),t(n(t(e(o[1],l[0]),e(-l[1],o[0])),-a[2]),n(t(e(o[1],a[0]),e(-a[1],o[0])),l[2]))),s[3]),n(t(n(t(e(a[1],l[0]),e(-l[1],a[0])),s[2]),t(n(t(e(s[1],l[0]),e(-l[1],s[0])),-a[2]),n(t(e(s[1],a[0]),e(-a[1],s[0])),l[2]))),-o[3])))),t(t(n(t(n(t(e(o[1],l[0]),e(-l[1],o[0])),s[2]),t(n(t(e(s[1],l[0]),e(-l[1],s[0])),-o[2]),n(t(e(s[1],o[0]),e(-o[1],s[0])),l[2]))),a[3]),t(n(t(n(t(e(o[1],a[0]),e(-a[1],o[0])),s[2]),t(n(t(e(s[1],a[0]),e(-a[1],s[0])),-o[2]),n(t(e(s[1],o[0]),e(-o[1],s[0])),a[2]))),-l[3]),n(t(n(t(e(r[1],a[0]),e(-a[1],r[0])),o[2]),t(n(t(e(o[1],a[0]),e(-a[1],o[0])),-r[2]),n(t(e(o[1],r[0]),e(-r[1],o[0])),a[2]))),s[3]))),t(n(t(n(t(e(r[1],a[0]),e(-a[1],r[0])),s[2]),t(n(t(e(s[1],a[0]),e(-a[1],s[0])),-r[2]),n(t(e(s[1],r[0]),e(-r[1],s[0])),a[2]))),-o[3]),t(n(t(n(t(e(o[1],a[0]),e(-a[1],o[0])),s[2]),t(n(t(e(s[1],a[0]),e(-a[1],s[0])),-o[2]),n(t(e(s[1],o[0]),e(-o[1],s[0])),a[2]))),r[3]),n(t(n(t(e(o[1],r[0]),e(-r[1],o[0])),s[2]),t(n(t(e(s[1],r[0]),e(-r[1],s[0])),-o[2]),n(t(e(s[1],o[0]),e(-o[1],s[0])),r[2]))),-a[3]))))),c=t(t(t(n(t(n(t(e(a[1],l[0]),e(-l[1],a[0])),r[2]),t(n(t(e(r[1],l[0]),e(-l[1],r[0])),-a[2]),n(t(e(r[1],a[0]),e(-a[1],r[0])),l[2]))),s[3]),n(t(n(t(e(a[1],l[0]),e(-l[1],a[0])),s[2]),t(n(t(e(s[1],l[0]),e(-l[1],s[0])),-a[2]),n(t(e(s[1],a[0]),e(-a[1],s[0])),l[2]))),-r[3])),t(n(t(n(t(e(r[1],l[0]),e(-l[1],r[0])),s[2]),t(n(t(e(s[1],l[0]),e(-l[1],s[0])),-r[2]),n(t(e(s[1],r[0]),e(-r[1],s[0])),l[2]))),a[3]),n(t(n(t(e(r[1],a[0]),e(-a[1],r[0])),s[2]),t(n(t(e(s[1],a[0]),e(-a[1],s[0])),-r[2]),n(t(e(s[1],r[0]),e(-r[1],s[0])),a[2]))),-l[3]))),t(t(n(t(n(t(e(r[1],l[0]),e(-l[1],r[0])),o[2]),t(n(t(e(o[1],l[0]),e(-l[1],o[0])),-r[2]),n(t(e(o[1],r[0]),e(-r[1],o[0])),l[2]))),s[3]),n(t(n(t(e(r[1],l[0]),e(-l[1],r[0])),s[2]),t(n(t(e(s[1],l[0]),e(-l[1],s[0])),-r[2]),n(t(e(s[1],r[0]),e(-r[1],s[0])),l[2]))),-o[3])),t(n(t(n(t(e(o[1],l[0]),e(-l[1],o[0])),s[2]),t(n(t(e(s[1],l[0]),e(-l[1],s[0])),-o[2]),n(t(e(s[1],o[0]),e(-o[1],s[0])),l[2]))),r[3]),n(t(n(t(e(o[1],r[0]),e(-r[1],o[0])),s[2]),t(n(t(e(s[1],r[0]),e(-r[1],s[0])),-o[2]),n(t(e(s[1],o[0]),e(-o[1],s[0])),r[2]))),-l[3])))),d=i(h,c);return d[d.length-1]}}function Jr(t){return(3===t?Kr:4===t?Xr:qr)(Ur,Wr,Yr,Gr)}const Qr=Jr(3),ta=Jr(4),ea=[function(){return 0},function(){return 0},function(t,e){return e[0]-t[0]},function(t,e,n){const i=(t[1]-n[1])*(e[0]-n[0]),s=(t[0]-n[0])*(e[1]-n[1]),o=i-s;let r;if(i>0){if(s<=0)return o;r=i+s}else{if(!(i<0))return o;if(s>=0)return o;r=-(i+s)}const a=33306690738754716e-32*r;return o>=a||o<=-a?o:Qr(t,e,n)},function(t,e,n,i){const s=t[0]-i[0],o=e[0]-i[0],r=n[0]-i[0],a=t[1]-i[1],l=e[1]-i[1],h=n[1]-i[1],c=t[2]-i[2],d=e[2]-i[2],u=n[2]-i[2],p=o*h,g=r*l,f=r*a,y=s*h,m=s*l,v=o*a,b=c*(p-g)+d*(f-y)+u*(m-v),E=7771561172376103e-31*((Math.abs(p)+Math.abs(g))*Math.abs(c)+(Math.abs(f)+Math.abs(y))*Math.abs(d)+(Math.abs(m)+Math.abs(v))*Math.abs(u));return b>E||-b>E?b:ta(t,e,n,i)}];function na(t){let e=ea[t.length];return e||(e=ea[t.length]=Jr(t.length)),e.apply(void 0,...t)}var ia=function(){for(;ea.length<=5;)ea.push(Jr(ea.length));const t=function(t,e,n,i,s,o,r){return function(...e){switch(e.length){case 0:case 1:return 0;case 2:return i(e[0],e[1]);case 3:return s(e[0],e[1],e[2]);case 4:return o(e[0],e[1],e[2],e[3]);case 5:return r(e[0],e[1],e[2],e[3],e[4])}return t(e)}}(void 0,na,...ea);for(let e=0;e<=5;++e)t[e]=ea[e];return t}();const sa=ia[3];function oa(t,e,n,i){const s=ia(t,n,i),o=ia(e,n,i);if(s>0&&o>0||s<0&&o<0)return!1;const r=ia(n,t,e),a=ia(i,t,e);return!(r>0&&a>0||r<0&&a<0)&&(0!==s||0!==o||0!==r||0!==a||function(t,e,n,i){for(let s=0;s<2;++s){const o=t[s],r=e[s],[a,l]=[Math.min(o,r),Math.max(o,r)],h=n[s],c=i[s],[d,u]=[Math.min(h,c),Math.max(h,c)];if(u<a||l<d)return!1}return!0}(t,e,n,i))}function ra(t,e){return Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2)}function aa(t,e,n){const i=[e[0]-t[0],e[1]-t[1]],s=[n[0]-t[0],n[1]-t[1]],o=ra(t,e),r=ra(t,n);return(i[0]*s[0]+i[1]*s[1])/Math.sqrt(o*r)}function la(t,e){for(let n=0;n<e.length-1;n++){const i=[e[n],e[n+1]];if(!(t[0][0]===i[0][0]&&t[0][1]===i[0][1]||t[0][0]===i[1][0]&&t[0][1]===i[1][1])&&oa(t[0],t[1],i[0],i[1]))return!0}return!1}function ha(t){return[Math.min(t[0][0],t[1][0]),Math.min(t[0][1],t[1][1]),Math.max(t[0][0],t[1][0]),Math.max(t[0][1],t[1][1])]}function ca(t,e,n){let i,s,o=null,r=pa,a=pa;for(let l=0;l<e.length;l++)i=aa(t[0],t[1],e[l]),s=aa(t[1],t[0],e[l]),i>r&&s>a&&!la([t[0],e[l]],n)&&!la([t[1],e[l]],n)&&(r=i,a=s,o=e[l]);return o}function da(t,e,n,i,s){let o=!1;for(let r=0;r<t.length-1;r++){const a=[t[r],t[r+1]],l=a[0][0]+","+a[0][1]+","+a[1][0]+","+a[1][1];if(ra(a[0],a[1])<e||s.has(l))continue;let h,c,d,u=0,p=ha(a);do{p=i.extendBbox(p,u),h=p[2]-p[0],c=p[3]-p[1],d=ca(a,i.rangePoints(p),t),u++}while(null===d&&(n[0]>h||n[1]>c));h>=n[0]&&c>=n[1]&&s.add(l),null!==d&&(t.splice(r+1,0,d),i.removePoint(d),o=!0)}return o?da(t,e,n,i,s):t}function ua(t,e,n){const i=e||20,s=function(t){const e=[t[0]];let n=t[0];for(let i=1;i<t.length;i++){const s=t[i];n[0]===s[0]&&n[1]===s[1]||e.push(s),n=s}return e}(function(t){return t.sort((function(t,e){return t[0]-e[0]||t[1]-e[1]}))}(Zr.toXy(t,n)));if(s.length<4){const t=s.concat([s[0]]);return n?Zr.fromXy(t,n):t}const o=function(t){let e=1/0,n=1/0,i=-1/0,s=-1/0;for(let o=t.length-1;o>=0;o--)t[o][0]<e&&(e=t[o][0]),t[o][1]<n&&(n=t[o][1]),t[o][0]>i&&(i=t[o][0]),t[o][1]>s&&(s=t[o][1]);return[i-e,s-n]}(s),r=[o[0]*ga,o[1]*ga],a=function(t){const e=t.length;if(e<3){const n=new Array(e);for(let t=0;t<e;++t)n[t]=t;return 2===e&&t[0][0]===t[1][0]&&t[0][1]===t[1][1]?[0]:n}const n=new Array(e);for(let t=0;t<e;++t)n[t]=t;n.sort(((e,n)=>t[e][0]-t[n][0]||t[e][1]-t[n][1]));const i=[n[0],n[1]],s=[n[0],n[1]];for(let o=2;o<e;++o){const e=n[o],r=t[e];let a=i.length;for(;a>1&&sa(t[i[a-2]],t[i[a-1]],r)<=0;)a-=1,i.pop();for(i.push(e),a=s.length;a>1&&sa(t[s[a-2]],t[s[a-1]],r)>=0;)a-=1,s.pop();s.push(e)}const o=new Array(s.length+i.length-2);let r=0;for(let t=0,e=i.length;t<e;++t)o[r++]=i[t];for(let t=s.length-2;t>0;--t)o[r++]=s[t];return o}(s).reverse().map((t=>s[t]));a.push(a[0]);const l=s.filter((function(t){return a.indexOf(t)<0})),h=Math.ceil(1/(s.length/(o[0]*o[1]))),c=da(a,Math.pow(i,2),r,function(t,e){return new $r(t,e)}(l,h),new Set);return n?Zr.fromXy(c,n):c}const pa=Math.cos(90/(180/Math.PI)),ga=.6;const fa=(t,e,n)=>{if("sharp"===n)return[["M",t[0]-e,t[1]-e],["L",t[0]+e,t[1]-e],["L",t[0]+e,t[1]+e],["L",t[0]-e,t[1]+e],["Z"]];const i=[e,e,0,0,0];return[["M",t[0],t[1]-e],["A",...i,t[0],t[1]+e],["A",...i,t[0],t[1]-e]]},ya=(t,e,n)=>{const i=[e,e,0,0,0],s="sharp"===n?ce(t[0],ge(me(de(t[0],t[1])),e)):t[0],o="sharp"===n?ce(t[1],ge(me(de(t[1],t[0])),e)):t[1],r=ge(me(be(de(s,o),!1)),e),a=ge(r,-1),l=ce(s,r),h=ce(o,r),c=ce(o,a),d=ce(s,a);return"sharp"===n?[["M",l[0],l[1]],["L",h[0],h[1]],["L",c[0],c[1]],["L",d[0],d[1]],["Z"]]:[["M",l[0],l[1]],["L",h[0],h[1]],["A",...i,c[0],c[1]],["L",d[0],d[1]],["A",...i,l[0],l[1]]]},ma=(t,e)=>{const n=$e(t).map(((n,i)=>{const s=(i-2+t.length)%t.length,o=(i-1+t.length)%t.length,r=(i+1)%t.length,a=t[s],l=t[o],h=t[r],c=de(a,l),d=de(l,n),u=de(n,h),p=(t,e)=>ve(t,e,!0)<Math.PI,g=p(c,d),f=p(d,u),y=t=>ge(me(be(t,!1)),e),m=y(d);return[{p:xe(ce(l,g?y(c):m)),concave:g&&l},{p:xe(ce(n,f?y(u):m)),concave:f&&n}]})),i=[e,e,0,0,0],s=n.findIndex(((t,e)=>!(n[(e-1+n.length)%n.length][0].concave||n[(e-1+n.length)%n.length][1].concave||t[0].concave||t[0].concave||t[1].concave))),o=n.slice(s).concat(n.slice(0,s));let r=[];return o.flatMap(((t,e)=>{const s=[],a=o[n.length-1];return 0===e&&s.push(["M",...a[1].p]),t[0].concave?r.push(t[0].p,t[1].p):s.push(["A",...i,...t[0].p]),t[1].concave?r.unshift(t[1].p):s.push(["L",...t[1].p]),3===r.length&&(s.pop(),s.push(["C",...r.flat()]),r=[]),s}))},va=(t,e)=>{const n=$e(t).map(((e,n)=>({p:e,v:me(de(t[(n+1)%t.length],e))})));return n.forEach(((i,s)=>{const o=s>0?s-1:t.length-1,r=n[o].v,a=me(ce(r,ge(i.v,ve(r,i.v,!0)<Math.PI?1:-1)));i.p=ce(i.p,ge(a,e))})),zn(n.map((t=>t.p)))},ba=(t,e)=>{const n=t.map(((n,i)=>{const s=t[0===i?t.length-1:i-1],o=we(ge(me(be(de(s,n),!1)),e));return[ce(s,o),ce(n,o)]})),i=n.flat();return i.map(((t,e)=>{if(e%2==0)return null;return De([i[(e-1)%i.length],i[e%i.length]],[i[(e+1)%i.length],i[(e+2)%i.length]],!0)})).filter(Boolean).map(((t,e)=>[0===e?"M":"L",t[0],t[1]])).concat([["Z"]])};var Ea=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(n[i[s]]=t[i[s]])}return n};class xa extends Mo{constructor(t,e){super(t,Object.assign({},xa.defaultOptions,e)),this.hullMemberIds=[],this.drawHull=()=>{if(this.shape){const t=!(0,a.Z)(this.optionsCache,this.options);this.shape.update(this.getHullStyle(t))}else this.shape=new Zn({style:this.getHullStyle()}),this.context.canvas.appendChild(this.shape);this.optionsCache=Object.assign({},this.options)},this.updateHullPath=t=>{this.shape&&this.options.members.includes(Ht(t.data))&&this.shape.update({d:this.getHullPath(!0)})},this.getHullPath=(t=!1)=>{const{graph:e}=this.context,n=this.getMember();if(0===n.length)return"";const i=n.map((t=>e.getNodeData(t))),s=ua(i.map(Me),this.options.concavity).slice(1).reverse(),o=s.flatMap((t=>i.filter((e=>(0,a.Z)(Me(e),t))).map(Ht)));return(0,a.Z)(o,this.hullMemberIds)&&!t||(this.hullMemberIds=o,this.path=function(t,e,n){if(1===t.length)return fa(t[0],e,n);if(2===t.length)return ya(t,e,n);if(3===t.length){const[i,s,o]=$e(t);if(je(i,s,o))return ya([i,o],e,n)}switch(n){case"smooth":return va(t,e);case"sharp":return ba(t,e);default:return ma(t,e)}}(s,this.getPadding(),this.options.corner)),this.path},this.bindEvents()}bindEvents(){this.context.graph.on(v.AFTER_RENDER,this.drawHull),this.context.graph.on(v.AFTER_ELEMENT_UPDATE,this.updateHullPath)}getHullStyle(t){const e=this.options,{members:n,padding:i,corner:s}=e,o=Ea(e,["members","padding","corner"]);return Object.assign(Object.assign({},o),{d:this.getHullPath(t)})}getPadding(){const{graph:t}=this.context;return this.hullMemberIds.reduce(((e,n)=>{const{halfExtents:i}=t.getElementRenderBounds(n),s=Math.max(i[0],i[1]);return Math.max(e,s)}),0)+this.options.padding}addMember(t){const e=Array.isArray(t)?t:[t];this.options.members=[...new Set([...this.options.members,...e])],this.shape.update({d:this.getHullPath()})}removeMember(t){const e=Array.isArray(t)?t:[t];this.options.members=this.options.members.filter((t=>!e.includes(t))),e.some((t=>this.hullMemberIds.includes(t)))&&this.shape.update({d:this.getHullPath()})}updateMember(t){this.options.members=(0,W.Z)(t)?t(this.options.members):t,this.shape.update(this.getHullStyle(!0))}getMember(){return this.options.members}destroy(){this.context.graph.off(v.AFTER_DRAW,this.drawHull),this.shape.destroy(),this.hullMemberIds=[],super.destroy()}}xa.defaultOptions={members:[],padding:10,corner:"rounded",concavity:1/0,fill:"lightblue",fillOpacity:.2,labelOpacity:1,stroke:"blue",strokeOpacity:.2};var wa=n(24085);function Oa(t){const{width:e,height:n,renderer:i}=t,o=function(t){var e;const{container:n,className:i,graphCanvas:s}=t;if(n)return"string"==typeof n?document.getElementById(n):n;const o=To(i,!1),{width:r,height:a,containerStyle:l}=t,[h,c]=function(t){const{width:e,height:n,placement:i,graphCanvas:s}=t,[o,r]=s.getSize(),[a,l]=Ce(i);return[a*(o-e),l*(r-n)]}(t);return Object.assign(o.style,Object.assign({position:"absolute",left:h+"px",top:c+"px",width:r+"px",height:a+"px"},l)),null===(e=s.getContainer())||void 0===e||e.appendChild(o),o}(t);return[o,new s.Xz({width:e,height:n,container:o,renderer:i||new si.Th})]}var Sa=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(n[i[s]]=t[i[s]])}return n};class Da extends Mo{constructor(t,e){super(t,Object.assign({},Da.defaultOptions,e)),this.typePrefix="__data__",this.draw=!1,this.fieldMap={node:new Map,edge:new Map,combo:new Map},this.selectedItems=[],this.bindEvents=()=>{const{graph:t}=this.context;t.on(v.AFTER_DRAW,this.createElement)},this.changeState=(t,e)=>{const{graph:n}=this.context,{typePrefix:i}=this,s=(0,rn.Z)(t,[i,"id"]),o=(0,rn.Z)(t,[i,"style","labelText"]),[r]=s.split("__"),a=this.fieldMap[r].get(o)||[];n.setElementState(Object.fromEntries(null==a?void 0:a.map((t=>[t,e]))))},this.click=t=>{if("hover"===this.options.trigger)return;const e=(0,rn.Z)(t,[this.typePrefix,"id"]);this.selectedItems.includes(e)?(this.selectedItems=this.selectedItems.filter((t=>t!==e)),this.changeState(t,[])):(this.selectedItems.push(e),this.changeState(t,"selected"))},this.mouseleave=t=>{"click"!==this.options.trigger&&(this.selectedItems=[],this.changeState(t,[]))},this.mouseenter=t=>{if("click"===this.options.trigger)return;const e=(0,rn.Z)(t,[this.typePrefix,"id"]);this.selectedItems.includes(e)?this.selectedItems=this.selectedItems.filter((t=>t!==e)):(this.selectedItems.push(e),this.changeState(t,"active"))},this.setFieldMap=(t,e,n)=>{if(!t)return;const i=this.fieldMap[n];if(i)if(i.has(t)){const n=i.get(t);n&&(n.push(e),i.set(t,n))}else i.set(t,[e])},this.getEvents=()=>({mouseenter:this.mouseenter,mouseleave:this.mouseleave,click:this.click}),this.getMarkerData=(t,e)=>{if(!t)return[];const{model:n,element:i}=this.context,{nodes:s,edges:o,combos:r}=n.getData(),a={},l=e=>(0,W.Z)(t)?t(e):t,h={node:"circle",edge:"line",combo:"rect"},c={circle:"circle",ellipse:"circle",image:"bowtie",rect:"square",star:"cross",triangle:"triangle",diamond:"diamond",cubic:"dot",line:"hyphen",polyline:"hyphen",quadratic:"hv","cubic-horizontal":"hyphen","cubic-vertical":"line"},d=(t,e)=>{t.forEach((t=>{const{id:n}=t,s=(0,rn.Z)(t,["data",l(t)]),o=(null==i?void 0:i.getElementType(e,t))||"circle",r=((t,e)=>null==i?void 0:i.getElementComputedStyle(t,e))(e,t),d=("edge"===e?null==r?void 0:r.stroke:null==r?void 0:r.fill)||"#1783ff";n&&s&&s.replace(/\s+/g,"")&&(this.setFieldMap(s,n,e),a[s]||(a[s]={id:`${e}__${n}`,label:s,marker:c[o]||h[e],elementType:e,lineWidth:1,stroke:d,fill:d}))}))};switch(e){case"node":d(s,"node");break;case"edge":d(o,"edge");break;case"combo":d(r,"combo");break;default:return[]}return Object.values(a)},this.createElement=()=>{if(this.draw)return void this.updateElement();const t=this.options,{width:e,height:n,nodeField:i,edgeField:s,comboField:o,trigger:r,position:a,container:l,containerStyle:h,className:c}=t,d=Sa(t,["width","height","nodeField","edgeField","comboField","trigger","position","container","containerStyle","className"]),u=this.getMarkerData(i,"node"),p=this.getMarkerData(s,"edge"),g=this.getMarkerData(o,"combo"),f=[...u,...g,...p],y=Object.assign({width:e,height:n,data:f,itemMarkerLineWidth:({lineWidth:t})=>t,itemMarker:({marker:t})=>t,itemMarkerStroke:({stroke:t})=>t,itemMarkerFill:({fill:t})=>t,gridCol:u.length},d,this.getEvents()),m=new wa.W({className:"legend",style:y});this.category=m;this.upsertCanvas().appendChild(m),this.draw=!0},this.bindEvents()}update(t){super.update(t),this.clear(),this.createElement()}clear(){var t,e;null===(t=this.canvas)||void 0===t||t.destroy(),null===(e=this.container)||void 0===e||e.remove(),this.canvas=void 0,this.container=void 0,this.draw=!1}updateElement(){this.category&&this.category.update({itemMarkerOpacity:({id:t})=>!this.selectedItems.length||this.selectedItems.includes(t)?1:.5,itemLabelOpacity:({id:t})=>!this.selectedItems.length||this.selectedItems.includes(t)?1:.5})}upsertCanvas(){if(this.canvas)return this.canvas;const t=this.context.canvas,[e,n]=t.getSize(),{width:i=e,height:s=n,position:o,container:r,containerStyle:a,className:l}=this.options,[h,c]=Oa({width:i,height:s,graphCanvas:t,container:r,containerStyle:a,placement:o,className:"legend"});return this.container=h,l&&h.classList.add(l),this.canvas=c,this.canvas}destroy(){this.clear(),this.context.graph.off(v.AFTER_DRAW,this.createElement),super.destroy()}}Da.defaultOptions={position:"bottom",trigger:"hover",orientation:"horizontal",layout:"flex",itemSpacing:4,rowPadding:10,colPadding:10,itemMarkerSize:16,itemLabelFontSize:16,width:240,height:160};class Ca extends Mo{constructor(t,e){super(t,Object.assign({},Ca.defaultOptions,e)),this.onDraw=t=>{var e;(null===(e=null==t?void 0:t.data)||void 0===e?void 0:e.render)||this.onRender()},this.shapes=new Map,this.landmarkMap=new Map,this.mask=null,this.isMaskDragging=!1,this.onMaskDragStart=t=>{this.mask&&(this.isMaskDragging=!0,this.mask.setPointerCapture(t.pointerId),this.mask.addEventListener("pointermove",this.onMaskDrag),this.mask.addEventListener("pointerup",this.onMaskDragEnd),this.mask.addEventListener("pointercancel",this.onMaskDragEnd))},this.onMaskDrag=t=>{if(!this.mask||!this.isMaskDragging)return;const{size:[e,n]}=this.options,{movementX:i,movementY:s}=t,{left:o,top:r,width:a,height:l}=this.mask.style,[,,h,c]=this.maskBBox;let d=parseInt(o)+i,u=parseInt(r)+s,p=parseInt(a),g=parseInt(l);d<0&&(d=0),u<0&&(u=0),d+p>e&&(d=Ta(e-p,0)),u+g>n&&(u=Ta(n-g,0)),p<h&&(i>0?(d=Ta(d-i,0),p=Ma(p+i,e)):i<0&&(p=Ma(p-i,e))),g<c&&(s>0?(u=Ta(u-s,0),g=Ma(g+s,n)):s<0&&(g=Ma(g-s,n))),Object.assign(this.mask.style,{left:d+"px",top:u+"px",width:p+"px",height:g+"px"});const f=parseInt(o)-d,y=parseInt(r)-u;if(0===f&&0===y)return;const m=this.context.canvas.getCamera().getZoom()/this.canvas.getCamera().getZoom();this.context.graph.translateBy([f*m,y*m],!1)},this.onMaskDragEnd=t=>{this.mask&&(this.isMaskDragging=!1,this.mask.releasePointerCapture(t.pointerId),this.mask.removeEventListener("pointermove",this.onMaskDrag),this.mask.removeEventListener("pointerup",this.onMaskDragEnd),this.mask.removeEventListener("pointercancel",this.onMaskDragEnd))},this.onTransform=(0,U.Z)((()=>{this.isMaskDragging||(this.updateMask(),this.setCamera())}),32,{leading:!0}),this.setOnRender(),this.bindEvents()}update(t){this.unbindEvents(),super.update(t),"delay"in t&&this.setOnRender(),this.bindEvents()}setOnRender(){this.onRender=(0,ks.Z)((()=>{this.renderMinimap(),this.renderMask()}),this.options.delay)}bindEvents(){const{graph:t}=this.context;t.on(v.AFTER_DRAW,this.onDraw),t.on(v.AFTER_RENDER,this.onRender),t.on(v.AFTER_TRANSFORM,this.onTransform)}unbindEvents(){const{graph:t}=this.context;t.off(v.AFTER_DRAW,this.onDraw),t.off(v.AFTER_RENDER,this.onRender),t.off(v.AFTER_TRANSFORM,this.onTransform)}renderMinimap(){const t=this.getElements(),e=this.initCanvas();this.setShapes(e,t)}getElements(){const{filter:t}=this.options,{model:e}=this.context,n=e.getData();if(!t)return n;const{nodes:i,edges:s,combos:o}=n;return{nodes:i.filter((e=>t(Ht(e),"node"))),edges:s.filter((e=>t(Ht(e),"edge"))),combos:o.filter((e=>t(Ht(e),"combo")))}}setShapes(t,e){const{nodes:n,edges:i,combos:s}=e,{shape:o}=this.options,{element:r}=this.context;if("key"===o){const e=new Set,o=n=>{const i=Ht(n);e.add(i);const s=r.getElement(i);if(!s)return;const o=s.getShape("key"),a=this.shapes.get(i)||o.cloneNode();a.setPosition(o.getPosition()),s.style.zIndex&&(a.style.zIndex=s.style.zIndex),a.id=s.id,this.shapes.has(i)?Object.entries(o.attributes).forEach((([t,e])=>{a.style[t]!==e&&(a.style[t]=e)})):(t.appendChild(a),this.shapes.set(i,a))};return i.forEach(o),s.forEach(o),n.forEach(o),void this.shapes.forEach(((n,i)=>{e.has(i)||(t.removeChild(n),this.shapes.delete(i))}))}const a=(t,e)=>{const n=r.getElement(t).getPosition();return e.setPosition(n),e};t.removeChildren(),i.forEach((e=>t.appendChild(o(Ht(e),"edge")))),s.forEach((e=>{t.appendChild(a(Ht(e),o(Ht(e),"combo")))})),n.forEach((e=>{t.appendChild(a(Ht(e),o(Ht(e),"node")))}))}initCanvas(){const{renderer:t,size:[e,n]}=this.options;if(this.canvas){const{width:i,height:s}=this.canvas.getConfig();e===i&&n===s||this.canvas.resize(e,n),t&&this.canvas.setRenderer(t)}else{const{className:i,position:s,container:o,containerStyle:r}=this.options,[a,l]=Oa({renderer:t,width:e,height:n,placement:s,className:"minimap",container:o,containerStyle:r,graphCanvas:this.context.canvas});i&&a.classList.add(i),this.container=a,this.canvas=l}return this.setCamera(),this.canvas}createLandmark(t,e,n){const i=`${t.join(",")}-${e.join(",")}-${n}`;if(this.landmarkMap.has(i))return this.landmarkMap.get(i);const s=this.canvas.getCamera().createLandmark(i,{position:t,focalPoint:e,zoom:n});return this.landmarkMap.set(i,s),s}setCamera(){var t;const{canvas:e}=this.context,n=null===(t=this.canvas)||void 0===t?void 0:t.getCamera();if(!n)return;const{size:[i,s],padding:o}=this.options,[r,a,l,h]=J(o),{min:c,max:d,center:u}=e.getBounds("elements"),p=(i-h-a)/(d[0]-c[0]),g=(s-r-l)/(d[1]-c[1]),f=Math.min(p,g),y=this.createLandmark(u,u,f);n.gotoLandmark(y,0)}get maskBBox(){const{canvas:t}=this.context,e=t.getSize(),n=t.getCanvasByViewport([0,0]),i=t.getCanvasByViewport(e),s=this.canvas.canvas2Viewport(Le(n)),o=this.canvas.canvas2Viewport(Le(i)),r=o.x-s.x,a=o.y-s.y;return[s.x,s.y,r,a]}calculateMaskBBox(){const{size:[t,e]}=this.options;let[n,i,s,o]=this.maskBBox;return n<0&&(s=Ma(s+n,t),n=0),i<0&&(o=Ma(o+i,e),i=0),n+s>t&&(s=Ta(t-n,0)),i+o>e&&(o=Ta(e-i,0)),[Ma(n,t),Ma(i,e),Ta(s,0),Ta(o,0)]}renderMask(){const{maskStyle:t}=this.options;this.mask||(this.mask=document.createElement("div"),this.mask.addEventListener("pointerdown",this.onMaskDragStart)),this.container.appendChild(this.mask),Object.assign(this.mask.style,Object.assign(Object.assign({},t),{cursor:"move",position:"absolute",pointerEvents:"auto"})),this.updateMask()}updateMask(){if(!this.mask)return;const[t,e,n,i]=this.calculateMaskBBox();Object.assign(this.mask.style,{top:e+"px",left:t+"px",width:n+"px",height:i+"px"})}destroy(){var t;this.unbindEvents(),this.canvas.destroy(),null===(t=this.mask)||void 0===t||t.remove(),super.destroy()}}Ca.defaultOptions={size:[240,160],shape:"key",padding:10,position:"right-bottom",maskStyle:{border:"1px solid #ddd",background:"rgba(0, 0, 0, 0.1)"},containerStyle:{border:"1px solid #ddd",background:"#fff"},delay:128};const Ma=(t,e)=>Math.min(t,e),Ta=(t,e)=>Math.max(t,e);var Pa=function(t,e,n,i){return new(n||(n=Promise))((function(s,o){function r(t){try{l(i.next(t))}catch(t){o(t)}}function a(t){try{l(i.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,a)}l((i=i.apply(t,e||[])).next())}))};const Aa={x1:0,y1:0,x2:0,y2:0,visibility:"hidden"};class Ra extends Mo{constructor(t,e){super(t,Object.assign({},Ra.defaultOptions,e)),this.initSnapline=()=>{const t=this.context.canvas.getLayer("transient");this.horizontalLine||(this.horizontalLine=t.appendChild(new s.x1({style:Object.assign(Object.assign({},Aa),this.options.horizontalLineStyle)}))),this.verticalLine||(this.verticalLine=t.appendChild(new s.x1({style:Object.assign(Object.assign({},Aa),this.options.verticalLineStyle)})))},this.isHorizontalSticking=!1,this.isVerticalSticking=!1,this.enableStick=!0,this.autoSnapToLine=(t,e,n)=>Pa(this,void 0,void 0,(function*(){const{verticalX:i,horizontalY:s}=n,{tolerance:o}=this.options,{min:[r,a],max:[l,h],center:[c,d]}=e;let u=0,p=0;null!==i&&(La(l,i)<o&&(u=i-l),La(r,i)<o&&(u=i-r),La(c,i)<o&&(u=i-c),0!==u&&(this.isVerticalSticking=!0)),null!==s&&(La(h,s)<o&&(p=s-h),La(a,s)<o&&(p=s-a),La(d,s)<o&&(p=s-d),0!==p&&(this.isHorizontalSticking=!0)),0===u&&0===p||(yield this.context.graph.translateElementBy({[t]:[u,p]},!1))})),this.enableSnap=t=>{const{target:e}=t,n=.5;if(this.isHorizontalSticking||this.isVerticalSticking){const[i,s]=this.getDelta(t);if(this.isHorizontalSticking&&this.isVerticalSticking&&Math.abs(i)<=n&&Math.abs(s)<=n)return this.context.graph.translateElementBy({[e.id]:[-i,-s]},!1),!1;if(this.isHorizontalSticking&&Math.abs(s)<=n)return this.context.graph.translateElementBy({[e.id]:[0,-s]},!1),!1;if(this.isVerticalSticking&&Math.abs(i)<=n)return this.context.graph.translateElementBy({[e.id]:[-i,0]},!1),!1;this.isHorizontalSticking=!1,this.isVerticalSticking=!1,this.enableStick=!1,setTimeout((()=>{this.enableStick=!0}),200)}return this.enableStick},this.calcSnaplineMetadata=(t,e)=>{const{tolerance:n,shape:i}=this.options,{min:[s,o],max:[r,l],center:[h,c]}=e;let d=null,u=null,p=null,g=null,f=null,y=null;return this.getNodes().some((e=>{if((0,a.Z)(t.id,e.id))return!1;const m=ka(e,i).getRenderBounds(),{min:[v,b],max:[E,x],center:[w,O]}=m;return null===d&&(La(w,h)<n?d=w:La(v,s)<n||La(v,r)<n?d=v:(La(E,r)<n||La(E,s)<n)&&(d=E),null!==d&&(u=Math.min(b,o),p=Math.max(x,l))),null===g&&(La(O,c)<n?g=O:La(b,o)<n||La(b,l)<n?g=b:(La(x,l)<n||La(x,o)<n)&&(g=x),null!==g&&(f=Math.min(v,s),y=Math.max(E,r))),null!==d&&null!==g})),{verticalX:d,verticalMinY:u,verticalMaxY:p,horizontalY:g,horizontalMinX:f,horizontalMaxX:y}},this.onDragStart=()=>{this.initSnapline()},this.onDrag=t=>Pa(this,void 0,void 0,(function*(){const{target:e}=t;if(this.options.autoSnap){if(!this.enableSnap(t))return}const n=ka(e,this.options.shape).getRenderBounds(),i=this.calcSnaplineMetadata(e,n);this.hideSnapline(),null===i.verticalX&&null===i.horizontalY||this.updateSnapline(i),this.options.autoSnap&&(yield this.autoSnapToLine(e.id,n,i))})),this.onDragEnd=()=>{this.hideSnapline()},this.bindEvents()}getNodes(){var t;const{filter:e}=this.options,n=((null===(t=this.context.element)||void 0===t?void 0:t.getNodes())||[]).filter((t=>{var e,n;return n=t,"hidden"!==(0,rn.Z)(n,["style","visibility"])&&(null===(e=this.context.viewport)||void 0===e?void 0:e.isInViewport(t.getRenderBounds()))}));return e?n.filter((t=>e(t))):n}hideSnapline(){this.horizontalLine.style.visibility="hidden",this.verticalLine.style.visibility="hidden"}getLineWidth(t){const{lineWidth:e}=this.options[`${t}LineStyle`];return+(e||Aa.lineWidth||1)/this.context.graph.getZoom()}updateSnapline(t){const{verticalX:e,verticalMinY:n,verticalMaxY:i,horizontalY:s,horizontalMinX:o,horizontalMaxX:r}=t,[a,l]=this.context.canvas.getSize(),{offset:h}=this.options;null!==s?Object.assign(this.horizontalLine.style,{x1:h===1/0?0:o-h,y1:s,x2:h===1/0?a:r+h,y2:s,visibility:"visible",lineWidth:this.getLineWidth("horizontal")}):this.horizontalLine.style.visibility="hidden",null!==e?Object.assign(this.verticalLine.style,{x1:e,y1:h===1/0?0:n-h,x2:e,y2:h===1/0?l:i+h,visibility:"visible",lineWidth:this.getLineWidth("vertical")}):this.verticalLine.style.visibility="hidden"}getDelta(t){const e=this.context.graph.getZoom();return pe([t.dx,t.dy],e)}bindEvents(){return Pa(this,void 0,void 0,(function*(){const{graph:t}=this.context;t.on(E.DRAG_START,this.onDragStart),t.on(E.DRAG,this.onDrag),t.on(E.DRAG_END,this.onDragEnd)}))}unbindEvents(){const{graph:t}=this.context;t.off(E.DRAG_START,this.onDragStart),t.off(E.DRAG,this.onDrag),t.off(E.DRAG_END,this.onDragEnd)}destroyElements(){var t,e;null===(t=this.horizontalLine)||void 0===t||t.destroy(),null===(e=this.verticalLine)||void 0===e||e.destroy()}destroy(){this.destroyElements(),this.unbindEvents(),super.destroy()}}Ra.defaultOptions={tolerance:5,offset:20,autoSnap:!0,shape:"key",verticalLineStyle:{stroke:"#1783FF"},horizontalLineStyle:{stroke:"#1783FF"},filter:()=>!0};const La=(t,e)=>Math.abs(t-e),ka=(t,e)=>"function"==typeof e?e(t):t.getShape(e);var Na=n(5951),Ia=n(8126),ja=n(43629),Ba=n(33016);function za(t,e){var n={YYYY:t.getFullYear(),MM:t.getMonth()+1,DD:t.getDate(),HH:t.getHours(),mm:t.getMinutes(),ss:t.getSeconds()},i=e;return Object.keys(n).forEach((function(t){var e=n[t];i=i.replace(t,"YYYY"===t?"".concat(e):"".concat(e).padStart(2,"0"))})),i}var Fa=n(47537),_a=n(24979),Za=n(62191),$a=n(54015),Va=n(34819),Wa=n(75494),Ha=n(62059),Ya=function(t){function e(n){var i=t.call(this,(0,Ia.n)({},e.defaultOptions,n))||this;return i.hoverColor="#f5f5f5",i.selectedColor="#e6f7ff",i.background=i.appendChild(new s.UL({})),i.label=i.background.appendChild(new s.ZA({})),i}return(0,bt.ZT)(e,t),Object.defineProperty(e.prototype,"padding",{get:function(){return(0,Za.j)(this.style.padding)},enumerable:!1,configurable:!0}),e.prototype.renderLabel=function(){var t=this.style,e=t.label,n=t.value,i=(0,Ba.zs)(this.attributes,"label");(0,$a.Ys)(this.label).maybeAppend(".label",(function(){return(0,Wa.S)(e)})).attr("className","label").styles(i),this.label.attr("__data__",n)},e.prototype.renderBackground=function(){var t=this.label.getBBox(),e=(0,bt.CR)(this.padding,4),n=e[0],i=e[1],s=e[2],o=e[3],r=t.width,a=t.height,l=r+o+i,h=a+n+s,c=(0,Ba.zs)(this.attributes,"background"),d=this.style,u=d.width,p=void 0===u?0:u,g=d.height,f=void 0===g?0:g,y=d.selected;this.background.attr((0,bt.pi)((0,bt.pi)({},c),{width:Math.max(l,p),height:Math.max(h,f),fill:y?this.selectedColor:"#fff"})),this.label.attr({transform:"translate(".concat(o,", ").concat((h-a)/2,")")})},e.prototype.render=function(){this.renderLabel(),this.renderBackground()},e.prototype.bindEvents=function(){var t=this;this.addEventListener("pointerenter",(function(){t.style.selected||t.background.attr("fill",t.hoverColor)})),this.addEventListener("pointerleave",(function(){t.style.selected||t.background.attr("fill",t.style.backgroundFill)}));var e=this;this.addEventListener("click",(function(){var n=t.style,i=n.label,s=n.value,o=n.onClick;null==o||o(s,{label:i,value:s},e)}))},e.defaultOptions={style:{value:"",label:"",cursor:"pointer"}},e}(Na.w),Ga=function(t){function e(n){var i,o,r=t.call(this,(0,Ia.n)({},e.defaultOptions,n))||this;r.currentValue=null===(i=e.defaultOptions.style)||void 0===i?void 0:i.defaultValue,r.isPointerInSelect=!1,r.select=r.appendChild(new s.UL({className:"select",style:{cursor:"pointer",width:0,height:0}})),r.dropdown=r.appendChild(new s.UL({className:"dropdown"}));var a=r.style.defaultValue;return a&&(null===(o=r.style.options)||void 0===o?void 0:o.some((function(t){return t.value===a})))&&(r.currentValue=a),r}return(0,bt.ZT)(e,t),e.prototype.setValue=function(t){this.currentValue=t,this.render()},e.prototype.getValue=function(){return this.currentValue},Object.defineProperty(e.prototype,"dropdownPadding",{get:function(){return(0,Za.j)(this.style.dropdownPadding)},enumerable:!1,configurable:!0}),e.prototype.renderSelect=function(){var t,e=this,n=this.style,i=n.x,s=n.y,o=n.width,r=n.height,a=n.bordered,l=n.showDropdownIcon,h=(0,Ba.zs)(this.attributes,"select"),c=(0,Ba.zs)(this.attributes,"placeholder");this.select.attr((0,bt.pi)((0,bt.pi)({x:i,y:s,width:o,height:r},h),{fill:"#fff",strokeWidth:a?1:0}));var d=this.dropdownPadding;l&&(0,$a.Ys)(this.select).maybeAppend(".dropdown-icon","path").style("d","M-5,-3.5 L0,3.5 L5,-3.5").style("transform","translate(".concat(i+o-10-d[1]-d[3],", ").concat(s+r/2,")")).style("lineWidth",1).style("stroke",this.select.style.stroke);var u=null===(t=this.style.options)||void 0===t?void 0:t.find((function(t){return t.value===e.currentValue})),p=(0,bt.pi)({x:i+d[3]},c);(0,$a.Ys)(this.select).selectAll(".placeholder").data(u?[]:[1]).join((function(t){return t.append("text").attr("className","placeholder").styles(p).style("y",(function(){var t=this.getBBox();return s+(r-t.height)/2}))}),(function(t){return t.styles(p)}),(function(t){return t.remove()}));var g=(0,Ba.zs)(this.attributes,"optionLabel"),f=(0,bt.pi)({x:i+d[3]},g);(0,$a.Ys)(this.select).selectAll(".value").data(u?[u]:[]).join((function(t){return t.append((function(t){return(0,Wa.S)(t.label)})).attr("className","value").styles(f).style("y",(function(){var t=this.getBBox();return s+(r-t.height)/2}))}),(function(t){return t.styles(f)}),(function(t){return t.remove()}))},e.prototype.renderDropdown=function(){var t,e,n=this,i=this.style,o=i.x,r=i.y,a=i.width,l=i.height,h=i.options,c=i.onSelect,d=i.open,u=(0,Ba.zs)(this.attributes,"dropdown"),p=(0,Ba.zs)(this.attributes,"option"),g=this.dropdownPadding;(0,$a.Ys)(this.dropdown).maybeAppend(".dropdown-container","g").attr("className","dropdown-container").selectAll(".dropdown-item").data(h,(function(t){return t.value})).join((function(t){return t.append((function(t){return new Ya({className:"dropdown-item",style:(0,bt.pi)((0,bt.pi)((0,bt.pi)({},t),p),{width:a-g[1]-g[3],selected:t.value===n.currentValue,onClick:function(t,e,i){n.setValue(t),null==c||c(t,e,i),n.dispatchEvent(new s.Aw("change",{detail:{value:t,option:e,item:i}})),(0,Ha.Cp)(n.dropdown)}})})})).each((function(t,e){var n,i=(null===(n=this.parentNode)||void 0===n?void 0:n.children).reduce((function(t,n,i){return i<e&&(t+=n.getBBox().height),t}),0);this.attr("transform","translate(".concat(g[3],", ").concat(g[0]+i,")"))}))}),(function(t){return t.update((function(t){return{selected:t.value===n.currentValue}}))}),(function(t){return t.remove()}));var f=null===(e=null===(t=this.dropdown.getElementsByClassName("dropdown-container"))||void 0===t?void 0:t[0])||void 0===e?void 0:e.getBBox(),y=u.spacing;this.dropdown.attr((0,bt.pi)({transform:"translate(".concat(o,", ").concat(r+l+y,")"),width:f.width+g[1]+g[3],height:f.height+g[0]+g[2]},u)),!d&&(0,Ha.Cp)(this.dropdown)},e.prototype.render=function(){this.renderSelect(),this.renderDropdown()},e.prototype.bindEvents=function(){var t=this;this.addEventListener("click",(function(t){t.stopPropagation()})),this.select.addEventListener("click",(function(){"visible"===t.dropdown.style.visibility?(0,Ha.Cp)(t.dropdown):(0,Ha.$Z)(t.dropdown)})),this.addEventListener("pointerenter",(function(){t.isPointerInSelect=!0})),this.addEventListener("pointerleave",(function(){t.isPointerInSelect=!1})),null===document||void 0===document||document.addEventListener("click",(function(){t.isPointerInSelect||(0,Ha.Cp)(t.dropdown)}))},e.defaultOptions={style:{x:0,y:0,width:140,height:32,options:[],bordered:!0,defaultValue:"",selectRadius:8,selectStroke:"#d9d9d9",showDropdownIcon:!0,placeholderText:"",placeholderFontSize:12,placeholderTextBaseline:"top",placeholderFill:"#c2c2c2",dropdownFill:"#fff",dropdownStroke:"#d9d9d9",dropdownRadius:8,dropdownShadowBlur:4,dropdownShadowColor:"rgba(0, 0, 0, 0.08)",dropdownPadding:8,dropdownSpacing:10,optionPadding:[8,12],optionFontSize:12,optionTextBaseline:"top",optionBackgroundFill:"#fff",optionBackgroundRadius:4,optionLabelFontSize:12,optionLabelTextBaseline:"top"}},e}(Na.w),Ua=function(t){function e(n){var i=t.call(this,(0,Ia.n)({},{style:{backgroundOpacity:e.backgroundOpacities.default}},e.defaultOptions,n))||this;return i.showBackground=!0,i.background=i.appendChild(new s.UL({})),i.icon=i.appendChild(new s.ZA({})),i}return(0,bt.ZT)(e,t),Object.defineProperty(e.prototype,"label",{get:function(){return"BaseIcon"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lineWidth",{get:function(){return Math.log10(this.attributes.size)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"padding",{get:function(){return(0,Za.j)(this.attributes.size/5)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"iconSize",{get:function(){var t=this.attributes.size,e=(0,bt.CR)(this.padding,4),n=e[0],i=e[1],s=e[2],o=e[3];return Math.max(t-Math.max(o+i,n+s),2*this.lineWidth+1)},enumerable:!1,configurable:!0}),e.prototype.renderBackground=function(){var t=this.attributes,e=t.x,n=t.y,i=t.size,s=i/2,o=(0,Ba.zs)(this.attributes,"background");this.background.attr((0,bt.pi)({x:e-s,y:n-s,width:i,height:i},o))},e.prototype.showIndicator=function(){if(this.label){var t=this.attributes.size,e=this.background.getBBox(),n=e.x,i=e.y;this.indicator.update({x:n+t/2,y:i-5,labelText:this.label,visibility:"visible"})}},e.prototype.hideIndicator=function(){this.indicator.update({visibility:"hidden"})},e.prototype.connectedCallback=function(){var e;t.prototype.connectedCallback.call(this);var n=this.attributes.size,i=this.background.getBBox(),s=i.x,o=i.y,r=null===(e=this.ownerDocument)||void 0===e?void 0:e.defaultView;r&&(this.indicator=r.appendChild(new Va.z({style:{x:s+n/2,y:o-n/2,visibility:"hidden",position:"top",radius:3,zIndex:100}})))},e.prototype.disconnectedCallback=function(){this.indicator.destroy()},e.prototype.render=function(){this.renderIcon(),this.showBackground&&this.renderBackground()},e.prototype.bindEvents=function(){var t=this,n=this.attributes.onClick;if(this.addEventListener("click",(function(){null==n||n(t)})),this.showBackground){var i=function(){return t.background.attr({opacity:e.backgroundOpacities.default})};this.addEventListener("pointerenter",(function(){t.background.attr({opacity:e.backgroundOpacities.hover}),t.showIndicator()})),this.addEventListener("pointerleave",(function(){i(),t.hideIndicator()})),this.addEventListener("pointerdown",(function(){t.background.attr({opacity:e.backgroundOpacities.active})})),this.addEventListener("pointerup",(function(){i()}))}},e.tag="IconBase",e.defaultOptions={style:{x:0,y:0,size:10,color:"#565758",backgroundRadius:4,backgroundFill:"#e2e2e2"}},e.backgroundOpacities={default:0,hover:.8,active:1},e}(Na.w),Ka=function(t,e){return void 0===e&&(e="#565758"),new s.y$({style:{fill:e,d:"M ".concat(t,",").concat(t," L -").concat(t,",0 L ").concat(t,",-").concat(t," Z"),transformOrigin:"center"}})},Xa=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,bt.ZT)(e,t),e.prototype.arcPath=function(t,e,n){var i=(0,bt.CR)([n,n],2),s=i[0],o=i[1],r=function(i){return[t+n*Math.cos(i),e+n*Math.sin(i)]},a=(0,bt.CR)(r(-5/4*Math.PI),2),l=a[0],h=a[1],c=(0,bt.CR)(r(1/4*Math.PI),2),d=c[0],u=c[1];return"M".concat(l,",").concat(h,",A").concat(s,",").concat(o,",0,1,1,").concat(d,",").concat(u)},Object.defineProperty(e.prototype,"label",{get:function(){return""},enumerable:!1,configurable:!0}),e.prototype.renderIcon=function(){var t=this.attributes,e=t.x,n=t.y,i=t.color,s=this.iconSize,o=this.lineWidth,r=o+.5;(0,$a.Ys)(this.icon).maybeAppend(".reset","path").styles({stroke:i,lineWidth:o,d:this.arcPath(e,n,s/2-o),markerStart:Ka(r,i)})},e}(Ua),qa=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,bt.ZT)(e,t),Object.defineProperty(e.prototype,"label",{get:function(){return""},enumerable:!1,configurable:!0}),e.prototype.renderIcon=function(){var t=this.attributes,e=t.x,n=t.y,i=t.color,s=this.iconSize,o=s/2,r=s/2/Math.pow(3,.5),a=[[e,n],[e,n-r],[e-o,n],[e,n+r],[e,n],[e+o,n-r],[e+o,n+r],[e,n]];(0,$a.Ys)(this.icon).maybeAppend(".backward","polygon").styles({points:a,fill:i})},e}(Ua),Ja=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,bt.ZT)(e,t),Object.defineProperty(e.prototype,"label",{get:function(){return""},enumerable:!1,configurable:!0}),e.prototype.renderIcon=function(){var t=this.attributes,e=t.x,n=t.y,i=t.color,s=this.iconSize,o=s/2,r=s/2/Math.pow(3,.5),a=[[e,n],[e,n-r],[e+o,n],[e,n+r],[e,n],[e-o,n-r],[e-o,n+r],[e,n]];(0,$a.Ys)(this.icon).maybeAppend(".forward","polygon").styles({points:a,fill:i})},e}(Ua),Qa=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,bt.ZT)(e,t),Object.defineProperty(e.prototype,"label",{get:function(){return""},enumerable:!1,configurable:!0}),e.prototype.renderIcon=function(){var t=this.attributes,e=t.x,n=t.y,i=t.color,s=this.iconSize,o=s/3*Math.pow(3,.5)*.8,r=[[e+o,n],[e-o/2,n-s/2*.8],[e-o/2,n+s/2*.8],[e+o,n]];(0,$a.Ys)(this.icon).maybeAppend(".play","polygon").styles({points:r,fill:i})},e}(Ua),tl=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,bt.ZT)(e,t),Object.defineProperty(e.prototype,"label",{get:function(){return""},enumerable:!1,configurable:!0}),e.prototype.renderIcon=function(){var t=this.attributes,e=t.x,n=t.y,i=t.color,s=this.iconSize,o=s/3,r=[[e-o,n-s/2],[e-o,n+s/2],[e-o/2,n+s/2],[e-o/2,n-s/2],[e-o,n-s/2],[e+o/2,n-s/2],[e+o/2,n+s/2],[e+o,n+s/2],[e+o,n-s/2]];(0,$a.Ys)(this.icon).maybeAppend(".pause","polygon").styles({points:r,fill:i})},e}(Ua),el=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,bt.ZT)(e,t),Object.defineProperty(e.prototype,"label",{get:function(){return""},enumerable:!1,configurable:!0}),e.prototype.renderIcon=function(){var t=this.attributes,e=t.x,n=t.y,i=t.color,s=this.iconSize,o=this.lineWidth,r=o;(0,$a.Ys)(this.icon).maybeAppend(".left-line","line").styles({x1:e-s/2,y1:n-s/2,x2:e-s/2,y2:n+s/2,stroke:i,lineWidth:o}),(0,$a.Ys)(this.icon).maybeAppend(".right-line","line").styles({x1:e+s/2,y1:n-s/2,x2:e+s/2,y2:n+s/2,stroke:i,lineWidth:o}),(0,$a.Ys)(this.icon).maybeAppend(".left-arrow","line").styles({x1:e,y1:n,x2:e-s/2+2*r,y2:n,stroke:i,lineWidth:o,markerEnd:Ka(2*o,i)}),(0,$a.Ys)(this.icon).maybeAppend(".right-arrow","line").styles({x1:e,y1:n,x2:e+s/2-2*r,y2:n,stroke:i,lineWidth:o,markerEnd:Ka(2*o,i)})},e}(Ua),nl=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,bt.ZT)(e,t),Object.defineProperty(e.prototype,"label",{get:function(){return""},enumerable:!1,configurable:!0}),e.prototype.renderIcon=function(){var t=this.attributes,e=t.x,n=t.y,i=t.color,s=this.iconSize,o=this.lineWidth;(0,$a.Ys)(this.icon).maybeAppend(".line","line").styles({x1:e,y1:n-s/2,x2:e,y2:n+s/2,stroke:i,lineWidth:o});var r=o;(0,$a.Ys)(this.icon).maybeAppend(".left-arrow","line").styles({x1:e-s/2-2*r,y1:n,x2:e-2*r,y2:n,stroke:i,lineWidth:o,markerEnd:Ka(2*o,i)}),(0,$a.Ys)(this.icon).maybeAppend(".right-arrow","line").styles({x1:e+s/2+2*r,y1:n,x2:e+2*r,y2:n,stroke:i,lineWidth:o,markerEnd:Ka(2*o,i)})},e}(Ua),il=function(t){return[[-t/2,-t/2],[-t/2,t/2],[t/2,t/2]]},sl=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,bt.ZT)(e,t),Object.defineProperty(e.prototype,"label",{get:function(){return""},enumerable:!1,configurable:!0}),e.prototype.renderIcon=function(){var t=this.attributes,e=t.x,n=t.y,i=t.color,s=this.iconSize,o=this.lineWidth,r=o,a=(s-2*r-o)/4,l=(s-2*r-o)/2,h=(0,bt.CR)([e-s/2+r,n+s/2-2*r],2),c=h[0],d=h[1];(0,$a.Ys)(this.icon).maybeAppend(".coordinate","polyline").styles({points:il(s).map((function(t){var i=(0,bt.CR)(t,2),s=i[0],o=i[1];return[s+e,o+n]})),stroke:i,lineWidth:o}),(0,$a.Ys)(this.icon).maybeAppend(".line","polyline").styles({points:[[c,d],[c+a,d-l],[c+2*a,d],[c+4*a,d-2*l]],stroke:i,lineWidth:o})},e}(Ua),ol=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,bt.ZT)(e,t),Object.defineProperty(e.prototype,"label",{get:function(){return""},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){return[1,4,2,4,3]},enumerable:!1,configurable:!0}),e.prototype.renderIcon=function(){var t=this.data,e=this.attributes,n=e.x,i=e.y,s=e.color,o=this.iconSize,r=this.lineWidth,a=r,l=(o-a)/t.length,h=(o-2*a)/4,c=(0,bt.CR)([n-o/2+2*a,i+o/2-a],2),d=c[0],u=c[1];(0,$a.Ys)(this.icon).maybeAppend(".coordinate","polyline").styles({points:il(o).map((function(t){var e=(0,bt.CR)(t,2),s=e[0],o=e[1];return[s+n,o+i]})),stroke:s,lineWidth:r}),(0,$a.Ys)(this.icon).maybeAppend(".bars","g").selectAll(".column").data(this.data.map((function(t,e){return{value:t,index:e}}))).join((function(t){return t.append("line").attr("className","column").style("x1",(function(t){var e=t.index;return d+l*e})).style("y1",u).style("x2",(function(t){var e=t.index;return d+l*e})).style("y2",(function(t){var e=t.value;return u-h*e})).styles({y1:u,stroke:s,lineWidth:r})}))},e}(Ua),rl=function(t){function e(e){var n=t.call(this,(0,Ia.n)({},{style:{color:"#d8d9d9"}},e))||this;return n.showBackground=!1,n}return(0,bt.ZT)(e,t),e.prototype.renderIcon=function(){var t=this.attributes,e=t.x,n=t.y,i=t.color,s=this.iconSize,o=this.lineWidth;(0,$a.Ys)(this.icon).maybeAppend(".split","line").styles({x1:e,y1:n-s/2,x2:e,y2:n+s/2,stroke:i,lineWidth:o})},e}(Ua),al=function(t){function e(){var e=t.apply(this,(0,bt.ev)([],(0,bt.CR)(arguments),!1))||this;return e.showBackground=!1,e}return(0,bt.ZT)(e,t),Object.defineProperty(e.prototype,"padding",{get:function(){return(0,Za.j)(0)},enumerable:!1,configurable:!0}),e.prototype.renderIcon=function(){var t=this.iconSize,e=this.attributes,n=e.x,i=e.y,s=e.speed,o=void 0===s?1:s,r=(0,Co.Z)(this.attributes,["x","y","transform","transformOrigin","width","height","size","color","speed"]),a=(0,to.Z)(t,20,1/0),l=(0,bt.pi)((0,bt.pi)({},r),{x:n-a/2,y:i-10,width:a,height:20,defaultValue:o,bordered:!1,showDropdownIcon:!1,selectRadius:2,dropdownPadding:this.padding,dropdownRadius:2,dropdownSpacing:t/5,placeholderFontSize:t/2,optionPadding:0,optionLabelFontSize:t/2,optionBackgroundRadius:1,options:[{label:"1x",value:1},{label:"1.5x",value:1.5},{label:"2x",value:2}]});(0,$a.Ys)(this.icon).maybeAppend(".speed",(function(){return new Ga({style:l})})).attr("className","speed").each((function(){this.update(l)}))},e.tag="SpeedSelect",e}(Ua),ll=function(t){function e(e){var n=t.call(this,e)||this;return n.icon=n.appendChild(new s.ZA({})),n.currentType=n.attributes.type,n}return(0,bt.ZT)(e,t),e.prototype.getType=function(){return this.currentType},e.prototype.render=function(){var t=this,e=this.attributes,n=(e.onChange,(0,bt._T)(e,["onChange"]));(0,$a.Ys)(this.icon).selectAll(".icon").data([this.currentType]).join((function(e){return e.append((function(e){var n,i=null===(n=t.toggles.find((function(t){return(0,bt.CR)(t,1)[0]===e})))||void 0===n?void 0:n[1];if(!i)throw new Error("Invalid type: ".concat(e));return new i({})})).attr("className","icon").styles(n,!1).update({})}),(function(t){return t.styles({restStyles:n}).update({})}),(function(t){return t.remove()}))},e.prototype.bindEvents=function(){var t=this,e=this.attributes.onChange;this.addEventListener("click",(function(n){n.preventDefault(),n.stopPropagation();var i=(t.toggles.findIndex((function(e){return(0,bt.CR)(e,1)[0]===t.currentType}))+1)%t.toggles.length,s=t.toggles[i][0];null==e||e(t.currentType),t.currentType=s,t.render()}))},e.tag="ToggleIcon",e}(Na.w),hl=function(t){function e(e){var n=t.call(this,(0,Ia.n)({},{style:{type:"play"}},e))||this;return n.toggles=[["play",Qa],["pause",tl]],n}return(0,bt.ZT)(e,t),e}(ll),cl=function(t){function e(e){var n=t.call(this,(0,Ia.n)({},{style:{type:"range"}},e))||this;return n.toggles=[["range",el],["value",nl]],n}return(0,bt.ZT)(e,t),e}(ll),dl=function(t){function e(e){var n=t.call(this,(0,Ia.n)({},{style:{type:"column"}},e))||this;return n.toggles=[["line",sl],["column",ol]],n}return(0,bt.ZT)(e,t),e}(ll),ul={reset:Xa,speed:al,backward:qa,playPause:hl,forward:Ja,selectionType:cl,chartType:dl,split:rl},pl=function(t){function e(n){var i=t.call(this,(0,Ia.n)({},e.defaultOptions,n))||this;return i.background=i.appendChild(new s.UL({})),i.functions=i.appendChild(new s.ZA({})),i}return(0,bt.ZT)(e,t),Object.defineProperty(e.prototype,"padding",{get:function(){return(0,Za.j)(this.attributes.padding)},enumerable:!1,configurable:!0}),e.prototype.renderBackground=function(){var t=this.style,e=t.x,n=t.y,i=t.width,s=t.height,o=(0,Ba.zs)(this.attributes,"background");this.background.attr((0,bt.pi)({x:e,y:n,width:i,height:s},o))},e.prototype.renderFunctions=function(){var t,e=this,n=this.attributes,i=n.functions,s=n.iconSize,o=n.iconSpacing,r=n.x,a=n.y,l=n.width,h=n.height,c=n.align,d=(0,bt.CR)(this.padding,4),u=d[1],p=d[3],g=i.reduce((function(t,e){return t.length&&e.length?t.concat.apply(t,(0,bt.ev)(["split"],(0,bt.CR)(e),!1)):t.concat.apply(t,(0,bt.ev)([],(0,bt.CR)(e),!1))}),[]),f=g.length*(s+o)-o,y={left:p+s/2,center:(l-f)/2+s/2,right:l-f-p-u+s/2}[c]||0;null===(t=this.speedSelect)||void 0===t||t.destroy(),this.functions.removeChildren(),g.forEach((function(t,n){var i,l=ul[t],c={x:r+n*(s+o)+y,y:a+h/2,size:s};if(l===al?(c.speed=e.attributes.speed,c.onSelect=function(n){return e.handleFunctionChange(t,{value:n})}):[hl,cl,dl].includes(l)?(c.onChange=function(n){return e.handleFunctionChange(t,{value:n})},l===hl&&(c.type="play"===e.attributes.state?"pause":"play"),l===cl&&(c.type="range"===e.attributes.selectionType?"value":"range"),l===dl&&(c.type="line"===e.attributes.chartType?"column":"line")):c.onClick=function(){return e.handleFunctionChange(t,{value:t})},l===al){var d=null===(i=e.ownerDocument)||void 0===i?void 0:i.defaultView;d&&(e.speedSelect=new l({style:(0,bt.pi)((0,bt.pi)({},c),{zIndex:100})}),d.appendChild(e.speedSelect))}else e.functions.appendChild(new l({style:c}))}))},e.prototype.disconnectedCallback=function(){var e;t.prototype.disconnectedCallback.call(this),null===(e=this.speedSelect)||void 0===e||e.destroy()},e.prototype.render=function(){this.renderBackground(),this.renderFunctions()},e.prototype.handleFunctionChange=function(t,e){var n=this.attributes.onChange;null==n||n(t,e)},e.defaultOptions={style:{x:0,y:0,width:300,height:40,padding:0,align:"center",iconSize:25,iconSpacing:0,speed:1,state:"pause",chartType:"line",selectionType:"range",backgroundFill:"#fbfdff",backgroundStroke:"#ebedf0",functions:[["reset","speed"],["backward","playPause","forward"],["selectionType","chartType"]]}},e}(Na.w),gl=function(t){function e(n){var i=t.call(this,(0,Ia.n)({},e.defaultOptions,n))||this;return i.bindEvents(),i}return(0,bt.ZT)(e,t),e.prototype.bindEvents=function(){var t=this;this.addEventListener("mouseenter",(function(){t.attr("lineWidth",Math.ceil(+(t.style.r||0)/2))})),this.addEventListener("mouseleave",(function(){t.attr("lineWidth",0)}))},e.defaultOptions={style:{r:5,fill:"#3f7cf7",lineWidth:0,stroke:"#3f7cf7",strokeOpacity:.5,cursor:"pointer"}},e}(s.Cd),fl=function(t){function e(n){return t.call(this,(0,Ia.n)({},e.defaultOptions,n))||this}return(0,bt.ZT)(e,t),e.prototype.renderBackground=function(){var t=this.attributes,e=t.x,n=t.y,i=t.width,s=t.height,o=(0,Ba.zs)(this.attributes,"background");(0,$a.Ys)(this).maybeAppend("background","rect").attr("className","background").styles((0,bt.pi)({x:e-i/2,y:n-s/2,width:i,height:s},o))},e.prototype.renderIcon=function(){var t=this.attributes,e=t.x,n=t.y,i=t.iconSize,s=(0,Ba.zs)(this.attributes,"icon"),o=i/2;(0,$a.Ys)(this).maybeAppend("icon-left-line","line").attr("className","icon-left-line").styles((0,bt.pi)({x1:e-1,y1:n-o,x2:e-1,y2:n+o},s)),(0,$a.Ys)(this).maybeAppend("icon-right-line","line").attr("className","icon-right-line").styles((0,bt.pi)({x1:e+1,y1:n-o,x2:e+1,y2:n+o},s))},e.prototype.renderBorder=function(){var t=this.attributes,e=t.x,n=t.y,i=t.width,s=t.height,o=t.type,r=(0,Ba.zs)(this.attributes,"border"),a="start"===o?+i/2:-i/2;(0,$a.Ys)(this).maybeAppend("border","line").attr("className","border").styles((0,bt.pi)({x1:a+e,y1:n-s/2,x2:a+e,y2:n+s/2},r))},e.prototype.render=function(){this.renderBackground(),this.renderIcon(),this.renderBorder()},e.defaultOptions={style:{x:0,y:0,width:10,height:50,iconSize:10,type:"start",backgroundFill:"#fff",backgroundFillOpacity:.5,iconStroke:"#9a9a9a",iconLineWidth:1,borderStroke:"#e8e8e8",borderLineWidth:1}},e}(Na.w);function yl(t,e){return"number"==typeof t?ml(t):function(t,e){var n=new Date(t);switch(e){case"half-hour":case"hour":case"four-hour":return[0,6,12,18].includes(n.getHours())&&0===n.getMinutes()?za(n,"HH:mm\nYYYY-MM-DD"):za(n,"HH:mm");case"half-day":return n.getHours()<12?"AM\n".concat(za(n,"YYYY-MM-DD")):"PM";case"day":return[1,10,20].includes(n.getDate())?za(n,"DD\nYYYY-MM"):za(n,"DD");case"week":return n.getDate()<=7?za(n,"DD\nYYYY-MM"):za(n,"DD");case"month":return[0,6].includes(n.getMonth())?za(n,"MM\nYYYY"):za(n,"MM");case"season":return[0].includes(n.getMonth())?za(n,"MM\nYYYY"):za(n,"MM");case"year":return za(n,"YYYY");default:return za(n,"YYYY-MM-DD HH:mm")}}(t,e)}function ml(t){var e=String(Math.floor(t/3600)).padStart(2,"0"),n=String(Math.floor(t%3600/60)).padStart(2,"0"),i=String(Math.floor(t%60)).padStart(2,"0");return t<3600?"".concat(n,":").concat(i):"".concat(e,":").concat(n,":").concat(i)}var vl=function(t){function e(n){var i=t.call(this,(0,Ia.n)({},e.defaultOptions,n))||this;i.axis=i.appendChild(new Fa.R({style:{type:"linear",startPos:[0,0],endPos:[0,0],data:[],showArrow:!1,animate:!1}})),i.timeline=i.appendChild(new _a.i({style:{onChange:function(t){i.handleSliderChange(t)}}})),i.controller=i.appendChild(new pl({})),i.states={},i.handleSliderChange=function(t){var e,n=(e=i.states.values,Array.isArray(e)?(0,bt.ev)([],(0,bt.CR)(e),!1):e);i.setBySliderValues(t),i.dispatchOnChange(n)};var s=i.attributes,o=s.selectionType,r=s.chartType,a=s.speed,l=s.state,h=s.playMode,c=s.values;return i.states={chartType:r,playMode:h,selectionType:o,speed:a,state:l},i.setByTimebarValues(c),i}return(0,bt.ZT)(e,t),Object.defineProperty(e.prototype,"data",{get:function(){return this.attributes.data.sort((function(t,e){return t.time<e.time?-1:t.time>e.time?1:0}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"space",{get:function(){var t,e=this.attributes,n=e.x,i=e.y,s=e.width,o=e.height,r=e.type,a=e.controllerHeight,l=(0,to.Z)(+o-a,0,+o),h=new ja.b(n,i+ +o-a,+s,a),c=0;"chart"===r?(c=35,t=new ja.b(n,i+l-c,+s,c)):t=new ja.b;var d="time"===r?10:l;return{axisBBox:t,controllerBBox:h,timelineBBox:new ja.b(n,i+("time"===r?l:l-d),+s,d-c)}},enumerable:!1,configurable:!0}),e.prototype.setBySliderValues=function(t){var e,n,i=this.data,s=(0,bt.CR)(Array.isArray(t)?t:[0,t],2),o=s[0],r=s[1],a=i.length,l=i[Math.floor(o*a)],h=i[Math.ceil(r*a)-(Array.isArray(t)?0:1)];this.states.values=[null!==(e=null==l?void 0:l.time)&&void 0!==e?e:i[0].time,null!==(n=null==h?void 0:h.time)&&void 0!==n?n:1/0]},e.prototype.setByTimebarValues=function(t){var e,n,i,s=this.data,o=(0,bt.CR)(Array.isArray(t)?t:[void 0,t],2),r=o[0],a=o[1],l=s.find((function(t){return t.time===r})),h=s.find((function(t){return t.time===a}));this.states.values=[null!==(e=null==l?void 0:l.time)&&void 0!==e?e:null===(n=s[0])||void 0===n?void 0:n.time,null!==(i=null==h?void 0:h.time)&&void 0!==i?i:1/0]},e.prototype.setByIndex=function(t){var e,n,i,s,o=this.data,r=(0,bt.CR)(t,2),a=r[0],l=r[1];this.states.values=[null!==(n=null===(e=o[a])||void 0===e?void 0:e.time)&&void 0!==n?n:o[0].time,null!==(s=null===(i=this.data[l])||void 0===i?void 0:i.time)&&void 0!==s?s:1/0]},Object.defineProperty(e.prototype,"sliderValues",{get:function(){var t,e=this.states,n=e.values,i=e.selectionType,s=(0,bt.CR)(Array.isArray(n)?n:[void 0,n],2),o=s[0],r=s[1],a=this.data,l=a.length,h="value"===i;return[(t=a.findIndex((function(t){return t.time===o})),h?0:t>-1?t/l:0),function(){if(r===1/0)return 1;var t=a.findIndex((function(t){return t.time===r}));return t>-1?t/l:h?.5:1}()]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"values",{get:function(){var t=this.states,e=t.values,n=t.selectionType,i=(0,bt.CR)(Array.isArray(e)?e:[this.data[0].time,e],2),s=i[0],o=i[1];return"value"===n?o:[s,o]},enumerable:!1,configurable:!0}),e.prototype.getDatumByRatio=function(t){var e=this.data,n=e.length;return e[Math.floor(t*(n-1))]},Object.defineProperty(e.prototype,"chartHandleIconShape",{get:function(){var t=this.states.selectionType,e=this.space.timelineBBox.height;return"range"===t?function(t){return new fl({style:{type:t,height:e,iconSize:e/6}})}:function(){return new s.x1({style:{x1:0,y1:-e/2,x2:0,y2:e/2,lineWidth:2,stroke:"#c8c8c8"}})}},enumerable:!1,configurable:!0}),e.prototype.getChartStyle=function(t){var e=this,n=t.x,i=t.y,s=t.width,o=t.height,r=this.states,a=r.selectionType,l=r.chartType,h=this.data,c=this.attributes,d=c.type,u=c.labelFormatter,p=(0,Ba.zs)(this.attributes,"chart"),g=(p.type,(0,bt._T)(p,["type"])),f="range"===a;if("time"===d)return(0,bt.pi)({handleIconShape:function(){return new gl({})},selectionFill:"#2e7ff8",selectionFillOpacity:1,showLabelOnInteraction:!0,handleLabelDy:f?-15:0,autoFitLabel:f,handleSpacing:f?-15:0,trackFill:"#edeeef",trackLength:s,trackOpacity:.5,trackRadius:o/2,trackSize:o/2,type:a,values:this.sliderValues,formatter:function(t){if(u)return u(t);var n=e.getDatumByRatio(t).time;return"number"==typeof n?ml(n):za(n,"YYYY-MM-DD HH:mm:ss")},transform:"translate(".concat(n,", ").concat(i,")"),zIndex:1},g);var y="range"===a?5:0,m=h.map((function(t){return t.value}));return(0,bt.pi)({handleIconOffset:y,handleIconShape:this.chartHandleIconShape,selectionFill:"#fff",selectionFillOpacity:.5,selectionType:"invert",sparklineSpacing:.1,sparklineColumnLineWidth:0,sparklineColor:"#d4e5fd",sparklineAreaOpacity:1,sparklineAreaLineWidth:0,sparklineData:m,sparklineType:l,sparklineScale:.8,trackLength:s,trackSize:o,type:a,values:this.sliderValues,transform:"translate(".concat(n,", ").concat(i,")"),zIndex:1},g)},e.prototype.renderChart=function(t){void 0===t&&(t=this.space.timelineBBox),this.timeline.update(this.getChartStyle(t))},e.prototype.updateSelection=function(){this.timeline.setValues(this.sliderValues,!0),this.handleSliderChange(this.sliderValues)},e.prototype.getAxisStyle=function(t){var e=this.data,n=this.attributes,i=n.interval,s=n.labelFormatter,o=(0,Ba.zs)(this.attributes,"axis"),r=t.x,a=t.y,l=t.width,h=(0,bt.ev)((0,bt.ev)([],(0,bt.CR)(e),!1),[{time:0}],!1).map((function(t,e,n){var i=t.time;return{label:"".concat(i),value:e/(n.length-1),time:i}})),c=(0,bt.pi)({startPos:[r,a],endPos:[r+l,a],data:h,labelFilter:function(t,e){return e<h.length-1},labelFormatter:function(t){var e=t.time;return s?s(e):yl(e,i)}},o);return c},e.prototype.renderAxis=function(t){void 0===t&&(t=this.space.axisBBox),"chart"===this.attributes.type&&this.axis.update(this.getAxisStyle(t))},e.prototype.renderController=function(t){void 0===t&&(t=this.space.controllerBBox);var e=this.attributes.type,n=this.states,i=n.state,s=n.speed,o=n.selectionType,r=n.chartType,a=(0,Ba.zs)(this.attributes,"controller"),l=this,h=(0,bt.pi)((0,bt.pi)((0,bt.pi)({},t),{iconSize:20,speed:s,state:i,selectionType:o,chartType:r,onChange:function(t,e){var n=e.value;switch(t){case"reset":l.internalReset();break;case"speed":l.handleSpeedChange(n);break;case"backward":l.internalBackward();break;case"playPause":"play"===n?l.internalPlay():l.internalPause();break;case"forward":l.internalForward();break;case"selectionType":l.handleSelectionTypeChange(n);break;case"chartType":l.handleChartTypeChange(n)}}}),a);"time"===e&&(h.functions=[["reset","speed"],["backward","playPause","forward"],["selectionType"]]),this.controller.update(h)},e.prototype.dispatchOnChange=function(t){var e=this.data,n=this.attributes.onChange,i=this.states,s=i.values,o=i.selectionType,r=(0,bt.CR)(s,2),a=r[0],l=r[1],h=l===1/0?e.at(-1).time:l;t&&function(t,e){if(Array.isArray(t)){if(!Array.isArray(e))return!1;if(t[0]===e[0]){if(t[1]===e[1])return!0;if(t[1]===1/0||e[1]===1/0)return!0}return!1}return!Array.isArray(e)&&t===e}(t,"range"===o?[a,h]:h)||null==n||n("range"===o?[a,h]:h)},e.prototype.internalReset=function(t){var e,n,i=this.states.selectionType;this.internalPause(),this.setBySliderValues("range"===i?[0,1]:[0,0]),this.renderController(),this.updateSelection(),t||(null===(n=null===(e=this.attributes)||void 0===e?void 0:e.onReset)||void 0===n||n.call(e),this.dispatchOnChange())},e.prototype.reset=function(){this.internalReset()},e.prototype.moveSelection=function(t,e){var n=this.data,i=n.length,s=this.states,o=s.values,r=s.selectionType,a=s.playMode,l=(0,bt.CR)(o,2),h=l[0],c=l[1],d=n.findIndex((function(t){return t.time===h})),u=n.findIndex((function(t){return t.time===c}));-1===u&&(u=i);var p,g="backward"===t?-1:1;"range"===r?"acc"===a?(p=[d,u+g],-1===g&&d===u&&(p=[d,i])):p=[d+g,u+g]:p=[d,u+g];var f=function(t){var e=(0,bt.CR)(t.sort((function(t,e){return t-e})),2),n=e[0],s=e[1],o=function(t){return(0,to.Z)(t,0,i)};return s>i?"value"===r?[0,0]:"acc"===a?[o(n),o(n)]:[0,o(s-n)]:n<0?"acc"===a?[0,o(s)]:[o(n+i-s),i]:[o(n),o(s)]}(p);return this.setByIndex(f),this.updateSelection(),f},e.prototype.internalBackward=function(t){var e,n,i=this.moveSelection("backward",t);return t||(null===(n=null===(e=this.attributes)||void 0===e?void 0:e.onBackward)||void 0===n||n.call(e),this.dispatchOnChange()),i},e.prototype.backward=function(){this.internalBackward()},e.prototype.internalPlay=function(t){var e,n,i=this,s=this.data,o=this.attributes.loop,r=this.states.speed,a=void 0===r?1:r;this.playInterval=window.setInterval((function(){i.internalForward()[1]!==s.length||o||(i.internalPause(),i.renderController())}),1e3/a),this.states.state="play",!t&&(null===(n=null===(e=this.attributes)||void 0===e?void 0:e.onPlay)||void 0===n||n.call(e))},e.prototype.play=function(){this.internalPlay()},e.prototype.internalPause=function(t){var e,n;clearInterval(this.playInterval),this.states.state="pause",!t&&(null===(n=null===(e=this.attributes)||void 0===e?void 0:e.onPause)||void 0===n||n.call(e))},e.prototype.pause=function(){this.internalPause()},e.prototype.internalForward=function(t){var e,n,i=this.moveSelection("forward",t);return t||(null===(n=null===(e=this.attributes)||void 0===e?void 0:e.onForward)||void 0===n||n.call(e),this.dispatchOnChange()),i},e.prototype.forward=function(){this.internalForward()},e.prototype.handleSpeedChange=function(t){var e,n;this.states.speed=t,"play"===this.states.state&&(this.internalPause(!0),this.internalPlay(!0)),null===(n=null===(e=this.attributes)||void 0===e?void 0:e.onSpeedChange)||void 0===n||n.call(e,t)},e.prototype.handleSelectionTypeChange=function(t){var e,n;this.states.selectionType=t,this.renderChart(),null===(n=null===(e=this.attributes)||void 0===e?void 0:e.onSelectionTypeChange)||void 0===n||n.call(e,t)},e.prototype.handleChartTypeChange=function(t){var e,n;this.states.chartType=t,this.renderChart(),null===(n=null===(e=this.attributes)||void 0===e?void 0:e.onChartTypeChange)||void 0===n||n.call(e,t)},e.prototype.render=function(){var t=this.space,e=t.axisBBox,n=t.controllerBBox,i=t.timelineBBox;this.renderController(n),this.renderAxis(e),this.renderChart(i),"play"===this.states.state&&this.internalPlay()},e.prototype.destroy=function(){t.prototype.destroy.call(this),this.internalPause(!0)},e.defaultOptions={style:{x:0,y:0,axisLabelFill:"#6e6e6e",axisLabelTextAlign:"left",axisLabelTextBaseline:"top",axisLabelTransform:"translate(5, -12)",axisLineLineWidth:1,axisLineStroke:"#cacdd1",axisTickLength:15,axisTickLineWidth:1,axisTickStroke:"#cacdd1",chartShowLabel:!1,chartType:"line",controllerAlign:"center",controllerHeight:40,data:[],interval:"day",loop:!1,playMode:"acc",selectionType:"range",type:"time"}},e}(Na.w);var bl=function(t,e,n,i){return new(n||(n=Promise))((function(s,o){function r(t){try{l(i.next(t))}catch(t){o(t)}}function a(t){try{l(i.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,a)}l((i=i.apply(t,e||[])).next())}))},El=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(n[i[s]]=t[i[s]])}return n};const xl=["timestamp","time","date","datetime"];class wl extends Mo{get padding(){return J(this.options.padding)}constructor(t,e){super(t,Object.assign({},wl.defaultOptions,e)),this.backup(),this.upsertTimebar()}play(){var t;null===(t=this.timebar)||void 0===t||t.play()}pause(){var t;null===(t=this.timebar)||void 0===t||t.pause()}forward(){var t;null===(t=this.timebar)||void 0===t||t.forward()}backward(){var t;null===(t=this.timebar)||void 0===t||t.backward()}reset(){var t;null===(t=this.timebar)||void 0===t||t.reset()}update(t){super.update(t),this.backup(),this.upsertTimebar()}backup(){this.originalData=Ol(this.context.graph.getData())}upsertTimebar(){const{canvas:t}=this.context,e=this.options,{onChange:n,timebarType:i,data:s,x:o,y:r,width:a,height:l,mode:h}=e,c=El(e,["onChange","timebarType","data","x","y","width","height","mode"]),d=t.getSize(),[u]=this.padding;this.upsertCanvas().ready.then((()=>{var t;const e=Object.assign(Object.assign({x:d[0]/2-a/2,y:u,onChange:t=>{const e=((0,H.Z)(t)?t:[t,t]).map((t=>function(t){return t instanceof Date}(t)?t.getTime():t));"modify"===this.options.mode?this.filterElements(e):this.hiddenElements(e),null==n||n(e)}},c),{data:s.map((t=>(0,N.Z)(t)?{time:t,value:0}:t)),width:a,height:l,type:i});this.timebar?this.timebar.update(e):(this.timebar=new vl({style:e}),null===(t=this.canvas)||void 0===t||t.appendChild(this.timebar))}))}upsertCanvas(){if(this.canvas)return this.canvas;const{className:t,height:e,position:n}=this.options,i=this.context.canvas,[s]=i.getSize(),[o,,r]=this.padding,[a,l]=Oa({width:s,height:e+o+r,graphCanvas:i,className:"timebar",placement:n});return this.container=a,t&&a.classList.add(t),this.canvas=l,this.canvas}filterElements(t){return bl(this,void 0,void 0,(function*(){var e;if(!this.originalData)return;const{elementTypes:n,getTime:i}=this.options,{graph:s,element:o}=this.context,r=Ol(this.originalData);n.forEach((e=>{const n=`${e}s`;r[n]=(this.originalData[n]||[]).filter((e=>{const n=i(e);return!!Sl(n,t)}))}));const a=[...r.nodes,...r.combos].map((t=>Ht(t)));r.edges=r.edges.filter((t=>{const e=t.source,n=t.target;return a.includes(e)&&a.includes(n)})),s.setData(r),yield null===(e=o.draw({animation:!1,silence:!0}))||void 0===e?void 0:e.finished}))}hiddenElements(t){const{graph:e}=this.context,{elementTypes:n,getTime:i}=this.options,s=[],o=[];n.forEach((e=>{var n;const r=`${e}s`;((null===(n=this.originalData)||void 0===n?void 0:n[r])||[]).forEach((e=>{const n=Ht(e),r=i(e);Sl(r,t)?o.push(n):s.push(n)}))})),e.hideElement(s,!1),e.showElement(o,!1)}destroy(){var t,e,n;const{graph:i}=this.context;this.originalData&&i.setData(Object.assign({},this.originalData)),null===(t=this.timebar)||void 0===t||t.destroy(),null===(e=this.canvas)||void 0===e||e.destroy(),null===(n=this.container)||void 0===n||n.remove(),this.originalData=void 0,this.container=void 0,this.timebar=void 0,this.canvas=void 0,super.destroy()}}wl.defaultOptions={position:"bottom",enable:!0,timebarType:"time",className:"g6-timebar",width:450,height:60,zIndex:3,elementTypes:["node"],padding:10,mode:"modify",getTime:t=>Dl(t,xl,void 0),loop:!1};const Ol=t=>{const{nodes:e=[],edges:n=[],combos:i=[]}=t;return{nodes:[...e],edges:[...n],combos:[...i]}},Sl=(t,e)=>{if((0,N.Z)(e))return t===e;const[n,i]=e;return t>=n&&t<=i},Dl=(t,e,n)=>{var i;for(let n=0;n<e.length;n++){const s=e[n],o=null===(i=t.data)||void 0===i?void 0:i[s];if(o)return o}return n};var Cl=function(t,e,n,i){return new(n||(n=Promise))((function(s,o){function r(t){try{l(i.next(t))}catch(t){o(t)}}function a(t){try{l(i.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,a)}l((i=i.apply(t,e||[])).next())}))};class Ml extends Mo{constructor(t,e){super(t,Object.assign({},Ml.defaultOptions,e)),this.$element=To("toolbar",!1),this.onToolbarItemClick=t=>{const{onClick:e}=this.options;if(t.target instanceof Element&&t.target.className.includes("g6-toolbar-item")){const n=t.target.getAttribute("value");null==e||e(n,t.target)}};const n=this.context.canvas.getContainer();this.$element.style.display="flex",n.appendChild(this.$element),Po("g6-toolbar-css","style",{},"\n  .g6-toolbar {\n    position: absolute;\n    z-index: 100;\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n    justify-content: center;\n    border-radius: 4px;\n    box-shadow: 0px 0px 8px rgba(0, 0, 0, 0.1);\n    opacity: 0.65;\n  }\n  .g6-toolbar .g6-toolbar-item {\n    display: inline-block;\n    width: 16px;\n    height: 16px;\n    padding: 4px;\n    cursor: pointer;\n    box-sizing: content-box;\n  }\n\n  .g6-toolbar .g6-toolbar-item:hover {\n    background-color: #f0f0f0;\n  }\n\n  .g6-toolbar .g6-toolbar-item svg {\n    display: inline-block;\n    width: 100%;\n    height: 100%;\n    pointer-events: none;\n  }\n",document.head),Po("g6-toolbar-svgicon","div",{display:"none"},'\n  <svg>\n    <symbol id="zoom-in" viewBox="64 64 896 896">\n      <path d="M637 443H519V309c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v134H325c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h118v134c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V519h118c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8zm284 424L775 721c122.1-148.9 113.6-369.5-26-509-148-148.1-388.4-148.1-537 0-148.1 148.6-148.1 389 0 537 139.5 139.6 360.1 148.1 509 26l146 146c3.2 2.8 8.3 2.8 11 0l43-43c2.8-2.7 2.8-7.8 0-11zM696 696c-118.8 118.7-311.2 118.7-430 0-118.7-118.8-118.7-311.2 0-430 118.8-118.7 311.2-118.7 430 0 118.7 118.8 118.7 311.2 0 430z"></path>\n    </symbol>\n    <symbol id="zoom-out" viewBox="64 64 896 896">\n      <path d="M637 443H325c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h312c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8zm284 424L775 721c122.1-148.9 113.6-369.5-26-509-148-148.1-388.4-148.1-537 0-148.1 148.6-148.1 389 0 537 139.5 139.6 360.1 148.1 509 26l146 146c3.2 2.8 8.3 2.8 11 0l43-43c2.8-2.7 2.8-7.8 0-11zM696 696c-118.8 118.7-311.2 118.7-430 0-118.7-118.8-118.7-311.2 0-430 118.8-118.7 311.2-118.7 430 0 118.7 118.8 118.7 311.2 0 430z"></path>\n    </symbol>\n    <symbol id="edit" viewBox="64 64 896 896">\n      <path d="M257.7 752c2 0 4-.2 6-.5L431.9 722c2-.4 3.9-1.3 5.3-2.8l423.9-423.9a9.96 9.96 0 000-14.1L694.9 114.9c-1.9-1.9-4.4-2.9-7.1-2.9s-5.2 1-7.1 2.9L256.8 538.8c-1.5 1.5-2.4 3.3-2.8 5.3l-29.5 168.2a33.5 33.5 0 009.4 29.8c6.6 6.4 14.9 9.9 23.8 9.9zm67.4-174.4L687.8 215l73.3 73.3-362.7 362.6-88.9 15.7 15.6-89zM880 836H144c-17.7 0-32 14.3-32 32v36c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-36c0-17.7-14.3-32-32-32z"></path>\n    </symbol>\n    <symbol id="delete" viewBox="64 64 896 896">\n      <path d="M360 184h-8c4.4 0 8-3.6 8-8v8h304v-8c0 4.4 3.6 8 8 8h-8v72h72v-80c0-35.3-28.7-64-64-64H352c-35.3 0-64 28.7-64 64v80h72v-72zm504 72H160c-17.7 0-32 14.3-32 32v32c0 4.4 3.6 8 8 8h60.4l24.7 523c1.6 34.1 29.8 61 63.9 61h454c34.2 0 62.3-26.8 63.9-61l24.7-523H888c4.4 0 8-3.6 8-8v-32c0-17.7-14.3-32-32-32zM731.3 840H292.7l-24.2-512h487l-24.2 512z"></path>\n    </symbol>\n    <symbol id="redo" viewBox="64 64 896 896">\n      <path d="M758.2 839.1C851.8 765.9 912 651.9 912 523.9 912 303 733.5 124.3 512.6 124 291.4 123.7 112 302.8 112 523.9c0 125.2 57.5 236.9 147.6 310.2 3.5 2.8 8.6 2.2 11.4-1.3l39.4-50.5c2.7-3.4 2.1-8.3-1.2-11.1-8.1-6.6-15.9-13.7-23.4-21.2a318.64 318.64 0 01-68.6-101.7C200.4 609 192 567.1 192 523.9s8.4-85.1 25.1-124.5c16.1-38.1 39.2-72.3 68.6-101.7 29.4-29.4 63.6-52.5 101.7-68.6C426.9 212.4 468.8 204 512 204s85.1 8.4 124.5 25.1c38.1 16.1 72.3 39.2 101.7 68.6 29.4 29.4 52.5 63.6 68.6 101.7 16.7 39.4 25.1 81.3 25.1 124.5s-8.4 85.1-25.1 124.5a318.64 318.64 0 01-68.6 101.7c-9.3 9.3-19.1 18-29.3 26L668.2 724a8 8 0 00-14.1 3l-39.6 162.2c-1.2 5 2.6 9.9 7.7 9.9l167 .8c6.7 0 10.5-7.7 6.3-12.9l-37.3-47.9z"></path>\n    </symbol>\n    <symbol id="undo" viewBox="64 64 896 896">\n      <path d="M511.4 124C290.5 124.3 112 303 112 523.9c0 128 60.2 242 153.8 315.2l-37.5 48c-4.1 5.3-.3 13 6.3 12.9l167-.8c5.2 0 9-4.9 7.7-9.9L369.8 727a8 8 0 00-14.1-3L315 776.1c-10.2-8-20-16.7-29.3-26a318.64 318.64 0 01-68.6-101.7C200.4 609 192 567.1 192 523.9s8.4-85.1 25.1-124.5c16.1-38.1 39.2-72.3 68.6-101.7 29.4-29.4 63.6-52.5 101.7-68.6C426.9 212.4 468.8 204 512 204s85.1 8.4 124.5 25.1c38.1 16.1 72.3 39.2 101.7 68.6 29.4 29.4 52.5 63.6 68.6 101.7 16.7 39.4 25.1 81.3 25.1 124.5s-8.4 85.1-25.1 124.5a318.64 318.64 0 01-68.6 101.7c-7.5 7.5-15.3 14.5-23.4 21.2a7.93 7.93 0 00-1.2 11.1l39.4 50.5c2.8 3.5 7.9 4.1 11.4 1.3C854.5 760.8 912 649.1 912 523.9c0-221.1-179.4-400.2-400.6-399.9z"></path>\n    </symbol>\n    <symbol id="export" viewBox="64 64 896 896">\n      <path d="M880 912H144c-17.7 0-32-14.3-32-32V144c0-17.7 14.3-32 32-32h360c4.4 0 8 3.6 8 8v56c0 4.4-3.6 8-8 8H184v656h656V520c0-4.4 3.6-8 8-8h56c4.4 0 8 3.6 8 8v360c0 17.7-14.3 32-32 32zM770.87 199.13l-52.2-52.2a8.01 8.01 0 014.7-13.6l179.4-21c5.1-.6 9.5 3.7 8.9 8.9l-21 179.4c-.8 6.6-8.9 9.4-13.6 4.7l-52.4-52.4-256.2 256.2a8.03 8.03 0 01-11.3 0l-42.4-42.4a8.03 8.03 0 010-11.3l256.1-256.3z"></path>\n    </symbol>\n    <symbol id="auto-fit" viewBox="64 64 896 896">\n      <path d="M952 474H829.8C812.5 327.6 696.4 211.5 550 194.2V72c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v122.2C327.6 211.5 211.5 327.6 194.2 474H72c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h122.2C211.5 696.4 327.6 812.5 474 829.8V952c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V829.8C696.4 812.5 812.5 696.4 829.8 550H952c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8zM512 756c-134.8 0-244-109.2-244-244s109.2-244 244-244 244 109.2 244 244-109.2 244-244 244z"></path>\n      <path d="M512 392c-32.1 0-62.1 12.4-84.8 35.2-22.7 22.7-35.2 52.7-35.2 84.8s12.5 62.1 35.2 84.8C449.9 619.4 480 632 512 632s62.1-12.5 84.8-35.2C619.4 574.1 632 544 632 512s-12.5-62.1-35.2-84.8A118.57 118.57 0 00512 392z"></path>\n    </symbol>\n    <symbol id="reset" viewBox="64 64 896 896">\n      <path d="M909.1 209.3l-56.4 44.1C775.8 155.1 656.2 92 521.9 92 290 92 102.3 279.5 102 511.5 101.7 743.7 289.8 932 521.9 932c181.3 0 335.8-115 394.6-276.1 1.5-4.2-.7-8.9-4.9-10.3l-56.7-19.5a8 8 0 00-10.1 4.8c-1.8 5-3.8 10-5.9 14.9-17.3 41-42.1 77.8-73.7 109.4A344.77 344.77 0 01655.9 829c-42.3 17.9-87.4 27-133.8 27-46.5 0-91.5-9.1-133.8-27A341.5 341.5 0 01279 755.2a342.16 342.16 0 01-73.7-109.4c-17.9-42.4-27-87.4-27-133.9s9.1-91.5 27-133.9c17.3-41 42.1-77.8 73.7-109.4 31.6-31.6 68.4-56.4 109.3-73.8 42.3-17.9 87.4-27 133.8-27 46.5 0 91.5 9.1 133.8 27a341.5 341.5 0 01109.3 73.8c9.9 9.9 19.2 20.4 27.8 31.4l-60.2 47a8 8 0 003 14.1l175.6 43c5 1.2 9.9-2.6 9.9-7.7l.8-180.9c-.1-6.6-7.8-10.3-13-6.2z"></path>\n    </symbol>\n    <symbol id="exit-fullscreen" viewBox="0 0 1024 1024">\n      <path d="M418.13333333 361.43786666c0 0.2048-0.13653333 0.4096-0.13653334 0.68266667C417.99679999 362.32533333 418.13333333 362.53013333 418.13333333 362.73493333 418.13333333 371.54133333 414.44693333 379.392 408.78079999 385.39946666 408.43946666 385.7408 408.30293333 386.21866666 408.02986666 386.49173333c-1.09226667 1.09226667-2.59413333 1.77493333-3.82293333 2.73066667C398.40426666 393.65973333 391.64586666 396.8 383.93173333 396.8 383.72693333 396.8 383.59039999 396.73173333 383.38559999 396.73173333S382.97599999 396.8 382.77119999 396.8L112.29866666 396.8C92.50133333 396.8 76.79999999 381.50826666 76.79999999 362.66666666 76.66346666 343.89333333 92.63786666 328.53333333 112.16213333 328.53333333l189.44 0L87.44959999 114.51733333C73.59146666 100.59093333 73.25013333 78.5408 86.63039999 65.29706666c13.17546667-13.44853333 35.36213333-12.97066667 49.152 0.88746667l214.08426667 214.08426667L349.86666666 90.89706666C349.79839999 71.23626666 365.22666666 55.46666666 383.99999999 55.46666666 402.77333333 55.33013333 418.13333333 71.30453333 418.13333333 90.8288L418.13333333 361.43786666zM928.90453333 328.53333333l-189.44 0 214.15253333-214.08426667c13.85813333-13.9264 14.19946667-35.90826667 0.88746667-49.22026666-13.17546667-13.44853333-35.36213333-12.97066667-49.152 0.88746666l-214.08426667 214.08426667L691.26826666 90.89706666C691.26826666 71.23626666 675.83999999 55.46666666 657.06666666 55.46666666 638.29333333 55.33013333 622.93333333 71.30453333 622.93333333 90.8288l0 270.60906666c0 0.2048 0.13653333 0.4096 0.13653333 0.68266667C623.06986666 362.32533333 622.93333333 362.53013333 622.93333333 362.73493333 622.93333333 371.54133333 626.61973333 379.392 632.28586666 385.39946666c0.34133333 0.34133333 0.47786667 0.8192 0.8192 1.09226667 1.09226667 1.09226667 2.59413333 1.77493333 3.8912 2.73066667C642.66239999 393.65973333 649.42079999 396.8 657.13493333 396.8c0.2048 0 0.34133333-0.06826667 0.54613333-0.06826667S658.09066666 396.8 658.29546666 396.8l270.5408 0C948.56533333 396.8 964.26666666 381.50826666 964.26666666 362.66666666 964.40319999 343.89333333 948.42879999 328.53333333 928.90453333 328.53333333zM418.13333333 635.73333333c0-8.8064-3.6864-16.5888-9.35253334-22.66453333C408.43946666 612.72746666 408.30293333 612.2496 408.02986666 611.90826666 406.86933333 610.88426666 405.43573333 610.2016 404.20693333 609.24586666 398.47253333 604.80853333 391.64586666 601.6 383.93173333 601.6 383.72693333 601.6 383.59039999 601.73653333 383.38559999 601.73653333S382.97599999 601.6 382.77119999 601.6L112.29866666 601.6C92.50133333 601.6 76.79999999 616.96 76.79999999 635.73333333 76.66346666 654.50666666 92.63786666 669.86666666 112.16213333 669.86666666l189.44 0-214.15253334 214.15253334c-13.85813333 13.85813333-14.19946667 35.84-0.88746666 49.22026666 13.17546667 13.44853333 35.36213333 12.9024 49.152-0.95573333l214.08426666-214.08426667 0 189.37173334c0 19.59253333 15.42826667 35.49866667 34.2016 35.36213333C402.77333333 943.2064 418.13333333 927.232 418.13333333 907.5712L418.13333333 637.09866666c0-0.27306667-0.13653333-0.47786667-0.13653334-0.68266666C417.99679999 636.14293333 418.13333333 635.93813333 418.13333333 635.73333333zM739.46453333 669.86666666l189.44 0c19.456 0 35.49866667-15.36 35.36213333-34.13333333C964.26666666 616.96 948.56533333 601.6 928.76799999 601.6L658.29546666 601.6C658.09066666 601.6 657.88586666 601.73653333 657.68106666 601.73653333S657.33973333 601.6 657.13493333 601.6C649.42079999 601.6 642.59413333 604.80853333 636.85973333 609.24586666 635.63093333 610.2016 634.19733333 610.88426666 633.03679999 611.90826666 632.76373333 612.2496 632.62719999 612.72746666 632.28586666 613.0688 626.61973333 619.14453333 622.93333333 626.92693333 622.93333333 635.73333333c0 0.2048 0.13653333 0.4096 0.13653333 0.68266667C623.06986666 636.6208 622.93333333 636.8256 622.93333333 637.09866666l0 270.5408C622.93333333 927.232 638.29333333 943.2064 657.06666666 942.93333333c18.77333333 0.13653333 34.2016-15.70133333 34.2016-35.36213333l0-189.37173334 214.08426667 214.08426667c13.78986667 13.85813333 35.90826667 14.40426667 49.152 0.95573333 13.312-13.312 12.97066667-35.36213333-0.88746667-49.22026666L739.46453333 669.86666666z"  ></path></symbol>\n    <symbol id="request-fullscreen" viewBox="0 0 1024 1024">\n      <path d="M69.818182 87.598545v273.128728a34.909091 34.909091 0 0 0 69.818182 0V163.653818l221.928727 222.021818a33.512727 33.512727 0 0 0 47.383273-47.383272L186.926545 116.363636h197.073455a34.909091 34.909091 0 0 0 0-69.818181H110.871273C85.364364 46.545455 69.818182 59.671273 69.818182 87.598545zM938.542545 46.545455H665.413818a34.909091 34.909091 0 0 0 0 69.818181h197.073455L640.465455 338.292364a33.512727 33.512727 0 0 0 47.383272 47.383272l221.928728-222.021818v197.073455a34.909091 34.909091 0 0 0 69.818181 0V87.598545c0-27.927273-15.453091-41.053091-40.96-41.05309z m-827.671272 907.636363h273.128727a34.909091 34.909091 0 0 0 0-69.818182H186.926545l222.021819-221.928727a33.512727 33.512727 0 0 0-47.383273-47.383273L139.636364 837.073455V640a34.909091 34.909091 0 0 0-69.818182 0v273.128727c0 27.927273 15.546182 41.053091 41.053091 41.053091z m868.724363-41.053091V640a34.909091 34.909091 0 0 0-69.818181 0v197.073455L687.941818 615.051636a33.512727 33.512727 0 0 0-47.383273 47.383273L862.487273 884.363636H665.413818a34.909091 34.909091 0 0 0 0 69.818182h273.128727c25.6 0 41.053091-13.125818 41.053091-41.053091z"  ></path></symbol>\n  </svg>\n'),this.$element.addEventListener("click",this.onToolbarItemClick),this.update(e)}update(t){const e=Object.create(null,{update:{get:()=>super.update}});return Cl(this,void 0,void 0,(function*(){e.update.call(this,t);const{className:n,position:i,style:s}=this.options;this.$element.className=`g6-toolbar ${n||""}`,Object.assign(this.$element.style,s,function(t){const e={top:"unset",right:"unset",bottom:"unset",left:"unset"};return t.split("-").forEach((t=>{e[t]="8px"})),e.flexDirection=t.startsWith("top")||t.startsWith("bottom")?"row":"column",e}(i)),this.$element.innerHTML=yield this.getDOMContent()}))}destroy(){this.$element.removeEventListener("click",this.onToolbarItemClick),this.$element.remove(),super.destroy()}getDOMContent(){return Cl(this,void 0,void 0,(function*(){return(yield this.options.getItems()).map((t=>{var e;return`\n          <div class="g6-toolbar-item" value="${t.value}" title="${null!==(e=t.title)&&void 0!==e?e:""}">\n            <svg aria-hidden="true" focusable="false">\n              <use xlink:href="#${t.id}"></use>\n            </svg>\n          </div>`})).join("")}))}}Ml.defaultOptions={position:"top-left"};var Tl=n(81666),Pl=function(t,e,n,i){return new(n||(n=Promise))((function(s,o){function r(t){try{l(i.next(t))}catch(t){o(t)}}function a(t){try{l(i.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,a)}l((i=i.apply(t,e||[])).next())}))};class Al extends Mo{constructor(t,e){super(t,Object.assign({},Al.defaultOptions,e)),this.currentTarget=null,this.tooltipElement=null,this.container=null,this.isEnable=(t,e)=>{const{enable:n}=this.options;return"function"==typeof n?n(t,e):n},this.onClick=t=>{const{target:{id:e}}=t;this.currentTarget===e?this.hide(t):this.show(t)},this.onPointerMove=t=>{const{target:e}=t;this.currentTarget&&e.id!==this.currentTarget&&this.show(t)},this.onPointerLeave=t=>{this.hide(t)},this.onCanvasMove=t=>{this.hide(t)},this.onPointerEnter=t=>{this.show(t)},this.showById=t=>Pl(this,void 0,void 0,(function*(){const e={target:{id:t}};yield this.show(e)})),this.getElementData=(t,e)=>{const{model:n}=this.context;switch(e){case"node":return n.getNodeData([t]);case"edge":return n.getEdgeData([t]);case"combo":return n.getComboData([t]);default:return[]}},this.show=t=>Pl(this,void 0,void 0,(function*(){var e,n;const{client:i,target:{id:s}}=t;if(Cs(t.target))return;const o=this.context.graph.getElementType(s),{getContent:r,title:a}=this.options,l=this.getElementData(s,o);if(!this.tooltipElement||!this.isEnable(t,l))return;let h,c,d={};if(r){if(d.content=yield r(t,l),!d.content)return}else{const t=this.context.graph.getElementRenderStyle(s),e="node"===o?t.fill:t.stroke;d={title:a||o,data:l.map((t=>({name:"ID",value:t.id||`${t.source} -> ${t.target}`,color:e})))}}if(this.currentTarget=s,i)h=i.x,c=i.y;else{const t=(0,rn.Z)(l,"0.style",{x:0,y:0});h=t.x,c=t.y}null===(n=(e=this.options).onOpenChange)||void 0===n||n.call(e,!0),this.tooltipElement.update(Object.assign(Object.assign(Object.assign({},this.tooltipStyleProps),{x:h,y:c,style:{".tooltip":{visibility:"visible"}}}),d))})),this.hide=t=>{var e,n,i,s,o;if(!t)return null===(n=(e=this.options).onOpenChange)||void 0===n||n.call(e,!1),null===(i=this.tooltipElement)||void 0===i||i.hide(),void(this.currentTarget=null);if(!this.tooltipElement)return;if(!this.currentTarget)return;const{client:{x:r,y:a}}=t;null===(o=(s=this.options).onOpenChange)||void 0===o||o.call(s,!1),this.tooltipElement.hide(r,a),this.currentTarget=null},this.initTooltip=()=>{var t;const e=new Tl.u({className:"tooltip",style:this.tooltipStyleProps});return null===(t=this.container)||void 0===t||t.appendChild(e.HTMLTooltipElement),e},this.render(),this.bindEvents()}getEvents(){return"click"===this.options.trigger?{"node:click":this.onClick,"edge:click":this.onClick,"combo:click":this.onClick,"canvas:click":this.onPointerLeave,contextmenu:this.onPointerLeave,drag:this.onPointerLeave}:{"node:pointerenter":this.onPointerEnter,"node:pointermove":this.onPointerMove,"canvas:pointermove":this.onCanvasMove,"edge:pointerenter":this.onPointerEnter,"edge:pointermove":this.onPointerMove,"combo:pointerenter":this.onPointerEnter,"combo:pointermove":this.onPointerMove,contextmenu:this.onPointerLeave,"node:drag":this.onPointerLeave}}update(t){var e;this.unbindEvents(),super.update(t),this.tooltipElement&&(null===(e=this.container)||void 0===e||e.removeChild(this.tooltipElement.HTMLTooltipElement)),this.tooltipElement=this.initTooltip(),this.bindEvents()}render(){const{canvas:t}=this.context,e=t.getContainer();e&&(this.container=e,this.tooltipElement=this.initTooltip())}unbindEvents(){const{graph:t}=this.context,e=this.getEvents();Object.keys(e).forEach((n=>{t.off(n,e[n])}))}bindEvents(){const{graph:t}=this.context,e=this.getEvents();Object.keys(e).forEach((n=>{t.on(n,e[n])}))}get tooltipStyleProps(){const{canvas:t}=this.context,{center:e}=t.getBounds(),n=t.getContainer(),{top:i,left:s}=n.getBoundingClientRect(),{style:o,position:r,enterable:a,container:l={x:-s,y:-i},title:h,offset:c}=this.options,[d,u]=e,[p,g]=t.getSize();return{x:d,y:u,container:l,title:h,bounding:{x:0,y:0,width:p,height:g},position:r,enterable:a,offset:c,style:o}}destroy(){var t;this.unbindEvents(),this.tooltipElement&&(null===(t=this.container)||void 0===t||t.removeChild(this.tooltipElement.HTMLTooltipElement)),super.destroy()}}Al.defaultOptions={trigger:"hover",position:"top-right",enterable:!1,enable:!0,offset:[10,10],style:{".tooltip":{visibility:"hidden"}}};var Rl=function(t,e,n,i){return new(n||(n=Promise))((function(s,o){function r(t){try{l(i.next(t))}catch(t){o(t)}}function a(t){try{l(i.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,a)}l((i=i.apply(t,e||[])).next())}))};let Ll;function kl(t,e){Ll||(Ll=document.createElement("canvas")),Ll.width=t,Ll.height=e;return Ll.getContext("2d").clearRect(0,0,t,e),Ll}var Nl=function(t,e,n,i){return new(n||(n=Promise))((function(s,o){function r(t){try{l(i.next(t))}catch(t){o(t)}}function a(t){try{l(i.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,a)}l((i=i.apply(t,e||[])).next())}))},Il=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(n[i[s]]=t[i[s]])}return n};class jl extends Mo{constructor(t,e){super(t,Object.assign({},jl.defaultOptions,e)),this.$element=To("watermark");this.context.canvas.getContainer().appendChild(this.$element),this.update(e)}update(t){const e=Object.create(null,{update:{get:()=>super.update}});return Nl(this,void 0,void 0,(function*(){e.update.call(this,t);const n=this.options,{width:i,height:s,text:o,imageURL:r}=n,a=Il(n,["width","height","text","imageURL"]);Object.keys(a).forEach((e=>{e.startsWith("background")&&(this.$element.style[e]=t[e])}));const l=r?yield function(t,e,n,i){return Rl(this,void 0,void 0,(function*(){const s=kl(t,e),o=s.getContext("2d"),{rotate:r,opacity:a}=i;r&&o.rotate(r),a&&(o.globalAlpha=a);const l=new Image;return l.crossOrigin="anonymous",l.src=n,new Promise((n=>{l.onload=function(){const i=t>l.width?(t-l.width)/2:0,r=e>l.height?(e-l.height)/2:0;o.drawImage(l,0,0,l.width,l.height,i,r,t-2*i,e-2*r),n(s.toDataURL())}}))}))}(i,s,r,a):yield function(t,e,n,i){return Rl(this,void 0,void 0,(function*(){const s=kl(t,e),o=s.getContext("2d"),{rotate:r,opacity:a,textFill:l,textFontSize:h,textFontFamily:c,textFontVariant:d,textFontWeight:u,textAlign:p,textBaseline:g}=i;return o.textAlign=p,o.textBaseline=g,o.translate(t/2,e/2),o.font=`${h}px ${c} ${d} ${u}`,r&&o.rotate(r),a&&(o.globalAlpha=a),l&&(o.fillStyle=l,o.fillText(`${n}`,0,0)),s.toDataURL()}))}(i,s,o,a);this.$element.style.backgroundImage=`url(${l})`}))}destroy(){super.destroy(),this.$element.remove()}}jl.defaultOptions={width:200,height:100,opacity:.2,rotate:Math.PI/12,text:"",textFill:"#000",textFontSize:16,textAlign:"center",textBaseline:"middle",backgroundRepeat:"repeat"};const Bl=["#7E92B5","#F4664A","#FFBE3A"],zl={type:"group",color:["#1783FF","#00C9C9","#F08F56","#D580FF","#7863FF","#DB9D0D","#60C42D","#FF80CA","#2491B3","#17C76F"]},Fl={type:"group",color:["#99ADD1","#1783FF","#00C9C9","#F08F56","#D580FF","#7863FF","#DB9D0D","#60C42D","#FF80CA","#2491B3","#17C76F"]};function _l(t){const{bgColor:e,textColor:n,nodeColor:i,nodeColorDisabled:s,nodeStroke:o,nodeHaloStrokeOpacityActive:r=.15,nodeHaloStrokeOpacitySelected:a=.25,nodeOpacityDisabled:l=.06,nodeIconOpacityInactive:h=.85,nodeOpacityInactive:c=.25,nodeBadgePalette:d=Bl,nodePaletteOptions:u=zl,edgeColor:p,edgeColorDisabled:g,edgePaletteOptions:f=Fl,comboColor:y,comboColorDisabled:m,comboStroke:v,comboStrokeDisabled:b,edgeColorInactive:E}=t;return{background:e,node:{palette:u,style:{donutOpacity:1,badgeBackgroundOpacity:1,badgeFill:"#fff",badgeFontSize:8,badgePadding:[0,4],badgePalette:d,fill:i,fillOpacity:1,halo:!1,iconFill:"#fff",iconOpacity:1,labelBackground:!1,labelBackgroundFill:e,labelBackgroundLineWidth:0,labelBackgroundOpacity:.75,labelFill:n,labelFillOpacity:.85,labelLineHeight:16,labelPadding:[0,2],labelFontSize:12,labelFontWeight:400,labelOpacity:1,labelOffsetY:2,lineWidth:0,portFill:i,portLineWidth:1,portStroke:o,portStrokeOpacity:.65,size:32,stroke:o,strokeOpacity:1,zIndex:2},state:{selected:{halo:!0,haloLineWidth:24,haloStrokeOpacity:a,labelFontSize:12,labelFontWeight:"bold",lineWidth:4,stroke:o},active:{halo:!0,haloLineWidth:12,haloStrokeOpacity:r},highlight:{labelFontWeight:"bold",lineWidth:4,stroke:o,strokeOpacity:.85},inactive:{badgeBackgroundOpacity:c,donutOpacity:c,fillOpacity:c,iconOpacity:h,labelFill:n,labelFillOpacity:c,strokeOpacity:c},disabled:{badgeBackgroundOpacity:.25,donutOpacity:l,fill:s,fillOpacity:l,iconFill:s,iconOpacity:.25,labelFill:n,labelFillOpacity:.25,strokeOpacity:l}},animation:{enter:"fade",exit:"fade",show:"fade",hide:"fade",expand:"node-expand",collapse:"node-collapse",update:[{fields:["x","y","fill","stroke"]}],translate:[{fields:["x","y"]}]}},edge:{palette:f,style:{badgeBackgroundFill:p,badgeFill:"#fff",badgeFontSize:8,badgeOffsetX:10,fillOpacity:1,halo:!1,haloLineWidth:12,haloStrokeOpacity:1,increasedLineWidthForHitTesting:2,labelBackground:!1,labelBackgroundFill:e,labelBackgroundLineWidth:0,labelBackgroundOpacity:.75,labelBackgroundPadding:[4,4,4,4],labelFill:n,labelFontSize:12,labelFontWeight:400,labelOpacity:1,labelPlacement:"center",labelTextBaseline:"middle",lineWidth:1,stroke:p,strokeOpacity:1,zIndex:1},state:{selected:{halo:!0,haloStrokeOpacity:.25,labelFontSize:14,labelFontWeight:"bold",lineWidth:3},active:{halo:!0,haloStrokeOpacity:.15},highlight:{labelFontWeight:"bold",lineWidth:3},inactive:{stroke:E,fillOpacity:.08,labelOpacity:.25,strokeOpacity:.08,badgeBackgroundOpacity:.25},disabled:{stroke:g,fillOpacity:.45,strokeOpacity:.45,labelOpacity:.25,badgeBackgroundOpacity:.45}},animation:{enter:"fade",exit:"fade",expand:"path-in",collapse:"path-out",show:"fade",hide:"fade",update:[{fields:["sourceNode","targetNode"]},{fields:["stroke"],shape:"key"}],translate:[{fields:["sourceNode","targetNode"]}]}},combo:{style:{collapsedMarkerFill:e,collapsedMarkerFontSize:12,collapsedMarkerFillOpacity:1,collapsedSize:32,collapsedFillOpacity:1,fill:y,halo:!1,haloLineWidth:12,haloStroke:v,haloStrokeOpacity:.25,labelBackground:!1,labelBackgroundFill:e,labelBackgroundLineWidth:0,labelBackgroundOpacity:.75,labelBackgroundPadding:[2,4,2,4],labelFill:n,labelFontSize:12,labelFontWeight:400,labelOpacity:1,lineDash:0,lineWidth:1,fillOpacity:.04,strokeOpacity:1,padding:10,stroke:v},state:{selected:{halo:!0,labelFontSize:14,labelFontWeight:700,lineWidth:4},active:{halo:!0},highlight:{labelFontWeight:700,lineWidth:4},inactive:{fillOpacity:.65,labelOpacity:.25,strokeOpacity:.65},disabled:{fill:m,fillOpacity:.25,labelOpacity:.25,stroke:b,strokeOpacity:.25}},animation:{enter:"fade",exit:"fade",show:"fade",hide:"fade",expand:"combo-expand",collapse:"combo-collapse",update:[{fields:["x","y"]},{fields:["fill","stroke","lineWidth"],shape:"key"}],translate:[{fields:["x","y"]}]}}}}const Zl=_l({bgColor:"#000000",comboColor:"#fdfdfd",comboColorDisabled:"#d0e4ff",comboStroke:"#99add1",comboStrokeDisabled:"#969696",edgeColor:"#637088",edgeColorDisabled:"#637088",edgeColorInactive:"#D0E4FF",edgePaletteOptions:{type:"group",color:["#637088","#0F55A6","#008383","#9C5D38","#8B53A6","#4E40A6","#8F6608","#3E801D","#A65383","#175E75","#0F8248"]},nodeColor:"#1783ff",nodeColorDisabled:"#D0E4FF",nodeHaloStrokeOpacityActive:.25,nodeHaloStrokeOpacitySelected:.45,nodeIconOpacityInactive:.45,nodeOpacityDisabled:.25,nodeOpacityInactive:.45,nodeStroke:"#d0e4ff",textColor:"#ffffff"}),$l=_l({bgColor:"#ffffff",comboColor:"#99ADD1",comboColorDisabled:"#f0f0f0",comboStroke:"#99add1",comboStrokeDisabled:"#d9d9d9",edgeColor:"#99add1",edgeColorDisabled:"#d9d9d9",edgeColorInactive:"#1B324F",nodeColor:"#1783ff",nodeColorDisabled:"#1B324F",nodeHaloStrokeOpacityActive:.15,nodeHaloStrokeOpacitySelected:.25,nodeIconOpacityInactive:.85,nodeOpacityDisabled:.06,nodeOpacityInactive:.25,nodeStroke:"#000000",textColor:"#000000"});class Vl extends oe{beforeDraw(t,e){return t}afterLayout(t,e){}}function Wl(t,e,n,i,s){const o=Ht(i),r=`${n}s`,a=s?i:t.add[r].get(o)||t.update[r].get(o)||t.remove[r].get(o)||i;Object.entries(t).forEach((([t,n])=>{e===t?n[r].set(o,a):n[r].delete(o)}))}function Hl(t,e){return Object.keys(t).every((n=>t[n]===e[n]))}const Yl=(t,e,n,i)=>{const s=`${n}s`,o=Ht(i);t.add[s].has(o)||t.update[s].has(o)||t[e][s].set(Ht(i),i)};new WeakMap;function Gl(t,e,n,i=!1){const s=S[t][e];!i&&s?s!==n&&M.warn(`The extension ${e} of ${t} has been registered before.`):Object.assign(S[t],{[e]:n})}var Ul=n(98875),Kl=n(88204),Xl=function(t,e,n,i){return new(n||(n=Promise))((function(s,o){function r(t){try{l(i.next(t))}catch(t){o(t)}}function a(t){try{l(i.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,a)}l((i=i.apply(t,e||[])).next())}))},ql=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(n[i[s]]=t[i[s]])}return n};const Jl=["main"],Ql=["background","main","label","transient"];class th{getConfig(){return this.config}getLayer(t="main"){return this.extends.layers[t]||this.getLayers().main}getLayers(){return this.extends.layers}getRenderer(t){return this.extends.renderers[t]}getCamera(t="main"){return this.getLayer(t).getCamera()}getRoot(t="main"){return this.getLayer(t).getRoot()}getContextService(t="main"){return this.getLayer(t).getContextService()}setCursor(t){this.config.cursor=t,this.getLayer().setCursor(t)}get document(){return this.getLayer().document}get context(){return this.getLayer().context}constructor(t){this.config={enableMultiLayer:!0},Object.assign(this.config,t);const e=this.config,{renderer:n,background:i,cursor:o,enableMultiLayer:r}=e,a=ql(e,["renderer","background","cursor","enableMultiLayer"]),l=r?Ql:Jl,h=eh(n,l),c=Object.fromEntries(l.map((t=>[t,new s.Xz(Object.assign(Object.assign({},a),{supportsMutipleCanvasesInOneContainer:r,renderer:h[t],background:r?"background"===t?i:void 0:i}))])));nh(c),this.extends={config:this.config,renderer:n,renderers:h,layers:c}}get ready(){return Promise.all(Object.entries(this.getLayers()).map((([,t])=>t.ready)))}resize(t,e){Object.assign(this.extends.config,{width:t,height:e}),Object.values(this.getLayers()).forEach((n=>{const i=n.getCamera(),s=i.getPosition(),o=i.getFocalPoint();n.resize(t,e),i.setPosition(s),i.setFocalPoint(o)}))}getBounds(t){return rt(Object.values(this.getLayers()).map((e=>t?e.getRoot().childNodes.find((e=>e.classList.includes(t))):e.getRoot())).filter((t=>(null==t?void 0:t.childNodes.length)>0)).map((t=>t.getBounds())))}getContainer(){const t=this.extends.config.container;return"string"==typeof t?document.getElementById(t):t}getSize(){return[this.extends.config.width||0,this.extends.config.height||0]}appendChild(t,e){var n;const i=(null===(n=t.style)||void 0===n?void 0:n.$layer)||"main";return this.getLayer(i).appendChild(t,e)}setRenderer(t){if(t===this.extends.renderer)return;const e=eh(t,this.config.enableMultiLayer?Ql:Jl);this.extends.renderers=e,Object.entries(e).forEach((([t,e])=>this.getLayer(t).setRenderer(e))),nh(this.getLayers())}getCanvasByViewport(t){return Re(this.getLayer().viewport2Canvas(Le(t)))}getViewportByCanvas(t){return Re(this.getLayer().canvas2Viewport(Le(t)))}getViewportByClient(t){return Re(this.getLayer().client2Viewport(Le(t)))}getClientByViewport(t){return Re(this.getLayer().viewport2Client(Le(t)))}getClientByCanvas(t){return this.getClientByViewport(this.getViewportByCanvas(t))}getCanvasByClient(t){const e=this.getLayer(),n=e.client2Viewport(Le(t));return Re(e.viewport2Canvas(n))}toDataURL(){return Xl(this,arguments,void 0,(function*(t={}){const e=globalThis.devicePixelRatio||1,{mode:n="viewport"}=t,i=ql(t,["mode"]);let[o,r,a,l]=[0,0,0,0];if("viewport"===n)[a,l]=this.getSize();else if("overall"===n){const t=this.getBounds(),e=nt(t);[o,r]=t.min,[a,l]=e}const h=(0,Kl.L)('<div id="virtual-image"></div>'),c=new s.Xz({width:a,height:l,renderer:new si.Th,devicePixelRatio:e,container:h,background:this.extends.config.background});yield c.ready,c.appendChild(this.getLayer("background").getRoot().cloneNode(!0)),c.appendChild(this.getRoot().cloneNode(!0));const d=this.getLayer("label").getRoot().cloneNode(!0),u=c.viewport2Canvas({x:0,y:0}),p=this.getCanvasByViewport([0,0]);d.translate([p[0]-u.x,p[1]-u.y]),d.scale(1/this.getCamera().getZoom()),c.appendChild(d),c.appendChild(this.getLayer("transient").getRoot().cloneNode(!0));const g=this.getCamera(),f=c.getCamera();if("viewport"===n)f.setZoom(g.getZoom()),f.setPosition(g.getPosition()),f.setFocalPoint(g.getFocalPoint());else if("overall"===n){const[t,e,n]=f.getPosition(),[i,s,a]=f.getFocalPoint();f.setPosition([t+o,e+r,n]),f.setFocalPoint([i+o,s+r,a])}const y=c.getContextService();return new Promise((t=>{c.addEventListener(s.$6.RERENDER,(()=>Xl(this,void 0,void 0,(function*(){yield new Promise((t=>setTimeout(t,300)));const e=yield y.toDataURL(i);t(e)}))))}))}))}destroy(){Object.values(this.getLayers()).forEach((t=>{t.getCamera().cancelLandmarkAnimation(),t.destroy()}))}}function eh(t,e){return Object.fromEntries(e.map((e=>{const n=(null==t?void 0:t(e))||new si.Th;return n instanceof si.Th&&n.setConfig({enableDirtyRectangleRendering:!1}),"main"===e?n.registerPlugin(new Ul.S({isDocumentDraggable:!0,isDocumentDroppable:!0,dragstartDistanceThreshold:10,dragstartTimeThreshold:100})):n.unregisterPlugin(n.getPlugin("dom-interaction")),[e,n]})))}function nh(t){Object.entries(t).forEach((([t,e])=>{const n=e.getContextService().getDomElement();(null==n?void 0:n.style)&&(n.style.gridArea="1 / 1 / 2 / 2",n.style.outline="none",n.tabIndex=1,"main"!==t&&(n.style.pointerEvents="none")),(null==n?void 0:n.parentElement)&&(n.parentElement.style.display="grid")}))}const ih=t=>t?parseInt(t):0;function sh(t){if(!t)return[0,0];let e=640,n=480;const[i,s]=function(t){const e=getComputedStyle(t),n=t.clientWidth||ih(e.width),i=t.clientHeight||ih(e.height);return[n-(ih(e.paddingLeft)+ih(e.paddingRight)),i-(ih(e.paddingTop)+ih(e.paddingBottom))]}(t);e=i||e,n=s||n;return[Math.max((0,N.Z)(e)?e:1,1),Math.max((0,N.Z)(n)?n:1,1)]}class oh{constructor(t){this.type=t}}class rh extends oh{constructor(t,e){super(t),this.data=e}}class ah extends oh{constructor(t,e,n,i){super(t),this.animationType=e,this.animation=n,this.data=i}}class lh extends oh{constructor(t,e,n){super(t),this.elementType=e,this.data=n}}class hh extends oh{constructor(t,e){super(t),this.data=e}}function ch(t,e){t.emit(e.type,e)}function dh(t){var e;return(null===(e=null==t?void 0:t.style)||void 0===e?void 0:e.zIndex)||0}const uh="cachedStyle",ph=t=>`__${t}__`;function gh(t,e){return(0,rn.Z)(t,[uh,ph(e)])}class fh{constructor(t){this.tasks=[],this.animations=new Set,this.context=t}getTasks(){const t=[...this.tasks];return this.tasks=[],t}add(t,e){this.tasks.push([t,e])}animate(t,e,n){var i,s,o;null===(i=null==e?void 0:e.before)||void 0===i||i.call(e);const r=this.getTasks().map((([e,i])=>{var s,o,r;const{element:a,elementType:l,stage:h}=e,c=k(this.context.options,l,h,t);null===(s=null==i?void 0:i.before)||void 0===s||s.call(i);const d=c.length?B(a,this.inferStyle(e,n),c):null;return d?(null===(o=null==i?void 0:i.beforeAnimate)||void 0===o||o.call(i,d),d.finished.then((()=>{var t,e;null===(t=null==i?void 0:i.afterAnimate)||void 0===t||t.call(i,d),null===(e=null==i?void 0:i.after)||void 0===e||e.call(i),this.animations.delete(d)}))):null===(r=null==i?void 0:i.after)||void 0===r||r.call(i),d})).filter(Boolean);r.forEach((t=>this.animations.add(t)));const a=P(r);return a?(null===(s=null==e?void 0:e.beforeAnimate)||void 0===s||s.call(e,a),a.finished.then((()=>{var t,n;null===(t=null==e?void 0:e.afterAnimate)||void 0===t||t.call(e,a),null===(n=null==e?void 0:e.after)||void 0===n||n.call(e),this.release()}))):null===(o=null==e?void 0:e.after)||void 0===o||o.call(e),a}inferStyle(t,e){var n,i;const{element:s,elementType:o,stage:r,originalStyle:a,updatedStyle:l={}}=t;t.modifiedStyle||(t.modifiedStyle=Object.assign(Object.assign({},a),l));const{modifiedStyle:h}=t,c={},d={};if("enter"===r)Object.assign(c,{opacity:0});else if("exit"===r)Object.assign(d,{opacity:0});else if("show"===r)Object.assign(c,{opacity:0}),Object.assign(d,{opacity:null!==(n=gh(s,"opacity"))&&void 0!==n?n:R("opacity")});else if("hide"===r)Object.assign(c,{opacity:null!==(i=gh(s,"opacity"))&&void 0!==i?i:R("opacity")}),Object.assign(d,{opacity:0});else if("collapse"===r){const{collapse:t}=e||{},{target:n,descendants:i,position:r}=t;if("node"===o){if(i.includes(s.id)){const[t,e,n]=r;Object.assign(d,{x:t,y:e,z:n})}}else if("combo"===o){if(s.id===n||i.includes(s.id)){const[t,e]=r;Object.assign(d,{x:t,y:e,childrenNode:a.childrenNode})}}else"edge"===o&&Object.assign(d,{sourceNode:h.sourceNode,targetNode:h.targetNode})}else if("expand"===r){const{expand:t}=e||{},{target:n,descendants:i,position:r}=t;if("node"===o){if(s.id===n||i.includes(s.id)){const[t,e,n]=r;Object.assign(c,{x:t,y:e,z:n})}}else if("combo"===o){if(s.id===n||i.includes(s.id)){const[t,e,n]=r;Object.assign(c,{x:t,y:e,z:n,childrenNode:h.childrenNode})}}else"edge"===o&&Object.assign(c,{sourceNode:h.sourceNode,targetNode:h.targetNode})}return[Object.keys(c).length>0?Object.assign({},a,c):a,Object.keys(d).length>0?Object.assign({},h,d):h]}stop(){this.animations.forEach((t=>t.cancel()))}clear(){this.tasks=[]}release(){var t,e;const{canvas:n}=this.context,i=null===(e=null===(t=n.document)||void 0===t?void 0:t.timeline)||void 0===e?void 0:e.animationsWithPromises;i&&(n.document.timeline.animationsWithPromises=i.filter((t=>"finished"!==t.playState)))}destroy(){this.stop(),this.animations.clear(),this.tasks=[]}}class yh{constructor(t){this.batchCount=0,this.context=t}emit(t){const{graph:e}=this.context;e.emit(t.type,t)}startBatch(t=!0){this.batchCount++,1===this.batchCount&&this.emit(new rh(v.BATCH_START,{initiate:t}))}endBatch(){this.batchCount--,0===this.batchCount&&this.emit(new rh(v.BATCH_END))}get isBatching(){return this.batchCount>0}destroy(){this.context=null}}class mh extends se{constructor(t){super(t),this.currentTarget=null,this.currentTargetType=null,this.category="behavior",this.forwardCanvasEvents=t=>{const{target:e}=t,n=function(t){if(!t)return null;if(t instanceof s.BB)return{type:"canvas",element:t};let e=t;for(;e;){if(us(e))return{type:"node",element:e};if(ps(e))return{type:"edge",element:e};if(gs(e))return{type:"combo",element:e};e=e.parentElement}return null}(e);if(!n)return;const{graph:i,canvas:o}=this.context,{type:r,element:a}=n;if("destroyed"in a&&(Cs(a)||a.destroyed))return;const{type:l,detail:h,button:c}=t,d=Object.assign(Object.assign({},t),{target:a,targetType:r,originalTarget:e});l===f.POINTER_MOVE&&(this.currentTarget!==a&&(this.currentTarget&&i.emit(`${this.currentTargetType}:${f.POINTER_LEAVE}`,Object.assign(Object.assign({},d),{type:f.POINTER_LEAVE,target:this.currentTarget,targetType:this.currentTargetType})),a&&(Object.assign(d,{type:f.POINTER_ENTER}),i.emit(`${r}:${f.POINTER_ENTER}`,d))),this.currentTarget=a,this.currentTargetType=r),l===f.CLICK&&2===c||(i.emit(`${r}:${l}`,d),i.emit(l,d)),l===f.CLICK&&2===h&&(Object.assign(d,{type:f.DBLCLICK}),i.emit(`${r}:${f.DBLCLICK}`,d),i.emit(f.DBLCLICK,d)),l===f.POINTER_DOWN&&2===c&&(Object.assign(d,{type:f.CONTEXT_MENU,preventDefault:()=>{var t;null===(t=o.getContainer())||void 0===t||t.addEventListener(f.CONTEXT_MENU,(t=>t.preventDefault()),{once:!0})}}),i.emit(`${r}:${f.CONTEXT_MENU}`,d),i.emit(f.CONTEXT_MENU,d))},this.forwardContainerEvents=t=>{this.context.graph.emit(t.type,t)},this.forwardEvents(),this.setBehaviors(this.context.options.behaviors||[])}setBehaviors(t){this.setExtensions(t)}forwardEvents(){const t=this.context.canvas.getContainer();t&&[y.KEY_DOWN,y.KEY_UP].forEach((e=>{t.addEventListener(e,this.forwardContainerEvents)}));const e=this.context.canvas.document;e&&[f.CLICK,f.DBLCLICK,f.POINTER_OVER,f.POINTER_LEAVE,f.POINTER_ENTER,f.POINTER_MOVE,f.POINTER_OUT,f.POINTER_DOWN,f.POINTER_UP,f.CONTEXT_MENU,f.DRAG_START,f.DRAG,f.DRAG_END,f.DRAG_ENTER,f.DRAG_OVER,f.DRAG_LEAVE,f.DROP,f.WHEEL].forEach((t=>{e.addEventListener(t,this.forwardCanvasEvents)}))}destroy(){const t=this.context.canvas.getContainer();t&&[y.KEY_DOWN,y.KEY_UP].forEach((e=>{t.removeEventListener(e,this.forwardContainerEvents)})),this.context.canvas.document.removeAllEventListeners(),super.destroy()}}var vh=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(n[i[s]]=t[i[s]])}return n};function bh(t,e){const{data:n,style:i}=t,s=vh(t,["data","style"]),{data:o,style:r}=e,a=vh(e,["data","style"]),l=Object.assign(Object.assign({},s),a);return(n||o)&&Object.assign(l,{data:Object.assign(Object.assign({},n),o)}),(i||r)&&Object.assign(l,{style:Object.assign(Object.assign({},i),r)}),l}function Eh(t){const{data:e,style:n}=t,i=vh(t,["data","style"]);return e&&(i.data=Object.assign({},e)),n&&(i.style=Object.assign({},n)),i}function xh(t={},e={}){const{states:n=[],data:i={},style:s={},children:o=[]}=t,r=vh(t,["states","data","style","children"]),{states:a=[],data:l={},style:h={},children:c=[]}=e,d=(t,e)=>t.length===e.length&&t.every(((t,n)=>t===e[n])),u=(t,e)=>{const n=Object.keys(t),i=Object.keys(e);return n.length===i.length&&n.every((n=>t[n]===e[n]))};return!!u(r,vh(e,["states","data","style","children"]))&&(!!d(o,c)&&(!!d(n,a)&&(!!u(i,l)&&!!u(s,h))))}var wh=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(n[i[s]]=t[i[s]])}return n};function Oh(t){const{id:e=Ht(t),style:n,data:i}=t,s=wh(t,["id","style","data"]),o=Object.assign(Object.assign({},t),{style:Object.assign({},n),data:Object.assign({},i)});return function(t){return"source"in t&&"target"in t}(t)?Object.assign({id:e,data:o},s):{id:e,data:o}}function Sh(t){return t.data}class Dh{constructor(){this.latestRemovedComboIds=new Set,this.comboIds=new Set,this.changes=[],this.batchCount=0,this.isTraceless=!1,this.enableUpdateNodeLikeHierarchy=!0,this.model=new zs.k}pushChange(t){if(this.isTraceless)return;const{type:e}=t;if(e===d.NodeUpdated||e===d.EdgeUpdated||e===d.ComboUpdated){const{value:n,original:i}=t;this.changes.push({value:Eh(n),original:Eh(i),type:e})}else this.changes.push({value:Eh(t.value),type:e})}getChanges(){return this.changes}clearChanges(){this.changes=[]}batch(t){this.batchCount++,this.model.batch(t),this.batchCount--}isBatching(){return this.batchCount>0}silence(t){this.isTraceless=!0,t(),this.isTraceless=!1}isCombo(t){return this.comboIds.has(t)||this.latestRemovedComboIds.has(t)}getData(){return{nodes:this.getNodeData(),edges:this.getEdgeData(),combos:this.getComboData()}}getNodeData(t){return this.model.getAllNodes().reduce(((e,n)=>{const i=Sh(n);return this.isCombo(Ht(i))||(void 0===t||t.includes(Ht(i)))&&e.push(i),e}),[])}getEdgeDatum(t){return Sh(this.model.getEdge(t))}getEdgeData(t){return this.model.getAllEdges().reduce(((e,n)=>{const i=Sh(n);return(void 0===t||t.includes(Ht(i)))&&e.push(i),e}),[])}getComboData(t){return this.model.getAllNodes().reduce(((e,n)=>{const i=Sh(n);return this.isCombo(Ht(i))?((void 0===t||t.includes(Ht(i)))&&e.push(i),e):e}),[])}getRootsData(t=w){return this.model.getRoots(t).map(Sh)}getAncestorsData(t,e){const{model:n}=this;return n.hasNode(t)&&n.hasTreeStructure(e)?n.getAncestors(t,e).map(Sh):[]}getDescendantsData(t){const e=this.getElementDataById(t),n=[];return Je(e,(t=>{t!==e&&n.push(t)}),(t=>this.getChildrenData(Ht(t))),"TB"),n}getParentData(t,e){const{model:n}=this;if(!e)return void M.warn("The hierarchy structure key is not specified");if(!n.hasNode(t)||!n.hasTreeStructure(e))return;const i=n.getParent(t,e);return i?Sh(i):void 0}getChildrenData(t){const e="node"===this.getElementType(t)?w:x,{model:n}=this;return n.hasNode(t)&&n.hasTreeStructure(e)?n.getChildren(t,e).map(Sh):[]}getElementsDataByType(t){return"node"===t?this.getNodeData():"edge"===t?this.getEdgeData():"combo"===t?this.getComboData():[]}getElementDataById(t){return"edge"===this.getElementType(t)?this.getEdgeDatum(t):this.getNodeLikeDatum(t)}getNodeLikeDatum(t){return Sh(this.model.getNode(t))}getNodeLikeData(t){return this.model.getAllNodes().reduce(((e,n)=>{const i=Sh(n);return t?t.includes(Ht(i))&&e.push(i):e.push(i),e}),[])}getElementDataByState(t,e){return this.getElementsDataByType(t).filter((t=>{var n;return null===(n=t.states)||void 0===n?void 0:n.includes(e)}))}getElementState(t){var e;return(null===(e=this.getElementDataById(t))||void 0===e?void 0:e.states)||[]}hasNode(t){return this.model.hasNode(t)&&!this.isCombo(t)}hasEdge(t){return this.model.hasEdge(t)}hasCombo(t){return this.model.hasNode(t)&&this.isCombo(t)}getRelatedEdgesData(t,e="both"){return this.model.getRelatedEdges(t,e).map(Sh)}getNeighborNodesData(t){return this.model.getNeighbors(t).map(Sh)}setData(t){const{nodes:e=[],edges:n=[],combos:i=[]}=t,{nodes:s,edges:o,combos:r}=this.getData(),a=ne(s,e,(t=>Ht(t)),xh),l=ne(o,n,(t=>Ht(t)),xh),h=ne(r,i,(t=>Ht(t)),xh);this.batch((()=>{const t={nodes:a.enter,edges:l.enter,combos:h.enter};this.addData(t),this.computeZIndex(t,"add",!0);const e={nodes:a.update,edges:l.update,combos:h.update};this.updateData(e),this.computeZIndex(e,"update",!0);const n={nodes:a.exit.map(Ht),edges:l.exit.map(Ht),combos:h.exit.map(Ht)};this.removeData(n)}))}addData(t){const{nodes:e,edges:n,combos:i}=t;this.batch((()=>{this.addComboData(i),this.addNodeData(e),this.addEdgeData(n)})),this.computeZIndex(t,"add")}addNodeData(t=[]){t.length&&(this.model.addNodes(t.map((t=>(this.pushChange({value:t,type:d.NodeAdded}),Oh(t))))),this.updateNodeLikeHierarchy(t),this.computeZIndex({nodes:t},"add"))}addEdgeData(t=[]){t.length&&(this.model.addEdges(t.map((t=>(this.pushChange({value:t,type:d.EdgeAdded}),Oh(t))))),this.computeZIndex({edges:t},"add"))}addComboData(t=[]){if(!t.length)return;const{model:e}=this;e.hasTreeStructure(x)||e.attachTreeStructure(x),e.addNodes(t.map((t=>(this.comboIds.add(Ht(t)),this.pushChange({value:t,type:d.ComboAdded}),Oh(t))))),this.updateNodeLikeHierarchy(t),this.computeZIndex({combos:t},"add")}addChildrenData(t,e){const n=this.getNodeLikeDatum(t),i=e.map(Ht);this.addNodeData(e),this.updateNodeData([{id:t,children:[...n.children||[],...i]}]),this.addEdgeData(i.map((e=>({source:t,target:e}))))}computeZIndex(t,e,n=!1){!n&&this.isBatching()||this.batch((()=>{const{nodes:n=[],edges:i=[],combos:s=[]}=t;s.forEach((t=>{var n,i,s;const o=Ht(t);if("add"===e&&(0,N.Z)(null===(n=t.style)||void 0===n?void 0:n.zIndex))return;if("update"===e&&!("combo"in t))return;const r=this.getParentData(o,x),a=r?(null!==(s=null===(i=r.style)||void 0===i?void 0:i.zIndex)&&void 0!==s?s:0)+1:0;this.preventUpdateNodeLikeHierarchy((()=>{this.updateComboData([{id:o,style:{zIndex:a}}])}))})),n.forEach((t=>{var n,i,s;const o=Ht(t);if("add"===e&&(0,N.Z)(null===(n=t.style)||void 0===n?void 0:n.zIndex))return;if("update"===e&&!("combo"in t)&&!("children"in t))return;let r=0;const a=this.getParentData(o,x);if(a)r=((null===(i=a.style)||void 0===i?void 0:i.zIndex)||0)+1;else{const t=this.getParentData(o,w);t&&(r=(null===(s=null==t?void 0:t.style)||void 0===s?void 0:s.zIndex)||0)}this.preventUpdateNodeLikeHierarchy((()=>{this.updateNodeData([{id:o,style:{zIndex:r}}])}))})),i.forEach((t=>{var e,n,i,s,o;if((0,N.Z)(null===(e=t.style)||void 0===e?void 0:e.zIndex))return;let{id:r,source:a,target:l}=t;if(r){const t=this.getEdgeDatum(r);a=t.source,l=t.target}else r=Ht(t);if(!a||!l)return;const h=(null===(i=null===(n=this.getNodeLikeDatum(a))||void 0===n?void 0:n.style)||void 0===i?void 0:i.zIndex)||0,c=(null===(o=null===(s=this.getNodeLikeDatum(l))||void 0===s?void 0:s.style)||void 0===o?void 0:o.zIndex)||0;this.updateEdgeData([{id:Ht(t),style:{zIndex:Math.max(h,c)-1}}])}))}))}getFrontZIndex(t){var e;const n=this.getElementType(t),i=this.getElementDataById(t),s=this.getData();if(Object.assign(s,{[`${n}s`]:s[`${n}s`].filter((e=>Ht(e)!==t))}),"combo"===n&&!on(i)){const e=new Set(this.getAncestorsData(t,x).map(Ht));s.nodes=s.nodes.filter((t=>!e.has(Ht(t)))),s.combos=s.combos.filter((t=>!e.has(Ht(t)))),s.edges=s.edges.filter((({source:t,target:n})=>!e.has(t)&&!e.has(n)))}return Math.max((null===(e=i.style)||void 0===e?void 0:e.zIndex)||0,0,...Object.values(s).flat().map((t=>{var e;return((null===(e=null==t?void 0:t.style)||void 0===e?void 0:e.zIndex)||0)+1})))}updateNodeLikeHierarchy(t){if(!this.enableUpdateNodeLikeHierarchy)return;const{model:e}=this;t.forEach((t=>{const n=Ht(t),i=Yt(t);void 0!==i&&(e.hasTreeStructure(x)||e.attachTreeStructure(x),null===i&&this.refreshComboData(n),this.setParent(n,Yt(t),x));const s=t.children||[];if(s.length){e.hasTreeStructure(w)||e.attachTreeStructure(w);const t=s.filter((t=>e.hasNode(t)));t.forEach((t=>this.setParent(t,n,w))),t.length!==s.length&&this.updateNodeData([{id:n,children:t}])}}))}preventUpdateNodeLikeHierarchy(t){this.enableUpdateNodeLikeHierarchy=!1,t(),this.enableUpdateNodeLikeHierarchy=!0}updateData(t){const{nodes:e,edges:n,combos:i}=t;this.batch((()=>{this.updateNodeData(e),this.updateComboData(i),this.updateEdgeData(n)})),this.computeZIndex(t,"update")}updateNodeData(t=[]){if(!t.length)return;const{model:e}=this;this.batch((()=>{const n=[];t.forEach((t=>{const i=Ht(t),s=Sh(e.getNode(i));if(xh(s,t))return;const o=bh(s,t);this.pushChange({value:o,original:s,type:d.NodeUpdated}),e.mergeNodeData(i,o),n.push(o)})),this.updateNodeLikeHierarchy(n)})),this.computeZIndex({nodes:t},"update")}refreshData(){const{nodes:t,edges:e,combos:n}=this.getData();t.forEach((t=>{this.pushChange({value:t,original:t,type:d.NodeUpdated})})),e.forEach((t=>{this.pushChange({value:t,original:t,type:d.EdgeUpdated})})),n.forEach((t=>{this.pushChange({value:t,original:t,type:d.ComboUpdated})}))}syncNodeLikeDatum(t){const{model:e}=this,n=Ht(t);if(!e.hasNode(n))return;const i=bh(Sh(e.getNode(n)),t);e.mergeNodeData(n,i)}syncEdgeDatum(t){const{model:e}=this,n=Ht(t);if(!e.hasEdge(n))return;const i=bh(Sh(e.getEdge(n)),t);e.mergeEdgeData(n,i)}updateEdgeData(t=[]){if(!t.length)return;const{model:e}=this;this.batch((()=>{t.forEach((t=>{const n=Ht(t),i=Sh(e.getEdge(n));if(xh(i,t))return;t.source&&i.source!==t.source&&e.updateEdgeSource(n,t.source),t.target&&i.target!==t.target&&e.updateEdgeTarget(n,t.target);const s=bh(i,t);this.pushChange({value:s,original:i,type:d.EdgeUpdated}),e.mergeEdgeData(n,s)}))})),this.computeZIndex({edges:t},"update")}updateComboData(t=[]){if(!t.length)return;const{model:e}=this;e.batch((()=>{const n=[];t.forEach((t=>{const i=Ht(t),s=Sh(e.getNode(i));if(xh(s,t))return;const o=bh(s,t);this.pushChange({value:o,original:s,type:d.ComboUpdated}),e.mergeNodeData(i,o),n.push(o)})),this.updateNodeLikeHierarchy(n)})),this.computeZIndex({combos:t},"update")}setParent(t,e,n,i=!0){if(t===e)return;const s=Yt(this.getNodeLikeDatum(t));if(s!==e&&n===x){const n={id:t,combo:e};this.isCombo(t),this.syncNodeLikeDatum(n)}this.model.setParent(t,e,n),i&&n===x&&function(t,e){void 0===e&&(e=new Map);var n=[];if(Array.isArray(t))for(var i=0,s=t.length;i<s;i++){var o=t[i];e.has(o)||(n.push(o),e.set(o,!0))}return n}([s,e]).forEach((t=>{void 0!==t&&this.refreshComboData(t)}))}refreshComboData(t){const e=this.getComboData([t])[0],n=this.getAncestorsData(t,x);e&&this.pushChange({value:e,original:e,type:d.ComboUpdated}),n.forEach((t=>{this.pushChange({value:t,original:t,type:d.ComboUpdated})}))}getElementPosition(t){return Me(this.getElementDataById(t))}translateNodeLikeBy(t,e){this.isCombo(t)?this.translateComboBy(t,e):this.translateNodeBy(t,e)}translateNodeLikeTo(t,e){this.isCombo(t)?this.translateComboTo(t,e):this.translateNodeTo(t,e)}translateNodeBy(t,e){const n=ce(this.getElementPosition(t),[...e,0].slice(0,3));this.translateNodeTo(t,n)}translateNodeTo(t,e){const[n=0,i=0,s=0]=e;this.preventUpdateNodeLikeHierarchy((()=>{this.updateNodeData([{id:t,style:{x:n,y:i,z:s}}])}))}translateComboBy(t,e){const[n=0,i=0,s=0]=e;if([n,i,s].some(isNaN)||[n,i,s].every((t=>0===t)))return;const o=this.getComboData([t])[0];if(!o)return;const r=new Set;Je(o,(t=>{const e=Ht(t);if(r.has(e))return;r.add(e);const[o,a,l]=Me(t),h=bh(t,{style:{x:o+n,y:a+i,z:l+s}});this.pushChange({value:h,original:t,type:this.isCombo(e)?d.ComboUpdated:d.NodeUpdated}),this.model.mergeNodeData(e,h)}),(t=>this.getChildrenData(Ht(t))),"BT")}translateComboTo(t,e){var n;if(e.some(isNaN))return;const[i=0,s=0,o=0]=e,r=null===(n=this.getComboData([t]))||void 0===n?void 0:n[0];if(!r)return;const[a,l,h]=Me(r),c=i-a,u=s-l,p=o-h;Je(r,(t=>{const e=Ht(t),[n,i,s]=Me(t),o=bh(t,{style:{x:n+c,y:i+u,z:s+p}});this.pushChange({value:o,original:t,type:this.isCombo(e)?d.ComboUpdated:d.NodeUpdated}),this.model.mergeNodeData(e,o)}),(t=>this.getChildrenData(Ht(t))),"BT")}removeData(t){const{nodes:e,edges:n,combos:i}=t;this.batch((()=>{this.removeEdgeData(n),this.removeNodeData(e),this.removeComboData(i),this.latestRemovedComboIds=new Set(i)}))}removeNodeData(t=[]){t.length&&this.batch((()=>{t.forEach((t=>{this.removeEdgeData(this.getRelatedEdgesData(t).map(Ht)),this.pushChange({value:this.getNodeData([t])[0],type:d.NodeRemoved}),this.removeNodeLikeHierarchy(t)})),this.model.removeNodes(t)}))}removeEdgeData(t=[]){t.length&&(t.forEach((t=>this.pushChange({value:this.getEdgeData([t])[0],type:d.EdgeRemoved}))),this.model.removeEdges(t))}removeComboData(t=[]){t.length&&this.batch((()=>{t.forEach((t=>{this.pushChange({value:this.getComboData([t])[0],type:d.ComboRemoved}),this.removeNodeLikeHierarchy(t),this.comboIds.delete(t)})),this.model.removeNodes(t)}))}removeNodeLikeHierarchy(t){if(this.model.hasTreeStructure(x)){const e=Yt(this.getNodeLikeDatum(t));this.setParent(t,void 0,x,!1),this.model.getChildren(t,x).forEach((t=>{const n=Sh(t),i=Ht(n);this.setParent(Ht(n),e,x,!1);const s=bh(n,{id:Ht(n),combo:e});this.pushChange({value:s,original:n,type:this.isCombo(i)?d.ComboUpdated:d.NodeUpdated}),this.model.mergeNodeData(Ht(n),s)})),(0,r.Z)(e)||this.refreshComboData(e)}}getElementType(t){if(this.model.hasNode(t))return this.isCombo(t)?"combo":"node";if(this.model.hasEdge(t))return"edge";throw new Error(C(`Unknown element type of id: ${t}`))}destroy(){const{model:t}=this,e=t.getAllNodes(),n=t.getAllEdges();t.removeEdges(n.map((t=>t.id))),t.removeNodes(e.map((t=>t.id))),this.context={}}}var Ch=function(t,e,n,i){return new(n||(n=Promise))((function(s,o){function r(t){try{l(i.next(t))}catch(t){o(t)}}function a(t){try{l(i.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,a)}l((i=i.apply(t,e||[])).next())}))};class Mh{constructor(t){this.elementMap={},this.shapeTypeMap={},this.paletteStyle={},this.defaultStyle={},this.stateStyle={},this.visibilityCache=new WeakMap,this.context=t}init(){this.initContainer()}initContainer(){if(!this.container||this.container.destroyed){const{canvas:t}=this.context;this.container=t.appendChild(new s.ZA({className:"elements"}))}}emit(t,e){e.silence||ch(this.context.graph,t)}forEachElementData(t){qe.forEach((e=>{const n=this.context.model.getElementsDataByType(e);t(e,n)}))}getElementType(t,e){var n;const{options:i,graph:s}=this.context,o=(null===(n=i[t])||void 0===n?void 0:n.type)||e.type;return o?"string"==typeof o?o:o.call(s,e):"edge"===t?"line":"circle"}getTheme(t){return T(this.context.options)[t]||{}}getThemeStyle(t){return this.getTheme(t).style||{}}getThemeStateStyle(t,e){const{state:n={}}=this.getTheme(t);return Object.assign({},...e.map((t=>n[t]||{})))}computePaletteStyle(){const{options:t}=this.context;this.paletteStyle={},this.forEachElementData(((e,n)=>{var i,s;const o=Object.assign({},bn(null===(i=this.getTheme(e))||void 0===i?void 0:i.palette),bn(null===(s=t[e])||void 0===s?void 0:s.palette));(null==o?void 0:o.field)&&Object.assign(this.paletteStyle,function(t,e){if(!e)return{};const{type:n,color:i,field:s,invert:o}=e,r=t=>{const e="string"==typeof i?D("palette",i):i;if("function"==typeof e){const n={};return t.forEach((([t,i])=>{n[t]=e(o?1-i:i)})),n}if(Array.isArray(e)){const n=o?[...e].reverse():e,i={};return t.forEach((([t,s])=>{i[t]=n[s%e.length]})),i}return{}},a=(t,e)=>{var n;return"string"==typeof t?null===(n=e.data)||void 0===n?void 0:n[t]:null==t?void 0:t(e)};if("group"===n){const e=G(t,(t=>{if(!s)return"default";const e=a(s,t);return e?String(e):"default"})),n=r(Object.keys(e).map(((t,e)=>[t,e]))),i={};return Object.entries(e).forEach((([t,e])=>{e.forEach((e=>{i[Ht(e)]=n[t]}))})),i}if("value"===n){const[e,n]=t.reduce((([t,e],n)=>{const i=a(s,n);if("number"!=typeof i)throw new Error(C(`Palette field ${s} is not a number`));return[Math.min(t,i),Math.max(e,i)]}),[1/0,-1/0]),i=n-e;return r(t.map((t=>[t.id,(a(s,t)-e)/i])))}}(n,o))}))}getPaletteStyle(t,e){const n=this.paletteStyle[e];return n?"edge"===t?{stroke:n}:{fill:n}:{}}computeElementDefaultStyle(t,e){var n;const{options:i}=this.context,s=(null===(n=i[t])||void 0===n?void 0:n.style)||{};"transform"in s&&Array.isArray(s.transform)&&(s.transform=[...s.transform]),this.defaultStyle[Ht(e.datum)]=mn(s,e)}computeElementsDefaultStyle(t){const{graph:e}=this.context;this.forEachElementData(((n,i)=>{const s=i.length;for(let o=0;o<s;o++){const s=i[o];(void 0===t||t.includes(Ht(s)))&&this.computeElementDefaultStyle(n,{datum:s,graph:e})}}))}getDefaultStyle(t){return this.defaultStyle[t]||{}}getElementState(t){try{const{model:e}=this.context;return e.getElementState(t)}catch(t){return[]}}getElementStateStyle(t,e,n){var i,s;const{options:o}=this.context;return mn((null===(s=null===(i=o[t])||void 0===i?void 0:i.state)||void 0===s?void 0:s[e])||{},n)}computeElementStatesStyle(t,e,n){this.stateStyle[Ht(n.datum)]=Object.assign({},...e.map((e=>this.getElementStateStyle(t,e,n))))}computeElementsStatesStyle(t){const{graph:e}=this.context;this.forEachElementData(((n,i)=>{const s=i.length;for(let o=0;o<s;o++){const s=i[o];if(void 0===t||t.includes(Ht(s))){const t=this.getElementState(Ht(s));this.computeElementStatesStyle(n,t,{datum:s,graph:e})}}}))}getStateStyle(t){return this.stateStyle[t]||{}}computeStyle(t,e){t&&["translate","zIndex"].includes(t)||(this.computePaletteStyle(),this.computeElementsDefaultStyle(e),this.computeElementsStatesStyle(e))}getElement(t){return this.elementMap[t]}getNodes(){return this.context.model.getNodeData().map((({id:t})=>this.elementMap[t]))}getEdges(){return this.context.model.getEdgeData().map((t=>this.elementMap[Ht(t)]))}getCombos(){return this.context.model.getComboData().map((({id:t})=>this.elementMap[t]))}getElementComputedStyle(t,e){const n=Ht(e),i=this.getThemeStyle(t),s=this.getPaletteStyle(t,n),o=e.style||{},r=this.getDefaultStyle(n),a=this.getThemeStateStyle(t,this.getElementState(n)),l=this.getStateStyle(n),h=Object.assign({},i,s,o,r,a,l);if("combo"===t){const t=this.context.model.getChildrenData(n),e=!!h.collapsed?[]:t.map(Ht).filter((t=>this.getElement(t)));Object.assign(h,{childrenNode:e,childrenData:t})}return h}getDrawData(t){this.init();const e=this.computeChangesAndDrawData(t);if(!e)return null;const{type:n="draw",stage:i=n}=t;return this.markDestroyElement(e.drawData),this.computeStyle(i),{type:n,stage:i,data:e}}draw(t={animation:!0}){const e=this.getDrawData(t);if(!e)return;const{data:{drawData:{add:n,update:i,remove:s}}}=e;return this.destroyElements(s,t),this.createElements(n,t),this.updateElements(i,t),this.setAnimationTask(t,e)}preLayoutDraw(){return Ch(this,arguments,void 0,(function*(t={animation:!0}){var e,n;const i=this.getDrawData(t);if(!i)return;const{data:{drawData:s}}=i;yield null===(n=null===(e=this.context.layout)||void 0===e?void 0:e.preLayout)||void 0===n?void 0:n.call(e,s);const{add:o,update:r,remove:a}=s;return this.destroyElements(a,t),this.createElements(o,t),this.updateElements(r,t),this.setAnimationTask(t,i)}))}setAnimationTask(t,e){const{animation:n,silence:i}=t,{data:{dataChanges:s,drawData:o},stage:r,type:a}=e;return this.context.animation.animate(n,i?{}:{before:()=>this.emit(new rh(v.BEFORE_DRAW,{dataChanges:s,animation:n,stage:r,render:"render"===a}),t),beforeAnimate:e=>this.emit(new ah(v.BEFORE_ANIMATE,u.DRAW,e,o),t),afterAnimate:e=>this.emit(new ah(v.AFTER_ANIMATE,u.DRAW,e,o),t),after:()=>this.emit(new rh(v.AFTER_DRAW,{dataChanges:s,animation:n,stage:r,render:"render"===a,firstRender:!1===this.context.graph.rendered}),t)})}computeChangesAndDrawData(t){const{model:e}=this.context,n=e.getChanges(),i=jr(n);if(0===i.length)return null;const{NodeAdded:s=[],NodeUpdated:o=[],NodeRemoved:r=[],EdgeAdded:a=[],EdgeUpdated:l=[],EdgeRemoved:h=[],ComboAdded:c=[],ComboUpdated:d=[],ComboRemoved:u=[]}=G(i,(t=>t.type)),p=t=>new Map(t.map((t=>{const e=t.value;return[Ht(e),e]}))),g={add:{nodes:p(s),edges:p(a),combos:p(c)},update:{nodes:p(o),edges:p(l),combos:p(d)},remove:{nodes:p(r),edges:p(h),combos:p(u)}},f=this.transformData(g,t);return e.clearChanges(),{dataChanges:n,drawData:f}}transformData(t,e){const n=this.context.transform.getTransformInstance();return Object.values(n).reduce(((t,n)=>n.beforeDraw(t,e)),t)}createElement(t,e,n){var i;const s=Ht(e);if(this.getElement(s))return;const o=this.getElementType(t,e),r=this.getElementComputedStyle(t,e),a=D(t,o);if(!a)return M.warn(`The element ${o} of ${t} is not registered.`);this.emit(new lh(v.BEFORE_ELEMENT_CREATE,t,e),n);const l=this.container.appendChild(new a({id:s,context:this.context,style:r}));this.shapeTypeMap[s]=o,this.elementMap[s]=l;const{stage:h="enter"}=n;null===(i=this.context.animation)||void 0===i||i.add({element:l,elementType:t,stage:h,originalStyle:Object.assign({},l.attributes),updatedStyle:r},{after:()=>{var i;this.emit(new lh(v.AFTER_ELEMENT_CREATE,t,e),n),null===(i=l.onCreate)||void 0===i||i.call(l)}})}createElements(t,e){const{nodes:n,edges:i,combos:s}=t;[["node",n],["combo",s],["edge",i]].forEach((([t,n])=>{n.forEach((n=>this.createElement(t,n,e)))}))}getUpdateStageStyle(t,e,n){const{stage:i="update"}=n;if("translate"===i){if("node"===t||"combo"===t){const{style:{x:t=0,y:n=0,z:i=0}={}}=e;return{x:t,y:n,z:i}}return{}}return this.getElementComputedStyle(t,e)}updateElement(t,e,n){var i;const s=Ht(e),{stage:o="update"}=n,r=this.getElement(s);if(!r)return()=>null;this.emit(new lh(v.BEFORE_ELEMENT_UPDATE,t,e),n);const a=this.getElementType(t,e),l=this.getUpdateStageStyle(t,e,n);this.shapeTypeMap[s]!==a&&(r.destroy(),delete this.shapeTypeMap[s],delete this.elementMap[s],this.createElement(t,e,{animation:!1,silence:!0}));const h="visibility"!==o?o:"hidden"===l.visibility?"hide":"show";"hide"===h&&delete l.visibility,null===(i=this.context.animation)||void 0===i||i.add({element:r,elementType:t,stage:h,originalStyle:Object.assign({},r.attributes),updatedStyle:l},{before:()=>{const t=this.elementMap[s];"collapse"!==o&&Ds(t,l),"visibility"===o&&(function(t,e){return ph(e)in((0,rn.Z)(t,uh)||{})}(t,"opacity")||function(t,e){const n=Array.isArray(e)?e:[e];(0,rn.Z)(t,uh)||(0,an.Z)(t,uh,{}),n.forEach((e=>{(0,an.Z)((0,rn.Z)(t,uh),ph(e),t.attributes[e])}))}(t,"opacity"),this.visibilityCache.set(t,"show"===h?"visible":"hidden"),"show"===h&&ie(t,"visible"))},after:()=>{var i;const r=this.elementMap[s];"collapse"===o&&Ds(r,l),"hide"===h&&ie(r,this.visibilityCache.get(r)),this.emit(new lh(v.AFTER_ELEMENT_UPDATE,t,e),n),null===(i=r.onUpdate)||void 0===i||i.call(r)}})}updateElements(t,e){const{nodes:n,edges:i,combos:s}=t;[["node",n],["combo",s],["edge",i]].forEach((([t,n])=>{n.forEach((n=>this.updateElement(t,n,e)))}))}markDestroyElement(t){Object.values(t.remove).forEach((t=>{t.forEach((t=>{const e=Ht(t),n=this.getElement(e);n&&function(t){(0,an.Z)(t,"__to_be_destroyed__",!0)}(n)}))}))}destroyElement(t,e,n){var i;const{stage:s="exit"}=n,o=Ht(e),r=this.elementMap[o];if(!r)return()=>null;this.emit(new lh(v.BEFORE_ELEMENT_DESTROY,t,e),n),null===(i=this.context.animation)||void 0===i||i.add({element:r,elementType:t,stage:s,originalStyle:Object.assign({},r.attributes),updatedStyle:{}},{after:()=>{var i;this.clearElement(o),r.destroy(),null===(i=r.onDestroy)||void 0===i||i.call(r),this.emit(new lh(v.AFTER_ELEMENT_DESTROY,t,e),n)}})}destroyElements(t,e){const{nodes:n,edges:i,combos:s}=t;[["combo",s],["edge",i],["node",n]].forEach((([t,n])=>{n.forEach((n=>this.destroyElement(t,n,e)))}))}clearElement(t){delete this.paletteStyle[t],delete this.defaultStyle[t],delete this.stateStyle[t],delete this.elementMap[t],delete this.shapeTypeMap[t]}alignLayoutResultToElement(t,e){var n,i;const s=null===(n=t.nodes)||void 0===n?void 0:n.find((t=>Ht(t)===e));if(s){const n=de(Me(this.context.model.getNodeLikeDatum(e)),Me(s));null===(i=t.nodes)||void 0===i||i.forEach((t=>{var e,i,s;(null===(e=t.style)||void 0===e?void 0:e.x)&&(t.style.x+=n[0]),(null===(i=t.style)||void 0===i?void 0:i.y)&&(t.style.y+=n[1]),(null===(s=t.style)||void 0===s?void 0:s.z)&&(t.style.z+=n[2]||0)}))}}collapseNode(t,e){return Ch(this,void 0,void 0,(function*(){var n;const{animation:i,align:s}=e,{model:o,layout:r}=this.context,a=this.computeChangesAndDrawData({stage:"collapse",animation:i});if(!a)return;this.markDestroyElement(a.drawData);const l=yield r.simulate();s&&this.alignLayoutResultToElement(l,t),o.updateData(l);const h=this.computeChangesAndDrawData({stage:"collapse",animation:i});if(!h)return;const{drawData:c}=h,{add:d,remove:p,update:g}=c;this.markDestroyElement(c);const f={animation:i,stage:"collapse",data:c};this.destroyElements(p,f),this.createElements(d,f),this.updateElements(g,f),yield null===(n=this.context.animation.animate(i,{beforeAnimate:t=>this.emit(new ah(v.BEFORE_ANIMATE,u.COLLAPSE,t,c),f),afterAnimate:t=>this.emit(new ah(v.AFTER_ANIMATE,u.COLLAPSE,t,c),f)},{collapse:{target:t,descendants:Array.from(p.nodes).map((([,t])=>Ht(t))),position:Me(g.nodes.get(t))}}))||void 0===n?void 0:n.finished}))}expandNode(t,e){return Ch(this,void 0,void 0,(function*(){var n;const{model:i,layout:s}=this.context,{animation:o,align:r}=e,a=Me(i.getNodeData([t])[0]),l=this.computeChangesAndDrawData({stage:"expand",animation:o});if(!l)return;const{drawData:{add:h}}=l;this.createElements(h,{animation:!1,stage:"expand",target:t}),this.context.animation.clear();const c=yield s.simulate();r&&this.alignLayoutResultToElement(c,t),i.updateData(c),this.computeStyle("expand");const d=this.computeChangesAndDrawData({stage:"collapse",animation:o});if(!d)return;const{drawData:p}=d,{update:g}=p,f={animation:o,stage:"expand",data:p};h.edges.forEach((t=>g.edges.set(Ht(t),t))),h.nodes.forEach((t=>g.nodes.set(Ht(t),t))),this.updateElements(g,f),yield null===(n=this.context.animation.animate(o,{beforeAnimate:t=>this.emit(new ah(v.BEFORE_ANIMATE,u.EXPAND,t,p),f),afterAnimate:t=>this.emit(new ah(v.AFTER_ANIMATE,u.EXPAND,t,p),f)},{expand:{target:t,descendants:Array.from(h.nodes).map((([,t])=>Ht(t))),position:a}}))||void 0===n?void 0:n.finished}))}collapseCombo(t,e){return Ch(this,void 0,void 0,(function*(){var n;const{model:i,element:s}=this.context;if(i.getAncestorsData(t,x).some((t=>on(t))))return;const o=s.getElement(t),r=o.getComboPosition(Object.assign(Object.assign({},o.attributes),{collapsed:!0})),a=this.computeChangesAndDrawData({stage:"collapse",animation:e});if(!a)return;const{dataChanges:l,drawData:h}=a;this.markDestroyElement(h);const{update:c,remove:d}=h,p={animation:e,stage:"collapse",data:h};this.destroyElements(d,p),this.updateElements(c,p);const g=t=>Array.from(t).map((([,t])=>Ht(t)));yield null===(n=this.context.animation.animate(e,{before:()=>this.emit(new rh(v.BEFORE_DRAW,{dataChanges:l,animation:e}),p),beforeAnimate:t=>this.emit(new ah(v.BEFORE_ANIMATE,u.COLLAPSE,t,h),p),afterAnimate:t=>this.emit(new ah(v.AFTER_ANIMATE,u.COLLAPSE,t,h),p),after:()=>this.emit(new rh(v.AFTER_DRAW,{dataChanges:l,animation:e}),p)},{collapse:{target:t,descendants:[...g(d.nodes),...g(d.combos)],position:r}}))||void 0===n?void 0:n.finished}))}expandCombo(t,e){return Ch(this,void 0,void 0,(function*(){var n;const{model:i}=this.context,s=Me(i.getComboData([t])[0]);this.computeStyle("expand");const o=this.computeChangesAndDrawData({stage:"expand",animation:e});if(!o)return;const{dataChanges:r,drawData:a}=o,{add:l,update:h}=a,c={animation:e,stage:"expand",data:a,target:t};this.createElements(l,c),this.updateElements(h,c);const d=t=>Array.from(t).map((([,t])=>Ht(t)));yield null===(n=this.context.animation.animate(e,{before:()=>this.emit(new rh(v.BEFORE_DRAW,{dataChanges:r,animation:e}),c),beforeAnimate:t=>this.emit(new ah(v.BEFORE_ANIMATE,u.EXPAND,t,a),c),afterAnimate:t=>this.emit(new ah(v.AFTER_ANIMATE,u.EXPAND,t,a),c),after:()=>this.emit(new rh(v.AFTER_DRAW,{dataChanges:r,animation:e}),c)},{expand:{target:t,descendants:[...d(l.nodes),...d(l.combos)],position:s}}))||void 0===n?void 0:n.finished}))}clear(){this.container.destroy(),this.initContainer(),this.elementMap={},this.shapeTypeMap={},this.defaultStyle={},this.stateStyle={},this.paletteStyle={}}destroy(){this.clear(),this.container.destroy(),this.context={}}}const Th=Symbol("Comlink.proxy"),Ph=Symbol("Comlink.endpoint"),Ah=Symbol("Comlink.releaseProxy"),Rh=Symbol("Comlink.finalizer"),Lh=Symbol("Comlink.thrown"),kh=t=>"object"==typeof t&&null!==t||"function"==typeof t,Nh=new Map([["proxy",{canHandle:t=>kh(t)&&t[Th],serialize(t){const{port1:e,port2:n}=new MessageChannel;return Ih(t,e),[n,[n]]},deserialize(t){return t.start(),Bh(t)}}],["throw",{canHandle:t=>kh(t)&&Lh in t,serialize({value:t}){let e;return e=t instanceof Error?{isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:{isError:!1,value:t},[e,[]]},deserialize(t){if(t.isError)throw Object.assign(new Error(t.value.message),t.value);throw t.value}}]]);function Ih(t,e=globalThis,n=["*"]){e.addEventListener("message",(function i(s){if(!s||!s.data)return;if(!function(t,e){for(const n of t){if(e===n||"*"===n)return!0;if(n instanceof RegExp&&n.test(e))return!0}return!1}(n,s.origin))return void console.warn(`Invalid origin '${s.origin}' for comlink proxy`);const{id:o,type:r,path:a}=Object.assign({path:[]},s.data),l=(s.data.argumentList||[]).map(Yh);let h;try{const e=a.slice(0,-1).reduce(((t,e)=>t[e]),t),n=a.reduce(((t,e)=>t[e]),t);switch(r){case"GET":h=n;break;case"SET":e[a.slice(-1)[0]]=Yh(s.data.value),h=!0;break;case"APPLY":h=n.apply(e,l);break;case"CONSTRUCT":h=function(t){return Object.assign(t,{[Th]:!0})}(new n(...l));break;case"ENDPOINT":{const{port1:e,port2:n}=new MessageChannel;Ih(t,n),h=function(t,e){return Wh.set(t,e),t}(e,[e])}break;case"RELEASE":h=void 0;break;default:return}}catch(t){h={value:t,[Lh]:0}}Promise.resolve(h).catch((t=>({value:t,[Lh]:0}))).then((n=>{const[s,a]=Hh(n);e.postMessage(Object.assign(Object.assign({},s),{id:o}),a),"RELEASE"===r&&(e.removeEventListener("message",i),jh(e),Rh in t&&"function"==typeof t[Rh]&&t[Rh]())})).catch((t=>{const[n,i]=Hh({value:new TypeError("Unserializable return value"),[Lh]:0});e.postMessage(Object.assign(Object.assign({},n),{id:o}),i)}))})),e.start&&e.start()}function jh(t){(function(t){return"MessagePort"===t.constructor.name})(t)&&t.close()}function Bh(t,e){const n=new Map;return t.addEventListener("message",(function(t){const{data:e}=t;if(!e||!e.id)return;const i=n.get(e.id);if(i)try{i(e)}finally{n.delete(e.id)}})),$h(t,n,[],e)}function zh(t){if(t)throw new Error("Proxy has been released and is not useable")}function Fh(t){return Gh(t,new Map,{type:"RELEASE"}).then((()=>{jh(t)}))}const _h=new WeakMap,Zh="FinalizationRegistry"in globalThis&&new FinalizationRegistry((t=>{const e=(_h.get(t)||0)-1;_h.set(t,e),0===e&&Fh(t)}));function $h(t,e,n=[],i=function(){}){let s=!1;const o=new Proxy(i,{get(i,r){if(zh(s),r===Ah)return()=>{!function(t){Zh&&Zh.unregister(t)}(o),Fh(t),e.clear(),s=!0};if("then"===r){if(0===n.length)return{then:()=>o};const i=Gh(t,e,{type:"GET",path:n.map((t=>t.toString()))}).then(Yh);return i.then.bind(i)}return $h(t,e,[...n,r])},set(i,o,r){zh(s);const[a,l]=Hh(r);return Gh(t,e,{type:"SET",path:[...n,o].map((t=>t.toString())),value:a},l).then(Yh)},apply(i,o,r){zh(s);const a=n[n.length-1];if(a===Ph)return Gh(t,e,{type:"ENDPOINT"}).then(Yh);if("bind"===a)return $h(t,e,n.slice(0,-1));const[l,h]=Vh(r);return Gh(t,e,{type:"APPLY",path:n.map((t=>t.toString())),argumentList:l},h).then(Yh)},construct(i,o){zh(s);const[r,a]=Vh(o);return Gh(t,e,{type:"CONSTRUCT",path:n.map((t=>t.toString())),argumentList:r},a).then(Yh)}});return function(t,e){const n=(_h.get(e)||0)+1;_h.set(e,n),Zh&&Zh.register(t,e,t)}(o,t),o}function Vh(t){const e=t.map(Hh);return[e.map((t=>t[0])),(n=e.map((t=>t[1])),Array.prototype.concat.apply([],n))];var n}const Wh=new WeakMap;function Hh(t){for(const[e,n]of Nh)if(n.canHandle(t)){const[i,s]=n.serialize(t);return[{type:"HANDLER",name:e,value:i},s]}return[{type:"RAW",value:t},Wh.get(t)||[]]}function Yh(t){switch(t.type){case"HANDLER":return Nh.get(t.name).deserialize(t.value);case"RAW":return t.value}}function Gh(t,e,n,i){return new Promise((s=>{const o=new Array(4).fill(0).map((()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16))).join("-");e.set(o,s),t.start&&t.start(),t.postMessage(Object.assign({id:o},n),i)}))}class Uh extends Ir.Z{constructor(t,e,n){super(),this.graph=t,this.layout=e,this.options=n,this.spawnWorker()}spawnWorker(){this.proxy=Bh(new Worker(new URL(n.p+n.u(1905),n.b),{type:void 0})),this.running&&(this.running=!1,this.execute())}execute(){var t;return(0,bt.mG)(this,void 0,void 0,(function*(){if(this.running)return this;this.running=!0;const e=this.layout.options,{onTick:n}=e,i=(0,bt._T)(e,["onTick"]),s={};Object.keys(i).forEach((t=>{(0,W.Z)(i[t])||(s[t]=i[t])}));const o={layout:{id:this.layout.id,options:s,iterations:null===(t=this.options)||void 0===t?void 0:t.iterations},nodes:this.graph.getAllNodes(),edges:this.graph.getAllEdges()},r=new Float32Array([0]),[a]=yield this.proxy.calculateLayout(o,[r]);return a}))}stop(){return this.running=!1,this.proxy.stopLayout(),this}kill(){this.proxy[Ah]()}isRunning(){return this.running}}var Kh=n(10779),Xh=function(t,e,n,i){return new(n||(n=Promise))((function(s,o){function r(t){try{l(i.next(t))}catch(t){o(t)}}function a(t){try{l(i.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,a)}l((i=i.apply(t,e||[])).next())}))},qh=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(n[i[s]]=t[i[s]])}return n};class Jh{get presetOptions(){return{animation:!!L(this.context.options,!0)}}get options(){const{options:t}=this.context;return t.layout}constructor(t){this.instances=[],this.context=t}getLayoutInstance(){return this.instances}preLayout(t){return Xh(this,void 0,void 0,(function*(){var e,n,i,s;const{graph:o,model:r}=this.context,{add:a}=t;ch(o,new rh(v.BEFORE_LAYOUT,{type:"pre"}));const l=yield null===(e=this.context.layout)||void 0===e?void 0:e.simulate();null===(n=null==l?void 0:l.nodes)||void 0===n||n.forEach((t=>{const e=Ht(t),n=a.nodes.get(e);r.syncNodeLikeDatum(t),n&&Object.assign(n.style,t.style)})),null===(i=null==l?void 0:l.edges)||void 0===i||i.forEach((t=>{const e=Ht(t),n=a.edges.get(e);r.syncEdgeDatum(t),n&&Object.assign(n.style,t.style)})),null===(s=null==l?void 0:l.combos)||void 0===s||s.forEach((t=>{const e=Ht(t),n=a.combos.get(e);r.syncNodeLikeDatum(t),n&&Object.assign(n.style,t.style)})),ch(o,new rh(v.AFTER_LAYOUT,{type:"pre"})),this.transformDataAfterLayout("pre",t)}))}postLayout(){return Xh(this,arguments,void 0,(function*(t=this.options){if(!t)return;const e=Array.isArray(t)?t:[t],{graph:n}=this.context;ch(n,new rh(v.BEFORE_LAYOUT,{type:"post"}));for(let t=0;t<e.length;t++){const i=e[t],s=this.getLayoutData(i),o=Object.assign(Object.assign({},this.presetOptions),i);ch(n,new rh(v.BEFORE_STAGE_LAYOUT,{options:o,index:t}));const r=yield this.stepLayout(s,o,t);ch(n,new rh(v.AFTER_STAGE_LAYOUT,{options:o,index:t})),i.animation||this.updateElementPosition(r,!1)}ch(n,new rh(v.AFTER_LAYOUT,{type:"post"})),this.transformDataAfterLayout("post")}))}transformDataAfterLayout(t,e){const n=this.context.transform.getTransformInstance();Object.values(n).forEach((n=>n.afterLayout(t,e)))}simulate(){return Xh(this,void 0,void 0,(function*(){if(!this.options)return{};const t=Array.isArray(this.options)?this.options:[this.options];let e={};for(let n=0;n<t.length;n++){const i=t[n],s=this.getLayoutData(i);e=yield this.stepLayout(s,Object.assign(Object.assign(Object.assign({},this.presetOptions),i),{animation:!1}),n)}return e}))}stepLayout(t,e,n){return Xh(this,void 0,void 0,(function*(){return function(t){const{type:e}=t;return["compact-box","mindmap","dendrogram","indented"].includes(e)}(e)?yield this.treeLayout(t,e,n):yield this.graphLayout(t,e,n)}))}graphLayout(t,e,n){return Xh(this,void 0,void 0,(function*(){const{animation:i,enableWorker:s,iterations:o=300}=e,r=this.initGraphLayout(e);if(!r)return{};if(this.instances[n]=r,this.instance=r,s){const e=r;return this.supervisor=new Uh(e.graphData2LayoutModel(t),e.instance,{iterations:o}),$s(yield this.supervisor.execute())}if((0,Kh.h)(r))return i?yield r.execute(t,{onTick:t=>{this.updateElementPosition(t,!1)}}):(r.execute(t),r.stop(),r.tick(o));const a=yield r.execute(t);if(i){const t=this.updateElementPosition(a,i);yield null==t?void 0:t.finished}return a}))}treeLayout(t,e,n){return Xh(this,void 0,void 0,(function*(){const{type:n,animation:i}=e,s=D("layout",n);if(!s)return{};const{nodes:o=[],edges:r=[]}=t,a=new zs.k({nodes:o.map((t=>({id:Ht(t),data:t.data||{}}))),edges:r.map((t=>({id:Ht(t),source:t.source,target:t.target,data:t.data||{}})))});!function(t){if(t.hasTreeStructure(w))return;t.attachTreeStructure(w);const e=t.getAllEdges();for(const n of e){const{source:e,target:i}=n;t.setParent(i,e,w)}}(a);const l={nodes:[],edges:[]},h={nodes:[],edges:[]};a.getRoots(w).forEach((t=>{Je(t,(t=>{t.children=a.getSuccessors(t.id)}),(t=>a.getSuccessors(t.id)),"TB");const n=s(t,e),{x:i,y:o,z:r=0}=n;Je(n,(t=>{const{id:e,x:n,y:s,z:a=0}=t;l.nodes.push({id:e,style:{x:i,y:o,z:r}}),h.nodes.push({id:e,style:{x:n,y:s,z:a}})}),(t=>t.children),"TB")}));const c=this.inferTreeLayoutOffset(h);if(Qh(h,c),i){Qh(l,c),this.updateElementPosition(l,!1);const t=this.updateElementPosition(h,i);yield null==t?void 0:t.finished}return h}))}inferTreeLayoutOffset(t){var e;let[n,i]=[1/0,-1/0],[s,o]=[1/0,-1/0];null===(e=t.nodes)||void 0===e||e.forEach((t=>{const{x:e=0,y:r=0}=t.style||{};n=Math.min(n,e),i=Math.max(i,e),s=Math.min(s,r),o=Math.max(o,r)}));const{canvas:r}=this.context,a=r.getSize(),[l,h]=r.getCanvasByViewport([0,0]),[c,d]=r.getCanvasByViewport(a);if(n>=l&&i<=c&&s>=h&&o<=d)return[0,0];return[(l+c)/2-(n+i)/2,(h+d)/2-(s+o)/2]}stopLayout(){this.instance&&(0,Kh.h)(this.instance)&&(this.instance.stop(),this.instance=void 0),this.supervisor&&(this.supervisor.stop(),this.supervisor=void 0),this.animationResult&&(this.animationResult.finish(),this.animationResult=void 0)}getLayoutData(t){const{nodeFilter:e=()=>!0,preLayout:n=!1,isLayoutInvisibleNodes:i=!1}=t,{nodes:s,edges:o,combos:r}=this.context.model.getData(),{element:a,model:l}=this.context,h=t=>a.getElement(t),c=n?t=>{var n;if(!i){if("hidden"===(null===(n=t.style)||void 0===n?void 0:n.visibility))return!1;if(l.getAncestorsData(t.id,w).some(on))return!1;if(l.getAncestorsData(t.id,x).some(on))return!1}return e(t)}:t=>{const n=Ht(t),i=h(n);return!!i&&(!Cs(i)&&e(t))},d=s.filter(c),u=new Map(d.map((t=>[Ht(t),t])));r.forEach((t=>u.set(Ht(t),t)));return{nodes:d,edges:o.filter((({source:t,target:e})=>u.has(t)&&u.has(e))),combos:r}}initGraphLayout(t){var e;const{element:n,viewport:i}=this.context,{type:s,enableWorker:o,animation:r,iterations:a}=t,l=qh(t,["type","enableWorker","animation","iterations"]),[h,c]=i.getCanvasSize(),d=[h/2,c/2],u=null!==(e=null==t?void 0:t.nodeSize)&&void 0!==e?e:t=>{const e=null==n?void 0:n.getElement(t.id);return e?e.attributes.size:null==n?void 0:n.getElementComputedStyle("node",t).size},p=D("layout",s);if(!p)return M.warn(`The layout of ${s} is not registered.`);const g=Object.getPrototypeOf(p.prototype)===Fs.prototype?p:function(t,e){return class extends Fs{constructor(e,n){if(super(e,n),this.instance=new t({}),this.id=this.instance.id,"stop"in this.instance&&"tick"in this.instance){const t=this.instance;this.stop=t.stop.bind(t),this.tick=e=>$s(t.tick(e))}}execute(t,e){return _s(this,void 0,void 0,(function*(){return $s(yield this.instance.execute(this.graphData2LayoutModel(t),this.transformOptions((0,le.Z)({},this.options,e))))}))}transformOptions(t){const{onTick:e}=t;return e?(t.onTick=t=>e($s(t)),t):t}graphData2LayoutModel(t){const{nodes:n=[],edges:i=[],combos:s=[]}=t,o=n.map((t=>{const e=Ht(t),{data:n,style:i,combo:s}=t,o=Zs(t,["data","style","combo"]),r={id:e,data:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},n),{data:n}),s?{parentId:s}:{}),{style:i}),o)};return(null==i?void 0:i.x)&&Object.assign(r.data,{x:i.x}),(null==i?void 0:i.y)&&Object.assign(r.data,{y:i.y}),(null==i?void 0:i.z)&&Object.assign(r.data,{z:i.z}),r})),r=new Map(o.map((t=>[t.id,t]))),a=i.filter((t=>{const{source:e,target:n}=t;return r.has(e)&&r.has(n)})).map((t=>{const{source:e,target:n,data:i,style:s}=t;return{id:Ht(t),source:e,target:n,data:Object.assign({},i),style:Object.assign({},s)}})),l=s.map((t=>({id:Ht(t),data:Object.assign({_isCombo:!0},t.data),style:Object.assign({},t.style)}))),h=new zs.k({nodes:[...o,...l],edges:a});return e.model.model.hasTreeStructure(x)&&(h.attachTreeStructure(x),o.forEach((t=>{const n=e.model.model.getParent(t.id,x);n&&h.hasNode(n.id)&&h.setParent(t.id,n.id,x)}))),h}}}(p,this.context),f=new g(this.context),y={nodeSize:u,width:h,height:c,center:d};switch(f.id){case"d3-force":case"d3-force-3d":Object.assign(y,{center:{x:h/2,y:c/2,z:0}})}return(0,le.Z)(f.options,y,l),f}updateElementPosition(t,e){const{model:n,element:i}=this.context;return i?(n.updateData(t),i.draw({animation:e,silence:!0})):null}destroy(){var t;this.stopLayout(),this.context={},null===(t=this.supervisor)||void 0===t||t.kill(),this.supervisor=void 0,this.instance=void 0,this.instances=[],this.animationResult=void 0}}const Qh=(t,e)=>{var n;const[i,s]=e;null===(n=t.nodes)||void 0===n||n.forEach((t=>{if(t.style){const{x:e=0,y:n=0}=t.style;t.style.x=e+i,t.style.y=n+s}else t.style={x:i,y:s}}))};function tc(t){return t.layout?(Array.isArray(t.layout)||"preLayout"in t.layout||["antv-dagre","combo-combined","compact-box","circular","concentric","dagre","fishbone","grid","indented","mds","radial","random","snake","dendrogram","mindmap"].includes(t.layout.type)&&(t.layout.preLayout=!0),t):t}class ec extends se{constructor(t){super(t),this.category="plugin",this.setPlugins(this.context.options.plugins||[])}setPlugins(t){this.setExtensions(t)}getPluginInstance(t){const e=this.extensionMap[t];if(e)return e;M.warn(`Cannot find the plugin ${t}, will try to find it by type.`);const n=this.extensions.find((e=>e.type===t));return n?this.extensionMap[n.key]:void 0}}const nc=["update-related-edges","collapse-expand-node","collapse-expand-combo","get-edge-actual-ends","arrange-draw-order"];class ic extends se{constructor(t){super(t),this.category="transform",this.setTransforms(this.context.options.transforms||[])}getTransforms(){}setTransforms(t){this.setExtensions([...nc.slice(0,nc.length-1),...t,nc[nc.length-1]])}getTransformInstance(t){return t?this.extensionMap[t]:this.extensionMap}}var sc=function(t,e,n,i){return new(n||(n=Promise))((function(s,o){function r(t){try{l(i.next(t))}catch(t){o(t)}}function a(t){try{l(i.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,a)}l((i=i.apply(t,e||[])).next())}))};class oc{get padding(){return J(this.context.options.padding)}get paddingOffset(){const[t,e,n,i]=this.padding,[s,o,r]=[(i-e)/2,(t-n)/2,0];return[s,o,r]}constructor(t){this.landmarkCounter=0,this.context=t;const[e,n]=this.paddingOffset,{zoom:i,rotation:s,x:o=e,y:r=n}=t.options;this.transform({mode:"absolute",scale:i,translate:[o,r],rotate:s},!1)}get camera(){const{canvas:t}=this.context;return new Proxy(t.getCamera(),{get:(e,n)=>{const i=Object.entries(t.getLayers()).filter((([t])=>!["main"].includes(t))).map((([,t])=>t.getCamera())),s=e[n];if("function"==typeof s)return(...t)=>{const o=s.apply(e,t);return i.forEach((e=>{e[n].apply(e,t)})),o}}})}createLandmark(t){return this.camera.createLandmark("landmark-"+this.landmarkCounter++,t)}getAnimation(t){const e=L(this.context.options,t);return!!e&&(0,oi.Z)(Object.assign({},e),["easing","duration"])}getCanvasSize(){const{canvas:t}=this.context,{width:e=0,height:n=0}=t.getConfig();return[e,n]}getCanvasCenter(){const{canvas:t}=this.context,{width:e=0,height:n=0}=t.getConfig();return[e/2,n/2,0]}getViewportCenter(){const[t,e]=this.camera.getPosition();return[t,e,0]}getGraphCenter(){return this.context.graph.getViewportByCanvas(this.getCanvasCenter())}getZoom(){return this.camera.getZoom()}getRotation(){return this.camera.getRoll()}getTranslateOptions(t){const{camera:e}=this,{mode:n,translate:i=[]}=t,s=this.getZoom(),o=e.getPosition(),r=e.getFocalPoint(),[a,l]=this.getCanvasCenter(),[h=0,c=0,d=0]=i,u=pe([-h,-c,-d],s);return"relative"===n?{position:ce(o,u),focalPoint:ce(r,u)}:{position:ce([a,l,o[2]],u),focalPoint:ce([a,l,r[2]],u)}}getRotateOptions(t){const{mode:e,rotate:n=0}=t;return{roll:"relative"===e?this.camera.getRoll()+n:n}}getZoomOptions(t){const{zoomRange:e}=this.context.options,n=this.camera.getZoom(),{mode:i,scale:s=1}=t;return(0,to.Z)("relative"===i?n*s:s,...e)}transform(t,e){return sc(this,void 0,void 0,(function*(){const{graph:n}=this.context,{translate:i,rotate:s,scale:o,origin:r}=t;this.cancelAnimation();const a=this.getAnimation(e);if(ch(n,new hh(v.BEFORE_TRANSFORM,t)),!s&&o&&!i&&r&&!a)return this.camera.setZoomByViewportPoint(this.getZoomOptions(t),r),void ch(n,new hh(v.AFTER_TRANSFORM,t));const l={};if(i&&Object.assign(l,this.getTranslateOptions(t)),(0,N.Z)(s)&&Object.assign(l,this.getRotateOptions(t)),(0,N.Z)(o)&&Object.assign(l,{zoom:this.getZoomOptions(t)}),a)return ch(n,new ah(v.BEFORE_ANIMATE,u.TRANSFORM,null,t)),new Promise((e=>{this.transformResolver=e,this.camera.gotoLandmark(this.createLandmark(l),Object.assign(Object.assign({},a),{onfinish:()=>{ch(n,new ah(v.AFTER_ANIMATE,u.TRANSFORM,null,t)),ch(n,new hh(v.AFTER_TRANSFORM,t)),this.transformResolver=void 0,e()}}))}));this.camera.gotoLandmark(this.createLandmark(l),{duration:0}),ch(n,new hh(v.AFTER_TRANSFORM,t))}))}fitView(t,e){return sc(this,void 0,void 0,(function*(){const[n,i,s,o]=this.padding,{when:r="always",direction:a="both"}=t||{},[l,h]=this.context.canvas.getSize(),c=l-o-i,d=h-n-s,u=this.context.canvas.getBounds(),p=this.getBBoxInViewport(u),[g,f]=nt(p);if("overflow"===r&&!("x"===a&&g>=c||"y"===a&&f>=d||"both"===a&&g>=c&&f>=d))return yield this.fitCenter({animation:e});const y=c/g,m=d/f,v="x"===a?y:"y"===a?m:Math.min(y,m),b=this.getAnimation(e);yield this.transform({mode:"relative",scale:v,translate:ce(de(this.getCanvasCenter(),this.getBBoxInViewport(u).center),pe(this.paddingOffset,v))},b)}))}fitCenter(t){return sc(this,void 0,void 0,(function*(){const e=this.context.canvas.getBounds();yield this.focus(e,t)}))}focusElements(t){return sc(this,arguments,void 0,(function*(t,e={}){const{element:n}=this.context;if(!n)return;const i=rt(t.map((t=>{return i=n.getElement(t),e.shapes?i.getShape(e.shapes).getRenderBounds():i.getRenderBounds();var i})));yield this.focus(i,e)}))}focus(t,e){return sc(this,void 0,void 0,(function*(){const n=this.context.graph.getViewportByCanvas(t.center),i=de(e.position||this.getCanvasCenter(),n);yield this.transform({mode:"relative",translate:ce(i,this.paddingOffset)},e.animation)}))}getBBoxInViewport(t){const{min:e,max:n}=t,{graph:i}=this.context,[o,r]=i.getViewportByCanvas(e),[a,l]=i.getViewportByCanvas(n),h=new s.mN;return h.setMinMax([o,r,0],[a,l,0]),h}isInViewport(t,e=!1,n=0){const{graph:i}=this.context,o=this.getCanvasSize(),[r,a]=i.getCanvasByViewport([0,0]),[l,h]=i.getCanvasByViewport(o);let c=new s.mN;return c.setMinMax([r,a,0],[l,h,0]),n&&(c=ot(c,n)),X(t)?at(t,c):e?function(t,e){const[n,i]=t.min,[s,o]=t.max,[r,a]=e.min,[l,h]=e.max;return n>=r&&s<=l&&i>=a&&o<=h}(t,c):c.intersects(t)}cancelAnimation(){var t,e;(null===(t=this.camera.landmarks)||void 0===t?void 0:t.length)&&this.camera.cancelLandmarkAnimation(),null===(e=this.transformResolver)||void 0===e||e.call(this)}}var rc=function(t,e,n,i){return new(n||(n=Promise))((function(s,o){function r(t){try{l(i.next(t))}catch(t){o(t)}}function a(t){try{l(i.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,a)}l((i=i.apply(t,e||[])).next())}))};class ac extends Ir.Z{constructor(t){var e;super(),this.options={},this.rendered=!1,this.destroyed=!1,this.context={model:new Dh},this.isCollapsingExpanding=!1,this.onResize=(0,ks.Z)((()=>{this.resize()}),300),this._setOptions(Object.assign({},ac.defaultOptions,t),!0),this.context.graph=this,this.options.autoResize&&(null===(e=globalThis.addEventListener)||void 0===e||e.call(globalThis,"resize",this.onResize))}getOptions(){return this.options}setOptions(t){this._setOptions(t,!1)}_setOptions(t,e){if(this.updateCanvas(t),Object.assign(this.options,function(t){return[tc].reduce(((t,e)=>e(t)),t)}(t)),e){const{data:e}=t;return void(e&&this.addData(e))}const{behaviors:n,combo:i,data:s,edge:o,layout:r,node:a,plugins:l,theme:h,transforms:c}=t;n&&this.setBehaviors(n),s&&this.setData(s),a&&this.setNode(a),o&&this.setEdge(o),i&&this.setCombo(i),r&&this.setLayout(r),h&&this.setTheme(h),l&&this.setPlugins(l),c&&this.setTransforms(c)}getSize(){return this.context.canvas?this.context.canvas.getSize():[this.options.width||0,this.options.height||0]}setSize(t,e){t&&(this.options.width=t),e&&(this.options.height=e),this.resize(t,e)}setZoomRange(t){this.options.zoomRange=t}getZoomRange(){return this.options.zoomRange}setNode(t){this.options.node=t,this.context.model.refreshData()}setEdge(t){this.options.edge=t,this.context.model.refreshData()}setCombo(t){this.options.combo=t,this.context.model.refreshData()}getTheme(){return this.options.theme}setTheme(t){this.options.theme=(0,W.Z)(t)?t(this.getTheme()):t}setLayout(t){this.options.layout=(0,W.Z)(t)?t(this.getLayout()):t}getLayout(){return this.options.layout}setBehaviors(t){var e;this.options.behaviors=(0,W.Z)(t)?t(this.getBehaviors()):t,null===(e=this.context.behavior)||void 0===e||e.setBehaviors(this.options.behaviors)}updateBehavior(t){this.setBehaviors((e=>e.map((e=>"object"==typeof e&&e.key===t.key?Object.assign(Object.assign({},e),t):e))))}getBehaviors(){return this.options.behaviors||[]}setPlugins(t){var e;this.options.plugins=(0,W.Z)(t)?t(this.getPlugins()):t,null===(e=this.context.plugin)||void 0===e||e.setPlugins(this.options.plugins)}updatePlugin(t){this.setPlugins((e=>e.map((e=>"object"==typeof e&&e.key===t.key?Object.assign(Object.assign({},e),t):e))))}getPlugins(){return this.options.plugins||[]}getPluginInstance(t){return this.context.plugin.getPluginInstance(t)}setTransforms(t){var e;this.options.transforms=(0,W.Z)(t)?t(this.getTransforms()):t,null===(e=this.context.transform)||void 0===e||e.setTransforms(this.options.transforms)}updateTransform(t){this.setTransforms((e=>e.map((e=>"object"==typeof e&&e.key===t.key?Object.assign(Object.assign({},e),t):e)))),this.context.model.refreshData()}getTransforms(){return this.options.transforms||[]}getData(){return this.context.model.getData()}getElementData(t){return Array.isArray(t)?t.map((t=>this.context.model.getElementDataById(t))):this.context.model.getElementDataById(t)}getNodeData(t){return void 0===t?this.context.model.getNodeData():Array.isArray(t)?this.context.model.getNodeData(t):this.context.model.getNodeLikeDatum(t)}getEdgeData(t){return void 0===t?this.context.model.getEdgeData():Array.isArray(t)?this.context.model.getEdgeData(t):this.context.model.getEdgeDatum(t)}getComboData(t){return void 0===t?this.context.model.getComboData():Array.isArray(t)?this.context.model.getComboData(t):this.context.model.getNodeLikeDatum(t)}setData(t){this.context.model.setData((0,W.Z)(t)?t(this.getData()):t)}addData(t){this.context.model.addData((0,W.Z)(t)?t(this.getData()):t)}addNodeData(t){this.context.model.addNodeData((0,W.Z)(t)?t(this.getNodeData()):t)}addEdgeData(t){this.context.model.addEdgeData((0,W.Z)(t)?t(this.getEdgeData()):t)}addComboData(t){this.context.model.addComboData((0,W.Z)(t)?t(this.getComboData()):t)}addChildrenData(t,e){this.context.model.addChildrenData(t,e)}updateData(t){this.context.model.updateData((0,W.Z)(t)?t(this.getData()):t)}updateNodeData(t){this.context.model.updateNodeData((0,W.Z)(t)?t(this.getNodeData()):t)}updateEdgeData(t){this.context.model.updateEdgeData((0,W.Z)(t)?t(this.getEdgeData()):t)}updateComboData(t){this.context.model.updateComboData((0,W.Z)(t)?t(this.getComboData()):t)}removeData(t){this.context.model.removeData((0,W.Z)(t)?t(this.getData()):t)}removeNodeData(t){this.context.model.removeNodeData((0,W.Z)(t)?t(this.getNodeData()):t)}removeEdgeData(t){this.context.model.removeEdgeData((0,W.Z)(t)?t(this.getEdgeData()):t)}removeComboData(t){this.context.model.removeComboData((0,W.Z)(t)?t(this.getComboData()):t)}getElementType(t){return this.context.model.getElementType(t)}getRelatedEdgesData(t,e="both"){return this.context.model.getRelatedEdgesData(t,e)}getNeighborNodesData(t){return this.context.model.getNeighborNodesData(t)}getAncestorsData(t,e){return this.context.model.getAncestorsData(t,e)}getParentData(t,e){return this.context.model.getParentData(t,e)}getChildrenData(t){return this.context.model.getChildrenData(t)}getDescendantsData(t){return this.context.model.getDescendantsData(t)}getElementDataByState(t,e){return this.context.model.getElementDataByState(t,e)}initCanvas(){return rc(this,void 0,void 0,(function*(){var t;if(this.context.canvas)return yield this.context.canvas.ready;const{container:e="container",width:n,height:i,renderer:s,cursor:o,background:r,canvas:a,devicePixelRatio:l=(null!==(t=globalThis.devicePixelRatio)&&void 0!==t?t:1)}=this.options;if(e instanceof th)this.context.canvas=e,o&&e.setCursor(o),s&&e.setRenderer(s),yield e.ready;else{const t=(0,We.Z)(e)?document.getElementById(e):e,h=sh(t);this.emit(v.BEFORE_CANVAS_INIT,{container:t,width:n,height:i});const c=Object.assign(Object.assign({},a),{container:t,width:n||h[0],height:i||h[1],background:r,renderer:s,cursor:o,devicePixelRatio:l}),d=new th(c);this.context.canvas=d,yield d.ready,this.emit(v.AFTER_CANVAS_INIT,{canvas:d})}}))}updateCanvas(t){var e,n;const{renderer:i,cursor:s,height:o,width:r}=t,a=this.context.canvas;a&&(i&&(this.emit(v.BEFORE_RENDERER_CHANGE,{renderer:this.options.renderer}),a.setRenderer(i),this.emit(v.AFTER_RENDERER_CHANGE,{renderer:i})),s&&a.setCursor(s),((0,N.Z)(r)||(0,N.Z)(o))&&this.setSize(null!==(e=null!=r?r:this.options.width)&&void 0!==e?e:0,null!==(n=null!=o?o:this.options.height)&&void 0!==n?n:0))}initRuntime(){this.context.options=this.options,this.context.batch||(this.context.batch=new yh(this.context)),this.context.plugin||(this.context.plugin=new ec(this.context)),this.context.viewport||(this.context.viewport=new oc(this.context)),this.context.transform||(this.context.transform=new ic(this.context)),this.context.element||(this.context.element=new Mh(this.context)),this.context.animation||(this.context.animation=new fh(this.context)),this.context.layout||(this.context.layout=new Jh(this.context)),this.context.behavior||(this.context.behavior=new mh(this.context))}prepare(){return rc(this,void 0,void 0,(function*(){if(yield Promise.resolve(),this.destroyed)throw new Error(C("The graph instance has been destroyed"));yield this.initCanvas(),this.initRuntime()}))}render(){return rc(this,void 0,void 0,(function*(){if(yield this.prepare(),ch(this,new rh(v.BEFORE_RENDER)),this.options.layout)if(this.rendered||(t=this.options.layout,Array.isArray(t)||!(null==t?void 0:t.preLayout))){const t=this.context.element.draw({type:"render"});yield Promise.all([null==t?void 0:t.finished,this.context.layout.postLayout()]),yield this.autoFit()}else{const t=yield this.context.element.preLayoutDraw({type:"render"});yield Promise.all([null==t?void 0:t.finished,this.autoFit()])}else{const t=this.context.element.draw({type:"render"});yield Promise.all([null==t?void 0:t.finished,this.autoFit()])}var t;this.rendered=!0,ch(this,new rh(v.AFTER_RENDER))}))}draw(){return rc(this,void 0,void 0,(function*(){var t;yield this.prepare(),yield null===(t=this.context.element.draw())||void 0===t?void 0:t.finished}))}layout(t){return rc(this,void 0,void 0,(function*(){yield this.context.layout.postLayout(t)}))}stopLayout(){this.context.layout.stopLayout()}clear(){return rc(this,void 0,void 0,(function*(){const{model:t,element:e}=this.context;t.setData({}),t.clearChanges(),null==e||e.clear()}))}destroy(){var t;ch(this,new rh(v.BEFORE_DESTROY));const{layout:e,animation:n,element:i,model:s,canvas:o,behavior:r,plugin:a}=this.context;null==a||a.destroy(),null==r||r.destroy(),null==e||e.destroy(),null==n||n.destroy(),null==i||i.destroy(),s.destroy(),null==o||o.destroy(),this.options={},this.context={},this.off(),null===(t=globalThis.removeEventListener)||void 0===t||t.call(globalThis,"resize",this.onResize),this.destroyed=!0,ch(this,new rh(v.AFTER_DESTROY))}getCanvas(){return this.context.canvas}resize(t,e){var n;const i=sh(null===(n=this.context.canvas)||void 0===n?void 0:n.getContainer()),s=[t||i[0],e||i[1]];if(!this.context.canvas)return;const o=this.context.canvas.getSize();(0,a.Z)(s,o)||(ch(this,new rh(v.BEFORE_SIZE_CHANGE,{size:s})),this.context.canvas.resize(...s),ch(this,new rh(v.AFTER_SIZE_CHANGE,{size:s})))}fitView(t,e){return rc(this,void 0,void 0,(function*(){var n;yield null===(n=this.context.viewport)||void 0===n?void 0:n.fitView(t,e)}))}fitCenter(t){return rc(this,void 0,void 0,(function*(){var e;yield null===(e=this.context.viewport)||void 0===e?void 0:e.fitCenter({animation:t})}))}autoFit(){return rc(this,void 0,void 0,(function*(){const{autoFit:t}=this.context.options;if(t)if((0,We.Z)(t))"view"===t?yield this.fitView():"center"===t&&(yield this.fitCenter());else{const{type:e,animation:n}=t;"view"===e?yield this.fitView(t.options,n):"center"===e&&(yield this.fitCenter(n))}}))}focusElement(t,e){return rc(this,void 0,void 0,(function*(){var n;yield null===(n=this.context.viewport)||void 0===n?void 0:n.focusElements(Array.isArray(t)?t:[t],{animation:e})}))}zoomBy(t,e,n){return rc(this,void 0,void 0,(function*(){yield this.context.viewport.transform({mode:"relative",scale:t,origin:n},e)}))}zoomTo(t,e,n){return rc(this,void 0,void 0,(function*(){yield this.context.viewport.transform({mode:"absolute",scale:t,origin:n},e)}))}getZoom(){return this.context.viewport.getZoom()}rotateBy(t,e,n){return rc(this,void 0,void 0,(function*(){yield this.context.viewport.transform({mode:"relative",rotate:t,origin:n},e)}))}rotateTo(t,e,n){return rc(this,void 0,void 0,(function*(){yield this.context.viewport.transform({mode:"absolute",rotate:t,origin:n},e)}))}getRotation(){return this.context.viewport.getRotation()}translateBy(t,e){return rc(this,void 0,void 0,(function*(){yield this.context.viewport.transform({mode:"relative",translate:t},e)}))}translateTo(t,e){return rc(this,void 0,void 0,(function*(){yield this.context.viewport.transform({mode:"absolute",translate:t},e)}))}getPosition(){return de([0,0],this.getCanvasByViewport([0,0]))}translateElementBy(t,e){return rc(this,arguments,void 0,(function*(t,e,n=!0){var i,s;const[o,r]=(0,l.Z)(t)?[t,null===(i=e)||void 0===i||i]:[{[t]:e},n];Object.entries(o).forEach((([t,e])=>this.context.model.translateNodeLikeBy(t,e))),yield null===(s=this.context.element.draw({animation:r,stage:"translate"}))||void 0===s?void 0:s.finished}))}translateElementTo(t,e){return rc(this,arguments,void 0,(function*(t,e,n=!0){var i,s;const[o,r]=(0,l.Z)(t)?[t,null===(i=e)||void 0===i||i]:[{[t]:e},n];Object.entries(o).forEach((([t,e])=>this.context.model.translateNodeLikeTo(t,e))),yield null===(s=this.context.element.draw({animation:r,stage:"translate"}))||void 0===s?void 0:s.finished}))}getElementPosition(t){return this.context.model.getElementPosition(t)}getElementRenderStyle(t){return(0,Co.Z)(this.context.element.getElement(t).attributes,["context"])}setElementVisibility(t,e){return rc(this,arguments,void 0,(function*(t,e,n=!0){var i,s;const[o,r]=(0,l.Z)(t)?[t,null===(i=e)||void 0===i||i]:[{[t]:e},n],a={nodes:[],edges:[],combos:[]};Object.entries(o).forEach((([t,e])=>{const n=this.getElementType(t);a[`${n}s`].push({id:t,style:{visibility:e}})}));const{model:h,element:c}=this.context;h.preventUpdateNodeLikeHierarchy((()=>{h.updateData(a)})),yield null===(s=c.draw({animation:r,stage:"visibility"}))||void 0===s?void 0:s.finished}))}showElement(t,e){return rc(this,void 0,void 0,(function*(){const n=Array.isArray(t)?t:[t];yield this.setElementVisibility(Object.fromEntries(n.map((t=>[t,"visible"]))),e)}))}hideElement(t,e){return rc(this,void 0,void 0,(function*(){const n=Array.isArray(t)?t:[t];yield this.setElementVisibility(Object.fromEntries(n.map((t=>[t,"hidden"]))),e)}))}getElementVisibility(t){var e,n;const i=this.context.element.getElement(t);return null!==(n=null===(e=null==i?void 0:i.style)||void 0===e?void 0:e.visibility)&&void 0!==n?n:"visible"}setElementZIndex(t,e){return rc(this,void 0,void 0,(function*(){var n;const i={nodes:[],edges:[],combos:[]},s=(0,l.Z)(t)?t:{[t]:e};Object.entries(s).forEach((([t,e])=>{const n=this.getElementType(t);i[`${n}s`].push({id:t,style:{zIndex:e}})}));const{model:o,element:r}=this.context;o.preventUpdateNodeLikeHierarchy((()=>o.updateData(i))),yield null===(n=r.draw({animation:!1,stage:"zIndex"}))||void 0===n?void 0:n.finished}))}frontElement(t){return rc(this,void 0,void 0,(function*(){const e=Array.isArray(t)?t:[t],{model:n}=this.context,i={};e.map((t=>{const e=n.getFrontZIndex(t);if("combo"===n.getElementType(t)){const s=n.getAncestorsData(t,x).at(-1)||this.getComboData(t),o=[s,...n.getDescendantsData(Ht(s))],r=e-dh(s);o.forEach((t=>{i[Ht(t)]=this.getElementZIndex(Ht(t))+r}));const{internal:a}=Bi(o.map(Ht),(t=>n.getRelatedEdgesData(t)));a.forEach((t=>{const e=Ht(t);i[e]=this.getElementZIndex(e)+r}))}else i[t]=e})),yield this.setElementZIndex(i)}))}getElementZIndex(t){return dh(this.context.model.getElementDataById(t))}setElementState(t,e){return rc(this,arguments,void 0,(function*(t,e,n=!0){var i,s;const[o,r]=(0,l.Z)(t)?[t,null===(i=e)||void 0===i||i]:[{[t]:e},n],a={nodes:[],edges:[],combos:[]};Object.entries(o).forEach((([t,e])=>{const n=this.getElementType(t);var i;a[`${n}s`].push({id:t,states:(i=e,i?Array.isArray(i)?i:[i]:[])})})),this.updateData(a),yield null===(s=this.context.element.draw({animation:r,stage:"state"}))||void 0===s?void 0:s.finished}))}getElementState(t){return this.context.model.getElementState(t)}getElementRenderBounds(t){return this.context.element.getElement(t).getRenderBounds()}collapseElement(t){return rc(this,arguments,void 0,(function*(t,e=!0){const{model:n,element:i}=this.context;if(on(n.getNodeLikeData([t])[0]))return;if(this.isCollapsingExpanding)return;"boolean"==typeof e&&(e={animation:e,align:!0});const s=n.getElementType(t);yield this.frontElement(t),this.isCollapsingExpanding=!0,this.setElementCollapsibility(t,!0),"node"===s?yield i.collapseNode(t,e):"combo"===s&&(yield i.collapseCombo(t,!!e.animation)),this.isCollapsingExpanding=!1}))}expandElement(t){return rc(this,arguments,void 0,(function*(t,e=!0){const{model:n,element:i}=this.context;if(!on(n.getNodeLikeData([t])[0]))return;if(this.isCollapsingExpanding)return;"boolean"==typeof e&&(e={animation:e,align:!0});const s=n.getElementType(t);this.isCollapsingExpanding=!0,this.setElementCollapsibility(t,!1),"node"===s?yield i.expandNode(t,e):"combo"===s&&(yield i.expandCombo(t,!!e.animation)),this.isCollapsingExpanding=!1}))}setElementCollapsibility(t,e){const n=this.getElementType(t);"node"===n?this.updateNodeData([{id:t,style:{collapsed:e}}]):"combo"===n&&this.updateComboData([{id:t,style:{collapsed:e}}])}toDataURL(){return rc(this,arguments,void 0,(function*(t={}){return this.context.canvas.toDataURL(t)}))}getCanvasByViewport(t){return this.context.canvas.getCanvasByViewport(t)}getViewportByCanvas(t){return this.context.canvas.getViewportByCanvas(t)}getClientByCanvas(t){return this.context.canvas.getClientByCanvas(t)}getCanvasByClient(t){return this.context.canvas.getCanvasByClient(t)}getViewportCenter(){return this.context.viewport.getViewportCenter()}getCanvasCenter(){return this.context.viewport.getCanvasCenter()}on(t,e,n){return super.on(t,e,n)}once(t,e){return super.once(t,e)}off(t,e){return super.off(t,e)}}ac.defaultOptions={autoResize:!1,theme:"light",rotation:0,zoom:1,zoomRange:[.01,10]};var lc=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(n[i[s]]=t[i[s]])}return n};function hc(t,e){const{getNodeData:n=(t,e)=>{if(t.depth=e,!t.children)return t;const{children:n}=t,i=lc(t,["children"]);return Object.assign(Object.assign({},i),{children:n.map((t=>t.id))})},getEdgeData:i=(t,e)=>({source:t.id,target:e.id}),getChildren:s=t=>t.children||[]}=e||{},o=[],r=[];return Je(t,((t,e)=>{o.push(n(t,e));const a=s(t);for(const e of a)r.push(i(t,e))}),(t=>s(t)),"TB"),{nodes:o,edges:r}}const cc=(t,e)=>{const{source:n,target:i}=e,s=t.getElementDataById(n),o=t.getElementDataById(i),r=zi(s,(e=>t.getParentData(e,x))),a=zi(o,(e=>t.getParentData(e,x))),l={sourceNode:Ht(r),targetNode:Ht(a)};return e.style?Object.assign(e.style,l):e.style=l,e};class dc extends Vl{constructor(t,e){super(t,(0,le.Z)({},dc.defaultOptions,e)),this.assignSizeByCentrality=(t,e,n,i,s,o)=>{const r=[e,n],a=[i[0],s[0]],l=[i[1],s[1]],h=[i[2],s[2]],c=(t,e)=>{if("function"==typeof o)return o(t,r,e);switch(o){case"linear":return((t,e,n)=>{const[i,s]=e,[o,r]=n;return s===i?o:o+(t-i)/(s-i)*(r-o)})(t,r,e);case"log":return((t,e,n)=>{const[i,s]=e,[o,r]=n;return o+Math.log(t-i+1)/Math.log(s-i+1)*(r-o)})(t,r,e);case"pow":return((t,e,n,i=2)=>{const[s,o]=e,[r,a]=n;return r+Math.pow((t-s)/(o-s),i)*(a-r)})(t,r,e,2);case"sqrt":return((t,e,n)=>{const[i,s]=e,[o,r]=n;return o+Math.sqrt((t-i)/(s-i))*(r-o)})(t,r,e);default:return e[0]}};return[c(t,a),c(t,l),c(t,h)]}}beforeDraw(t){const{model:e}=this.context,n=e.getNodeData(),i=fn(this.options.maxSize),s=fn(this.options.minSize),o=this.getCentralities(this.options.centrality),r=o.size>0?Math.max(...o.values()):0,a=o.size>0?Math.min(...o.values()):0;return n.forEach((e=>{var n;const l=this.assignSizeByCentrality(o.get(Ht(e))||0,a,r,s,i,this.options.scale),h=null===(n=this.context.element)||void 0===n?void 0:n.getElement(Ht(e)),c={size:l};this.assignLabelStyle(c,l,e,h),h&&Hl(c,h.attributes)||Wl(t,h?"update":"add","node",(0,le.Z)(e,{style:c}),!0)})),t}assignLabelStyle(t,e,n,i){var s;const o=i?i.config.style:null===(s=this.context.element)||void 0===s?void 0:s.getElementComputedStyle("node",n);if(Object.assign(t,(0,oi.Z)(o,["labelFontSize","labelLineHeight"])),this.options.mapLabelSize){const n=this.getLabelSizeByNodeSize(e,1/0,Number(t.labelFontSize));Object.assign(t,{labelFontSize:n,labelLineHeight:n+Q(t.labelPadding)})}return t}getLabelSizeByNodeSize(t,e,n){const i=Math.min(...t)/2,[s,o]=Array.isArray(this.options.mapLabelSize)?this.options.mapLabelSize:[n,e];return Math.min(o,Math.max(i,s))}getCentralities(t){const{model:e}=this.context,n=e.getData();if("function"==typeof t)return t(n);const i=e.getRelatedEdgesData.bind(e);return Ut(n,i,t)}}dc.defaultOptions={centrality:{type:"degree"},maxSize:80,minSize:20,scale:"linear",mapLabelSize:!1};class uc extends Vl{constructor(t,e){super(t,Object.assign({},uc.defaultOptions,e))}get ref(){return this.context.model.getRootsData()[0]}afterLayout(){var t;const e=Me(this.ref),{graph:n,model:i}=this.context;null===(t=i.getData().nodes)||void 0===t||t.forEach((t=>{var o;if(Ht(t)===Ht(this.ref))return;const r=Oe(de(Me(t),e)),a=Math.abs(r)>Math.PI/2,l=!t.children||0===t.children.length,h=Ht(t),c=null===(o=this.context.element)||void 0===o?void 0:o.getElement(h);if(!c||!c.isVisible())return;const d=(l?1:-1)*(fn(n.getElementRenderStyle(h).size)[0]/2+this.options.offset),u=[["translate",d*Math.cos(r),d*Math.sin(r)],["rotate",a?(0,s.BV)(r)+180:(0,s.BV)(r)]];i.updateNodeData([{id:Ht(t),style:{labelTextAlign:a===l?"right":"left",labelTextBaseline:"middle",labelTransform:u}}])})),n.draw()}}uc.defaultOptions={offset:5};const pc=["top","top-right","right","right-bottom","bottom","bottom-left","left","left-top"];class gc extends Vl{constructor(t,e){super(t,Object.assign({},gc.defaultOptions,e)),this.cacheMergeStyle=new Map,this.getAffectedParallelEdges=t=>{const{add:{edges:e},update:{nodes:n,edges:i,combos:s},remove:{edges:o}}=t,{model:r}=this.context,a=new Map,l=(t,e)=>{r.getRelatedEdgesData(e).forEach((t=>!a.has(Ht(t))&&a.set(Ht(t),t)))};n.forEach(l),s.forEach(l);const h=t=>{const e=r.getEdgeData().map((t=>cc(r,t)));yc(t,e,!0).forEach((t=>!a.has(Ht(t))&&a.set(Ht(t),t)))};if(o.size&&o.forEach(h),e.size&&e.forEach(h),i.size){const t=Br(jr(r.getChanges())).update.edges;i.forEach((e=>{var n;h(e);const i=null===(n=t.find((t=>Ht(t.value)===Ht(e))))||void 0===n?void 0:n.original;i&&!mc(e,i)&&h(i)}))}Pn(this.options.edges)||a.forEach(((t,e)=>!this.options.edges.includes(e)&&a.delete(e)));const c=r.getEdgeData().map(Ht);return new Map([...a].sort(((t,e)=>c.indexOf(t[0])-c.indexOf(e[0]))))},this.applyBundlingStyle=(t,e,n)=>{const{edgeMap:i,reverses:s}=fc(e);i.forEach((e=>{e.forEach(((e,i,o)=>{var r;const a=o.length,l=e.style||{};if(e.source===e.target){const t=pc.length;l.loopPlacement=pc[i%t],l.loopDist=Math.floor(i/t)*n+50}else if(1===a)l.curveOffset=0;else{const t=(i%2==0?1:-1)*(s[`${e.source}|${e.target}|${i}`]?-1:1);l.curveOffset=a%2==1?t*Math.ceil(i/2)*n*2:t*(Math.floor(i/2)*n*2+n)}const h=Object.assign(e,{type:"quadratic",style:l}),c=null===(r=this.context.element)||void 0===r?void 0:r.getElement(Ht(e));c&&Hl(h.style,c.attributes)||Wl(t,c?"update":"add","edge",h,!0)}))}))},this.resetEdgeStyle=t=>{const e=t.style||{},n=this.cacheMergeStyle.get(Ht(t))||{};return Object.keys(n).forEach((i=>{(0,a.Z)(e[i],n[i])&&(t[i]?e[i]=t[i]:delete e[i])})),Object.assign(t,{style:e})},this.applyMergingStyle=(t,e)=>{const{edgeMap:n,reverses:i}=fc(e);n.forEach((e=>{var n;if(1===e.length){const i=e[0],s=null===(n=this.context.element)||void 0===n?void 0:n.getElement(Ht(i)),o=this.resetEdgeStyle(i);return void(s&&Hl(o,s.attributes)||Wl(t,s?"update":"add","edge",o))}const s=e.map((({source:t,target:e,style:n={}},s)=>{const{startArrow:o,endArrow:r}=n,a={},[l,h]=i[`${t}|${e}|${s}`]?["endArrow","startArrow"]:["startArrow","endArrow"];return(0,kr.Z)(o)&&(a[l]=o),(0,kr.Z)(r)&&(a[h]=r),a})).reduce(((t,e)=>Object.assign(Object.assign({},t),e)),{});e.forEach(((e,n,i)=>{var o;if(0!==n)return void Wl(t,"remove","edge",e);const r=Object.assign({},(0,W.Z)(this.options.style)?this.options.style(i):this.options.style,{childrenData:i});this.cacheMergeStyle.set(Ht(e),r);const a=Object.assign(Object.assign({},e),{type:"line",style:Object.assign(Object.assign(Object.assign({},e.style),s),r)}),l=null===(o=this.context.element)||void 0===o?void 0:o.getElement(Ht(e));l&&Hl(a.style,l.attributes)||Wl(t,l?"update":"add","edge",a,!0)}))}))}}beforeDraw(t){const e=this.getAffectedParallelEdges(t);return 0===e.size||("bundle"===this.options.mode?this.applyBundlingStyle(t,e,this.options.distance):this.applyMergingStyle(t,e)),t}}gc.defaultOptions={mode:"bundle",distance:15};const fc=t=>{const e=new Map,n=new Set,i={},s=new Map;for(const[o,r]of t){if(n.has(o))continue;const{source:a,target:l}=r,h=`${a}-${l}`;e.has(h)||(e.set(h,[]),s.set(h,new Set));const c=e.get(h),d=s.get(h);c&&d&&!d.has(o)&&(c.push(r),d.add(o),n.add(o));for(const[c,d]of t)if(!n.has(c)&&c!==o&&mc(r,d)){const t=e.get(h),o=s.get(h);t&&o&&!o.has(c)&&(t.push(d),o.add(c),a===d.target&&l===d.source&&(i[`${d.source}|${d.target}|${t.length-1}`]=!0),n.add(c))}}return{edgeMap:e,reverses:i}},yc=(t,e,n)=>e.filter((e=>(n||Ht(e)!==Ht(t))&&mc(e,t))),mc=(t,e)=>{const{sourceNode:n,targetNode:i}=t.style||{},{sourceNode:s,targetNode:o}=e.style||{};return n===s&&i===o||n===o&&i===s};const vc={animation:{"combo-collapse":$,"combo-expand":V,"node-collapse":z,"node-expand":F,"path-in":_,"path-out":Z,fade:[{fields:["opacity"]}],translate:[{fields:["x","y"]}]},behavior:{"brush-select":Ue,"click-select":sn,"collapse-expand":Ts,"create-edge":Ls,"drag-canvas":Is,"drag-element-force":class extends Bs{get forceLayoutInstance(){return this.context.layout.getLayoutInstance().find((t=>["d3-force","d3-force-3d"].includes(null==t?void 0:t.id)))}validate(t){return!!this.context.layout&&(this.forceLayoutInstance?super.validate(t):(M.warn("DragElementForce only works with d3-force or d3-force-3d layout"),!1))}moveElement(t,e){return Hs(this,void 0,void 0,(function*(){const n=this.forceLayoutInstance;this.context.graph.getNodeData(t).forEach(((i,s)=>{const{x:o=0,y:r=0}=i.style||{};n&&Vs(n,"setFixedPosition",t[s],[...ce([+o,+r],e)])}))}))}onDragStart(t){if(this.enable=this.validate(t),!this.enable)return;this.target=this.getSelectedNodeIDs([t.target.id]),this.hideEdge(),this.context.graph.frontElement(this.target);const e=this.forceLayoutInstance;e&&Ws(e,"simulation").alphaTarget(.3).restart(),this.context.graph.getNodeData(this.target).forEach((t=>{const{x:n=0,y:i=0}=t.style||{};e&&Vs(e,"setFixedPosition",Ht(t),[+n,+i])}))}onDrag(t){if(!this.enable)return;const e=this.getDelta(t);this.moveElement(this.target,e)}onDragEnd(){const t=this.forceLayoutInstance;t&&Ws(t,"simulation").alphaTarget(0),this.options.fixed||this.context.graph.getNodeData(this.target).forEach((e=>{t&&Vs(t,"setFixedPosition",Ht(e),[null,null,null])}))}},"drag-element":Bs,"fix-element-size":Gs,"focus-element":Ks,"hover-activate":Xs,"lasso-select":class extends Ue{onPointerDown(t){if(!super.validate(t)||!super.isKeydown()||this.points)return;const{canvas:e}=this.context;this.pathShape=new s.y$({id:"g6-lasso-select",style:this.options.style}),e.appendChild(this.pathShape),this.points=[Ke(t)]}onPointerMove(t){var e;if(!this.points)return;const{immediately:n,mode:i}=this.options;this.points.push(Ke(t)),null===(e=this.pathShape)||void 0===e||e.setAttribute("d",function(t,e=!0){const n=[];return t.forEach(((t,e)=>{n.push([0===e?"M":"L",...t])})),e&&n.push(["Z"]),n}(this.points)),n&&"default"===i&&this.points.length>2&&super.updateElementsStates(this.points)}onPointerUp(){this.points&&(this.points.length<2||super.updateElementsStates(this.points),this.clearLasso())}clearLasso(){var t;null===(t=this.pathShape)||void 0===t||t.remove(),this.pathShape=void 0,this.points=void 0}},"auto-adapt-label":ae,"optimize-viewport-transform":qs,"scroll-canvas":Qs,"zoom-canvas":no},combo:{circle:class extends pi{constructor(t){super(t)}drawKeyShape(t,e){return this.upsert("key",s.Cd,this.getKeyStyle(t),e)}getKeyStyle(t){const{collapsed:e}=t,n=super.getKeyStyle(t),[i]=this.getKeySize(t);return Object.assign(Object.assign(Object.assign({},n),e&&un(n,"collapsed")),{r:i/2})}getCollapsedKeySize(t){const[e,n]=fn(t.collapsedSize),i=Math.max(e,n)/2;return[2*i,2*i,0]}getExpandedKeySize(t){const e=this.getContentBBox(t),[n,i]=nt(e),s=Math.sqrt(Math.pow(n,2)+Math.pow(i,2))/2;return[2*s,2*s,0]}getIntersectPoint(t,e=!1){return Fe(t,this.getShape("key").getBounds(),e)}},rect:class extends pi{constructor(t){super(t)}drawKeyShape(t,e){return this.upsert("key",s.UL,this.getKeyStyle(t),e)}getKeyStyle(t){const e=super.getKeyStyle(t),[n,i]=this.getKeySize(t);return Object.assign(Object.assign(Object.assign({},e),t.collapsed&&un(e,"collapsed")),{width:n,height:i,x:-n/2,y:-i/2})}}},edge:{cubic:Ui,line:Ji,polyline:hs,quadratic:cs,"cubic-horizontal":Ki,"cubic-radial":Xi,"cubic-vertical":qi},layout:{"antv-dagre":so.b,"combo-combined":ro.u,"compact-box":io.compactBox,"d3-force":lo.j,"force-atlas2":co.E,circular:oo.S,concentric:ao.W,dagre:ho.V,dendrogram:io.dendrogram,fishbone:Eo,force:uo.y,fruchterman:po.O,grid:go.M,indented:io.indented,mds:fo.A,mindmap:io.mindmap,radial:yo.D,random:mo._,snake:Do},node:{circle:qn,diamond:class extends Jn{constructor(t){super(t)}getPoints(t){const[e,n]=this.getSize(t);return function(t,e){return[[0,-e/2],[t/2,0],[0,e/2],[-t/2,0]]}(e,n)}},ellipse:ii,hexagon:class extends Jn{constructor(t){super(t)}getOuterR(t){return t.outerR||Math.min(...this.getSize(t))/2}getPoints(t){return[[0,e=this.getOuterR(t)],[e*Math.sqrt(3)/2,e/2],[e*Math.sqrt(3)/2,-e/2],[0,-e],[-e*Math.sqrt(3)/2,-e/2],[-e*Math.sqrt(3)/2,e/2]];var e}getIconStyle(t){const e=super.getIconStyle(t),n=this.getOuterR(t)*Xe;return!!e&&Object.assign({width:n,height:n},e)}},html:li,image:ci,rect:class extends Xn{constructor(t){super(t)}getKeyStyle(t){const[e,n]=this.getSize(t);return Object.assign(Object.assign({},super.getKeyStyle(t)),{width:e,height:n,x:-e/2,y:-n/2})}getIconStyle(t){const e=super.getIconStyle(t),{width:n,height:i}=this.getShape("key").attributes;return!!e&&Object.assign({width:n*Xe,height:i*Xe},e)}drawKeyShape(t,e){return this.upsert("key",s.UL,this.getKeyStyle(t),e)}},star:class extends Jn{constructor(t){super(t)}getInnerR(t){return t.innerR||3*this.getOuterR(t)/8}getOuterR(t){return Math.min(...this.getSize(t))/2}getPoints(t){return e=this.getOuterR(t),n=this.getInnerR(t),[[0,-e],[n*Math.cos(3*Math.PI/10),-n*Math.sin(3*Math.PI/10)],[e*Math.cos(Math.PI/10),-e*Math.sin(Math.PI/10)],[n*Math.cos(Math.PI/10),n*Math.sin(Math.PI/10)],[e*Math.cos(3*Math.PI/10),e*Math.sin(3*Math.PI/10)],[0,n],[-e*Math.cos(3*Math.PI/10),e*Math.sin(3*Math.PI/10)],[-n*Math.cos(Math.PI/10),n*Math.sin(Math.PI/10)],[-e*Math.cos(Math.PI/10),-e*Math.sin(Math.PI/10)],[-n*Math.cos(3*Math.PI/10),-n*Math.sin(3*Math.PI/10)]];var e,n}getIconStyle(t){const e=super.getIconStyle(t),n=2*this.getInnerR(t)*Xe;return!!e&&Object.assign({width:n,height:n},e)}getPortXY(t,e){const{placement:n="top"}=e;return ys(this.getShape("key").getLocalBounds(),n,function(t,e){const n={};return n.top=[0,-t],n.left=[-t*Math.cos(Math.PI/10),-t*Math.sin(Math.PI/10)],n["left-bottom"]=[-t*Math.cos(3*Math.PI/10),t*Math.sin(3*Math.PI/10)],n.bottom=[0,e],n["right-bottom"]=[t*Math.cos(3*Math.PI/10),t*Math.sin(3*Math.PI/10)],n.right=n.default=[t*Math.cos(Math.PI/10),-t*Math.sin(Math.PI/10)],n}(this.getOuterR(t),this.getInnerR(t)),!1)}},donut:ti,triangle:di},palette:{spectral:["rgb(158, 1, 66)","rgb(213, 62, 79)","rgb(244, 109, 67)","rgb(253, 174, 97)","rgb(254, 224, 139)","rgb(255, 255, 191)","rgb(230, 245, 152)","rgb(171, 221, 164)","rgb(102, 194, 165)","rgb(50, 136, 189)","rgb(94, 79, 162)"],tableau:["rgb(78, 121, 167)","rgb(242, 142, 44)","rgb(225, 87, 89)","rgb(118, 183, 178)","rgb(89, 161, 79)","rgb(237, 201, 73)","rgb(175, 122, 161)","rgb(255, 157, 167)","rgb(156, 117, 95)","rgb(186, 176, 171)"],oranges:["rgb(255, 245, 235)","rgb(254, 230, 206)","rgb(253, 208, 162)","rgb(253, 174, 107)","rgb(253, 141, 60)","rgb(241, 105, 19)","rgb(217, 72, 1)","rgb(166, 54, 3)","rgb(127, 39, 4)"],greens:["rgb(247, 252, 245)","rgb(229, 245, 224)","rgb(199, 233, 192)","rgb(161, 217, 155)","rgb(116, 196, 118)","rgb(65, 171, 93)","rgb(35, 139, 69)","rgb(0, 109, 44)","rgb(0, 68, 27)"],blues:["rgb(247, 251, 255)","rgb(222, 235, 247)","rgb(198, 219, 239)","rgb(158, 202, 225)","rgb(107, 174, 214)","rgb(66, 146, 198)","rgb(33, 113, 181)","rgb(8, 81, 156)","rgb(8, 48, 107)"]},theme:{dark:Zl,light:$l},plugin:{"bubble-sets":fr,"edge-bundling":Er,"edge-filter-lens":Pr,"grid-line":Nr,background:ko,contextmenu:br,fisheye:Rr,fullscreen:Lr,history:_r,hull:xa,legend:Da,minimap:Ca,snapline:Ra,timebar:wl,toolbar:Ml,tooltip:Al,watermark:jl},transform:{"arrange-draw-order":class extends Vl{beforeDraw(t){const{model:e}=this.context,n=t.add.combos,i=t=>{const n=[];return t.forEach(((t,i)=>{const s=e.getAncestorsData(i,"combo").map((t=>Ht(t))).reverse();n.push([i,t,s.length])})),new Map(n.sort((([,,t],[,,e])=>e-t)).map((([t,e])=>[t,e])))};return t.add.combos=i(n),t.update.combos=i(t.update.combos),t}},"collapse-expand-combo":class extends Vl{beforeDraw(t,e){if("visibility"===e.stage)return t;if(!this.context.model.model.hasTreeStructure(x))return t;const{model:n}=this.context,{add:i,update:s}=t,o=[...t.update.combos.entries(),...t.add.combos.entries()];for(;o.length;){const[e,r]=o.pop();if(on(r)){const r=n.getDescendantsData(e),a=r.map(Ht),{internal:l,external:h}=Bi(a,(t=>n.getRelatedEdgesData(t)));r.forEach((e=>{const i=Ht(e),s=o.findIndex((([t])=>t===i));-1!==s&&o.splice(s,1);const r=n.getElementType(i);Wl(t,"remove",r,e)})),l.forEach((e=>Wl(t,"remove","edge",e))),h.forEach((t=>{var e;const n=Ht(t);(null===(e=this.context.element)||void 0===e?void 0:e.getElement(n))?s.edges.set(n,t):i.edges.set(n,t)}))}else{const i=n.getChildrenData(e),s=i.map(Ht),{edges:r}=Bi(s,(t=>n.getRelatedEdgesData(t)));[...i,...r].forEach((e=>{var i;const s=Ht(e),r=n.getElementType(s),a=null===(i=this.context.element)||void 0===i?void 0:i.getElement(s);Wl(t,a?"update":"add",r,e),"combo"===r&&o.push([s,e])}))}}return t}},"collapse-expand-node":class extends Vl{getElement(t){return this.context.element.getElement(t)}handleExpand(t,e){if(Yl(e,"add","node",t),on(t))return;const n=Ht(t);Yl(e,"add","node",t);this.context.model.getRelatedEdgesData(n,"out").forEach((t=>{Wl(e,"add","edge",t)}));this.context.model.getChildrenData(n).forEach((t=>{this.handleExpand(t,e)}))}beforeDraw(t){const{graph:e,model:n}=this.context;if(!n.model.hasTreeStructure(w))return t;const{add:{nodes:i,edges:s},update:{nodes:o}}=t,r=new Map,a=new Map;i.forEach(((t,e)=>{on(t)&&r.set(e,t)})),s.forEach((t=>{if("node"!==e.getElementType(t.source))return;const n=e.getNodeData(t.source);on(n)&&r.set(t.source,n)})),o.forEach(((t,e)=>{const n=this.getElement(e);if(!n)return;const i=n.attributes.collapsed;on(t)?i||r.set(e,t):i&&a.set(e,t)}));const l=new Set;return r.forEach(((e,i)=>{n.getDescendantsData(i).forEach((e=>{const i=Ht(e);if(l.has(i))return;Wl(t,"remove","node",e);n.getRelatedEdgesData(i).forEach((e=>{Wl(t,"remove","edge",e)})),l.add(i)}))})),a.forEach(((e,i)=>{n.getAncestorsData(i,w).some(on)?Wl(t,"remove","node",e):this.handleExpand(e,t)})),t}},"get-edge-actual-ends":class extends Vl{beforeDraw(t){const{add:e,update:n}=t,{model:i}=this.context;return[...e.edges.entries(),...n.edges.entries()].forEach((([,t])=>{cc(i,t)})),t}},"map-node-size":dc,"place-radial-labels":uc,"process-parallel-edges":gc,"update-related-edges":class extends Vl{beforeDraw(t,e){const{stage:n}=e;if("visibility"===n)return t;const{model:i}=this.context,{update:{nodes:s,edges:o,combos:r}}=t,a=(t,e)=>{i.getRelatedEdgesData(e).forEach((t=>!o.has(Ht(t))&&o.set(Ht(t),t)))};return s.forEach(a),r.forEach(a),t}}},shape:{circle:s.Cd,ellipse:s.Pj,group:s.ZA,html:s.k9,image:$n,line:s.x1,path:s.y$,polygon:s.mg,polyline:s.aH,rect:s.UL,text:s.xv,label:Nn,badge:In}};Object.entries(vc).forEach((([t,e])=>{Object.entries(e).forEach((([e,n])=>{Gl(t,e,n)}))}))},81746:function(t){var e;"undefined"!=typeof self&&self,e=function(){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var s=e[i]={i:i,l:!1,exports:{}};return t[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=5)}([function(t,e){t.exports={assign:Object.assign,getHeight:function(t,e,n,i){return void 0===i&&(i="height"),"center"===n?(t[i]+e[i])/2:t.height}}},function(t,e,n){var i=n(3),s=function(){function t(t,e){void 0===e&&(e={}),this.options=e,this.rootNode=i(t,e)}return t.prototype.execute=function(){throw new Error("please override this method")},t}();t.exports=s},function(t,e,n){var i=n(4),s=["LR","RL","TB","BT","H","V"],o=["LR","RL","H"],r=s[0];t.exports=function(t,e,n){var a=e.direction||r;if(e.isHorizontal=function(t){return o.indexOf(t)>-1}(a),a&&-1===s.indexOf(a))throw new TypeError("Invalid direction: "+a);if(a===s[0])n(t,e);else if(a===s[1])n(t,e),t.right2left();else if(a===s[2])n(t,e);else if(a===s[3])n(t,e),t.bottom2top();else if(a===s[4]||a===s[5]){var l=i(t,e),h=l.left,c=l.right;n(h,e),n(c,e),e.isHorizontal?h.right2left():h.bottom2top(),c.translate(h.x-c.x,h.y-c.y),t.x=h.x,t.y=c.y;var d=t.getBoundingBox();e.isHorizontal?d.top<0&&t.translate(0,-d.top):d.left<0&&t.translate(-d.left,0)}var u=e.fixedRoot;return void 0===u&&(u=!0),u&&t.translate(-(t.x+t.width/2+t.hgap),-(t.y+t.height/2+t.vgap)),function(t,e){if(e.radial){var n=e.isHorizontal?["x","y"]:["y","x"],i=n[0],s=n[1],o={x:1/0,y:1/0},r={x:-1/0,y:-1/0},a=0;t.DFTraverse((function(t){a++;var e=t.x,n=t.y;o.x=Math.min(o.x,e),o.y=Math.min(o.y,n),r.x=Math.max(r.x,e),r.y=Math.max(r.y,n)}));var l=r[s]-o[s];if(0===l)return;var h=2*Math.PI/a;t.DFTraverse((function(e){var n=(e[s]-o[s])/l*(2*Math.PI-h)+h,r=e[i]-t[i];e.x=Math.cos(n)*r,e.y=Math.sin(n)*r}))}}(t,e),t}},function(t,e,n){var i=n(0),s={getId:function(t){return t.id||t.name},getPreH:function(t){return t.preH||0},getPreV:function(t){return t.preV||0},getHGap:function(t){return t.hgap||18},getVGap:function(t){return t.vgap||18},getChildren:function(t){return t.children},getHeight:function(t){return t.height||36},getWidth:function(t){var e=t.label||" ";return t.width||18*e.split("").length}};function o(t,e){var n=this;if(n.vgap=n.hgap=0,t instanceof o)return t;n.data=t;var i=e.getHGap(t),s=e.getVGap(t);return n.preH=e.getPreH(t),n.preV=e.getPreV(t),n.width=e.getWidth(t),n.height=e.getHeight(t),n.width+=n.preH,n.height+=n.preV,n.id=e.getId(t),n.x=n.y=0,n.depth=0,n.children||(n.children=[]),n.addGap(i,s),n}i.assign(o.prototype,{isRoot:function(){return 0===this.depth},isLeaf:function(){return 0===this.children.length},addGap:function(t,e){var n=this;n.hgap+=t,n.vgap+=e,n.width+=2*t,n.height+=2*e},eachNode:function(t){for(var e,n=[this];e=n.shift();)t(e),n=e.children.concat(n)},DFTraverse:function(t){this.eachNode(t)},BFTraverse:function(t){for(var e,n=[this];e=n.shift();)t(e),n=n.concat(e.children)},getBoundingBox:function(){var t={left:Number.MAX_VALUE,top:Number.MAX_VALUE,width:0,height:0};return this.eachNode((function(e){t.left=Math.min(t.left,e.x),t.top=Math.min(t.top,e.y),t.width=Math.max(t.width,e.x+e.width),t.height=Math.max(t.height,e.y+e.height)})),t},translate:function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.eachNode((function(n){n.x+=t,n.y+=e,n.x+=n.preH,n.y+=n.preV}))},right2left:function(){var t=this,e=t.getBoundingBox();t.eachNode((function(t){t.x=t.x-2*(t.x-e.left)-t.width})),t.translate(e.width,0)},bottom2top:function(){var t=this,e=t.getBoundingBox();t.eachNode((function(t){t.y=t.y-2*(t.y-e.top)-t.height})),t.translate(0,e.height)}}),t.exports=function(t,e,n){void 0===e&&(e={});var r,a=new o(t,e=i.assign({},s,e)),l=[a];if(!n&&!t.collapsed)for(;r=l.shift();)if(!r.data.collapsed){var h=e.getChildren(r.data),c=h?h.length:0;if(r.children=new Array(c),h&&c)for(var d=0;d<c;d++){var u=new o(h[d],e);r.children[d]=u,l.push(u),u.parent=r,u.depth=r.depth+1}}return a}},function(t,e,n){var i=n(3);t.exports=function(t,e){for(var n=i(t.data,e,!0),s=i(t.data,e,!0),o=t.children.length,r=Math.round(o/2),a=e.getSide||function(t,e){return e<r?"right":"left"},l=0;l<o;l++){var h=t.children[l];"right"===a(h,l)?s.children.push(h):n.children.push(h)}return n.eachNode((function(t){t.isRoot()||(t.side="left")})),s.eachNode((function(t){t.isRoot()||(t.side="right")})),{left:n,right:s}}},function(t,e,n){var i={compactBox:n(6),dendrogram:n(8),indented:n(10),mindmap:n(12)};t.exports=i},function(t,e,n){function i(t,e){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},i(t,e)}var s=n(1),o=n(7),r=n(2),a=n(0),l=function(t){function e(){return t.apply(this,arguments)||this}var n,s;return s=t,(n=e).prototype=Object.create(s.prototype),n.prototype.constructor=n,i(n,s),e.prototype.execute=function(){return r(this.rootNode,this.options,o)},e}(s),h={};t.exports=function(t,e){return e=a.assign({},h,e),new l(t,e).execute()}},function(t,e){function n(t,e,n,i){void 0===i&&(i=[]);var s=this;s.w=t||0,s.h=e||0,s.y=n||0,s.x=0,s.c=i||[],s.cs=i.length,s.prelim=0,s.mod=0,s.shift=0,s.change=0,s.tl=null,s.tr=null,s.el=null,s.er=null,s.msel=0,s.mser=0}function i(t,e,n){n?t.y+=e:t.x+=e,t.children.forEach((function(t){i(t,e,n)}))}function s(t,e){var n=e?t.y:t.x;return t.children.forEach((function(t){n=Math.min(s(t,e),n)})),n}function o(t,e){i(t,-s(t,e),e)}function r(t,e,n){n?e.y=t.x:e.x=t.x,t.c.forEach((function(t,i){r(t,e.children[i],n)}))}function a(t,e,n){void 0===n&&(n=0),e?(t.x=n,n+=t.width):(t.y=n,n+=t.height),t.children.forEach((function(t){a(t,e,n)}))}n.fromNode=function(t,e){if(!t)return null;var i=[];return t.children.forEach((function(t){i.push(n.fromNode(t,e))})),e?new n(t.height,t.width,t.x,i):new n(t.width,t.height,t.y,i)},t.exports=function(t,e){void 0===e&&(e={});var i=e.isHorizontal;function s(t){0===t.cs?(t.el=t,t.er=t,t.msel=t.mser=0):(t.el=t.c[0].el,t.msel=t.c[0].msel,t.er=t.c[t.cs-1].er,t.mser=t.c[t.cs-1].mser)}function l(t,e,n){for(var i=t.c[e-1],s=i.mod,o=t.c[e],r=o.mod;null!==i&&null!==o;){u(i)>n.low&&(n=n.nxt);var a=s+i.prelim+i.w-(r+o.prelim);a>0&&(r+=a,h(t,e,n.index,a));var l=u(i),p=u(o);l<=p&&null!==(i=d(i))&&(s+=i.mod),l>=p&&null!==(o=c(o))&&(r+=o.mod)}!i&&o?function(t,e,n,i){var s=t.c[0].el;s.tl=n;var o=i-n.mod-t.c[0].msel;s.mod+=o,s.prelim-=o,t.c[0].el=t.c[e].el,t.c[0].msel=t.c[e].msel}(t,e,o,r):i&&!o&&function(t,e,n,i){var s=t.c[e].er;s.tr=n;var o=i-n.mod-t.c[e].mser;s.mod+=o,s.prelim-=o,t.c[e].er=t.c[e-1].er,t.c[e].mser=t.c[e-1].mser}(t,e,i,s)}function h(t,e,n,i){t.c[e].mod+=i,t.c[e].msel+=i,t.c[e].mser+=i,function(t,e,n,i){if(n!==e-1){var s=e-n;t.c[n+1].shift+=i/s,t.c[e].shift-=i/s,t.c[e].change-=i-i/s}}(t,e,n,i)}function c(t){return 0===t.cs?t.tl:t.c[0]}function d(t){return 0===t.cs?t.tr:t.c[t.cs-1]}function u(t){return t.y+t.h}function p(t,e,n){for(;null!==n&&t>=n.low;)n=n.nxt;return{low:t,index:e,nxt:n}}a(t,i);var g=n.fromNode(t,i);return function t(e){if(0!==e.cs){t(e.c[0]);for(var n=p(u(e.c[0].el),0,null),i=1;i<e.cs;++i){t(e.c[i]);var o=u(e.c[i].er);l(e,i,n),n=p(o,i,n)}!function(t){t.prelim=(t.c[0].prelim+t.c[0].mod+t.c[t.cs-1].mod+t.c[t.cs-1].prelim+t.c[t.cs-1].w)/2-t.w/2}(e),s(e)}else s(e)}(g),function t(e,n){n+=e.mod,e.x=e.prelim+n,function(t){for(var e=0,n=0,i=0;i<t.cs;i++)n+=(e+=t.c[i].shift)+t.c[i].change,t.c[i].mod+=n}(e);for(var i=0;i<e.cs;i++)t(e.c[i],n)}(g,0),r(g,t,i),o(t,i),t}},function(t,e,n){function i(t,e){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},i(t,e)}var s=n(1),o=n(9),r=n(2),a=n(0),l=function(t){function e(){return t.apply(this,arguments)||this}var n,s;return s=t,(n=e).prototype=Object.create(s.prototype),n.prototype.constructor=n,i(n,s),e.prototype.execute=function(){var t=this;return t.rootNode.width=0,r(t.rootNode,t.options,o)},e}(s),h={};t.exports=function(t,e){return e=a.assign({},h,e),new l(t,e).execute()}},function(t,e,n){var i=n(0);function s(t,e){void 0===t&&(t=0),void 0===e&&(e=[]);var n=this;n.x=n.y=0,n.leftChild=n.rightChild=null,n.height=0,n.children=e}var o={isHorizontal:!0,nodeSep:20,nodeSize:20,rankSep:200,subTreeSep:10};function r(t,e,n){n?(e.x=t.x,e.y=t.y):(e.x=t.y,e.y=t.x),t.children.forEach((function(t,i){r(t,e.children[i],n)}))}t.exports=function(t,e){void 0===e&&(e={}),e=i.assign({},o,e);var n,a=0,l=function t(e){if(!e)return null;e.width=0,e.depth&&e.depth>a&&(a=e.depth);var n=e.children,i=n.length,o=new s(e.height,[]);return n.forEach((function(e,n){var s=t(e);o.children.push(s),0===n&&(o.leftChild=s),n===i-1&&(o.rightChild=s)})),o.originNode=e,o.isLeaf=e.isLeaf(),o}(t);return function t(e){if(e.isLeaf||0===e.children.length)e.drawingDepth=a;else{var n=e.children.map((function(e){return t(e)})),i=Math.min.apply(null,n);e.drawingDepth=i-1}return e.drawingDepth}(l),function t(i){i.x=i.drawingDepth*e.rankSep,i.isLeaf?(i.y=0,n&&(i.y=n.y+n.height+e.nodeSep,i.originNode.parent!==n.originNode.parent&&(i.y+=e.subTreeSep)),n=i):(i.children.forEach((function(e){t(e)})),i.y=(i.leftChild.y+i.rightChild.y)/2)}(l),r(l,t,e.isHorizontal),t}},function(t,e,n){function i(t,e){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},i(t,e)}var s=n(1),o=n(11),r=n(4),a=n(0),l=["LR","RL","H"],h=l[0],c=function(t){function e(){return t.apply(this,arguments)||this}var n,s;return s=t,(n=e).prototype=Object.create(s.prototype),n.prototype.constructor=n,i(n,s),e.prototype.execute=function(){var t=this.options,e=this.rootNode;t.isHorizontal=!0;var n=t.indent,i=void 0===n?20:n,s=t.dropCap,a=void 0===s||s,c=t.direction,d=void 0===c?h:c,u=t.align;if(d&&-1===l.indexOf(d))throw new TypeError("Invalid direction: "+d);if(d===l[0])o(e,i,a,u);else if(d===l[1])o(e,i,a,u),e.right2left();else if(d===l[2]){var p=r(e,t),g=p.left,f=p.right;o(g,i,a,u),g.right2left(),o(f,i,a,u);var y=g.getBoundingBox();f.translate(y.width,0),e.x=f.x-e.width/2}return e},e}(s),d={};t.exports=function(t,e){return e=a.assign({},d,e),new c(t,e).execute()}},function(t,e,n){var i=n(0);t.exports=function(t,e,n,s){var o=null;t.eachNode((function(t){!function(t,e,n,s,o){var r=("function"==typeof n?n(t):n)*t.depth;if(!s)try{if(t.id===t.parent.children[0].id)return t.x+=r,void(t.y=e?e.y:0)}catch(t){}if(t.x+=r,e){if(t.y=e.y+i.getHeight(e,t,o),e.parent&&t.parent.id!==e.parent.id){var a=e.parent,l=a.y+i.getHeight(a,t,o);t.y=l>t.y?l:t.y}}else t.y=0}(t,o,e,n,s),o=t}))}},function(t,e,n){function i(t,e){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},i(t,e)}var s=n(1),o=n(13),r=n(2),a=n(0),l=function(t){function e(){return t.apply(this,arguments)||this}var n,s;return s=t,(n=e).prototype=Object.create(s.prototype),n.prototype.constructor=n,i(n,s),e.prototype.execute=function(){return r(this.rootNode,this.options,o)},e}(s),h={};t.exports=function(t,e){return e=a.assign({},h,e),new l(t,e).execute()}},function(t,e,n){var i=n(0);function s(t,e){var n=0;return t.children.length?t.children.forEach((function(t){n+=s(t,e)})):n=t.height,t._subTreeSep=e.getSubTreeSep(t.data),t.totalHeight=Math.max(t.height,n)+2*t._subTreeSep,t.totalHeight}function o(t){var e=t.children,n=e.length;if(n){e.forEach((function(t){o(t)}));var i=e[0],s=e[n-1],r=s.y-i.y+s.height,a=0;if(e.forEach((function(t){a+=t.totalHeight})),r>t.height)t.y=i.y+r/2-t.height/2;else if(1!==e.length||t.height>a){var l=t.y+(t.height-r)/2-i.y;e.forEach((function(t){t.translate(0,l)}))}else t.y=(i.y+i.height/2+s.y+s.height/2)/2-t.height/2}}var r={getSubTreeSep:function(){return 0}};t.exports=function(t,e){void 0===e&&(e={}),e=i.assign({},r,e),t.parent={x:0,width:0,height:0,y:0},t.BFTraverse((function(t){t.x=t.parent.x+t.parent.width})),t.parent=null,s(t,e),t.startY=0,t.y=t.totalHeight/2-t.height/2,t.eachNode((function(t){var e=t.children,n=e.length;if(n){var i=e[0];if(i.startY=t.startY+t._subTreeSep,1===n)i.y=t.y+t.height/2-i.height/2;else{i.y=i.startY+i.totalHeight/2-i.height/2;for(var s=1;s<n;s++){var o=e[s];o.startY=e[s-1].startY+e[s-1].totalHeight,o.y=o.startY+o.totalHeight/2-o.height/2}}}})),o(t)}}])},t.exports=e()},27361:function(t,e,n){var i=n(97786);t.exports=function(t,e,n){var s=null==t?void 0:i(t,e);return void 0===s?n:s}},47037:function(t,e,n){var i=n(44239),s=n(1469),o=n(37005);t.exports=function(t){return"string"==typeof t||!s(t)&&o(t)&&"[object String]"==i(t)}},66604:function(t,e,n){var i=n(89465),s=n(47816),o=n(67206);t.exports=function(t,e){var n={};return e=o(e,3),s(t,(function(t,s,o){i(n,s,e(t,s,o))})),n}}}]);
//# sourceMappingURL=6038.bd5f3f31.async.js.map