(self.webpackChunkweb=self.webpackChunkweb||[]).push([[390],{3234:function(e,n,t){"use strict";t.d(n,{Z:function(){return s}});var r=t(5089),a=t(46693),i=t(93352),u=t(67294),o="thumbnailImg___cbGoI",c=t(85893),s=function(e){var n=e.name,t=e.id,s=(0,r.RT)(n),l=(0,i.x2)(),d=l.data,f=l.setDocumentIds,p=d[t];return(0,u.useEffect)((function(){t&&f([t])}),[t,f]),p?(0,c.jsx)("img",{src:p,className:o}):(0,c.jsx)(a.Z,{name:"file-icon/".concat(s),width:24})}},7306:function(e,n,t){"use strict";t.d(n,{Z:function(){return b}});var r=t(97857),a=t.n(r),i=t(13769),u=t.n(i),o=t(93967),c=t.n(o),s=t(6501),l=t(21373),d=t(30402),f=t(99719),p=t(50567),h=t(77437),v=(t(81897),t(71250)),m="text___QzeTq",g="code___dMLXp",y=t(85893),x=["children","className","node"],b=function(e){var n=e.children;return(0,y.jsx)(s.UG,{remarkPlugins:[p.Z,h.Z],rehypePlugins:[f.Z,d.Z],className:c()(m),components:{code:function(e){var n=e.children,t=e.className,r=(e.node,u()(e,x)),i=/language-(\w+)/.exec(t||"");return i?(0,y.jsx)(l.Z,a()(a()({},r),{},{PreTag:"div",language:i[1],children:String(n).replace(/\n$/,"")})):(0,y.jsx)("code",a()(a()({},r),{},{className:"".concat(t," ").concat(g),children:n}))}},children:n?(0,v.CE)(n):n})}},43714:function(e,n,t){"use strict";t.d(n,{s:function(){return y},Z:function(){return g}});var r=t(97857),a=t.n(r),i=t(13769),u=t.n(i),o=t(60806),c=t(55241),s=t(93967),l=t.n(s),d="primitiveImg___VkCiH",f="image___BCkCB",p="imagePreview___qFyP3",h=t(85893),v=["id","className"],m=function(e){var n=e.id,t=e.className,r=u()(e,v);return(0,h.jsx)("img",a()(a()({},r),{},{src:"".concat(o.N,"/document/image/").concat(n),alt:"",className:l()(d,t)}))},g=m,y=function(e){var n=e.id;return(0,h.jsx)(c.Z,{placement:"left",content:(0,h.jsx)(m,{id:n,className:p}),children:(0,h.jsx)(m,{id:n,className:f})})}},373:function(e,n,t){"use strict";var r=t(15009),a=t.n(r),i=t(99289),u=t.n(i),o=t(25098),c=t.n(o),s=t(97857),l=t.n(s),d=t(5574),f=t.n(d),p=t(12444),h=t.n(p),v=t(72004),m=t.n(v),g=t(28785),y=t.n(g),x=t(48374),b=t.n(x),k=t(31996),_=t.n(k),w=t(26037),D=t.n(w),Z=t(9783),P=t.n(Z),C=t(1242),I=t(47736),E=t(41609),N=t.n(E),S=t(67294),j=t(4511),A=t(85893),F="root",L=["#5B8FF9","#F6BD16","#5AD8A6","#945FB9","#E86452","#6DC8EC","#FF99C3","#1E9493","#FF9845","#5D7092"],K="collapse-expand",T=function(e){_()(t,e);var n=D()(t);function t(e){return h()(this,t),Object.assign(e.style,t.defaultStyleProps),n.call(this,e)}return m()(t,[{key:"childrenData",get:function(){var e;return null===(e=this.attributes.context)||void 0===e?void 0:e.model.getChildrenData(this.id)}},{key:"getKeyStyle",value:function(e){var n=this.getSize(e),r=f()(n,2),a=r[0],i=r[1],u=y()(b()(t.prototype),"getKeyStyle",this).call(this,e);return l()(l()({width:a,height:i},u),{},{fill:"transparent"})}},{key:"drawKeyShape",value:function(e,n){var t=this.getKeyStyle(e);return this.upsert("key",C.UL,t,n)}},{key:"getLabelStyle",value:function(e){return!(!1===e.label||!e.labelText)&&(0,I.zs)(this.getGraphicStyle(e),"label")}},{key:"drawIconArea",value:function(e,n){var t=this.getSize(e),r={fill:"transparent",height:30,width:12,x:-6,y:f()(t,2)[1],zIndex:-1};this.upsert("icon-area",C.UL,r,n)}},{key:"forwardEvent",value:function(e,n,t){e&&!Reflect.has(e,"__bind__")&&(Reflect.set(e,"__bind__",!0),e.addEventListener(n,t))}},{key:"getCountStyle",value:function(e){var n=e.collapsed,t=e.color;if(n){var r,a=this.getSize(e),i=f()(a,2)[1];return{backgroundFill:t,cursor:"pointer",fill:"#fff",fontSize:8,padding:[0,10],text:"".concat(null===(r=this.childrenData)||void 0===r?void 0:r.length),textAlign:"center",y:i+8}}return!1}},{key:"drawCountShape",value:function(e,n){var t=this,r=this.getCountStyle(e),a=this.upsert("count",I.Ct,r,n);this.forwardEvent(a,I.C9.CLICK,(function(n){n.stopPropagation(),e.context.graph.emit(K,{id:t.id,collapsed:!1})}))}},{key:"isShowCollapse",value:function(e){var n;return!e.collapsed&&Array.isArray(this.childrenData)&&(null===(n=this.childrenData)||void 0===n?void 0:n.length)>0}},{key:"getCollapseStyle",value:function(e){var n=e.showIcon,t=e.color;if(!this.isShowCollapse(e))return!1;var r=this.getSize(e);return{visibility:n?"visible":"hidden",backgroundFill:t,backgroundHeight:12,backgroundWidth:12,cursor:"pointer",fill:"#fff",fontFamily:"iconfont",fontSize:8,text:"",textAlign:"center",x:-1,y:f()(r,2)[1]+8}}},{key:"drawCollapseShape",value:function(e,n){var t=this,r=this.getCollapseStyle(e),a=this.upsert("collapse-expand",I.Ct,r,n);this.forwardEvent(a,I.C9.CLICK,(function(n){n.stopPropagation(),e.context.graph.emit(K,{id:t.id,collapsed:!e.collapsed})}))}},{key:"getAddStyle",value:function(e){var n=e.collapsed,t=e.showIcon;if(n)return!1;var r=this.getSize(e),a="#ddd";return{visibility:t?"visible":"hidden",backgroundFill:"#fff",backgroundHeight:12,backgroundLineWidth:1,backgroundStroke:a,backgroundWidth:12,cursor:"pointer",fill:a,fontFamily:"iconfont",text:"",textAlign:"center",x:-1,y:f()(r,2)[1]+(this.isShowCollapse(e)?22:8)}}},{key:"render",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.parsedAttributes,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this;y()(b()(t.prototype),"render",this).call(this,e,n),this.drawCountShape(e,n),this.drawIconArea(e,n),this.drawCollapseShape(e,n)}}]),t}(I.Hd);P()(T,"defaultStyleProps",{ports:[{key:"in",placement:"right-bottom"},{key:"out",placement:"left-bottom"}]});var R=function(e){_()(t,e);var n=D()(t);function t(){return h()(this,t),n.apply(this,arguments)}return m()(t,[{key:"getControlPoints",value:function(e,n,t){return[[f()(n,1)[0],f()(t,2)[1]]]}}]),t}(I.aH),z=function(e){_()(t,e);var n=D()(t);function t(e,r){var i;return h()(this,t),i=n.call(this,e,r),P()(c()(i),"status","idle"),P()(c()(i),"showIcon",(function(e){i.setIcon(e,!0)})),P()(c()(i),"hideIcon",(function(e){i.setIcon(e,!1)})),P()(c()(i),"setIcon",(function(e,n){if("idle"===i.status){var t=e.target.id,r=i.context,a=r.graph,u=r.element;a.updateNodeData([{id:t,style:{showIcon:n}}]),null==u||u.draw({animation:!1,silence:!0})}})),P()(c()(i),"onCollapseExpand",function(){var e=u()(a()().mark((function e(n){var t,r,u;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i.status="busy",t=n.id,r=n.collapsed,u=i.context.graph,!r){e.next=8;break}return e.next=6,u.collapseElement(t);case 6:e.next=10;break;case 8:return e.next=10,u.expandElement(t);case 10:i.status="idle";case 11:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()),i.bindEvents(),i}return m()(t,[{key:"update",value:function(e){this.unbindEvents(),y()(b()(t.prototype),"update",this).call(this,e),this.bindEvents()}},{key:"bindEvents",value:function(){var e=this.context.graph;e.on(I.bG.POINTER_ENTER,this.showIcon),e.on(I.bG.POINTER_LEAVE,this.hideIcon),e.on(K,this.onCollapseExpand)}},{key:"unbindEvents",value:function(){var e=this.context.graph;e.off(I.bG.POINTER_ENTER,this.showIcon),e.off(I.bG.POINTER_LEAVE,this.hideIcon),e.off(K,this.onCollapseExpand)}}]),t}(I.Zt);function B(e){var n=e.error;return(0,A.jsxs)("div",{role:"alert",children:[(0,A.jsx)("p",{children:"Something went wrong:"}),(0,A.jsx)("pre",{style:{color:"red"},children:n.message})]})}(0,I.z2)(I.MD.NODE,"indented",T),(0,I.z2)(I.MD.EDGE,"indented",R),(0,I.z2)(I.MD.BEHAVIOR,"collapse-expand-tree",z);n.Z=function(e){var n=e.data,t=e.show,r=e.style,i=void 0===r?{}:r,o=(0,S.useRef)(null),c=(0,S.useRef)(null),s=S.useCallback((function e(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;n.id||(n.id=t?"".concat(t,"-").concat(r):"root"),n.children&&n.children.forEach((function(t,r){return e(t,n.id,r)}))}),[]),d=(0,S.useCallback)(function(){var e=u()(a()().mark((function e(n){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=new I.kJ({container:o.current,x:60,node:{type:"indented",style:{size:function(e){return[6*e.id.length+10,20]},labelBackground:function(e){return e.id===F},labelBackgroundRadius:0,labelBackgroundFill:"#576286",labelFill:function(e){return e.id===F?"#fff":"#666"},labelText:function(e){var n;return(null===(n=e.style)||void 0===n?void 0:n.labelText)||e.id},labelTextAlign:function(e){return e.id===F?"center":"left"},labelTextBaseline:"top",color:function(e){var n=t.getAncestorsData(e.id,"tree").length-1;return L[n%L.length]||"#576286"}},state:{selected:{lineWidth:0,labelFill:"#40A8FF",labelBackground:!0,labelFontWeight:"normal",labelBackgroundFill:"#e8f7ff",labelBackgroundRadius:10}}},edge:{type:"indented",style:{radius:16,lineWidth:2,sourcePort:"out",targetPort:"in",stroke:function(e){var n=t.getAncestorsData(e.source,"tree").length;return L[n%L.length]||"black"}}},layout:{type:"indented",direction:"LR",isHorizontal:!0,indent:40,getHeight:function(){return 20},getVGap:function(){return 10}},behaviors:["scroll-canvas","collapse-expand-tree",{type:"click-select",enable:function(e){return"node"===e.targetType&&e.target.id!==F}}]}),c.current&&c.current.destroy(),c.current=t,s(n),null==t||t.setData((0,I.RN)(n)),null==t||t.render();case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),[s]);return(0,S.useEffect)((function(){N()(n)||d(n)}),[d,n]),(0,A.jsx)(j.SV,{fallbackRender:B,children:(0,A.jsx)("div",{id:"tree",ref:o,style:l()({width:"90vw",height:"80vh",display:t?"block":"none"},i)})})}},18334:function(e,n,t){"use strict";var r=t(5089),a=(t(67294),t(85893));n.Z=function(e){var n=e.children,t=e.link,i=e.preventDefault,u=void 0!==i&&i,o=e.color,c=void 0===o?"rgb(15, 79, 170)":o,s=e.documentId,l=e.documentName,d=e.prefix,f=void 0===d?"file":d,p=t,h=(0,r.RT)(l);return t||(p="/document/".concat(s,"?ext=").concat(h,"&prefix=").concat(f)),(0,a.jsx)("a",{target:"_blank",onClick:!u||(0,r.Ep)(h)?void 0:function(e){return e.preventDefault()},href:p,rel:"noreferrer",style:{color:c,wordBreak:"break-all"},children:n})}},71580:function(e,n,t){"use strict";t.d(n,{B:function(){return o}});var r=t(5574),a=t.n(r),i=t(86968),u=t(67294),o=function(){var e=(0,i.pG)(),n=e.visible,t=e.showModal,r=e.hideModal,o=(0,u.useState)({}),c=a()(o,2),s=c[0],l=c[1],d=(0,u.useState)(""),f=a()(d,2),p=f[0],h=f[1],v=(0,u.useCallback)((function(e,n){t(),l(n),h(e)}),[t]);return{clickDocumentButton:v,visible:n,showModal:t,hideModal:r,selectedChunk:s,documentId:p}}},61110:function(e,n,t){"use strict";t.d(n,{Z:function(){return y}});var r=t(85265),a=t(97857),i=t.n(a),u=t(5574),o=t.n(u),c=t(93352),s=t(4772),l=t(48054),d=t(67294),f=t(91492),p=t(96449),h="documentContainer___kWzt7",v=t(85893),m=function(e){var n=e.comment;return n.text?(0,v.jsxs)("div",{className:"Highlight__popup",children:[n.emoji," ",n.text]}):null},g=function(e){var n=e.chunk,t=e.documentId,r=e.visible,a=(0,c.pC)(t),u=(0,c.tl)(n),g=u.highlights,y=u.setWidthAndHeight,x=(0,d.useRef)((function(){})),b=(0,d.useState)(!1),k=o()(b,2),_=k[0],w=k[1],D=a(),Z=(0,p.s)(D),P=function(){};return(0,d.useEffect)((function(){w(r)}),[r]),(0,d.useEffect)((function(){g.length>0&&_&&(w(!1),x.current(g[0]))}),[g,_]),(0,v.jsx)("div",{className:h,children:(0,v.jsx)(f.Hz,{url:D,beforeLoad:(0,v.jsx)(l.Z,{active:!0}),workerSrc:"/pdfjs-dist/pdf.worker.min.js",errorMessage:(0,v.jsx)(s.Z,{children:Z}),children:function(e){return e.getPage(1).then((function(e){var n=e.getViewport({scale:1}),t=n.width,r=n.height;y(t,r)})),(0,v.jsx)(f.Nb,{pdfDocument:e,enableAreaSelection:function(e){return e.altKey},onScrollChange:P,scrollRef:function(e){x.current=e,w(!0)},onSelectionFinished:function(){return null},highlightTransform:function(e,n,t,r,a,u,o){var c=!Boolean(e.content&&e.content.image)?(0,v.jsx)(f.y$,{isScrolledTo:o,position:e.position,comment:e.comment}):(0,v.jsx)(f.PD,{isScrolledTo:o,highlight:e,onChange:function(){}});return(0,v.jsx)(f.GI,{popupContent:(0,v.jsx)(m,i()({},e)),onMouseOver:function(n){return t(e,(function(){return n}))},onMouseOut:r,children:c},n)},highlights:g})}})})},y=function(e){var n=e.visible,t=void 0!==n&&n,a=e.hideModal,i=e.documentId,u=e.chunk;return(0,v.jsx)(r.Z,{title:"Document Previewer",onClose:a,open:t,width:"50vw",children:(0,v.jsx)(g,{documentId:i,chunk:u,visible:t})})}},96449:function(e,n,t){"use strict";t.d(n,{s:function(){return d}});var r=t(15009),a=t.n(r),i=t(99289),u=t.n(i),o=t(5574),c=t.n(o),s=t(54683),l=t(67294),d=function(e){var n=(0,l.useState)(""),t=c()(n,2),r=t[0],i=t[1],o=(0,l.useCallback)(u()(a()().mark((function n(){var t,r;return a()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,s.Z.get(e);case 2:t=n.sent,0!==(r=t.data).code&&i(null==r?void 0:r.message);case 5:case"end":return n.stop()}}),n)}))),[e]);return(0,l.useEffect)((function(){o()}),[o]),r}},93352:function(e,n,t){"use strict";t.d(n,{A3:function(){return N},GH:function(){return S},Hy:function(){return q},Mc:function(){return M},QG:function(){return L},Yb:function(){return F},an:function(){return R},hf:function(){return K},jz:function(){return E},pC:function(){return P},tC:function(){return B},tl:function(){return C},ui:function(){return A},v3:function(){return I},wO:function(){return z},wk:function(){return j},x2:function(){return T}});var r=t(97857),a=t.n(r),i=t(15009),u=t.n(i),o=t(99289),c=t.n(o),s=t(5574),l=t.n(s),d=t(54707),f=t(53506),p=t(73955),h=t(60806),v=t(5089),m=t(78158),g=t(78551),y=t(30202),x=t(98029),b=t(45360),k=t(96486),_=t(67294),w=t(86004),D=t(2938),Z=t(96100),P=function(e){return(0,_.useCallback)((function(n){return"".concat(h.N,"/document/get/").concat(e||n)}),[e])},C=function(e){var n=(0,_.useState)({width:849,height:1200}),t=l()(n,2),r=t[0],a=t[1];return{highlights:(0,_.useMemo)((function(){return(0,v.q1)(e,r)}),[e,r]),setWidthAndHeight:function(e,n){a((function(t){return t.height!==n||t.width!==e?{height:n,width:e}:t}))}}},I=function(){var e,n=(0,Z.pE)().knowledgeId,t=(0,D.Qe)(),r=t.searchString,i=t.handleInputChange,o=(0,D.ye)(),s=o.pagination,l=o.setPagination,d=(0,w.UO)().id,f=(0,g.a)({queryKey:["fetchDocumentList",r,s],initialData:{docs:[],total:0},refetchInterval:15e3,enabled:!!n||!!d,queryFn:(e=c()(u()().mark((function e(){var t;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.ZP.get_document_list({kb_id:n||d,keywords:r,page_size:s.pageSize,page:s.current});case 2:if(0!==(t=e.sent).data.code){e.next=5;break}return e.abrupt("return",t.data.data);case 5:return e.abrupt("return",{docs:[],total:0});case 6:case"end":return e.stop()}}),e)}))),function(){return e.apply(this,arguments)})}),h=f.data,v=f.isFetching,m=(0,_.useCallback)((function(e){l({page:1}),i(e)}),[i,l]);return{loading:v,searchString:r,documents:h.docs,pagination:a()(a()({},s),{},{total:null==h?void 0:h.total}),handleInputChange:m,setPagination:l}},E=function(){var e,n=(0,y.NL)(),t=(0,x.D)({mutationKey:["updateDocumentStatus"],mutationFn:(e=c()(u()().mark((function e(t){var r,a,i,o;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.status,a=t.documentId,e.next=3,p.ZP.document_change_status({doc_id:a,status:Number(r)});case 3:return i=e.sent,0===(o=i.data).code&&(b.ZP.success(d.Z.t("message.modified")),n.invalidateQueries({queryKey:["fetchDocumentList"]})),e.abrupt("return",o);case 7:case"end":return e.stop()}}),e)}))),function(n){return e.apply(this,arguments)})}),r=t.data,a=t.isPending;return{setDocumentStatus:t.mutateAsync,data:r,loading:a}},N=function(){var e,n=(0,y.NL)(),t=(0,x.D)({mutationKey:["saveDocumentName"],mutationFn:(e=c()(u()().mark((function e(t){var r,a,i,o;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.name,a=t.documentId,e.next=3,p.ZP.document_rename({doc_id:a,name:r});case 3:return i=e.sent,0===(o=i.data).code&&(b.ZP.success(d.Z.t("message.renamed")),n.invalidateQueries({queryKey:["fetchDocumentList"]})),e.abrupt("return",o.code);case 7:case"end":return e.stop()}}),e)}))),function(n){return e.apply(this,arguments)})}),r=t.data;return{loading:t.isPending,saveName:t.mutateAsync,data:r}},S=function(){var e,n=(0,Z.pE)().knowledgeId,t=(0,Z.fz)(),r=t.setPaginationParams,a=t.page,i=(0,y.NL)(),o=(0,x.D)({mutationKey:["createDocument"],mutationFn:(e=c()(u()().mark((function e(t){var o,c;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.ZP.document_create({name:t,kb_id:n});case 2:return o=e.sent,0===(c=o.data).code&&(1===a?i.invalidateQueries({queryKey:["fetchDocumentList"]}):r(),b.ZP.success(d.Z.t("message.created"))),e.abrupt("return",c.code);case 6:case"end":return e.stop()}}),e)}))),function(n){return e.apply(this,arguments)})}),s=o.data,l=o.isPending;return{createDocument:o.mutateAsync,loading:l,data:s}},j=function(){var e,n=(0,y.NL)(),t=(0,x.D)({mutationKey:["setDocumentParser"],mutationFn:(e=c()(u()().mark((function e(t){var r,a,i,o,c;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.parserId,a=t.documentId,i=t.parserConfig,e.next=3,p.ZP.document_change_parser({parser_id:r,doc_id:a,parser_config:i});case 3:return o=e.sent,0===(c=o.data).code&&(n.invalidateQueries({queryKey:["fetchDocumentList"]}),b.ZP.success(d.Z.t("message.modified"))),e.abrupt("return",c.code);case 7:case"end":return e.stop()}}),e)}))),function(n){return e.apply(this,arguments)})}),r=t.data,a=t.isPending;return{setDocumentParser:t.mutateAsync,data:r,loading:a}},A=function(){var e,n=(0,y.NL)(),t=(0,Z.pE)().knowledgeId,r=(0,x.D)({mutationKey:["uploadDocument"],mutationFn:(e=c()(u()().mark((function e(r){var a,i,o;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(a=new FormData).append("kb_id",t),r.forEach((function(e){a.append("file",e)})),e.prev=3,e.next=6,p.ZP.document_upload(a);case 6:return i=e.sent,0!==(o=(0,k.get)(i,"data.code"))&&500!==o||n.invalidateQueries({queryKey:["fetchDocumentList"]}),e.abrupt("return",null==i?void 0:i.data);case 12:return e.prev=12,e.t0=e.catch(3),console.warn(e.t0),e.abrupt("return",{code:500,message:e.t0+""});case 16:case"end":return e.stop()}}),e,null,[[3,12]])}))),function(n){return e.apply(this,arguments)})}),a=r.data,i=r.isPending;return{uploadDocument:r.mutateAsync,loading:i,data:a}},F=function(){var e,n=(0,Z.pE)().knowledgeId,t=(0,x.D)({mutationKey:["webCrawl"],mutationFn:(e=c()(u()().mark((function e(t){var r,a,i,o,c;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.name,a=t.url,(i=new FormData).append("name",r),i.append("url",a),i.append("kb_id",n),e.next=7,p.ZP.web_crawl(i);case 7:return o=e.sent,0===(c=(0,k.get)(o,"data.code"))&&b.ZP.success(d.Z.t("message.uploaded")),e.abrupt("return",c);case 11:case"end":return e.stop()}}),e)}))),function(n){return e.apply(this,arguments)})});return{data:t.data,loading:t.isPending,webCrawl:t.mutateAsync}},L=function(){var e,n=(0,y.NL)(),t=(0,x.D)({mutationKey:["runDocumentByIds"],mutationFn:(e=c()(u()().mark((function e(t){var r,a,i,o,c;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.documentIds,a=t.run,i=t.shouldDelete,e.next=3,p.ZP.document_run({doc_ids:r,run:a,delete:i});case 3:return o=e.sent,0===(c=(0,k.get)(o,"data.code"))&&(n.invalidateQueries({queryKey:["fetchDocumentList"]}),b.ZP.success(d.Z.t("message.operated"))),e.abrupt("return",c);case 7:case"end":return e.stop()}}),e)}))),function(n){return e.apply(this,arguments)})}),r=t.data,a=t.isPending;return{runDocumentByIds:t.mutateAsync,loading:a,data:r}},K=function(){var e,n=(0,_.useState)([]),t=l()(n,2),r=t[0],a=t[1],i=(0,g.a)({queryKey:["fetchDocumentInfos",r],enabled:r.length>0,initialData:[],queryFn:(e=c()(u()().mark((function e(){var n,t;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.ZP.document_infos({doc_ids:r});case 2:if(n=e.sent,0!==(t=n.data).code){e.next=6;break}return e.abrupt("return",t.data);case 6:return e.abrupt("return",[]);case 7:case"end":return e.stop()}}),e)}))),function(){return e.apply(this,arguments)})});return{data:i.data,setDocumentIds:a}},T=function(){var e,n=(0,_.useState)([]),t=l()(n,2),r=t[0],a=t[1],i=(0,g.a)({queryKey:["fetchDocumentThumbnails",r],enabled:r.length>0,initialData:{},queryFn:(e=c()(u()().mark((function e(){var n,t;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.ZP.document_thumbnails({doc_ids:r});case 2:if(n=e.sent,0!==(t=n.data).code){e.next=6;break}return e.abrupt("return",t.data);case 6:return e.abrupt("return",{});case 7:case"end":return e.stop()}}),e)}))),function(){return e.apply(this,arguments)})});return{data:i.data,setDocumentIds:a}},R=function(){var e,n=(0,y.NL)(),t=(0,x.D)({mutationKey:["removeDocument"],mutationFn:(e=c()(u()().mark((function e(t){var r,a;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.ZP.document_rm({doc_id:t});case 2:return r=e.sent,0===(a=r.data).code&&(b.ZP.success(d.Z.t("message.deleted")),n.invalidateQueries({queryKey:["fetchDocumentList"]})),e.abrupt("return",a.code);case 6:case"end":return e.stop()}}),e)}))),function(n){return e.apply(this,arguments)})});return{data:t.data,loading:t.isPending,removeDocument:t.mutateAsync}},z=function(){var e,n=(0,x.D)({mutationKey:["deleteDocument"],mutationFn:(e=c()(u()().mark((function e(n){var t;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.ZP.document_delete({doc_ids:n});case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)}))),function(n){return e.apply(this,arguments)})});return{data:n.data,loading:n.isPending,deleteDocument:n.mutateAsync}},B=function(e){var n,t=(0,x.D)({mutationKey:["uploadAndParseDocument"],mutationFn:(n=c()(u()().mark((function n(t){var r,a,i,o,c;return u()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=t.conversationId,a=t.fileList,n.prev=1,(i=new FormData).append("conversation_id",r),a.forEach((function(e){i.append("file",e)})),"upload_and_parse"!==e){n.next=10;break}return n.next=8,p.ZP.upload_and_parse(i);case 8:return o=n.sent,n.abrupt("return",null==o?void 0:o.data);case 10:return n.next=12,f.Z.uploadAndParseExternal(i);case 12:return c=n.sent,n.abrupt("return",null==c?void 0:c.data);case 16:n.prev=16,n.t0=n.catch(1);case 18:case"end":return n.stop()}}),n,null,[[1,16]])}))),function(e){return n.apply(this,arguments)})});return{data:t.data,loading:t.isPending,uploadAndParseDocument:t.mutateAsync}},M=function(){var e,n=(0,x.D)({mutationKey:["parseDocument"],mutationFn:(e=c()(u()().mark((function e(n){var t;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,m.v_)(h.Z.parse,{url:n});case 3:return 0===(null==(t=e.sent)?void 0:t.code)&&b.ZP.success(d.Z.t("message.uploaded")),e.abrupt("return",t);case 8:e.prev=8,e.t0=e.catch(0),b.ZP.error("error");case 11:case"end":return e.stop()}}),e,null,[[0,8]])}))),function(n){return e.apply(this,arguments)})}),t=n.data,r=n.isPending;return{parseDocument:n.mutateAsync,data:t,loading:r}},q=function(){var e,n=(0,y.NL)(),t=(0,x.D)({mutationKey:["setDocumentMeta"],mutationFn:(e=c()(u()().mark((function e(t){var r,a;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,p.ZP.setMeta({meta:t.meta,doc_id:t.documentId});case 3:return r=e.sent,0===(null==(a=r.data)?void 0:a.code)&&(n.invalidateQueries({queryKey:["fetchDocumentList"]}),b.ZP.success(d.Z.t("message.modified"))),e.abrupt("return",null==a?void 0:a.code);case 9:e.prev=9,e.t0=e.catch(0),b.ZP.error("error");case 12:case"end":return e.stop()}}),e,null,[[0,9]])}))),function(n){return e.apply(this,arguments)})}),r=t.data,a=t.isPending;return{setDocumentMeta:t.mutateAsync,data:r,loading:a}}},46008:function(e,n,t){"use strict";t.d(n,{Z:function(){return q}});var r=t(97857),a=t.n(r),i=t(13769),u=t.n(i),o=t(43714),c=t(46693),s=t(5089),l=t(45605),d=t(86250),f=t(55241),p=t(42075),h=t(77683),v=t(22424),m=t(67294),g=t(6501),y=t(59632),x=t.n(y),b=t(86592),k=t(30402),_=t(99719),w=t(50567),D=t(77437),Z=t(88718),P=t(93352),C=t(67421),I=(t(81897),t(71250)),E=t(35293),N=t(78230),S="markdownContentWrapper___geQCE",j="referencePopoverWrapper___rn9A6",A="referenceChunkImage___LoR67",F="referenceImagePreview___kcQgd",L="chunkContentText___vcP0P",K="documentLink___USud0",T="referenceIcon___g5Mgk",R="fileThumbnail___BzBir",z=t(85893),B=["children","className","node"],M=/(~{2}\d+={2})/g,q=function(e){var n=e.reference,t=e.clickDocumentButton,r=e.content,i=(0,C.$G)().t,y=(0,P.x2)(),q=y.setDocumentIds,H=y.data,G=(0,m.useMemo)((function(){var e=r;""===e&&(e=i("chat.searching"));var n=(0,E.fL)(e);return(0,N.pipe)(I.hH,I.CE)(n)}),[r,i]);(0,m.useEffect)((function(){var e=null==n?void 0:n.doc_aggs;q(Array.isArray(e)?e.map((function(e){return e.doc_id})):[])}),[n,q]);var Q=(0,m.useCallback)((function(e,n,r,a){return function(){if(r)null==t||t(e,n);else{if(!a)return;window.open(a,"_blank")}}}),[t]),O=(0,m.useCallback)((function(e){var t,r,a,i=(null!==(t=null==n?void 0:n.chunks)&&void 0!==t?t:[])[e],u=null==n||null===(r=n.doc_aggs)||void 0===r?void 0:r.find((function(e){return(null==e?void 0:e.doc_id)===(null==i?void 0:i.document_id)})),l=null==u?void 0:u.doc_id,m=null==u?void 0:u.url,g=l?H[l]:"",y=l?(0,s.RT)(null==u?void 0:u.doc_name):"",x=null==i?void 0:i.image_id;return(0,z.jsxs)(d.Z,{gap:10,className:j,children:[x&&(0,z.jsx)(f.Z,{placement:"left",content:(0,z.jsx)(o.Z,{id:x,className:F}),children:(0,z.jsx)(o.Z,{id:x,className:A})}),(0,z.jsxs)(p.Z,{direction:"vertical",children:[(0,z.jsx)("div",{dangerouslySetInnerHTML:{__html:v.Z.sanitize(null!==(a=null==i?void 0:i.content)&&void 0!==a?a:"")},className:L}),l&&(0,z.jsxs)(d.Z,{gap:"small",children:[g?(0,z.jsx)("img",{src:g,alt:"",className:R}):(0,z.jsx)(c.Z,{name:"file-icon/".concat(y),width:24}),(0,z.jsx)(h.ZP,{type:"link",className:K,onClick:Q(l,i,"pdf"===y,m),children:null==u?void 0:u.doc_name})]})]})]},null==i?void 0:i.id)}),[n,H,Q]),W=(0,m.useCallback)((function(e){return x()(e,M,(function(e,n){var t=function(e){return Number(e.slice(2,-2))}(e);return(0,z.jsx)(f.Z,{content:O(t),children:(0,z.jsx)(l.Z,{className:T})},n)}))}),[O]);return(0,z.jsx)(g.UG,{rehypePlugins:[function(){return function(e){(0,Z.S4)(e,"text",(function(e,n){var t=n.at(-1);"custom-typography"!==t.tagName&&"code"!==t.tagName&&(e.type="element",e.tagName="custom-typography",e.properties={},e.children=[{type:"text",value:e.value}])}))}},k.Z,_.Z],remarkPlugins:[w.Z,D.Z],className:S,components:{"custom-typography":function(e){var n=e.children;return W(n)},code:function(e){var n=e.children,t=e.className,r=(e.node,u()(e,B)),i=/language-(\w+)/.exec(t||"");return i?(0,z.jsx)(b.Z,a()(a()({},r),{},{PreTag:"div",language:i[1],children:String(n).replace(/\n$/,"")})):(0,z.jsx)("code",a()(a()({},r),{},{className:t,children:n}))}},children:G})}},35293:function(e,n,t){"use strict";t.d(n,{fL:function(){return o},oI:function(){return i}});var r=t(1079),a=t(96486),i=function(e,n){var t,i,u=(null===(t=e.message)||void 0===t?void 0:t.filter((function(e){return e.role===r.Cs.Assistant})).slice(1)).findIndex((function(e){return e.id===n.id})),o=(0,a.isEmpty)(null==n?void 0:n.reference)?(null!==(i=null==e?void 0:e.reference)&&void 0!==i?i:[])[u]:null==n?void 0:n.reference;return null!=o?o:{doc_aggs:[],chunks:[],total:0}},u=/(#{2}\d+\${2})/g,o=function(e){return e.replace(u,(function(e){return"~~".concat(e.slice(2,-2),"==")}))}},4772:function(e,n,t){"use strict";t.d(n,{Z:function(){return c}});var r=t(86250),a=t(38925),i=t(86968),u=(t(67294),"errorWrapper___QfVXQ"),o=t(85893),c=function(e){var n=e.children,t=(0,i.qM)("fileManager").t;return(0,o.jsx)(r.Z,{align:"center",justify:"center",className:u,children:(0,o.jsx)(a.Z,{type:"error",message:(0,o.jsx)("h2",{children:n||t("fileError")})})})}},5089:function(e,n,t){"use strict";t.d(n,{Ep:function(){return d},Or:function(){return f},RT:function(){return s},YC:function(){return l},q1:function(){return c}});var r=t(19632),a=t.n(r),i=t(40169),u=t(96486),o=t(57632),c=function(e,n){var t;return Array.isArray(null==e?void 0:e.positions)&&e.positions.every((function(e){return Array.isArray(e)}))?null==e||null===(t=e.positions)||void 0===t?void 0:t.map((function(t){var r={width:n.width,height:n.height,x1:t[1],x2:t[2],y1:t[3],y2:t[4]};return{id:(0,o.Z)(),comment:{text:"",emoji:""},content:{text:(0,u.get)(e,"content_with_weight")||(0,u.get)(e,"content","")},position:{boundingRect:r,rects:[r],pageNumber:t[0]}}})):[]},s=function(e){var n;return null!==(n=null==e?void 0:e.slice(e.lastIndexOf(".")+1).toLowerCase())&&void 0!==n?n:""},l=function(e){return e.split("\n").length},d=function(e){return i.ru.includes(e)},f=function(e){return[].concat(a()(i.rU),["svg"]).some((function(n){return n===e}))}},14601:function(){},32767:function(){},28251:function(){},57677:function(){},1543:function(){},87324:function(){}}]);
//# sourceMappingURL=390.83e27573.async.js.map