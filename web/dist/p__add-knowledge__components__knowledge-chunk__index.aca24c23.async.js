(self.webpackChunkweb=self.webpackChunkweb||[]).push([[4336],{26572:function(e,n,t){"use strict";t.d(n,{Z:function(){return m}});var a=t(19632),r=t.n(a),i=t(5574),c=t.n(i),u=t(24969),l=t(9361),s=t(83062),o=t(66309),d=t(38289),h=t(52376),f=t(67294),k="tweenGroup___HgfIF",g="tag___EPGvm",p=t(85893),m=function(e){var n=e.value,t=void 0===n?[]:n,a=e.onChange,i=l.Z.useToken().token,m=(0,f.useState)(!1),v=c()(m,2),x=v[0],C=v[1],_=(0,f.useState)(""),j=c()(_,2),b=j[0],Z=j[1],w=(0,f.useRef)(null);(0,f.useEffect)((function(){var e;x&&(null===(e=w.current)||void 0===e||e.focus())}),[x]);var y=function(){if(b&&t){var e=b.split(";").map((function(e){return e.trim()})).filter((function(e){return e&&!t.includes(e)}));null==a||a([].concat(r()(t),r()(e)))}C(!1),Z("")},I=null==t?void 0:t.map((function(e){return(0,p.jsx)(s.Z,{title:e,children:(0,p.jsx)(o.Z,{className:g,closable:!0,onClose:function(n){var r,i;n.preventDefault(),r=e,i=null==t?void 0:t.filter((function(e){return e!==r})),null==a||a(null!=i?i:[])},children:e},e)})})),P={background:i.colorBgContainer,borderStyle:"dashed"};return(0,p.jsxs)("div",{children:[Array.isArray(I)&&I.length>0&&(0,p.jsx)(h.Z,{className:k,enter:{scale:.8,opacity:0,type:"from",duration:100},onEnd:function(e){"appear"!==e.type&&"enter"!==e.type||(e.target.style="display: inline-block")},leave:{opacity:0,width:0,scale:0,duration:200},appear:!1,children:I}),x?(0,p.jsx)(d.Z,{ref:w,type:"text",size:"small",value:b,onChange:function(e){Z(e.target.value)},onBlur:y,onPressEnter:y}):(0,p.jsx)(o.Z,{onClick:function(){C(!0)},style:P,children:(0,p.jsx)(u.Z,{})})]})}},43714:function(e,n,t){"use strict";t.d(n,{s:function(){return v},Z:function(){return m}});var a=t(97857),r=t.n(a),i=t(13769),c=t.n(i),u=t(60806),l=t(55241),s=t(93967),o=t.n(s),d="primitiveImg___VkCiH",h="image___BCkCB",f="imagePreview___qFyP3",k=t(85893),g=["id","className"],p=function(e){var n=e.id,t=e.className,a=c()(e,g);return(0,k.jsx)("img",r()(r()({},a),{},{src:"".concat(u.N,"/document/image/").concat(n),alt:"",className:o()(d,t)}))},m=p,v=function(e){var n=e.id;return(0,k.jsx)(l.Z,{placement:"left",content:(0,k.jsx)(p,{id:n,className:f}),children:(0,k.jsx)(p,{id:n,className:h})})}},96449:function(e,n,t){"use strict";t.d(n,{s:function(){return d}});var a=t(15009),r=t.n(a),i=t(99289),c=t.n(i),u=t(5574),l=t.n(u),s=t(54683),o=t(67294),d=function(e){var n=(0,o.useState)(""),t=l()(n,2),a=t[0],i=t[1],u=(0,o.useCallback)(c()(r()().mark((function n(){var t,a;return r()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,s.Z.get(e);case 2:t=n.sent,0!==(a=t.data).code&&i(null==a?void 0:a.message);case 5:case"end":return n.stop()}}),n)}))),[e]);return(0,o.useEffect)((function(){u()}),[u]),a}},37441:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return cn}});var a=t(97857),r=t.n(a),i=t(9783),c=t.n(i),u=t(15009),l=t.n(u),s=t(99289),o=t.n(s),d=t(19632),h=t.n(d),f=t(5574),k=t.n(f),g=t(73955),p=t(78551),m=t(30202),v=t(98029),x=t(58580),C=t(45360),_=t(67294),j=t(67421),b=t(2938),Z=t(96100),w=function(){var e,n=(0,m.NL)().getQueriesData({queryKey:["fetchChunkList"]});return null==n||null===(e=n.at(-1))||void 0===e?void 0:e[1]},y=t(96074),I=t(86250),P=t(74330),S=t(42075),N=t(11004),M=t(93967),F=t.n(M),q=t(43714),A=t(4393),E=t(84567),O=t(55241),T=t(72269),L=t(22424),D=t(98236),z=function(e){return e.Full="full",e.Ellipse="ellipse",e}({}),K="image___fDGTe",U="imagePreview___N6faK",G="content___dvAD4",H="contentEllipsis___ku_hG",Q="contentText___FFy2D",R="chunkCard___FJadg",V="cardSelected___xZpKQ",W="cardSelectedDark___mfM8g",B=t(85893),$=function(e){var n=e.item,t=e.checked,a=e.handleCheckboxClick,r=e.editChunk,i=e.switchChunk,u=e.selected,l=e.clickChunkCard,s=e.textMode,o=Number(n.available_int),d=(0,_.useState)(!1),h=k()(d,2),f=h[0],g=h[1],p=(0,D.Fg)().theme;return(0,_.useEffect)((function(){g(1===o)}),[o]),(0,B.jsx)(A.Z,{className:F()(R,c()({},"".concat("dark"===p?W:V),u)),children:(0,B.jsxs)(I.Z,{gap:"middle",justify:"space-between",children:[(0,B.jsx)(E.Z,{onChange:function(e){a(n.chunk_id,e.target.checked)},checked:t}),n.img_id&&(0,B.jsx)(O.Z,{placement:"right",content:(0,B.jsx)(q.Z,{id:n.img_id,className:U}),children:(0,B.jsx)(q.Z,{id:n.img_id,className:K})}),(0,B.jsx)("section",{onDoubleClick:function(){r(n.chunk_id)},onClick:function(){l(n.chunk_id)},className:G,children:(0,B.jsx)("div",{dangerouslySetInnerHTML:{__html:L.Z.sanitize(n.content_with_weight)},className:F()(Q,c()({},H,s===z.Ellipse))})}),(0,B.jsx)("div",{children:(0,B.jsx)(T.Z,{checked:f,onChange:function(e){g(e),i(0===o?1:0,[n.chunk_id])}})})]})})},J=t(26572),X=t(48689),Y=t(22150),ee=t(85576),ne=t(38289),te=t(86968),ae=t(5089),re=function(e){var n=(0,_.useState)({width:849,height:1200}),t=k()(n,2),a=t[0],r=t[1],i=function(e){var n,t,a=w();return null!==(n=null==a||null===(t=a.data)||void 0===t?void 0:t.find((function(n){return n.chunk_id===e})))&&void 0!==n?n:{}}(e);return{highlights:(0,_.useMemo)((function(){return(0,ae.q1)(i,a)}),[i,a]),setWidthAndHeight:(0,_.useCallback)((function(e,n){r((function(t){return t.height!==n||t.width!==e?{height:n,width:e}:t}))}),[])}},ie=function(){var e,n,t,a,r=(n=(0,m.NL)(),t=(0,Z.fz)().setPaginationParams,a=(0,v.D)({mutationKey:["deleteChunk"],mutationFn:(e=o()(l()().mark((function e(a){var r,i;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g.ZP.rm_chunk(a);case 2:return r=e.sent,0===(i=r.data).code&&(t(1),n.invalidateQueries({queryKey:["fetchChunkList"]})),e.abrupt("return",null==i?void 0:i.code);case 6:case"end":return e.stop()}}),e)}))),function(n){return e.apply(this,arguments)})}),{data:a.data,loading:a.isPending,deleteChunk:a.mutateAsync}),i=r.deleteChunk,c=(0,te.I3)(),u=(0,_.useCallback)((function(e,n){return function(){return i({chunkIds:e,doc_id:n})}}),[i]);return{removeChunk:(0,_.useCallback)((function(e,n){return c({onOk:u(e,n)})}),[u,c])}},ce=function(){var e,n,t,a,i=(0,_.useState)(""),c=k()(i,2),u=c[0],s=c[1],d=(0,te.pG)(),h=d.visible,f=d.hideModal,p=d.showModal,x=(n=(0,j.$G)().t,t=(0,m.NL)(),a=(0,v.D)({mutationKey:["createChunk"],mutationFn:(e=o()(l()().mark((function e(a){var r,i,c;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=g.ZP.create_chunk,a.chunk_id&&(r=g.ZP.set_chunk),e.next=4,r(a);case 4:return i=e.sent,0===(c=i.data).code&&(C.ZP.success(n("message.created")),t.invalidateQueries({queryKey:["fetchChunkList"]})),e.abrupt("return",null==c?void 0:c.code);case 8:case"end":return e.stop()}}),e)}))),function(n){return e.apply(this,arguments)})}),{data:a.data,loading:a.isPending,createChunk:a.mutateAsync}),b=x.createChunk,w=x.loading,y=(0,Z.pE)().documentId,I=(0,_.useCallback)(function(){var e=o()(l()().mark((function e(n){return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b(r()(r()({},n),{},{doc_id:y,chunk_id:u}));case 2:0===e.sent&&f();case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),[b,f,u,y]),P=(0,_.useCallback)(function(){var e=o()(l()().mark((function e(n){return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s(n),p();case 2:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),[p]);return{chunkUpdatingLoading:w,onChunkUpdatingOk:I,chunkUpdatingVisible:h,hideChunkUpdatingModal:f,showChunkUpdatingModal:P,chunkId:u,documentId:y}};function ue(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).reduce((function(e,n){return e[n.tag]=n.frequency,e}),{})}function le(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.keys(e).reduce((function(n,t){return n.push({frequency:e[t],tag:t}),n}),[])}var se=t(13769),oe=t.n(se),de=t(10541),he=t(3089),fe=t(24969),ke=t(34041),ge=t(24435),pe=t(77683),me=["key","name"],ve="tag_feas",xe=function(){var e,n=Y.Z.useFormInstance(),t=(0,j.$G)().t,a=(0,de.PX)().data,i=(0,de.rd)(),c=i.setKnowledgeIds,u=i.list,l=(0,_.useMemo)((function(){var e,n;return null!==(e=null==a||null===(n=a.parser_config)||void 0===n?void 0:n.tag_kb_ids)&&void 0!==e?e:[]}),[null==a||null===(e=a.parser_config)||void 0===e?void 0:e.tag_kb_ids]),s=(0,_.useMemo)((function(){return u.map((function(e){return{value:e[0],label:e[0]}}))}),[u]),o=(0,_.useCallback)((function(e){var t,a=(null!==(t=n.getFieldValue(ve))&&void 0!==t?t:[]).filter((function(n,t){return n&&e!==t})).map((function(e){return e.tag}));return s.filter((function(e){return!a.some((function(n){return e.value===n}))}))}),[n,s]);return(0,_.useEffect)((function(){c(l)}),[c,l]),(0,B.jsx)(Y.Z.Item,{label:t("knowledgeConfiguration.tags"),children:(0,B.jsx)(Y.Z.List,{name:ve,initialValue:[],children:function(e,n){var a=n.add,i=n.remove;return(0,B.jsxs)(B.Fragment,{children:[e.map((function(e){var n=e.key,a=e.name,c=oe()(e,me);return(0,B.jsxs)("div",{className:"flex gap-3 items-center",children:[(0,B.jsxs)("div",{className:"flex flex-1  gap-8",children:[(0,B.jsx)(Y.Z.Item,r()(r()({},c),{},{name:[a,"tag"],rules:[{required:!0,message:t("common.pleaseSelect")}],className:"w-2/3",children:(0,B.jsx)(ke.Z,{showSearch:!0,placeholder:t("knowledgeConfiguration.tagName"),options:o(a)})})),(0,B.jsx)(Y.Z.Item,r()(r()({},c),{},{name:[a,"frequency"],rules:[{required:!0,message:t("common.pleaseInput")}],children:(0,B.jsx)(ge.Z,{placeholder:t("knowledgeConfiguration.frequency"),max:10,min:0})}))]}),(0,B.jsx)(he.Z,{onClick:function(){return i(a)},className:"mb-6"})]},n)})),(0,B.jsx)(Y.Z.Item,{children:(0,B.jsx)(pe.ZP,{type:"dashed",onClick:function(){return a()},block:!0,icon:(0,B.jsx)(fe.Z,{}),children:t("knowledgeConfiguration.addTag")})})]})}})})},Ce=function(e){var n=e.doc_id,t=e.chunkId,a=e.hideModal,i=e.onOk,c=e.loading,u=e.parserId,s=Y.Z.useForm(),d=k()(s,1)[0],h=(0,_.useState)(!1),f=k()(h,2),m=f[0],v=f[1],x=ie().removeChunk,C=function(e){var n,t=(0,p.a)({queryKey:["fetchChunk"],enabled:!!e,initialData:{},gcTime:0,queryFn:(n=o()(l()().mark((function n(){var t;return l()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,g.ZP.get_chunk({chunk_id:e});case 2:return t=n.sent,n.abrupt("return",t);case 4:case"end":return n.stop()}}),n)}))),function(){return n.apply(this,arguments)})});return t.data}(t),b=C.data,Z=(0,j.$G)().t,w="tag"===u,I=(0,_.useCallback)(o()(l()().mark((function e(){var n;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,d.validateFields();case 3:n=e.sent,console.log("ðŸš€ ~ handleOk ~ values:",n),null==i||i(r()(r()({},n),{},{tag_feas:ue(n.tag_feas),available_int:m?1:0})),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log("Failed:",e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])}))),[m,d,i]),P=(0,_.useCallback)((function(){if(t)return x([t],n)}),[t,n,x]),N=(0,_.useCallback)((function(){v(!m)}),[m]);return(0,_.useEffect)((function(){if(0===(null==b?void 0:b.code)){var e=b.data,n=e.available_int,t=e.tag_feas;d.setFieldsValue(r()(r()({},b.data||{}),{},{tag_feas:le(t)})),v(0!==n)}}),[b,d,t]),(0,B.jsxs)(ee.Z,{title:"".concat(Z(t?"common.edit":"common.create")," ").concat(Z("chunk.chunk")),open:!0,onOk:I,onCancel:a,okButtonProps:{loading:c},destroyOnClose:!0,children:[(0,B.jsxs)(Y.Z,{form:d,autoComplete:"off",layout:"vertical",children:[(0,B.jsx)(Y.Z.Item,{label:Z("chunk.chunk"),name:"content_with_weight",rules:[{required:!0,message:Z("chunk.chunkMessage")}],children:(0,B.jsx)(ne.Z.TextArea,{autoSize:{minRows:4,maxRows:10}})}),(0,B.jsx)(Y.Z.Item,{label:Z("chunk.keyword"),name:"important_kwd",children:(0,B.jsx)(J.Z,{})}),(0,B.jsx)(Y.Z.Item,{label:Z("chunk.question"),name:"question_kwd",tooltip:Z("chunk.questionTip"),children:(0,B.jsx)(J.Z,{})}),w&&(0,B.jsx)(Y.Z.Item,{label:Z("knowledgeConfiguration.tagName"),name:"tag_kwd",children:(0,B.jsx)(J.Z,{})}),!w&&(0,B.jsx)(xe,{})]}),t&&(0,B.jsxs)("section",{children:[(0,B.jsx)(y.Z,{}),(0,B.jsxs)(S.Z,{size:"large",children:[(0,B.jsx)(T.Z,{checkedChildren:Z("chunk.enabled"),unCheckedChildren:Z("chunk.disabled"),onChange:N,checked:m}),(0,B.jsxs)("span",{onClick:P,children:[(0,B.jsx)(X.Z,{})," ",Z("common.delete")]})]})]})]})},_e=Object.defineProperty,je=Object.getOwnPropertySymbols,be=Object.prototype.hasOwnProperty,Ze=Object.prototype.propertyIsEnumerable,we=(e,n,t)=>n in e?_e(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t;const ye=e=>_.createElement("svg",((e,n)=>{for(var t in n||(n={}))be.call(n,t)&&we(e,t,n[t]);if(je)for(var t of je(n))Ze.call(n,t)&&we(e,t,n[t]);return e})({width:20,height:20,fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),_.createElement("path",{d:"M5 10h10M2.5 5h15m-10 10h5",stroke:"#344054",strokeWidth:1.667,strokeLinecap:"round",strokeLinejoin:"round"}));var Ie=t(96330),Pe=t(8751),Se=t(18429),Ne=t(82826),Me=t(49354),Fe=t(80882),qe=t(68795),Ae=t(25593),Ee=t(50136),Oe=t(78045),Te=t(92783),Le=t(86004),De=Ae.Z.Text,ze=function(e){var n=e.selectAllChunk,t=e.checked,a=e.createChunk,r=e.removeChunk,i=e.switchChunk,c=e.changeChunkTextMode,u=e.available,l=e.handleSetAvailable,s=e.searchString,o=e.handleInputChange,d=w(),h=null==d?void 0:d.documentInfo,f=(0,de.w9)(),g=(0,_.useState)(!1),p=k()(g,2),m=p[0],v=p[1],x=(0,te.qM)("chunk").t,C=(0,_.useCallback)((function(e){n(e.target.checked)}),[n]),j=(0,_.useCallback)((function(){r()}),[r]),b=(0,_.useCallback)((function(){i(1)}),[i]),Z=(0,_.useCallback)((function(){i(0)}),[i]),y=(0,_.useMemo)((function(){return[{key:"1",label:(0,B.jsx)(B.Fragment,{children:(0,B.jsx)(E.Z,{onChange:C,checked:t,children:(0,B.jsx)("b",{children:x("selectAll")})})})},{type:"divider"},{key:"2",label:(0,B.jsxs)(S.Z,{onClick:b,children:[(0,B.jsx)(Pe.Z,{}),(0,B.jsx)("b",{children:x("enabledSelected")})]})},{key:"3",label:(0,B.jsxs)(S.Z,{onClick:Z,children:[(0,B.jsx)(Se.Z,{}),(0,B.jsx)("b",{children:x("disabledSelected")})]})},{type:"divider"},{key:"4",label:(0,B.jsxs)(S.Z,{onClick:j,children:[(0,B.jsx)(X.Z,{}),(0,B.jsx)("b",{children:x("deleteSelected")})]})}]}),[t,C,j,b,Z,x]),P=(0,B.jsx)(Ee.Z,{style:{width:200},items:y,selectable:!1}),N=(0,B.jsx)(Oe.ZP.Group,{onChange:function(e){n(!1),l(e.target.value)},value:u,children:(0,B.jsxs)(S.Z,{direction:"vertical",children:[(0,B.jsx)(Oe.ZP,{value:void 0,children:x("all")}),(0,B.jsx)(Oe.ZP,{value:1,children:x("enabled")}),(0,B.jsx)(Oe.ZP,{value:0,children:x("disabled")})]})});return(0,B.jsxs)(I.Z,{justify:"space-between",align:"center",children:[(0,B.jsxs)(S.Z,{size:"middle",children:[(0,B.jsx)(Le.rU,{to:"/knowledge/".concat(Ie.Rx.Dataset,"?id=").concat(f),children:(0,B.jsx)(Ne.Z,{})}),(0,B.jsx)(Me.Z,{}),(0,B.jsx)(De,{ellipsis:{tooltip:null==h?void 0:h.name},style:{width:150},children:null==h?void 0:h.name})]}),(0,B.jsxs)(S.Z,{children:[(0,B.jsx)(Te.Z,{options:[{label:x(z.Full),value:z.Full},{label:x(z.Ellipse),value:z.Ellipse}],onChange:c}),(0,B.jsx)(O.Z,{content:P,placement:"bottom",arrow:!1,children:(0,B.jsxs)(pe.ZP,{children:[x("bulk"),(0,B.jsx)(Fe.Z,{})]})}),m?(0,B.jsx)(ne.Z,{size:"middle",placeholder:x("search"),prefix:(0,B.jsx)(qe.Z,{}),allowClear:!0,onChange:o,onBlur:function(){null!=s&&s.trim()||v(!1)},value:s}):(0,B.jsx)(pe.ZP,{icon:(0,B.jsx)(qe.Z,{}),onClick:function(){v(!0)}}),(0,B.jsx)(O.Z,{content:N,placement:"bottom",arrow:!1,children:(0,B.jsx)(pe.ZP,{icon:(0,B.jsx)(ye,{})})}),(0,B.jsx)(pe.ZP,{icon:(0,B.jsx)(fe.Z,{}),type:"primary",onClick:function(){return a()}})]})]})},Ke=t(48054),Ue=t(91492),Ge=t(60806);var He=t(96449),Qe=t(4772),Re="documentContainer___TU9k2",Ve=function(e){var n=e.comment;return n.text?(0,B.jsxs)("div",{className:"Highlight__popup",children:[n.emoji," ",n.text]}):null},We=function(e){var n,t=e.highlights,a=e.setWidthAndHeight,i=(n=(0,Z.pE)().documentId,(0,_.useMemo)((function(){return"".concat(Ge.N,"/document/get/").concat(n)}),[n])),c=(0,_.useRef)((function(){})),u=(0,He.s)(i),l=function(){};return(0,_.useEffect)((function(){t.length>0&&(null==c||c.current(t[0]))}),[t]),(0,B.jsx)("div",{className:Re,children:(0,B.jsx)(Ue.Hz,{url:i,beforeLoad:(0,B.jsx)(Ke.Z,{active:!0}),workerSrc:"/pdfjs-dist/pdf.worker.min.js",errorMessage:(0,B.jsx)(Qe.Z,{children:u}),children:function(e){return e.getPage(1).then((function(e){var n=e.getViewport({scale:1}),t=n.width,r=n.height;a(t,r)})),(0,B.jsx)(Ue.Nb,{pdfDocument:e,enableAreaSelection:function(e){return e.altKey},onScrollChange:l,scrollRef:function(e){c.current=e},onSelectionFinished:function(){return null},highlightTransform:function(e,n,t,a,i,c,u){var l=!Boolean(e.content&&e.content.image)?(0,B.jsx)(Ue.y$,{isScrolledTo:u,position:e.position,comment:e.comment}):(0,B.jsx)(Ue.PD,{isScrolledTo:u,highlight:e,onChange:function(){}});return(0,B.jsx)(Ue.GI,{popupContent:(0,B.jsx)(Ve,r()({},e)),onMouseOver:function(n){return t(e,(function(){return n}))},onMouseOut:a,children:l},n)},highlights:t})}})})},Be=(0,_.memo)(We),$e="chunkPage___Mlm1d",Je="pagePdfWrapper___NxUun",Xe="pageWrapper___wkiwd",Ye="pageContent___fubpP",en="spin___OiDil",nn="documentPreview___tbu9J",tn="chunkContainer___m_m6K",an="chunkOtherContainer___bj5TE",rn="pageFooter___O05bO",cn=function(){var e=(0,_.useState)([]),n=k()(e,2),t=n[0],a=n[1],i=ie().removeChunk,u=function(){var e,n=(0,b.ye)(),t=n.pagination,a=n.setPagination,r=(0,Z.pE)().documentId,i=(0,b.Qe)(),c=i.searchString,u=i.handleInputChange,s=(0,_.useState)(),d=k()(s,2),h=d[0],f=d[1],m=(0,x.Z)(c,{wait:500}),v=(0,p.a)({queryKey:["fetchChunkList",r,t.current,t.pageSize,m,h],placeholderData:function(e){return null!=e?e:{data:[],total:0,documentInfo:{}}},gcTime:0,queryFn:(e=o()(l()().mark((function e(){var n,a,i,u;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g.ZP.chunk_list({doc_id:r,page:t.current,size:t.pageSize,available_int:h,keywords:c});case 2:if(a=e.sent,0!==(i=a.data).code){e.next=7;break}return u=i.data,e.abrupt("return",{data:u.chunks,total:u.total,documentInfo:u.doc});case 7:return e.abrupt("return",null!==(n=null==i?void 0:i.data)&&void 0!==n?n:{data:[],total:0,documentInfo:{}});case 8:case"end":return e.stop()}}),e)}))),function(){return e.apply(this,arguments)})}),C=v.data,j=v.isFetching,w=(0,_.useCallback)((function(e){a({page:1}),u(e)}),[u,a]),y=(0,_.useCallback)((function(e){a({page:1}),f(e)}),[f,a]);return{data:C,loading:j,pagination:t,setPagination:a,searchString:c,handleInputChange:w,available:h,handleSetAvailable:y}}(),s=u.data,d=s.documentInfo,f=s.data,w=void 0===f?[]:f,M=s.total,q=u.pagination,A=u.loading,E=u.searchString,O=u.handleInputChange,T=u.available,L=u.handleSetAvailable,D=function(){var e=(0,_.useState)(""),n=k()(e,2),t=n[0],a=n[1];return{handleChunkCardClick:(0,_.useCallback)((function(e){a(e)}),[]),selectedChunkId:t}}(),K=D.handleChunkCardClick,U=D.selectedChunkId,G="pdf"===(null==d?void 0:d.type),H=(0,j.$G)().t,Q=function(){var e=(0,_.useState)(z.Full),n=k()(e,2),t=n[0],a=n[1];return{textMode:t,changeChunkTextMode:(0,_.useCallback)((function(e){a(e)}),[])}}(),R=Q.changeChunkTextMode,V=Q.textMode,W=function(){var e,n=(0,j.$G)().t,t=(0,m.NL)(),a=(0,v.D)({mutationKey:["switchChunk"],mutationFn:(e=o()(l()().mark((function e(a){var r,i;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g.ZP.switch_chunk(a);case 2:return r=e.sent,0===(i=r.data).code&&(C.ZP.success(n("message.modified")),t.invalidateQueries({queryKey:["fetchChunkList"]})),e.abrupt("return",null==i?void 0:i.code);case 6:case"end":return e.stop()}}),e)}))),function(n){return e.apply(this,arguments)})});return{data:a.data,loading:a.isPending,switchChunk:a.mutateAsync}}(),J=W.switchChunk,X=ce(),Y=X.chunkUpdatingLoading,ee=X.onChunkUpdatingOk,ne=X.showChunkUpdatingModal,te=X.hideChunkUpdatingModal,ae=X.chunkId,ue=X.chunkUpdatingVisible,le=X.documentId,se=(0,_.useCallback)((function(e){a(e?w.map((function(e){return e.chunk_id})):[])}),[w]),oe=(0,_.useCallback)((function(e,n){a((function(t){var a=t.findIndex((function(n){return n===e})),r=h()(t);return n&&-1===a?r.push(e):n||-1===a||r.splice(a,1),r}))}),[]),de=(0,_.useCallback)((function(){C.ZP.warning(H("message.pleaseSelectChunk"))}),[H]),he=(0,_.useCallback)(o()(l()().mark((function e(){return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.length>0)){e.next=7;break}return e.next=3,i(t,le);case 3:0===e.sent&&a([]),e.next=8;break;case 7:de();case 8:case"end":return e.stop()}}),e)}))),[t,le,i,de]),fe=(0,_.useCallback)(function(){var e=o()(l()().mark((function e(n,a){var r;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a,a){e.next=6;break}if(r=t,0!==t.length){e.next=6;break}return de(),e.abrupt("return");case 6:return e.next=8,J({chunk_ids:r,available_int:n,doc_id:le});case 8:e.sent;case 10:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}(),[J,le,t,de]),ke=re(U),ge=ke.highlights,pe=ke.setWidthAndHeight;return(0,B.jsxs)(B.Fragment,{children:[(0,B.jsxs)("div",{className:$e,children:[(0,B.jsx)(ze,{selectAllChunk:se,createChunk:ne,removeChunk:he,checked:t.length===w.length,switchChunk:fe,changeChunkTextMode:R,searchString:E,handleInputChange:O,available:T,handleSetAvailable:L}),(0,B.jsx)(y.Z,{}),(0,B.jsxs)(I.Z,{flex:1,gap:"middle",children:[(0,B.jsxs)(I.Z,{vertical:!0,className:G?Je:Xe,children:[(0,B.jsx)(P.Z,{spinning:A,className:en,size:"large",children:(0,B.jsx)("div",{className:Ye,children:(0,B.jsx)(S.Z,{direction:"vertical",size:"middle",className:F()(tn,c()({},an,!G)),children:w.map((function(e){return(0,B.jsx)($,{item:e,editChunk:ne,checked:t.some((function(n){return n===e.chunk_id})),handleCheckboxClick:oe,switchChunk:fe,clickChunkCard:K,selected:e.chunk_id===U,textMode:V},e.chunk_id)}))})})}),(0,B.jsx)("div",{className:rn,children:(0,B.jsx)(N.Z,r()(r()({},q),{},{total:M,size:"small",onChange:function(e,n){var t;a([]),null===(t=q.onChange)||void 0===t||t.call(q,e,n)}}))})]}),G&&(0,B.jsx)("section",{className:nn,children:(0,B.jsx)(Be,{highlights:ge,setWidthAndHeight:pe})})]})]}),ue&&(0,B.jsx)(Ce,{doc_id:le,chunkId:ae,hideModal:te,visible:ue,loading:Y,onOk:ee,parserId:d.parser_id})]})}},4772:function(e,n,t){"use strict";t.d(n,{Z:function(){return l}});var a=t(86250),r=t(38925),i=t(86968),c=(t(67294),"errorWrapper___QfVXQ"),u=t(85893),l=function(e){var n=e.children,t=(0,i.qM)("fileManager").t;return(0,u.jsx)(a.Z,{align:"center",justify:"center",className:c,children:(0,u.jsx)(r.Z,{type:"error",message:(0,u.jsx)("h2",{children:n||t("fileError")})})})}},5089:function(e,n,t){"use strict";t.d(n,{Ep:function(){return d},Or:function(){return h},RT:function(){return s},YC:function(){return o},q1:function(){return l}});var a=t(19632),r=t.n(a),i=t(40169),c=t(96486),u=t(57632),l=function(e,n){var t;return Array.isArray(null==e?void 0:e.positions)&&e.positions.every((function(e){return Array.isArray(e)}))?null==e||null===(t=e.positions)||void 0===t?void 0:t.map((function(t){var a={width:n.width,height:n.height,x1:t[1],x2:t[2],y1:t[3],y2:t[4]};return{id:(0,u.Z)(),comment:{text:"",emoji:""},content:{text:(0,c.get)(e,"content_with_weight")||(0,c.get)(e,"content","")},position:{boundingRect:a,rects:[a],pageNumber:t[0]}}})):[]},s=function(e){var n;return null!==(n=null==e?void 0:e.slice(e.lastIndexOf(".")+1).toLowerCase())&&void 0!==n?n:""},o=function(e){return e.split("\n").length},d=function(e){return i.ru.includes(e)},h=function(e){return[].concat(r()(i.rU),["svg"]).some((function(n){return n===e}))}},14601:function(){},32767:function(){},28251:function(){},57677:function(){},1543:function(){},87324:function(){}}]);
//# sourceMappingURL=p__add-knowledge__components__knowledge-chunk__index.aca24c23.async.js.map